<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Service Workers Nightly</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet" type="text/css">
  <meta content="Bikeshed version e53c08d6a8d54a53d3f70722e296386143aea2a0" name="generator">
  <link href="https://www.w3.org/TR/service-workers/" rel="canonical">
  <meta content="9f28ebffef9a944245859f3600afd0e52cba3783" name="document-revision">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Service Workers Nightly</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2018-04-24">24 April 2018</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/service-workers/">https://www.w3.org/TR/service-workers/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/ServiceWorker/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:slightlyoff@chromium.org">Alex Russell</a> (<span class="p-org org">Google</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jungkee.song@samsung.com">Jungkee Song</a> (<span class="p-org org">Samsung Electronics</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jakearchibald@chromium.org">Jake Archibald</a> (<span class="p-org org">Google</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:mek@chromium.org">Marijn Kruisselbrink</a> (<span class="p-org org">Google</span>)
     <dt>Tests:
     <dd><a href="https://github.com/w3c/web-platform-tests/tree/master/service-workers">web-platform-tests service-workers/</a> (<a href="https://github.com/w3c/web-platform-tests/labels/service-workers">ongoing work</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2018 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification describes a method that enables applications to take advantage of persistent background processing, including hooks to enable bootstrapping of web applications while offline.</p>
   <p>The core of this system is an event-driven <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#workers" id="ref-for-workers">Web Worker</a>, which responds to events dispatched from documents and other sources. A system for managing installation, versions, and upgrades is provided.</p>
   <p>The service worker is a generic entry point for event-driven background processing in the Web Platform that is <a href="#extensibility">extensible by other specifications</a>.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em> </p>
   <p> This document was published by the <a href="https://www.w3.org/sw/">Service Workers Working Group</a> as an Editors Draft. This document is intended to become a W3C Recommendation. </p>
   <p></p>
   <p>This is a living document. Readers need to be aware that this specification may include unimplemented features, and details that may change. <a href="https://w3c.github.io/ServiceWorker/v1/">Service Workers 1</a> is a version that is advancing toward a W3C Recommendation.</p>
   <p></p>
   <p> Feedback and comments on this specification are welcome, please send them to <a href="mailto:public-webapps@w3.org?subject=%5Bservice-workers%5D">public-webapps@w3.org</a> (<a href="mailto:public-webapps@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-webapps/">archives</a>) with <code>[service-workers]</code> at the start of your email’s subject. </p>
   <p> Publication as an Editors Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may
    be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite
    this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="https://www.w3.org/2004/01/pp-impl/101220/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/2018/Process-20180201/" id="w3c_process_revision">1 February 2018 W3C Process Document</a>. </p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#motivations"><span class="secno">1</span> <span class="content">Motivations</span></a>
    <li>
     <a href="#model"><span class="secno">2</span> <span class="content">Model</span></a>
     <ol class="toc">
      <li>
       <a href="#service-worker-concept"><span class="secno">2.1</span> <span class="content">Service Worker</span></a>
       <ol class="toc">
        <li><a href="#service-worker-lifetime"><span class="secno">2.1.1</span> <span class="content">Lifetime</span></a>
       </ol>
      <li>
       <a href="#service-worker-registration-concept"><span class="secno">2.2</span> <span class="content">Service Worker Registration</span></a>
       <ol class="toc">
        <li><a href="#service-worker-registration-lifetime"><span class="secno">2.2.1</span> <span class="content">Lifetime</span></a>
       </ol>
      <li><a href="#service-worker-client-concept"><span class="secno">2.3</span> <span class="content">Service Worker Client</span></a>
      <li><a href="#selection"><span class="secno">2.4</span> <span class="content">Selection and Use</span></a>
      <li><a href="#task-sources"><span class="secno">2.5</span> <span class="content">Task Sources</span></a>
      <li><a href="#user-agent-shutdown"><span class="secno">2.6</span> <span class="content">User Agent Shutdown</span></a>
     </ol>
    <li>
     <a href="#document-context"><span class="secno">3</span> <span class="content">Client Context</span></a>
     <ol class="toc">
      <li>
       <a href="#serviceworker-interface"><span class="secno">3.1</span> <span class="content"><code class="idl"><span>ServiceWorker</span></code></span></a>
       <ol class="toc">
        <li><a href="#service-worker-url"><span class="secno">3.1.1</span> <span class="content"><code class="idl"><span>scriptURL</span></code></span></a>
        <li><a href="#service-worker-state"><span class="secno">3.1.2</span> <span class="content"><code class="idl"><span>state</span></code></span></a>
        <li><a href="#service-worker-postmessage"><span class="secno">3.1.3</span> <span class="content"><code class="idl"><span>postMessage(message, transfer)</span></code></span></a>
        <li><a href="#service-worker-event-handler"><span class="secno">3.1.4</span> <span class="content">Event handler</span></a>
       </ol>
      <li>
       <a href="#serviceworkerregistration-interface"><span class="secno">3.2</span> <span class="content"><code class="idl"><span>ServiceWorkerRegistration</span></code></span></a>
       <ol class="toc">
        <li><a href="#navigator-service-worker-installing"><span class="secno">3.2.1</span> <span class="content"><code class="idl"><span>installing</span></code></span></a>
        <li><a href="#navigator-service-worker-waiting"><span class="secno">3.2.2</span> <span class="content"><code class="idl"><span>waiting</span></code></span></a>
        <li><a href="#navigator-service-worker-active"><span class="secno">3.2.3</span> <span class="content"><code class="idl"><span>active</span></code></span></a>
        <li><a href="#service-worker-registration-navigationpreload"><span class="secno">3.2.4</span> <span class="content"><code class="idl"><span>navigationPreload</span></code></span></a>
        <li><a href="#service-worker-registration-scope"><span class="secno">3.2.5</span> <span class="content"><code class="idl"><span>scope</span></code></span></a>
        <li><a href="#service-worker-registration-updateviacache"><span class="secno">3.2.6</span> <span class="content"><code class="idl"><span>updateViaCache</span></code></span></a>
        <li><a href="#service-worker-registration-update"><span class="secno">3.2.7</span> <span class="content"><code class="idl"><span>update()</span></code></span></a>
        <li><a href="#navigator-service-worker-unregister"><span class="secno">3.2.8</span> <span class="content"><code class="idl"><span>unregister()</span></code></span></a>
        <li><a href="#service-worker-registration-event-handler"><span class="secno">3.2.9</span> <span class="content">Event handler</span></a>
       </ol>
      <li><a href="#navigator-serviceworker"><span class="secno">3.3</span> <span class="content"><code class="idl"><span>navigator.serviceWorker</span></code></span></a>
      <li>
       <a href="#serviceworkercontainer-interface"><span class="secno">3.4</span> <span class="content"><code class="idl"><span>ServiceWorkerContainer</span></code></span></a>
       <ol class="toc">
        <li><a href="#navigator-service-worker-controller"><span class="secno">3.4.1</span> <span class="content"><code class="idl"><span>controller</span></code></span></a>
        <li><a href="#navigator-service-worker-ready"><span class="secno">3.4.2</span> <span class="content"><code class="idl"><span>ready</span></code></span></a>
        <li><a href="#navigator-service-worker-register"><span class="secno">3.4.3</span> <span class="content"><code class="idl"><span>register(scriptURL, options)</span></code></span></a>
        <li><a href="#navigator-service-worker-getRegistration"><span class="secno">3.4.4</span> <span class="content"><code class="idl"><span>getRegistration(clientURL)</span></code></span></a>
        <li><a href="#navigator-service-worker-getRegistrations"><span class="secno">3.4.5</span> <span class="content"><code class="idl"><span>getRegistrations()</span></code></span></a>
        <li><a href="#navigator-service-worker-startMessages"><span class="secno">3.4.6</span> <span class="content"><code class="idl"><span>startMessages()</span></code></span></a>
        <li><a href="#service-worker-container-event-handlers"><span class="secno">3.4.7</span> <span class="content">Event handlers</span></a>
       </ol>
      <li><a href="#document-context-events"><span class="secno">3.5</span> <span class="content">Events</span></a>
      <li>
       <a href="#navigation-preload-manager"><span class="secno">3.6</span> <span class="content"><code class="idl"><span>NavigationPreloadManager</span></code></span></a>
       <ol class="toc">
        <li><a href="#navigation-preload-manager-enable"><span class="secno">3.6.1</span> <span class="content"><code class="idl"><span>enable()</span></code></span></a>
        <li><a href="#navigation-preload-manager-disable"><span class="secno">3.6.2</span> <span class="content"><code class="idl"><span>disable()</span></code></span></a>
        <li><a href="#navigation-preload-manager-setheadervalue"><span class="secno">3.6.3</span> <span class="content"><code class="idl"><span>setHeaderValue(value)</span></code></span></a>
        <li><a href="#navigation-preload-manager-getstate"><span class="secno">3.6.4</span> <span class="content"><code class="idl"><span>getState()</span></code></span></a>
       </ol>
     </ol>
    <li>
     <a href="#execution-context"><span class="secno">4</span> <span class="content">Execution Context</span></a>
     <ol class="toc">
      <li>
       <a href="#serviceworkerglobalscope-interface"><span class="secno">4.1</span> <span class="content"><code class="idl"><span>ServiceWorkerGlobalScope</span></code></span></a>
       <ol class="toc">
        <li><a href="#service-worker-global-scope-clients"><span class="secno">4.1.1</span> <span class="content"><code class="idl"><span>clients</span></code></span></a>
        <li><a href="#service-worker-global-scope-registration"><span class="secno">4.1.2</span> <span class="content"><code class="idl"><span>registration</span></code></span></a>
        <li><a href="#service-worker-global-scope-skipwaiting"><span class="secno">4.1.3</span> <span class="content"><code class="idl"><span>skipWaiting()</span></code></span></a>
        <li><a href="#service-worker-global-scope-event-handlers"><span class="secno">4.1.4</span> <span class="content">Event handlers</span></a>
       </ol>
      <li>
       <a href="#client-interface"><span class="secno">4.2</span> <span class="content"><code class="idl"><span>Client</span></code></span></a>
       <ol class="toc">
        <li><a href="#client-url"><span class="secno">4.2.1</span> <span class="content"><code class="idl"><span>url</span></code></span></a>
        <li><a href="#client-id"><span class="secno">4.2.2</span> <span class="content"><code class="idl"><span>id</span></code></span></a>
        <li><a href="#client-type"><span class="secno">4.2.3</span> <span class="content"><code class="idl"><span>type</span></code></span></a>
        <li><a href="#client-postmessage"><span class="secno">4.2.4</span> <span class="content"><code class="idl"><span>postMessage(message, transfer)</span></code></span></a>
        <li><a href="#client-visibilitystate"><span class="secno">4.2.5</span> <span class="content"><code class="idl"><span>visibilityState</span></code></span></a>
        <li><a href="#client-focused"><span class="secno">4.2.6</span> <span class="content"><code class="idl"><span>focused</span></code></span></a>
        <li><a href="#client-ancestororigins"><span class="secno">4.2.7</span> <span class="content"><code class="idl"><span>ancestorOrigins</span></code></span></a>
        <li><a href="#client-focus"><span class="secno">4.2.8</span> <span class="content"><code class="idl"><span>focus()</span></code></span></a>
        <li><a href="#client-navigate"><span class="secno">4.2.9</span> <span class="content"><code class="idl"><span>navigate(url)</span></code></span></a>
       </ol>
      <li>
       <a href="#clients-interface"><span class="secno">4.3</span> <span class="content"><code class="idl"><span>Clients</span></code></span></a>
       <ol class="toc">
        <li><a href="#clients-get"><span class="secno">4.3.1</span> <span class="content"><code class="idl"><span>get(id)</span></code></span></a>
        <li><a href="#clients-matchall"><span class="secno">4.3.2</span> <span class="content"><code class="idl"><span>matchAll(options)</span></code></span></a>
        <li><a href="#clients-openwindow"><span class="secno">4.3.3</span> <span class="content"><code class="idl"><span>openWindow(url)</span></code></span></a>
        <li><a href="#clients-claim"><span class="secno">4.3.4</span> <span class="content"><code class="idl"><span>claim()</span></code></span></a>
       </ol>
      <li>
       <a href="#extendableevent-interface"><span class="secno">4.4</span> <span class="content"><code class="idl"><span>ExtendableEvent</span></code></span></a>
       <ol class="toc">
        <li><a href="#wait-until-method"><span class="secno">4.4.1</span> <span class="content"><code class="idl"><span>event.waitUntil(f)</span></code></span></a>
       </ol>
      <li>
       <a href="#fetchevent-interface"><span class="secno">4.5</span> <span class="content"><code class="idl"><span>FetchEvent</span></code></span></a>
       <ol class="toc">
        <li><a href="#fetch-event-request"><span class="secno">4.5.1</span> <span class="content"><code class="idl"><span>event.request</span></code></span></a>
        <li><a href="#fetch-event-preloadresponse"><span class="secno">4.5.2</span> <span class="content"><code class="idl"><span>event.preloadResponse</span></code></span></a>
        <li><a href="#fetch-event-clientid"><span class="secno">4.5.3</span> <span class="content"><code class="idl"><span>event.clientId</span></code></span></a>
        <li><a href="#fetch-event-resultingclientid"><span class="secno">4.5.4</span> <span class="content"><code class="idl"><span>event.resultingClientId</span></code></span></a>
        <li><a href="#fetch-event-targetclientid"><span class="secno">4.5.5</span> <span class="content"><code class="idl"><span>event.targetClientId</span></code></span></a>
        <li><a href="#fetch-event-respondwith"><span class="secno">4.5.6</span> <span class="content"><code class="idl"><span>event.respondWith(r)</span></code></span></a>
       </ol>
      <li>
       <a href="#extendablemessageevent-interface"><span class="secno">4.6</span> <span class="content"><code class="idl"><span>ExtendableMessageEvent</span></code></span></a>
       <ol class="toc">
        <li><a href="#extendablemessage-event-data"><span class="secno">4.6.1</span> <span class="content"><code class="idl"><span>event.data</span></code></span></a>
        <li><a href="#extendablemessage-event-origin"><span class="secno">4.6.2</span> <span class="content"><code class="idl"><span>event.origin</span></code></span></a>
        <li><a href="#extendablemessage-event-lasteventid"><span class="secno">4.6.3</span> <span class="content"><code class="idl"><span>event.lastEventId</span></code></span></a>
        <li><a href="#extendablemessage-event-source"><span class="secno">4.6.4</span> <span class="content"><code class="idl"><span>event.source</span></code></span></a>
        <li><a href="#extendablemessage-event-ports"><span class="secno">4.6.5</span> <span class="content"><code class="idl"><span>event.ports</span></code></span></a>
       </ol>
      <li><a href="#execution-context-events"><span class="secno">4.7</span> <span class="content">Events</span></a>
     </ol>
    <li>
     <a href="#cache-objects"><span class="secno">5</span> <span class="content">Caches</span></a>
     <ol class="toc">
      <li><a href="#cache-constructs"><span class="secno">5.1</span> <span class="content">Constructs</span></a>
      <li><a href="#cache-lifetimes"><span class="secno">5.2</span> <span class="content">Understanding Cache Lifetimes</span></a>
      <li>
       <a href="#self-caches"><span class="secno">5.3</span> <span class="content"><code class="idl"><span>self.caches</span></code></span></a>
       <ol class="toc">
        <li><a href="#global-caches"><span class="secno">5.3.1</span> <span class="content"><code class="idl"><span>caches</span></code></span></a>
       </ol>
      <li>
       <a href="#cache-interface"><span class="secno">5.4</span> <span class="content"><code class="idl"><span>Cache</span></code></span></a>
       <ol class="toc">
        <li><a href="#cache-match"><span class="secno">5.4.1</span> <span class="content"><code class="idl"><span>match(request, options)</span></code></span></a>
        <li><a href="#cache-matchall"><span class="secno">5.4.2</span> <span class="content"><code class="idl"><span>matchAll(request, options)</span></code></span></a>
        <li><a href="#cache-add"><span class="secno">5.4.3</span> <span class="content"><code class="idl"><span>add(request)</span></code></span></a>
        <li><a href="#cache-addAll"><span class="secno">5.4.4</span> <span class="content"><code class="idl"><span>addAll(requests)</span></code></span></a>
        <li><a href="#cache-put"><span class="secno">5.4.5</span> <span class="content"><code class="idl"><span>put(request, response)</span></code></span></a>
        <li><a href="#cache-delete"><span class="secno">5.4.6</span> <span class="content"><code class="idl"><span>delete(request, options)</span></code></span></a>
        <li><a href="#cache-keys"><span class="secno">5.4.7</span> <span class="content"><code class="idl"><span>keys(request, options)</span></code></span></a>
       </ol>
      <li>
       <a href="#cachestorage-interface"><span class="secno">5.5</span> <span class="content"><code class="idl"><span>CacheStorage</span></code></span></a>
       <ol class="toc">
        <li><a href="#cache-storage-match"><span class="secno">5.5.1</span> <span class="content"><code class="idl"><span>match(request, options)</span></code></span></a>
        <li><a href="#cache-storage-has"><span class="secno">5.5.2</span> <span class="content"><code class="idl"><span>has(cacheName)</span></code></span></a>
        <li><a href="#cache-storage-open"><span class="secno">5.5.3</span> <span class="content"><code class="idl"><span>open(cacheName)</span></code></span></a>
        <li><a href="#cache-storage-delete"><span class="secno">5.5.4</span> <span class="content"><code class="idl"><span>delete(cacheName)</span></code></span></a>
        <li><a href="#cache-storage-keys"><span class="secno">5.5.5</span> <span class="content"><code class="idl"><span>keys()</span></code></span></a>
       </ol>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">6</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#secure-context"><span class="secno">6.1</span> <span class="content">Secure Context</span></a>
      <li><a href="#content-security-policy"><span class="secno">6.2</span> <span class="content">Content Security Policy</span></a>
      <li>
       <a href="#origin-relativity"><span class="secno">6.3</span> <span class="content">Origin Relativity</span></a>
       <ol class="toc">
        <li><a href="#origin-restriction"><span class="secno">6.3.1</span> <span class="content">Origin restriction</span></a>
        <li><a href="#importscripts"><span class="secno">6.3.2</span> <span class="content"><code class="idl"><span>importScripts(urls)</span></code></span></a>
       </ol>
      <li><a href="#cross-origin-resources"><span class="secno">6.4</span> <span class="content">Cross-Origin Resources and CORS</span></a>
      <li><a href="#implementer-concerns"><span class="secno">6.5</span> <span class="content">Implementer Concerns</span></a>
      <li><a href="#privacy"><span class="secno">6.6</span> <span class="content">Privacy</span></a>
     </ol>
    <li>
     <a href="#extensibility"><span class="secno">7</span> <span class="content">Extensibility</span></a>
     <ol class="toc">
      <li><a href="#extension-to-service-worker-registration"><span class="secno">7.1</span> <span class="content">Define API bound to Service Worker Registration</span></a>
      <li><a href="#extension-to-extendable-event"><span class="secno">7.2</span> <span class="content">Define Functional Event</span></a>
      <li><a href="#extension-to-service-worker-global-scope"><span class="secno">7.3</span> <span class="content">Define Event Handler</span></a>
      <li><a href="#request-functional-event-dispatch"><span class="secno">7.4</span> <span class="content">Request Functional Event Dispatch</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno"></span> <span class="content">Appendix A: Algorithms</span></a>
     <ol class="toc">
      <li><a href="#create-job-algorithm"><span class="secno"></span> <span class="content"><span>Create Job</span></span></a>
      <li><a href="#schedule-job-algorithm"><span class="secno"></span> <span class="content"><span>Schedule Job</span></span></a>
      <li><a href="#run-job-algorithm"><span class="secno"></span> <span class="content"><span>Run Job</span></span></a>
      <li><a href="#finish-job-algorithm"><span class="secno"></span> <span class="content"><span>Finish Job</span></span></a>
      <li><a href="#resolve-job-promise-algorithm"><span class="secno"></span> <span class="content"><span>Resolve Job Promise</span></span></a>
      <li><a href="#reject-job-promise-algorithm"><span class="secno"></span> <span class="content"><span>Reject Job Promise</span></span></a>
      <li><a href="#start-register-algorithm"><span class="secno"></span> <span class="content"><span>Start Register</span></span></a>
      <li><a href="#register-algorithm"><span class="secno"></span> <span class="content"><span>Register</span></span></a>
      <li><a href="#update-algorithm"><span class="secno"></span> <span class="content"><span>Update</span></span></a>
      <li><a href="#soft-update-algorithm"><span class="secno"></span> <span class="content"><span>Soft Update</span></span></a>
      <li><a href="#installation-algorithm"><span class="secno"></span> <span class="content"><span>Install</span></span></a>
      <li><a href="#activation-algorithm"><span class="secno"></span> <span class="content"><span>Activate</span></span></a>
      <li><a href="#try-activate-algorithm"><span class="secno"></span> <span class="content"><span>Try Activate</span></span></a>
      <li><a href="#run-service-worker-algorithm"><span class="secno"></span> <span class="content"><span>Run Service Worker</span></span></a>
      <li><a href="#terminate-service-worker-algorithm"><span class="secno"></span> <span class="content"><span>Terminate Service Worker</span></span></a>
      <li><a href="#on-fetch-request-algorithm"><span class="secno"></span> <span class="content"><span>Handle Fetch</span></span></a>
      <li><a href="#handle-functional-event-algorithm"><span class="secno"></span> <span class="content"><span>Handle Functional Event</span></span></a>
      <li><a href="#on-client-unload-algorithm"><span class="secno"></span> <span class="content"><span>Handle Service Worker Client Unload</span></span></a>
      <li><a href="#on-user-agent-shutdown-algorithm"><span class="secno"></span> <span class="content"><span>Handle User Agent Shutdown</span></span></a>
      <li><a href="#update-service-worker-extended-events-set-algorithm"><span class="secno"></span> <span class="content"><span>Update Service Worker Extended Events Set</span></span></a>
      <li><a href="#unregister-algorithm"><span class="secno"></span> <span class="content"><span>Unregister</span></span></a>
      <li><a href="#set-registration-algorithm"><span class="secno"></span> <span class="content"><span>Set Registration</span></span></a>
      <li><a href="#clear-registration-algorithm"><span class="secno"></span> <span class="content"><span>Clear Registration</span></span></a>
      <li><a href="#try-clear-registration-algorithm"><span class="secno"></span> <span class="content"><span>Try Clear Registration</span></span></a>
      <li><a href="#update-registration-state-algorithm"><span class="secno"></span> <span class="content"><span>Update Registration State</span></span></a>
      <li><a href="#update-state-algorithm"><span class="secno"></span> <span class="content"><span>Update Worker State</span></span></a>
      <li><a href="#notify-controller-change-algorithm"><span class="secno"></span> <span class="content"><span>Notify Controller Change</span></span></a>
      <li><a href="#scope-match-algorithm"><span class="secno"></span> <span class="content"><span>Match Service Worker Registration</span></span></a>
      <li><a href="#get-registration-algorithm"><span class="secno"></span> <span class="content"><span>Get Registration</span></span></a>
      <li><a href="#get-newest-worker-algorithm"><span class="secno"></span> <span class="content"><span>Get Newest Worker</span></span></a>
      <li><a href="#service-worker-has-no-pending-events-algorithm"><span class="secno"></span> <span class="content"><span>Service Worker Has No Pending Events</span></span></a>
      <li><a href="#create-client-algorithm"><span class="secno"></span> <span class="content"><span>Create Client</span></span></a>
      <li><a href="#create-windowclient-algorithm"><span class="secno"></span> <span class="content"><span>Create Window Client</span></span></a>
      <li><a href="#query-cache-algorithm"><span class="secno"></span> <span class="content"><span>Query Cache</span></span></a>
      <li><a href="#batch-cache-operations-algorithm"><span class="secno"></span> <span class="content"><span>Batch Cache Operations</span></span></a>
     </ol>
    <li>
     <a href="#extended-http-headers"><span class="secno"></span> <span class="content">Appendix B: Extended HTTP headers</span></a>
     <ol class="toc">
      <li><a href="#service-worker-script-request"><span class="secno"></span> <span class="content">Service Worker Script Request</span></a>
      <li><a href="#service-worker-script-response"><span class="secno"></span> <span class="content">Service Worker Script Response</span></a>
      <li><a href="#syntax"><span class="secno"></span> <span class="content">Syntax</span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">8</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="motivations"><span class="secno">1. </span><span class="content">Motivations</span><a class="self-link" href="#motivations"></a></h2>
    <p><em>This section is non-normative.</em></p>
    <p>Web Applications traditionally assume that the network is reachable. This assumption pervades the platform. HTML documents are loaded over HTTP and traditionally fetch all of their sub-resources via subsequent HTTP requests. This places web content at a disadvantage versus other technology stacks.</p>
    <p>The <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker">service worker</a> is designed first to redress this balance by providing a Web Worker context, which can be started by a runtime when navigations are about to occur. This event-driven worker is registered against an origin and a path (or pattern), meaning it can be consulted when navigations occur to that location. Events that correspond to network requests are dispatched to the worker and the responses generated by the worker may override default network stack behavior. This puts the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①">service worker</a>, conceptually, between the network and a document renderer, allowing the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②">service worker</a> to provide content for documents, even while offline.</p>
    <p>Web developers familiar with previous attempts to solve the offline problem have reported a deficit of flexibility in those solutions. As a result, the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③">service worker</a> is highly procedural, providing a maximum of flexibility at the price of additional complexity for developers. Part of this complexity arises from the need to keep <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④">service workers</a> responsive in the face of a single-threaded execution model. As a result, APIs exposed by <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤">service workers</a> are almost entirely asynchronous, a pattern familiar in other JavaScript contexts but accentuated here by the need to avoid blocking document and resource loading.</p>
    <p>Developers using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/offline.html#application-cache" id="ref-for-application-cache">HTML5 Application Cache</a> have also <a href="http://alistapart.com/article/application-cache-is-a-douchebag">reported that several attributes</a> of the design contribute to <a href="http://alistapart.com/article/application-cache-is-a-douchebag#section6">unrecoverable errors</a>. A key design principle of the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥">service worker</a> is that errors should <em>always</em> be recoverable. Many details of the update process of <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦">service workers</a> are designed to avoid these hazards.</p>
    <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧">Service workers</a> are started and kept alive by their relationship to events, not documents. This design borrows heavily from developer and vendor experience with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#shared-workers" id="ref-for-shared-workers">Shared Workers</a> and <a href="https://developer.chrome.com/extensions/background_pages">Chrome Background Pages</a>. A key lesson from these systems is the necessity to time-limit the execution of background processing contexts, both to conserve resources and to ensure that background context loss and restart is top-of-mind for developers. As a result, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨">service workers</a> bear more than a passing resemblance to <a href="https://developer.chrome.com/extensions/event_pages">Chrome Event Pages</a>, the successor to Background Pages. <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪">Service workers</a> may be started by user agents <em>without an attached document</em> and may be killed by the user agent at nearly any time. Conceptually, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①①">service workers</a> can be thought of as Shared Workers that can start, process events, and die without ever handling messages from documents. Developers are advised to keep in mind that <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①②">service workers</a> may be started and killed many times a second.</p>
    <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①③">Service workers</a> are generic, event-driven, time-limited script contexts that run at an origin. These properties make them natural endpoints for a range of runtime services that may outlive the context of a particular document, e.g. handling push notifications, background data synchronization, responding to resource requests from other origins, or receiving centralized updates to expensive-to-calculate data (e.g., geolocation or gyroscope).</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="model"><span class="secno">2. </span><span class="content">Model</span><a class="self-link" href="#model"></a></h2>
    <section>
     <h3 class="heading settled" data-level="2.1" id="service-worker-concept"><span class="secno">2.1. </span><span class="content">Service Worker</span><a class="self-link" href="#service-worker-concept"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-for="" data-dfn-type="dfn" data-export="" id="dfn-service-worker">service worker</dfn> is a type of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#workers" id="ref-for-workers①">web worker</a>. A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①④">service worker</a> executes in the registering <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a>.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⑤">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-state">state</dfn>, which is one of <em>parsed</em>, <em>installing</em>, <em>installed</em>, <em>activating</em>, <em>activated</em>, and <em>redundant</em>. It is initially <em>parsed</em>.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⑥">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-script-url">script url</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>).</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⑦">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-type">type</dfn> which is either "<code>classic</code>" or "<code>module</code>". Unless stated otherwise, it is "<code>classic</code>".</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⑧">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" data-lt="registration|containing service worker registration" id="dfn-containing-service-worker-registration">containing service worker registration</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration">service worker registration</a>), which contains itself.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⑨">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-service-worker-global-object">global object</dfn> (a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope">ServiceWorkerGlobalScope</a></code> object or null).</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⓪">service worker</a> has <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-lifecycle-events">lifecycle events</dfn>, <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event">install</a></code> and <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event">activate</a></code>, and <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-functional-events">functional events</dfn> including <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event">fetch</a></code>, which target the <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①">ServiceWorkerGlobalScope</a></code>.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②①">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-script-resource">script resource</dfn> (a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-script" id="ref-for-concept-script">script</a>), which represents its own script resource. It is initially set to null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource">script resource</a> has an associated <dfn class="dfn-paneled" data-dfn-for="script resource" data-dfn-type="dfn" data-export="" id="dfn-has-ever-been-evaluated-flag">has ever been evaluated flag</dfn>. It is initially unset.</p>
     <p>A <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①">script resource</a> has an associated <dfn class="dfn-paneled" data-dfn-for="script resource" data-dfn-type="dfn" data-export="" id="dfn-https-state">HTTPS state</dfn> (an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-https-state-value" id="ref-for-concept-https-state-value">HTTPS state value</a>). It is initially "<code>none</code>".</p>
     <p>A <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource②">script resource</a> has an associated <dfn class="dfn-paneled" data-dfn-for="script resource" data-dfn-type="dfn" data-export="" id="dfn-referrer-policy">referrer policy</dfn> (a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy">referrer policy</a>). It is initially the empty string.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②②">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-script-resource-map">script resource map</dfn> which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">ordered map</a> where the keys are <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URLs</a> and the values are <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">responses</a>.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②③">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-skip-waiting-flag">skip waiting flag</dfn>. Unless stated otherwise it is unset.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②④">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-classic-scripts-imported-flag">classic scripts imported flag</dfn>. It is initially unset.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⑤">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-set-of-event-types-to-handle">set of event types to handle</dfn> (a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a>) whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">item</a> is an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-listener" id="ref-for-concept-event-listener">event listener</a>’s event type. It is initially an empty set.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⑥">service worker</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker" data-dfn-type="dfn" data-export="" id="dfn-set-of-extended-events">set of extended events</dfn> (a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a>) whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item①">item</a> is an <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent">ExtendableEvent</a></code>. It is initially an empty set.</p>
     <section>
      <h4 class="heading settled" data-level="2.1.1" id="service-worker-lifetime"><span class="secno">2.1.1. </span><span class="content">Lifetime</span><a class="self-link" href="#service-worker-lifetime"></a></h4>
      <p>The lifetime of a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⑦">service worker</a> is tied to the execution lifetime of events and not references held by <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①">service worker clients</a> to the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker">ServiceWorker</a></code> object.</p>
      <p>A user agent <em>may</em> <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker">terminate</a> <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⑧">service workers</a> at any time it:</p>
      <ul>
       <li data-md="">
        <p>Has no event to handle.</p>
       <li data-md="">
        <p>Detects abnormal operation: such as infinite loops and tasks exceeding imposed time limits (if any) while handling the events.</p>
      </ul>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="2.2" id="service-worker-registration-concept"><span class="secno">2.2. </span><span class="content">Service Worker Registration</span><a class="self-link" href="#service-worker-registration-concept"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-for="" data-dfn-type="dfn" data-export="" id="dfn-service-worker-registration">service worker registration</dfn> is a tuple of a <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url">scope url</a> and a set of <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker②⑨">service workers</a>, an <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker">installing worker</a>, a <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker">waiting worker</a>, and an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker">active worker</a>. A user agent <em>may</em> enable many <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①">service worker registrations</a> at a single origin so long as the <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①">scope url</a> of the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②">service worker registration</a> differs. A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③">service worker registration</a> of an identical <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url②">scope url</a> when one already exists in the user agent causes the existing <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④">service worker registration</a> to be replaced.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-scope-url">scope url</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL</a>).</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-installing-worker">installing worker</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⓪">service worker</a> or null) whose <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state">state</a> is <em>installing</em>. It is initially set to null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑦">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-waiting-worker">waiting worker</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③①">service worker</a> or null) whose <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state①">state</a> is <em>installed</em>. It is initially set to null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑧">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-active-worker">active worker</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③②">service worker</a> or null) whose <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state②">state</a> is either <em>activating</em> or <em>activated</em>. It is initially set to null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑨">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-last-update-check-time">last update check time</dfn>. It is initially set to null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⓪">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-update-via-cache">update via cache mode</dfn>, which is "<code>imports</code>", "<code>all</code>", or "<code>none</code>". It is initially set to "<code>imports</code>".</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①①">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-uninstalling-flag">uninstalling flag</dfn>. It is initially unset.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①②">service worker registration</a> has one or more <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="dfn-service-worker-registration-task-queue">task queues</dfn> that back up the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task">tasks</a> from its <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①">active worker</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a>’s corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue">task queues</a>. (The target task sources for this back up operation are the <a data-link-type="dfn" href="#dfn-handle-fetch-task-source" id="ref-for-dfn-handle-fetch-task-source">handle fetch task source</a> and the <a data-link-type="dfn" href="#dfn-handle-functional-event-task-source" id="ref-for-dfn-handle-functional-event-task-source">handle functional event task source</a>.) The user agent dumps the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②">active worker</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①">tasks</a> to the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①③">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-service-worker-registration-task-queue" id="ref-for-dfn-service-worker-registration-task-queue">task queues</a> when the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③">active worker</a> is <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker①">terminated</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">re-queues those tasks</a> to the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④">active worker</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a>’s corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue①">task queues</a> when the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤">active worker</a> spins off. Unlike the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue②">task queues</a> owned by <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop②">event loops</a>, the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①④">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-service-worker-registration-task-queue" id="ref-for-dfn-service-worker-registration-task-queue①">task queues</a> are not processed by any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop③">event loops</a> in and of itself.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⑤">service worker registration</a> has an associated <dfn data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="service-worker-registration-navigationpreloadmanager"><code class="idl"><a data-link-type="idl" href="#navigationpreloadmanager" id="ref-for-navigationpreloadmanager">NavigationPreloadManager</a></code><a class="self-link" href="#service-worker-registration-navigationpreloadmanager"></a></dfn> object.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⑥">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="service-worker-registration-navigation-preload-enabled-flag">navigation preload enabled flag</dfn>. It is initially unset.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⑦">service worker registration</a> has an associated <dfn class="dfn-paneled" data-dfn-for="service worker registration" data-dfn-type="dfn" data-export="" id="service-worker-registration-navigation-preload-header-value">navigation preload header value</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a>. It is initially set to `<code>true</code>`.</p>
     <section>
      <h4 class="heading settled" data-level="2.2.1" id="service-worker-registration-lifetime"><span class="secno">2.2.1. </span><span class="content">Lifetime</span><a class="self-link" href="#service-worker-registration-lifetime"></a></h4>
      <p>A user agent <em>must</em> persistently keep a list of <a data-link-type="dfn" href="#register" id="ref-for-register">registered</a> <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⑧">service worker registrations</a> unless otherwise they are explicitly <a data-link-type="dfn" href="#unregister" id="ref-for-unregister">unregistered</a>. A user agent has a <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map">scope to registration map</a> that stores the entries of the tuple of <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration①⑨">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url③">scope url</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer">serialized</a>, and the corresponding <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⓪">service worker registration</a>. The lifetime of <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②①">service worker registrations</a> is beyond that of the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration">ServiceWorkerRegistration</a></code> objects which represent them within the lifetime of their corresponding <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②">service worker clients</a>.</p>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="2.3" id="service-worker-client-concept"><span class="secno">2.3. </span><span class="content">Service Worker Client</span><a class="self-link" href="#service-worker-client-concept"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-for="" data-dfn-type="dfn" data-export="" id="dfn-service-worker-client">service worker client</dfn> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment">environment</a>.</p>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③">service worker client</a> has an algorithm defined as the <dfn class="dfn-paneled" data-dfn-for="service worker client" data-dfn-type="dfn" data-export="" id="service-worker-client-origin">origin</dfn> that returns the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a> if the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑤">service worker client</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>, and the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑥">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url">creation URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> otherwise.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-for="service worker client" data-dfn-type="dfn" data-export="" id="dfn-window-client">window client</dfn> is a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑦">service worker client</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-for="service worker client" data-dfn-type="dfn" data-export="" id="dfn-dedicatedworker-client">dedicated worker client</dfn> is a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑧">service worker client</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①">global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> object.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-for="service worker client" data-dfn-type="dfn" data-export="" id="dfn-sharedworker-client">shared worker client</dfn> is a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑨">service worker client</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global②">global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope" id="ref-for-sharedworkerglobalscope">SharedWorkerGlobalScope</a></code> object.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-for="service worker client" data-dfn-type="dfn" data-export="" id="dfn-worker-client">worker client</dfn> is either a <a data-link-type="dfn" href="#dfn-dedicatedworker-client" id="ref-for-dfn-dedicatedworker-client">dedicated worker client</a> or a <a data-link-type="dfn" href="#dfn-sharedworker-client" id="ref-for-dfn-sharedworker-client">shared worker client</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="2.4" id="selection"><span class="secno">2.4. </span><span class="content">Selection and Use</span><a class="self-link" href="#selection"></a></h3>
     <p>A <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⓪">service worker client</a> independently <a data-link-type="dfn" href="#dfn-service-worker-registration-selection" id="ref-for-dfn-service-worker-registration-selection">selects</a> and <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use">uses</a> a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②②">service worker registration</a> for its own loading and its subresources. The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-service-worker-registration-selection">selection</dfn> of a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②③">service worker registration</a>, upon a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request">non-subresource request</a>, is a process of either <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration">matching</a> a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②④">service worker registration</a> from <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map①">scope to registration map</a> or inheriting an existing <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⑤">service worker registration</a> from its parent or owner context depending on the request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a>.</p>
     <p>When the request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">url</a> is not <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#is-local" id="ref-for-is-local">local</a>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①①">service worker client</a> <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration①">matches</a> a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⑥">service worker registration</a> from <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map②">scope to registration map</a>. That is, the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①②">service worker client</a> attempts to consult a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⑦">service worker registration</a> whose <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url④">scope url</a> <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration②">matches</a> its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①">creation URL</a>.</p>
     <p>When the request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url②">url</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#is-local" id="ref-for-is-local①">is local</a>, if the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①③">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context" id="ref-for-responsible-browsing-context">responsible browsing context</a> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a> or the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①④">service worker client</a> is a <a data-link-type="dfn" href="#dfn-worker-client" id="ref-for-dfn-worker-client">worker client</a>, the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⑤">service worker client</a> inherits the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⑧">service worker registration</a> from its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context" id="ref-for-parent-browsing-context">parent browsing context</a>’s environment or from the environment of a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> in the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⑥">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global③">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set">owner set</a>, respectively, if it exists.</p>
     <p>If the <a data-link-type="dfn" href="#dfn-service-worker-registration-selection" id="ref-for-dfn-service-worker-registration-selection①">selection</a> was successful, the <a data-link-type="dfn" href="#dfn-service-worker-registration-selection" id="ref-for-dfn-service-worker-registration-selection②">selected</a> <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration②⑨">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑥">active worker</a> starts to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-control">control</dfn> the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⑦">service worker client</a>. Otherwise, the flow returns to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetch</a> where it falls back to the default behavior. When a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⑧">service worker client</a> is <a data-link-type="dfn" href="#dfn-control" id="ref-for-dfn-control">controlled</a> by an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑦">active worker</a>, it is considered that the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client①⑨">service worker client</a> is <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="using|uses|used" data-noexport="" id="dfn-use">using</dfn> the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑧">active worker</a>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration">containing service worker registration</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="2.5" id="task-sources"><span class="secno">2.5. </span><span class="content">Task Sources</span><a class="self-link" href="#task-sources"></a></h3>
     <p>The following additional <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task sources</a> are used by <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③③">service workers</a>.</p>
     <dl>
      <dt data-md="">The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="dfn-handle-fetch-task-source">handle fetch task source</dfn>
      <dd data-md="">
       <p>This <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a> is used for <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch">dispatching</a> <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event①">fetch</a></code> events to <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③④">service workers</a>.</p>
      <dt data-md="">The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="dfn-handle-functional-event-task-source">handle functional event task source</dfn>
      <dd data-md="">
       <p>This <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source②">task source</a> is used for features that <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①">dispatch</a> other <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events">functional events</a>, e.g. <code class="idl"><a class="idl-code" data-link-type="event" href="https://w3c.github.io/push-api/#h-the-push-event" id="ref-for-h-the-push-event">push</a></code> events, to <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⑤">service workers</a>.</p>
       <p class="note" role="note"><span>Note:</span> A user agent may use a separate task source for each functional event type in order to avoid a head-of-line blocking phenomenon for certain functional events.</p>
     </dl>
    </section>
    <section>
     <h3 class="heading settled" data-level="2.6" id="user-agent-shutdown"><span class="secno">2.6. </span><span class="content">User Agent Shutdown</span><a class="self-link" href="#user-agent-shutdown"></a></h3>
     <p>A user agent <em>must</em> maintain the state of its stored <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⓪">service worker registrations</a> across restarts with the following rules:</p>
     <ul>
      <li data-md="">
       <p>An <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①">installing worker</a> does not persist but is discarded. If the <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker②">installing worker</a> was the only <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⑥">service worker</a> for the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③①">service worker registration</a>, the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③②">service worker registration</a> is discarded.</p>
      <li data-md="">
       <p>A <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①">waiting worker</a> promotes to an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑨">active worker</a>.</p>
     </ul>
     <p>To attain this, the user agent <em>must</em> invoke <a data-link-type="dfn" href="#handle-user-agent-shutdown" id="ref-for-handle-user-agent-shutdown">Handle User Agent Shutdown</a> when it terminates.</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="document-context"><span class="secno">3. </span><span class="content">Client Context</span><a class="self-link" href="#document-context"></a></h2>
    <div class="example" id="example-03b9d237">
     <a class="self-link" href="#example-03b9d237"></a> Bootstrapping with a service worker: 
<pre class="highlight"><span class="c1">// scope defaults to the path the script sits in</span>
<span class="c1">// "/" in this example</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/serviceworker.js"</span><span class="p">).</span>then<span class="p">(</span>registration <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>log<span class="p">(</span><span class="s2">"success!"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span>registration<span class="p">.</span>installing<span class="p">)</span> <span class="p">{</span>
    registration<span class="p">.</span>installing<span class="p">.</span>postMessage<span class="p">(</span><span class="s2">"Howdy from your installing page."</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> err <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>error<span class="p">(</span><span class="s2">"Installing the worker failed!"</span><span class="p">,</span> err<span class="p">);</span>
<span class="p">});</span>
</pre>
    </div>
    <section>
     <h3 class="heading settled" data-level="3.1" id="serviceworker-interface"><span class="secno">3.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①">ServiceWorker</a></code></span><a class="self-link" href="#serviceworker-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="serviceworker"><code>ServiceWorker</code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-serviceworker-scripturl" id="ref-for-dom-serviceworker-scripturl">scriptURL</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerstate" id="ref-for-enumdef-serviceworkerstate">ServiceWorkerState</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerState" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state">state</a>;
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworker-postmessage" id="ref-for-dom-serviceworker-postmessage">postMessage</a>(<span class="kt">any</span> <dfn class="nv idl-code" data-dfn-for="ServiceWorker/postMessage(message, transfer), ServiceWorker/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-serviceworker-postmessage-message-transfer-message"><code>message</code><a class="self-link" href="#dom-serviceworker-postmessage-message-transfer-message"></a></dfn>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-object" id="ref-for-idl-object"><span class="kt">object</span></a>> <dfn class="nv idl-code" data-dfn-for="ServiceWorker/postMessage(message, transfer), ServiceWorker/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-serviceworker-postmessage-message-transfer-transfer"><code>transfer</code><a class="self-link" href="#dom-serviceworker-postmessage-message-transfer-transfer"></a></dfn> = []);

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworker-onstatechange" id="ref-for-dom-serviceworker-onstatechange">onstatechange</a>;
};
<a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②">ServiceWorker</a> <span class="kt">includes</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#abstractworker" id="ref-for-abstractworker">AbstractWorker</a>;

<span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-serviceworkerstate"><code>ServiceWorkerState</code></dfn> {
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ServiceWorkerState" data-dfn-type="enum-value" data-export="" data-lt="&quot;installing&quot;|installing" id="dom-serviceworkerstate-installing"><code>"installing"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ServiceWorkerState" data-dfn-type="enum-value" data-export="" data-lt="&quot;installed&quot;|installed" id="dom-serviceworkerstate-installed"><code>"installed"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ServiceWorkerState" data-dfn-type="enum-value" data-export="" data-lt="&quot;activating&quot;|activating" id="dom-serviceworkerstate-activating"><code>"activating"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ServiceWorkerState" data-dfn-type="enum-value" data-export="" data-lt="&quot;activated&quot;|activated" id="dom-serviceworkerstate-activated"><code>"activated"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ServiceWorkerState" data-dfn-type="enum-value" data-export="" data-lt="&quot;redundant&quot;|redundant" id="dom-serviceworkerstate-redundant"><code>"redundant"</code></dfn>
};
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker③">ServiceWorker</a></code> object represents a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⑦">service worker</a>. Each <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker④">ServiceWorker</a></code> object is associated with a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⑧">service worker</a>. Multiple separate objects implementing the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker⑤">ServiceWorker</a></code> interface across documents and workers can all be associated with the same <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker③⑨">service worker</a> simultaneously.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker⑥">ServiceWorker</a></code> object has an associated <code class="idl"><a data-link-type="idl" href="#enumdef-serviceworkerstate" id="ref-for-enumdef-serviceworkerstate①">ServiceWorkerState</a></code> object which is itself associated with <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⓪">service worker</a>'s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state③">state</a>.</p>
     <section>
      <h4 class="heading settled" data-level="3.1.1" id="service-worker-url"><span class="secno">3.1.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworker-scripturl" id="ref-for-dom-serviceworker-scripturl①">scriptURL</a></code></span><a class="self-link" href="#service-worker-url"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorker" data-dfn-type="attribute" data-export="" id="dom-serviceworker-scripturl"><code>scriptURL</code></dfn> attribute <em>must</em> return the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④①">service worker</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①">serialized</a> <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url">script url</a>.</p>
      <div class="example" id="example-6dc657c5">
       <a class="self-link" href="#example-6dc657c5"></a> For example, consider a document created by a navigation to <code>https://example.com/app.html</code> which <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration③">matches</a> via the following registration call which has been previously executed: 
<pre class="highlight"><span class="c1">// Script on the page https://example.com/app.html</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/service_worker.js"</span><span class="p">);</span>
</pre>
       <p>The value of <code>navigator.serviceWorker.controller.scriptURL</code> will be "<code>https://example.com/service_worker.js</code>".</p>
      </div>
     </section>
     <section>
      <h4 class="heading settled" data-level="3.1.2" id="service-worker-state"><span class="secno">3.1.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state①">state</a></code></span><a class="self-link" href="#service-worker-state"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorker" data-dfn-type="attribute" data-export="" id="dom-serviceworker-state"><code>state</code></dfn> attribute <em>must</em> return the value (in <code class="idl"><a data-link-type="idl" href="#enumdef-serviceworkerstate" id="ref-for-enumdef-serviceworkerstate②">ServiceWorkerState</a></code> enumeration) to which it was last set.</p>
     </section>
     <section class="algorithm" data-algorithm="service-worker-postmessage">
      <h4 class="heading settled" data-level="3.1.3" id="service-worker-postmessage"><span class="secno">3.1.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworker-postmessage" id="ref-for-dom-serviceworker-postmessage①">postMessage(message, transfer)</a></code></span><a class="self-link" href="#service-worker-postmessage"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorker" data-dfn-type="method" data-export="" id="dom-serviceworker-postmessage"><code>postMessage(<var>message</var>, <var>transfer</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If the <code class="idl"><a data-link-type="idl" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state②">state</a></code> attribute value of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object">context object</a> is <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-redundant" id="ref-for-dom-serviceworkerstate-redundant">"redundant"</a></code>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>serviceWorker</var> be the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④②">service worker</a> represented by the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①">context object</a>.</p>
       <li data-md="">
        <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker">Run Service Worker</a> algorithm with <var>serviceWorker</var> as the argument.</p>
       <li data-md="">
        <p>Let <var>incumbentSettings</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object" id="ref-for-incumbent-settings-object">incumbent settings object</a>, and <var>incumbentGlobal</var> its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global④">global object</a>.</p>
       <li data-md="">
        <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source">DOM manipulation task source</a> to run the following steps:</p>
        <ol>
         <li data-md="">
          <p>Let <var>source</var> be determined by switching on the type of <var>incumbentGlobal</var>:</p>
          <dl class="switch">
           <dt><code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope②">ServiceWorkerGlobalScope</a></code>
           <dd>a new <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker⑦">ServiceWorker</a></code> object that represents <var>incumbentGlobal</var>’s <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker">service worker</a>.
           <dt><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①">Window</a></code>
           <dd>a new <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient">WindowClient</a></code> object that represents <var>incumbentGlobal</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>.
           <dt>Otherwise
           <dd>a new <code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client">Client</a></code> object that represents <var>incumbentGlobal</var>’s associated worker 
          </dl>
         <li data-md="">
          <p>Let <var>origin</var> be the <a data-link-type="dfn">Unicode serialization</a> of <var>incumbentSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>.</p>
         <li data-md="">
          <p>Let <var>destination</var> be the <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope③">ServiceWorkerGlobalScope</a></code> object associated with <var>serviceWorker</var>.</p>
         <li data-md="">
          <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>destination</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm" id="ref-for-concept-global-object-realm">Realm</a>).</p>
          <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-messageerror" id="ref-for-eventdef-serviceworkerglobalscope-messageerror">messageerror</a></code> at <var>destination</var>, using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source">source</a></code> attribute initialized to <var>source</var>, and then abort these steps.</p>
         <li data-md="">
          <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
         <li data-md="">
          <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.</p>
         <li data-md="">
          <p>Let <var>e</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create">creating an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-message" id="ref-for-eventdef-serviceworkerglobalscope-message">message</a></code>, using <code class="idl"><a data-link-type="idl" href="#extendablemessageevent" id="ref-for-extendablemessageevent">ExtendableMessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-origin" id="ref-for-dom-extendablemessageevent-origin">origin</a></code> attribute initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-source" id="ref-for-dom-extendablemessageevent-source">source</a></code> attribute initialized to <var>source</var>, the <code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-data" id="ref-for-dom-extendablemessageevent-data">data</a></code> attribute initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-ports" id="ref-for-dom-extendablemessageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch②">Dispatch</a> <var>e</var> at <var>destination</var>.</p>
         <li data-md="">
          <p>Invoke <a data-link-type="dfn" href="#update-service-worker-extended-events-set" id="ref-for-update-service-worker-extended-events-set">Update Service Worker Extended Events Set</a> with <var>serviceWorker</var> and <var>e</var>.</p>
        </ol>
      </ol>
     </section>
     <section>
      <h4 class="heading settled" data-level="3.1.4" id="service-worker-event-handler"><span class="secno">3.1.4. </span><span class="content">Event handler</span><a class="self-link" href="#service-worker-event-handler"></a></h4>
      <p>The following is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handler</a> (and its corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">event handler event type</a>) that <em>must</em> be supported, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker⑧">ServiceWorker</a></code> interface:</p>
      <table class="data">
       <thead>
        <tr>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers①">event handler</a>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type①">event handler event type</a>
       <tbody>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorker" data-dfn-type="attribute" data-export="" id="dom-serviceworker-onstatechange"><code>onstatechange</code></dfn>
         <td><code class="idl"><a data-link-type="idl" href="#eventdef-serviceworker-statechange" id="ref-for-eventdef-serviceworker-statechange">statechange</a></code>
      </table>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.2" id="serviceworkerregistration-interface"><span class="secno">3.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①">ServiceWorkerRegistration</a></code></span><a class="self-link" href="#serviceworkerregistration-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="serviceworkerregistration"><code>ServiceWorkerRegistration</code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker⑨">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-installing" id="ref-for-dom-serviceworkerregistration-installing">installing</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①⓪">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-waiting" id="ref-for-dom-serviceworkerregistration-waiting">waiting</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①①">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-active" id="ref-for-dom-serviceworkerregistration-active">active</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#navigationpreloadmanager" id="ref-for-navigationpreloadmanager①">NavigationPreloadManager</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="NavigationPreloadManager" href="#dom-serviceworkerregistration-navigationpreload" id="ref-for-dom-serviceworkerregistration-navigationpreload">navigationPreload</a>;

  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-serviceworkerregistration-scope" id="ref-for-dom-serviceworkerregistration-scope">scope</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerupdateviacache" id="ref-for-enumdef-serviceworkerupdateviacache">ServiceWorkerUpdateViaCache</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerUpdateViaCache" href="#dom-serviceworkerregistration-updateviacache" id="ref-for-dom-serviceworkerregistration-updateviacache">updateViaCache</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerregistration-update" id="ref-for-dom-serviceworkerregistration-update">update</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerregistration-unregister" id="ref-for-dom-serviceworkerregistration-unregister">unregister</a>();

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerregistration-onupdatefound" id="ref-for-dom-serviceworkerregistration-onupdatefound">onupdatefound</a>;
};

<span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-serviceworkerupdateviacache"><code>ServiceWorkerUpdateViaCache</code></dfn> {
  <dfn class="s idl-code" data-dfn-for="ServiceWorkerUpdateViaCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;imports&quot;|imports" id="dom-serviceworkerupdateviacache-imports"><code>"imports"</code><a class="self-link" href="#dom-serviceworkerupdateviacache-imports"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="ServiceWorkerUpdateViaCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;all&quot;|all" id="dom-serviceworkerupdateviacache-all"><code>"all"</code><a class="self-link" href="#dom-serviceworkerupdateviacache-all"></a></dfn>,
  <dfn class="s idl-code" data-dfn-for="ServiceWorkerUpdateViaCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;none&quot;|none" id="dom-serviceworkerupdateviacache-none"><code>"none"</code><a class="self-link" href="#dom-serviceworkerupdateviacache-none"></a></dfn>
};
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration②">ServiceWorkerRegistration</a></code> object represents a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③③">service worker registration</a>. Each <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration③">ServiceWorkerRegistration</a></code> object is associated with a <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="dfn" data-noexport="" id="serviceworkerregistration-service-worker-registration">service worker registration</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③④">service worker registration</a>). Multiple separate objects implementing the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration④">ServiceWorkerRegistration</a></code> interface across documents and workers can all be associated with the same <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⑤">service worker registration</a> simultaneously.</p>
     <section class="algorithm" data-algorithm="navigator-service-worker-installing">
      <h4 class="heading settled" data-level="3.2.1" id="navigator-service-worker-installing"><span class="secno">3.2.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-installing" id="ref-for-dom-serviceworkerregistration-installing①">installing</a></code></span><a class="self-link" href="#navigator-service-worker-installing"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-installing"><code>installing</code></dfn> attribute <em>must</em> return the value to which it was last set.</p>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①②">ServiceWorker</a></code> objects returned from this attribute getter that represent the same <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④③">service worker</a> are the same objects.</p>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-waiting">
      <h4 class="heading settled" data-level="3.2.2" id="navigator-service-worker-waiting"><span class="secno">3.2.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-waiting" id="ref-for-dom-serviceworkerregistration-waiting①">waiting</a></code></span><a class="self-link" href="#navigator-service-worker-waiting"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-waiting"><code>waiting</code></dfn> attribute <em>must</em> return the value to which it was last set.</p>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①③">ServiceWorker</a></code> objects returned from this attribute getter that represent the same <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④④">service worker</a> are the same objects.</p>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-active">
      <h4 class="heading settled" data-level="3.2.3" id="navigator-service-worker-active"><span class="secno">3.2.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-active" id="ref-for-dom-serviceworkerregistration-active①">active</a></code></span><a class="self-link" href="#navigator-service-worker-active"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-active"><code>active</code></dfn> attribute <em>must</em> return the value to which it was last set.</p>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①④">ServiceWorker</a></code> objects returned from this attribute getter that represent the same <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⑤">service worker</a> are the same objects.</p>
     </section>
     <section class="algorithm" data-algorithm="service-worker-registration-navigationpreload">
      <h4 class="heading settled" data-level="3.2.4" id="service-worker-registration-navigationpreload"><span class="secno">3.2.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-navigationpreload" id="ref-for-dom-serviceworkerregistration-navigationpreload①">navigationPreload</a></code></span><a class="self-link" href="#service-worker-registration-navigationpreload"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-navigationpreload"><code>navigationPreload</code></dfn> attribute <em>must</em> return <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration">service worker registration</a>'s <code class="idl"><a data-link-type="idl" href="#navigationpreloadmanager" id="ref-for-navigationpreloadmanager②">NavigationPreloadManager</a></code> object.</p>
     </section>
     <section class="algorithm" data-algorithm="service-worker-registration-scope">
      <h4 class="heading settled" data-level="3.2.5" id="service-worker-registration-scope"><span class="secno">3.2.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-scope" id="ref-for-dom-serviceworkerregistration-scope①">scope</a></code></span><a class="self-link" href="#service-worker-registration-scope"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-scope"><code>scope</code></dfn> attribute <em>must</em> return <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration①">service worker registration</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer②">serialized</a> <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url⑤">scope url</a>.</p>
      <div class="example" id="example-c0619bcc"><a class="self-link" href="#example-c0619bcc"></a> In the example in <a href="#service-worker-url">§3.1.1 scriptURL</a>, the value of <code>registration.scope</code>, obtained from <code>navigator.serviceWorker.ready.then(registration => console.log(registration.scope))</code> for example, will be "<code>https://example.com/</code>". </div>
     </section>
     <section class="algorithm" data-algorithm="service-worker-registration-updateviacache">
      <h4 class="heading settled" data-level="3.2.6" id="service-worker-registration-updateviacache"><span class="secno">3.2.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-updateviacache" id="ref-for-dom-serviceworkerregistration-updateviacache①">updateViaCache</a></code></span><a class="self-link" href="#service-worker-registration-updateviacache"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-updateviacache"><code>updateViaCache</code></dfn> attribute <em>must</em> return <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration②">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache">update via cache mode</a>.</p>
     </section>
     <section class="algorithm" data-algorithm="service-worker-registration-update">
      <h4 class="heading settled" data-level="3.2.7" id="service-worker-registration-update"><span class="secno">3.2.7. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-update" id="ref-for-dom-serviceworkerregistration-update①">update()</a></code></span><a class="self-link" href="#service-worker-registration-update"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="method" data-export="" id="dom-serviceworkerregistration-update"><code>update()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>registration</var> be the <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration③">service worker registration</a>.</p>
       <li data-md="">
        <p>Let <var>newestWorker</var> be the result of running <a data-link-type="dfn" href="#get-newest-worker" id="ref-for-get-newest-worker">Get Newest Worker</a> algorithm passing <var>registration</var> as its argument.</p>
       <li data-md="">
        <p>If <var>newestWorker</var> is null, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> and abort these steps.</p>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global⑤">global object</a> <var>globalObject</var> is a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope④">ServiceWorkerGlobalScope</a></code> object, and <var>globalObject</var>’s associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①">service worker</a>'s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state④">state</a> is <em>installing</em>, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code> and abort these steps.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects">promise</a>.</p>
       <li data-md="">
        <p>Let <var>job</var> be the result of running <a data-link-type="dfn" href="#create-job" id="ref-for-create-job">Create Job</a> with <em>update</em>, <var>registration</var>’s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url⑥">scope url</a>, <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url①">script url</a>, <var>promise</var>, and the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>.</p>
       <li data-md="">
        <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type">worker type</a> to <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-type" id="ref-for-dfn-type">type</a>.</p>
       <li data-md="">
        <p>Invoke <a data-link-type="dfn" href="#schedule-job" id="ref-for-schedule-job">Schedule Job</a> with <var>job</var>.</p>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-unregister">
      <h4 class="heading settled" data-level="3.2.8" id="navigator-service-worker-unregister"><span class="secno">3.2.8. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-unregister" id="ref-for-dom-serviceworkerregistration-unregister①">unregister()</a></code></span><a class="self-link" href="#navigator-service-worker-unregister"></a></h4>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-unregister" id="ref-for-dom-serviceworkerregistration-unregister②">unregister()</a></code> method unregisters the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⑥">service worker registration</a>. It is important to note that the currently <a data-link-type="dfn" href="#dfn-control" id="ref-for-dfn-control①">controlled</a> <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⓪">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker">active service worker</a>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①">containing service worker registration</a> is effective until all the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②①">service worker clients</a> (including itself) using this <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⑦">service worker registration</a> unload. That is, the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-unregister" id="ref-for-dom-serviceworkerregistration-unregister③">unregister()</a></code> method only affects subsequent <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">navigations</a>.</p>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="method" data-export="" id="dom-serviceworkerregistration-unregister"><code>unregister()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①">promise</a>.</p>
       <li data-md="">
        <p>Let <var>job</var> be the result of running <a data-link-type="dfn" href="#create-job" id="ref-for-create-job①">Create Job</a> with <em>unregister</em>, the <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url⑦">scope url</a> of the <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration④">service worker registration</a>, null, <var>promise</var>, and the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>.</p>
       <li data-md="">
        <p>Invoke <a data-link-type="dfn" href="#schedule-job" id="ref-for-schedule-job①">Schedule Job</a> with <var>job</var>.</p>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section>
      <h4 class="heading settled" data-level="3.2.9" id="service-worker-registration-event-handler"><span class="secno">3.2.9. </span><span class="content">Event handler</span><a class="self-link" href="#service-worker-registration-event-handler"></a></h4>
      <p>The following is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers②">event handler</a> (and its corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type②">event handler event type</a>) that <em>must</em> be supported, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes①">event handler IDL attributes</a>, by all objects implementing <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑤">ServiceWorkerRegistration</a></code> interface:</p>
      <table class="data">
       <thead>
        <tr>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers③">event handler</a>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type③">event handler event type</a>
       <tbody>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="attribute" data-export="" id="dom-serviceworkerregistration-onupdatefound"><code>onupdatefound</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-registration-updatefound-event" id="ref-for-service-worker-registration-updatefound-event">updatefound</a></code>
      </table>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.3" id="navigator-serviceworker"><span class="secno">3.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#navigator-service-worker-attribute" id="ref-for-navigator-service-worker-attribute">navigator.serviceWorker</a></code></span><a class="self-link" href="#navigator-serviceworker"></a></h3>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator">Navigator</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext②">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer">ServiceWorkerContainer</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerContainer" href="#navigator-service-worker-attribute" id="ref-for-navigator-service-worker-attribute①">serviceWorker</a>;
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator">WorkerNavigator</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext③">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject②">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①">ServiceWorkerContainer</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerContainer" href="#navigator-service-worker-attribute" id="ref-for-navigator-service-worker-attribute②">serviceWorker</a>;
};
</pre>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Navigator,WorkerNavigator" data-dfn-type="attribute" data-export="" id="navigator-service-worker-attribute"><code>serviceWorker</code></dfn> attribute <em>must</em> return the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer②">ServiceWorkerContainer</a></code> object that is associated with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object⑤">context object</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.4" id="serviceworkercontainer-interface"><span class="secno">3.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer③">ServiceWorkerContainer</a></code></span><a class="self-link" href="#serviceworkercontainer-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext④">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="serviceworkercontainer"><code>ServiceWorkerContainer</code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget②">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①⑤">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkercontainer-controller" id="ref-for-dom-serviceworkercontainer-controller">controller</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑥">ServiceWorkerRegistration</a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Promise<ServiceWorkerRegistration>" href="#dom-serviceworkercontainer-ready" id="ref-for-dom-serviceworkercontainer-ready">ready</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑦">ServiceWorkerRegistration</a>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-register" id="ref-for-dom-serviceworkercontainer-register">register</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-dfn-for="ServiceWorkerContainer/register(scriptURL, options), ServiceWorkerContainer/register(scriptURL)" data-dfn-type="argument" data-export="" id="dom-serviceworkercontainer-register-scripturl-options-scripturl"><code>scriptURL</code><a class="self-link" href="#dom-serviceworkercontainer-register-scripturl-options-scripturl"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-registrationoptions" id="ref-for-dictdef-registrationoptions">RegistrationOptions</a> <dfn class="nv idl-code" data-dfn-for="ServiceWorkerContainer/register(scriptURL, options), ServiceWorkerContainer/register(scriptURL)" data-dfn-type="argument" data-export="" id="dom-serviceworkercontainer-register-scripturl-options-options"><code>options</code><a class="self-link" href="#dom-serviceworkercontainer-register-scripturl-options-options"></a></dfn>);

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject③">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-getregistration" id="ref-for-dom-serviceworkercontainer-getregistration">getRegistration</a>(<span class="kt">optional</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString③"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-dfn-for="ServiceWorkerContainer/getRegistration(clientURL), ServiceWorkerContainer/getRegistration()" data-dfn-type="argument" data-export="" id="dom-serviceworkercontainer-getregistration-clienturl-clienturl"><code>clientURL</code><a class="self-link" href="#dom-serviceworkercontainer-getregistration-clienturl-clienturl"></a></dfn> = "");
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject④">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑧">ServiceWorkerRegistration</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-getregistrations" id="ref-for-dom-serviceworkercontainer-getregistrations">getRegistrations</a>();

  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-startmessages" id="ref-for-dom-serviceworkercontainer-startmessages">startMessages</a>();


  // events
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-oncontrollerchange" id="ref-for-dom-serviceworkercontainer-oncontrollerchange">oncontrollerchange</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-onmessage" id="ref-for-dom-serviceworkercontainer-onmessage">onmessage</a>; // event.source of message events is ServiceWorker object
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler④">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-onmessageerror" id="ref-for-dom-serviceworkercontainer-onmessageerror">onmessageerror</a>;
};
</pre>
<pre class="idl highlight def" id="registration-option-list-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-registrationoptions"><code>RegistrationOptions</code></dfn> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString④"><span class="kt">USVString</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="RegistrationOptions" data-dfn-type="dict-member" data-export="" data-type="USVString " id="dom-registrationoptions-scope"><code>scope</code></dfn>;
  <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workertype" id="ref-for-workertype">WorkerType</a> <dfn class="nv dfn-paneled idl-code" data-default="&quot;classic&quot;" data-dfn-for="RegistrationOptions" data-dfn-type="dict-member" data-export="" data-type="WorkerType " id="dom-registrationoptions-type"><code>type</code></dfn> = "classic";
  <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerupdateviacache" id="ref-for-enumdef-serviceworkerupdateviacache①">ServiceWorkerUpdateViaCache</a> <dfn class="nv dfn-paneled idl-code" data-default="&quot;imports&quot;" data-dfn-for="RegistrationOptions" data-dfn-type="dict-member" data-export="" data-type="ServiceWorkerUpdateViaCache " id="dom-registrationoptions-updateviacache"><code>updateViaCache</code></dfn> = "imports";
};
</pre>
     <p>The user agent <em>must</em> create a <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer④">ServiceWorkerContainer</a></code> object when a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator①">Navigator</a></code> object or a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator①">WorkerNavigator</a></code> object is created and associate it with that object.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer⑤">ServiceWorkerContainer</a></code> provides capabilities to register, unregister, and update the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⑧">service worker registrations</a>, and provides access to the state of the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration③⑨">service worker registrations</a> and their associated <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⑥">service workers</a>.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer⑥">ServiceWorkerContainer</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerContainer" data-dfn-type="dfn" data-noexport="" id="serviceworkercontainer-service-worker-client">service worker client</dfn>, which is a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②②">service worker client</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global⑥">global object</a> is associated with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator②">Navigator</a></code> object or the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator②">WorkerNavigator</a></code> object that the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer⑦">ServiceWorkerContainer</a></code> is retrieved from.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer⑧">ServiceWorkerContainer</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerContainer" data-dfn-type="dfn" data-noexport="" id="serviceworkercontainer-ready-promise">ready promise</dfn> (a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②">promise</a>). It is initially set to <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer⑨">ServiceWorkerContainer</a></code> object has a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source③">task source</a> called the <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerContainer" data-dfn-type="dfn" data-export="" id="dfn-client-message-queue">client message queue</dfn>, initially empty. A <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue">client message queue</a> can be enabled or disabled, and is initially disabled. When a <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①⓪">ServiceWorkerContainer</a></code> object’s <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue①">client message queue</a> is enabled, the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop④">event loop</a> <em>must</em> use it as one of its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source④">task sources</a>. When the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①①">ServiceWorkerContainer</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window②">Window</a></code> object, all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task②">tasks</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②">queued</a> on its <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue②">client message queue</a> <em>must</em> be associated with its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document" id="ref-for-responsible-document">responsible document</a>.</p>
     <section class="algorithm" data-algorithm="navigator-service-worker-controller">
      <h4 class="heading settled" data-level="3.4.1" id="navigator-service-worker-controller"><span class="secno">3.4.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-controller" id="ref-for-dom-serviceworkercontainer-controller①">controller</a></code></span><a class="self-link" href="#navigator-service-worker-controller"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="attribute" data-export="" id="dom-serviceworkercontainer-controller"><code>controller</code></dfn> attribute <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>client</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object⑥">context object</a>’s <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client">service worker client</a>.</p>
       <li data-md="">
        <p>Return the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①⑥">ServiceWorker</a></code> object that represents <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker①">active service worker</a>.</p>
      </ol>
      <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-controller" id="ref-for-dom-serviceworkercontainer-controller②">navigator.serviceWorker.controller</a></code> returns <code>null</code> if the request is a force refresh (shift+refresh). The <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①⑦">ServiceWorker</a></code> objects returned from this attribute getter that represent the same <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⑦">service worker</a> are the same objects.</p>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-ready">
      <h4 class="heading settled" data-level="3.4.2" id="navigator-service-worker-ready"><span class="secno">3.4.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-ready" id="ref-for-dom-serviceworkercontainer-ready①">ready</a></code></span><a class="self-link" href="#navigator-service-worker-ready"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="attribute" data-export="" id="dom-serviceworkercontainer-ready"><code>ready</code></dfn> attribute <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>readyPromise</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object⑦">context object</a>'s <a data-link-type="dfn" href="#serviceworkercontainer-ready-promise" id="ref-for-serviceworkercontainer-ready-promise">ready promise</a>.</p>
       <li data-md="">
        <p>If <var>readyPromise</var> is pending, run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>registration</var> be the result of running <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration④">Match Service Worker Registration</a> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object⑧">context object</a>'s <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client①">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url②">creation URL</a>.</p>
         <li data-md="">
          <p>If <var>registration</var> is not null, and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⓪">active worker</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③">queue a task</a> on <var>readyPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑤">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop">responsible event loop</a>, using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①">DOM manipulation task source</a>, to resolve <var>readyPromise</var> with the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑨">ServiceWorkerRegistration</a></code> object that represents <var>registration</var> in <var>readyPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant Realm</a>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>readyPromise</var>.</p>
      </ol>
      <p class="note" role="note"><span>Note:</span> The returned <a data-link-type="dfn" href="#serviceworkercontainer-ready-promise" id="ref-for-serviceworkercontainer-ready-promise①">ready promise</a> will never reject. If it does not resolve in this algorithm, it will eventually resolve when a matching <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⓪">service worker registration</a> is registered and its <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①①">active worker</a> is set. (See the relevant <a href="#activate-resolve-ready-step">Activate algorithm step</a>.)</p>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-register">
      <h4 class="heading settled" data-level="3.4.3" id="navigator-service-worker-register"><span class="secno">3.4.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-register" id="ref-for-dom-serviceworkercontainer-register①">register(scriptURL, options)</a></code></span><a class="self-link" href="#navigator-service-worker-register"></a></h4>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-register" id="ref-for-dom-serviceworkercontainer-register②">register(scriptURL, options)</a></code> method creates or updates a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④①">service worker registration</a> for the given <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url⑧">scope url</a>. If successful, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④②">service worker registration</a> ties the provided <var>scriptURL</var> to a <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url⑨">scope url</a>, which is subsequently used for <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch">navigation matching</a>.</p>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="method" data-export="" data-lt="register(scriptURL, options)|register(scriptURL)" id="dom-serviceworkercontainer-register"><code>register(<var>scriptURL</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>p</var> be a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects③">promise</a>.</p>
       <li data-md="">
        <p>Let <var>client</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object⑨">context object</a>’s <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client②">service worker client</a>.</p>
       <li data-md="">
        <p>Let <var>scriptURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">parsing</a> <var>scriptURL</var> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⓪">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑥">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url">API base URL</a>.</p>
       <li data-md="">
        <p>Let <var>scopeURL</var> be null.</p>
       <li data-md="">
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-registrationoptions-scope" id="ref-for-dom-registrationoptions-scope">scope</a></code> is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-present" id="ref-for-dfn-present">present</a>, set <var>scopeURL</var> to the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">parsing</a> <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-registrationoptions-scope" id="ref-for-dom-registrationoptions-scope①">scope</a></code> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①①">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑦">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url①">API base URL</a>.</p>
       <li data-md="">
        <p>Invoke <a data-link-type="dfn" href="#start-register" id="ref-for-start-register">Start Register</a> with <var>scopeURL</var>, <var>scriptURL</var>, <var>p</var>, <var>client</var>, <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url③">creation URL</a>, <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-registrationoptions-type" id="ref-for-dom-registrationoptions-type">type</a></code>, and <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-registrationoptions-updateviacache" id="ref-for-dom-registrationoptions-updateviacache">updateViaCache</a></code>.</p>
       <li data-md="">
        <p>Return <var>p</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-getRegistration">
      <h4 class="heading settled" data-level="3.4.4" id="navigator-service-worker-getRegistration"><span class="secno">3.4.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-getregistration" id="ref-for-dom-serviceworkercontainer-getregistration①">getRegistration(clientURL)</a></code></span><a class="self-link" href="#navigator-service-worker-getRegistration"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="method" data-export="" data-lt="getRegistration(clientURL)|getRegistration()" id="dom-serviceworkercontainer-getregistration"><code>getRegistration(<var>clientURL</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>client</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①②">context object</a>’s <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client③">service worker client</a>.</p>
       <li data-md="">
        <p>Let <var>clientURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser②">parsing</a> <var>clientURL</var> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①③">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑧">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url②">API base URL</a>.</p>
       <li data-md="">
        <p>If <var>clientURL</var> is failure, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects④">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>Set <var>clientURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment">fragment</a> to null.</p>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a> of <var>clientURL</var> is not <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>, return a <var>promise</var> rejected with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects⑤">promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>registration</var> be the result of running <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration⑤">Match Service Worker Registration</a> algorithm with <var>clientURL</var> as its argument.</p>
         <li data-md="">
          <p>If <var>registration</var> is not null, then:</p>
          <ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⓪">ServiceWorkerRegistration</a></code> object which represents <var>registration</var>.</p>
          </ol>
         <li data-md="">
          <p>Else:</p>
          <ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with undefined.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-getRegistrations">
      <h4 class="heading settled" data-level="3.4.5" id="navigator-service-worker-getRegistrations"><span class="secno">3.4.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-getregistrations" id="ref-for-dom-serviceworkercontainer-getregistrations①">getRegistrations()</a></code></span><a class="self-link" href="#navigator-service-worker-getRegistrations"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="method" data-export="" id="dom-serviceworkercontainer-getregistrations"><code>getRegistrations()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>client</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①④">context object</a>'s <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client④">service worker client</a>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>registrations</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>scope</var> → <var>registration</var> of <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map③">scope to registration map</a>:</p>
          <ol>
           <li data-md="">
            <p>If the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> of the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser③">parsing</a> <var>scope</var> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same</a> as <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin④">origin</a>, and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag">uninstalling flag</a> is unset, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">append</a> <var>registration</var> to <var>registrations</var>.</p>
          </ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task④">Queue a task</a> on <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑨">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①">responsible event loop</a>, using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source②">DOM manipulation task source</a>, to run the following steps:</p>
          <ol>
           <li data-md="">
            <p>Let <var>registrationObjects</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>registration</var> of <var>registrations</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">append</a> the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①①">ServiceWorkerRegistration</a></code> object associated with <var>registration</var> to <var>registrationObjects</var>.</p>
           <li data-md="">
            <p>Resolve <var>promise</var> with <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-frozen-array" id="ref-for-dfn-create-frozen-array">a new frozen array of</a> <var>registrationObjects</var> in <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm①">relevant Realm</a>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="navigator-service-worker-startMessages">
      <h4 class="heading settled" data-level="3.4.6" id="navigator-service-worker-startMessages"><span class="secno">3.4.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-startmessages" id="ref-for-dom-serviceworkercontainer-startmessages①">startMessages()</a></code></span><a class="self-link" href="#navigator-service-worker-startMessages"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="method" data-export="" id="dom-serviceworkercontainer-startmessages"><code>startMessages()</code></dfn> method <em>must</em> enable the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⑤">context object</a>’s <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue③">client message queue</a> if it is not enabled.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="3.4.7" id="service-worker-container-event-handlers"><span class="secno">3.4.7. </span><span class="content">Event handlers</span><a class="self-link" href="#service-worker-container-event-handlers"></a></h4>
      <p>The following are the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers④">event handlers</a> (and their corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type④">event handler event types</a>) that <em>must</em> be supported, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes②">event handler IDL attributes</a>, by all objects implementing the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①②">ServiceWorkerContainer</a></code> interface:</p>
      <table class="data">
       <thead>
        <tr>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers⑤">event handler</a>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type⑤">event handler event type</a>
       <tbody>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="attribute" data-export="" id="dom-serviceworkercontainer-oncontrollerchange"><code>oncontrollerchange</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-container-controllerchange-event" id="ref-for-service-worker-container-controllerchange-event">controllerchange</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="attribute" data-export="" id="dom-serviceworkercontainer-onmessage"><code>onmessage</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-message" id="ref-for-eventdef-serviceworkerglobalscope-message①">message</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="attribute" data-export="" id="dom-serviceworkercontainer-onmessageerror"><code>onmessageerror</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-messageerror" id="ref-for-eventdef-serviceworkerglobalscope-messageerror①">messageerror</a></code>
      </table>
      <p>The first time the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⑥">context object</a>’s <code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-onmessage" id="ref-for-dom-serviceworkercontainer-onmessage①">onmessage</a></code> IDL attribute is set, its <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue④">client message queue</a> <em>must</em> be enabled.</p>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="3.5" id="document-context-events"><span class="secno">3.5. </span><span class="content">Events</span><a class="self-link" href="#document-context-events"></a></h3>
     <p>The following event is dispatched on <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①⑧">ServiceWorker</a></code> object:</p>
     <table class="data">
      <thead>
       <tr>
        <th>Event name
        <th>Interface
        <th>Dispatched when…
      <tbody>
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorker" data-dfn-type="event" data-export="" id="eventdef-serviceworker-statechange"><code>statechange</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event">Event</a></code>
        <td>The <code class="idl"><a data-link-type="idl" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state③">state</a></code> attribute of the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker①⑨">ServiceWorker</a></code> object is changed.
     </table>
     <p>The following event is dispatched on <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①②">ServiceWorkerRegistration</a></code> object:</p>
     <table class="data">
      <thead>
       <tr>
        <th>Event name
        <th>Interface
        <th>Dispatched when…
      <tbody>
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerRegistration" data-dfn-type="event" data-export="" id="service-worker-registration-updatefound-event"><code>updatefound</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event①">Event</a></code>
        <td>The <a data-link-type="dfn" href="#serviceworkerregistration-service-worker-registration" id="ref-for-serviceworkerregistration-service-worker-registration⑤">service worker registration</a>'s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker③">installing worker</a> changes. (See step 8 of the <a data-link-type="dfn" href="#install" id="ref-for-install">Install</a> algorithm.)
     </table>
     <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①③">ServiceWorkerContainer</a></code> object:</p>
     <table class="data">
      <thead>
       <tr>
        <th>Event name
        <th>Interface
        <th>Dispatched when…
      <tbody>
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerContainer" data-dfn-type="event" data-export="" id="service-worker-container-controllerchange-event"><code>controllerchange</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event②">Event</a></code>
        <td>The <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client⑤">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker②">active service worker</a> changes. (See step 9.2 of the <a data-link-type="dfn" href="#activate" id="ref-for-activate">Activate</a> algorithm. The <a data-link-type="dfn" href="#dfn-skip-waiting-flag" id="ref-for-dfn-skip-waiting-flag">skip waiting flag</a> of a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⑧">service worker</a> causes <a data-link-type="dfn" href="#activate" id="ref-for-activate①">activation</a> of the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④③">service worker registration</a> to occur while <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②③">service worker clients</a> are <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use①">using</a> the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④④">service worker registration</a>, <code class="idl"><a data-link-type="idl" href="#dom-serviceworkercontainer-controller" id="ref-for-dom-serviceworkercontainer-controller③">navigator.serviceWorker.controller</a></code> immediately reflects the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①②">active worker</a> as the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker④⑨">service worker</a> that <a data-link-type="dfn" href="#dfn-control" id="ref-for-dfn-control②">controls</a> the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②④">service worker client</a>.)
     </table>
    </section>
   </section>
   <section>
    <h3 class="heading settled" data-level="3.6" id="navigation-preload-manager"><span class="secno">3.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#navigationpreloadmanager" id="ref-for-navigationpreloadmanager③">NavigationPreloadManager</a></code></span><a class="self-link" href="#navigation-preload-manager"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑤">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="navigationpreloadmanager"><code>NavigationPreloadManager</code></dfn> {
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-enable" id="ref-for-dom-navigationpreloadmanager-enable">enable</a>();
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-disable" id="ref-for-dom-navigationpreloadmanager-disable">disable</a>();
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-setheadervalue" id="ref-for-dom-navigationpreloadmanager-setheadervalue">setHeaderValue</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-ByteString" id="ref-for-idl-ByteString"><span class="kt">ByteString</span></a> <dfn class="nv idl-code" data-dfn-for="NavigationPreloadManager/setHeaderValue(value)" data-dfn-type="argument" data-export="" id="dom-navigationpreloadmanager-setheadervalue-value-value"><code>value</code><a class="self-link" href="#dom-navigationpreloadmanager-setheadervalue-value-value"></a></dfn>);
  <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#dictdef-navigationpreloadstate" id="ref-for-dictdef-navigationpreloadstate">NavigationPreloadState</a>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-getstate" id="ref-for-dom-navigationpreloadmanager-getstate">getState</a>();
};

<span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-navigationpreloadstate"><code>NavigationPreloadState</code></dfn> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①"><span class="kt">boolean</span></a> <dfn class="nv dfn-paneled idl-code" data-default="false" data-dfn-for="NavigationPreloadState" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-navigationpreloadstate-enabled"><code>enabled</code></dfn> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-ByteString" id="ref-for-idl-ByteString①"><span class="kt">ByteString</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="NavigationPreloadState" data-dfn-type="dict-member" data-export="" data-type="ByteString " id="dom-navigationpreloadstate-headervalue"><code>headerValue</code></dfn>;
};
</pre>
    <section class="algorithm" data-algorithm="navigation-preload-manager-enable">
     <h4 class="heading settled" data-level="3.6.1" id="navigation-preload-manager-enable"><span class="secno">3.6.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadmanager-enable" id="ref-for-dom-navigationpreloadmanager-enable①">enable()</a></code></span><a class="self-link" href="#navigation-preload-manager-enable"></a></h4>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigationPreloadManager" data-dfn-type="method" data-export="" id="dom-navigationpreloadmanager-enable"><code>enable()</code></dfn> method, when invoked, <em>must</em> return a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects⑥">promise</a> <var>promise</var> and run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③">in parallel</a>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⑦">context object</a>'s associated <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⑤">service worker registration</a>.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①③">active worker</a> is null, <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#reject-promise" id="ref-for-reject-promise">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>, and abort these steps.</p>
      <li data-md="">
       <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-enabled-flag" id="ref-for-service-worker-registration-navigation-preload-enabled-flag">navigation preload enabled flag</a>.</p>
      <li data-md="">
       <p>Resolve <var>promise</var> with undefined.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="navigation-preload-manager-disable">
     <h4 class="heading settled" data-level="3.6.2" id="navigation-preload-manager-disable"><span class="secno">3.6.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadmanager-disable" id="ref-for-dom-navigationpreloadmanager-disable①">disable()</a></code></span><a class="self-link" href="#navigation-preload-manager-disable"></a></h4>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigationPreloadManager" data-dfn-type="method" data-export="" id="dom-navigationpreloadmanager-disable"><code>disable()</code></dfn> method, when invoked, <em>must</em> return a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects⑦">promise</a> <var>promise</var> and run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel④">in parallel</a>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⑧">context object</a>'s associated <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⑥">service worker registration</a>.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①④">active worker</a> is null, <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#reject-promise" id="ref-for-reject-promise①">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>, and abort these steps.</p>
      <li data-md="">
       <p>Unset <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-enabled-flag" id="ref-for-service-worker-registration-navigation-preload-enabled-flag①">navigation preload enabled flag</a>.</p>
      <li data-md="">
       <p>Resolve <var>promise</var> with undefined.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="navigation-preload-manager-setheadervalue">
     <h4 class="heading settled" data-level="3.6.3" id="navigation-preload-manager-setheadervalue"><span class="secno">3.6.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadmanager-setheadervalue" id="ref-for-dom-navigationpreloadmanager-setheadervalue①">setHeaderValue(value)</a></code></span><a class="self-link" href="#navigation-preload-manager-setheadervalue"></a></h4>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigationPreloadManager" data-dfn-type="method" data-export="" id="dom-navigationpreloadmanager-setheadervalue"><code>setHeaderValue(<var>value</var>)</code></dfn> method, when invoked, <em>must</em> return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise②">a new promise</a> <var>promise</var> and run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑤">in parallel</a>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object①⑨">context object</a>'s associated <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⑦">service worker registration</a>.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⑤">active worker</a> is null, <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#reject-promise" id="ref-for-reject-promise②">reject</a> <var>promise</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑤">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>, and abort these steps.</p>
      <li data-md="">
       <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-header-value" id="ref-for-service-worker-registration-navigation-preload-header-value">navigation preload header value</a> to <var>value</var>.</p>
      <li data-md="">
       <p>Resolve <var>promise</var> with undefined.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="navigation-preload-manager-getstate">
     <h4 class="heading settled" data-level="3.6.4" id="navigation-preload-manager-getstate"><span class="secno">3.6.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadmanager-getstate" id="ref-for-dom-navigationpreloadmanager-getstate①">getState()</a></code></span><a class="self-link" href="#navigation-preload-manager-getstate"></a></h4>
     <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="NavigationPreloadManager" data-dfn-type="method" data-export="" id="dom-navigationpreloadmanager-getstate"><code>getState()</code></dfn> method, when invoked, <em>must</em> return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise③">a new promise</a> <var>promise</var> and run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑥">in parallel</a>:</p>
     <ol>
      <li data-md="">
       <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⓪">context object</a>'s associated <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⑧">service worker registration</a>.</p>
      <li data-md="">
       <p>Let <var>state</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-navigationpreloadstate" id="ref-for-dictdef-navigationpreloadstate①">NavigationPreloadState</a></code> dictionary.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-enabled-flag" id="ref-for-service-worker-registration-navigation-preload-enabled-flag②">navigation preload enabled flag</a> is set, set <var>state</var>’s <code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadstate-enabled" id="ref-for-dom-navigationpreloadstate-enabled">enabled</a></code> dictionary member to true.</p>
      <li data-md="">
       <p>Set <var>state</var>’s <code class="idl"><a data-link-type="idl" href="#dom-navigationpreloadstate-headervalue" id="ref-for-dom-navigationpreloadstate-headervalue">headerValue</a></code> dictionary member to the <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-header-value" id="ref-for-service-worker-registration-navigation-preload-header-value①">navigation preload header value</a>.</p>
      <li data-md="">
       <p>Resolve <var>promise</var> with <var>state</var>.</p>
     </ol>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="execution-context"><span class="secno">4. </span><span class="content">Execution Context</span><a class="self-link" href="#execution-context"></a></h2>
    <div class="example" id="example-9b51e2b6">
     <a class="self-link" href="#example-9b51e2b6"></a> Serving Cached Resources: 
<pre class="highlight"><span class="c1">// caching.js</span>
<span class="c1"></span>self<span class="p">.</span>addEventListener<span class="p">(</span><span class="s2">"install"</span><span class="p">,</span> event <span class="p">=></span> <span class="p">{</span>
  event<span class="p">.</span>waitUntil<span class="p">(</span>
    <span class="c1">// Open a cache of resources.</span>
<span class="c1"></span>    caches<span class="p">.</span>open<span class="p">(</span><span class="s2">"shell-v1"</span><span class="p">).</span>then<span class="p">(</span>cache <span class="p">=></span> <span class="p">{</span>
      <span class="c1">// Begins the process of fetching them.</span>
<span class="c1"></span>      <span class="c1">// The coast is only clear when all the resources are ready.</span>
<span class="c1"></span>      <span class="k">return</span> cache<span class="p">.</span>addAll<span class="p">([</span>
        <span class="s2">"/app.html"</span><span class="p">,</span>
        <span class="s2">"/assets/v1/base.css"</span><span class="p">,</span>
        <span class="s2">"/assets/v1/app.js"</span><span class="p">,</span>
        <span class="s2">"/assets/v1/logo.png"</span><span class="p">,</span>
        <span class="s2">"/assets/v1/intro_video.webm"</span>
      <span class="p">]);</span>
    <span class="p">})</span>
  <span class="p">);</span>
<span class="p">});</span>

self<span class="p">.</span>addEventListener<span class="p">(</span><span class="s2">"fetch"</span><span class="p">,</span> event <span class="p">=></span> <span class="p">{</span>
  <span class="c1">// No "fetch" events are dispatched to the service worker until it</span>
<span class="c1"></span>  <span class="c1">// successfully installs and activates.</span>
<span class="c1"></span>
  <span class="c1">// All operations on caches are async, including matching URLs, so we use</span>
<span class="c1"></span>  <span class="c1">// promises heavily. e.respondWith() even takes promises to enable this:</span>
<span class="c1"></span>  event<span class="p">.</span>respondWith<span class="p">(</span>
    caches<span class="p">.</span>match<span class="p">(</span>e<span class="p">.</span>request<span class="p">).</span>then<span class="p">(</span>response <span class="p">=></span> <span class="p">{</span>
      <span class="k">return</span> response <span class="o">||</span> fetch<span class="p">(</span>e<span class="p">.</span>request<span class="p">);</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">(()</span> <span class="p">=></span> <span class="p">{</span>
      <span class="k">return</span> caches<span class="p">.</span>match<span class="p">(</span><span class="s2">"/fallback.html"</span><span class="p">);</span>
    <span class="p">})</span>
  <span class="p">);</span>
<span class="p">});</span>
</pre>
    </div>
    <section>
     <h3 class="heading settled" data-level="4.1" id="serviceworkerglobalscope-interface"><span class="secno">4.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope⑤">ServiceWorkerGlobalScope</a></code></span><a class="self-link" href="#serviceworkerglobalscope-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global">Global</a>=(<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#worker" id="ref-for-worker">Worker</a>,<a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②⓪">ServiceWorker</a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="serviceworkerglobalscope"><code>ServiceWorkerGlobalScope</code></dfn> : <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject③">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#clients" id="ref-for-clients">Clients</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Clients" href="#dom-serviceworkerglobalscope-clients" id="ref-for-dom-serviceworkerglobalscope-clients">clients</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject④">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①③">ServiceWorkerRegistration</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerRegistration" href="#dom-serviceworkerglobalscope-registration" id="ref-for-dom-serviceworkerglobalscope-registration">registration</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑤">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerglobalscope-skipwaiting" id="ref-for-dom-serviceworkerglobalscope-skipwaiting">skipWaiting</a>();

  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑤">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-oninstall" id="ref-for-dom-serviceworkerglobalscope-oninstall">oninstall</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑥">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onactivate" id="ref-for-dom-serviceworkerglobalscope-onactivate">onactivate</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑦">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onfetch" id="ref-for-dom-serviceworkerglobalscope-onfetch">onfetch</a>;

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑧">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onmessage" id="ref-for-dom-serviceworkerglobalscope-onmessage">onmessage</a>; // event.source of the message events is Client object
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑨">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onmessageerror" id="ref-for-dom-serviceworkerglobalscope-onmessageerror">onmessageerror</a>;
};
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope⑥">ServiceWorkerGlobalScope</a></code> object represents the global execution context of a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⓪">service worker</a>. A <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope⑦">ServiceWorkerGlobalScope</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="dfn" data-noexport="" id="serviceworkerglobalscope-service-worker">service worker</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤①">service worker</a>). A <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope⑧">ServiceWorkerGlobalScope</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="dfn" data-noexport="" id="serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">force bypass cache for importscripts flag</dfn>. It is initially unset.</p>
     <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope⑨">ServiceWorkerGlobalScope</a></code> object provides generic, event-driven, time-limited script execution contexts that run at an origin. Once successfully <a data-link-type="dfn" href="#register" id="ref-for-register①">registered</a>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤②">service worker</a> is started, kept alive and killed by their relationship to events, not <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⑤">service worker clients</a>. Any type of synchronous requests must not be initiated inside of a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤③">service worker</a>.</p>
     <section>
      <h4 class="heading settled" data-level="4.1.1" id="service-worker-global-scope-clients"><span class="secno">4.1.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-clients" id="ref-for-dom-serviceworkerglobalscope-clients①">clients</a></code></span><a class="self-link" href="#service-worker-global-scope-clients"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-clients"><code>clients</code></dfn> attribute <em>must</em> return the <code class="idl"><a data-link-type="idl" href="#clients" id="ref-for-clients①">Clients</a></code> object that is associated with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②①">context object</a>.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.1.2" id="service-worker-global-scope-registration"><span class="secno">4.1.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-registration" id="ref-for-dom-serviceworkerglobalscope-registration①">registration</a></code></span><a class="self-link" href="#service-worker-global-scope-registration"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-registration"><code>registration</code></dfn> attribute <em>must</em> return the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①④">ServiceWorkerRegistration</a></code> object that represents the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker②">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration②">containing service worker registration</a>.</p>
     </section>
     <section class="algorithm" data-algorithm="service-worker-global-scope-skipwaiting">
      <h4 class="heading settled" data-level="4.1.3" id="service-worker-global-scope-skipwaiting"><span class="secno">4.1.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-skipwaiting" id="ref-for-dom-serviceworkerglobalscope-skipwaiting①">skipWaiting()</a></code></span><a class="self-link" href="#service-worker-global-scope-skipwaiting"></a></h4>
      <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-skipwaiting" id="ref-for-dom-serviceworkerglobalscope-skipwaiting②">skipWaiting()</a></code> method allows this <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤④">service worker</a> to progress from the <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration③">registration</a>'s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker②">waiting</a> position to <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⑥">active</a> even while <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⑥">service worker clients</a> are <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use②">using</a> the <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration④">registration</a>.</p>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="method" data-export="" id="dom-serviceworkerglobalscope-skipwaiting"><code>skipWaiting()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects⑧">promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑦">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Set <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker③">service worker</a>'s <a data-link-type="dfn" href="#dfn-skip-waiting-flag" id="ref-for-dfn-skip-waiting-flag①">skip waiting flag</a>.</p>
         <li data-md="">
          <p>Invoke <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate">Try Activate</a> with <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker④">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration⑤">containing service worker registration</a>.</p>
         <li data-md="">
          <p>Resolve <var>promise</var> with undefined.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.1.4" id="service-worker-global-scope-event-handlers"><span class="secno">4.1.4. </span><span class="content">Event handlers</span><a class="self-link" href="#service-worker-global-scope-event-handlers"></a></h4>
      <p>The following are the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers⑥">event handlers</a> (and their corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type⑥">event handler event types</a>) that <em>must</em> be supported, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes③">event handler IDL attributes</a>, by all objects implementing the <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①⓪">ServiceWorkerGlobalScope</a></code> interface:</p>
      <table class="data">
       <thead>
        <tr>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers⑦">event handler</a>
         <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type⑦">event handler event type</a>
       <tbody>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-oninstall"><code>oninstall</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event①">install</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-onactivate"><code>onactivate</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event①">activate</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-onfetch"><code>onfetch</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event②">fetch</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-onmessage"><code>onmessage</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-message" id="ref-for-eventdef-serviceworkerglobalscope-message②">message</a></code>
        <tr>
         <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="dom-serviceworkerglobalscope-onmessageerror"><code>onmessageerror</code></dfn>
         <td><code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-messageerror" id="ref-for-eventdef-serviceworkerglobalscope-messageerror②">messageerror</a></code>
      </table>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.2" id="client-interface"><span class="secno">4.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client①">Client</a></code></span><a class="self-link" href="#client-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="client"><code>Client</code></dfn> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑤"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-client-url" id="ref-for-dom-client-url">url</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-client-id" id="ref-for-dom-client-id">id</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-clienttype" id="ref-for-enumdef-clienttype">ClientType</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ClientType" href="#dom-client-type" id="ref-for-dom-client-type">type</a>;
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-client-postmessage" id="ref-for-dom-client-postmessage">postMessage</a>(<span class="kt">any</span> <dfn class="nv idl-code" data-dfn-for="Client/postMessage(message, transfer), Client/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-client-postmessage-message-transfer-message"><code>message</code><a class="self-link" href="#dom-client-postmessage-message-transfer-message"></a></dfn>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-object" id="ref-for-idl-object①"><span class="kt">object</span></a>> <dfn class="nv idl-code" data-dfn-for="Client/postMessage(message, transfer), Client/postMessage(message)" data-dfn-type="argument" data-export="" id="dom-client-postmessage-message-transfer-transfer"><code>transfer</code><a class="self-link" href="#dom-client-postmessage-message-transfer-transfer"></a></dfn> = []);
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="windowclient"><code>WindowClient</code></dfn> : <a class="n" data-link-type="idl-name" href="#client" id="ref-for-client②">Client</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/page-visibility/#VisibilityState" id="ref-for-VisibilityState">VisibilityState</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="VisibilityState" href="#dom-windowclient-visibilitystate" id="ref-for-dom-windowclient-visibilitystate">visibilityState</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean②"><span class="kt">boolean</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-windowclient-focused" id="ref-for-dom-windowclient-focused">focused</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑤">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">FrozenArray</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑥"><span class="kt">USVString</span></a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="FrozenArray<USVString>" href="#dom-windowclient-ancestororigins" id="ref-for-dom-windowclient-ancestororigins">ancestorOrigins</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑥">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient①">WindowClient</a>> <a class="nv idl-code" data-link-type="method" href="#dom-windowclient-focus" id="ref-for-dom-windowclient-focus">focus</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑦">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient②">WindowClient</a>?> <dfn class="nv dfn-paneled idl-code" data-dfn-for="WindowClient" data-dfn-type="method" data-export="" data-lt="navigate(url)" id="dom-windowclient-navigate"><code>navigate</code></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑦"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-dfn-for="WindowClient/navigate(url)" data-dfn-type="argument" data-export="" id="dom-windowclient-navigate-url-url"><code>url</code><a class="self-link" href="#dom-windowclient-navigate-url-url"></a></dfn>);
};
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client③">Client</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Client" data-dfn-type="dfn" data-noexport="" id="client-service-worker-client">service worker client</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⑦">service worker client</a>).</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient③">WindowClient</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="WindowClient" data-dfn-type="dfn" data-noexport="" id="dfn-service-worker-client-browsing-context">browsing context</dfn>, which is its <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global⑦">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a>.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient④">WindowClient</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-service-worker-client-visibilitystate">visibility state</dfn>, which is one of <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate">visibilityState</a></code> attribute value.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient⑤">WindowClient</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-service-worker-client-focusstate">focus state</dfn>, which is either true or false (initially false).</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient⑥">WindowClient</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="WindowClient" data-dfn-type="dfn" data-noexport="" id="windowclient-ancestor-origins-array">ancestor origins array</dfn>.</p>
     <section>
      <h4 class="heading settled" data-level="4.2.1" id="client-url"><span class="secno">4.2.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-client-url" id="ref-for-dom-client-url①">url</a></code></span><a class="self-link" href="#client-url"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Client" data-dfn-type="attribute" data-export="" id="dom-client-url"><code>url</code></dfn> attribute <em>must</em> return the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②②">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①">service worker client</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer③">serialized</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url④">creation URL</a>.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.2.2" id="client-id"><span class="secno">4.2.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-client-id" id="ref-for-dom-client-id①">id</a></code></span><a class="self-link" href="#client-id"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Client" data-dfn-type="attribute" data-export="" id="dom-client-id"><code>id</code></dfn> attribute <em>must</em> return its associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client②">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" id="ref-for-concept-environment-id">id</a>.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.2.3" id="client-type"><span class="secno">4.2.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-client-type" id="ref-for-dom-client-type①">type</a></code></span><a class="self-link" href="#client-type"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Client" data-dfn-type="attribute" data-export="" id="dom-client-type"><code>type</code></dfn> attribute <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>client</var> be <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②③">context object</a>'s <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client③">service worker client</a>.</p>
       <li data-md="">
        <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a>, then:</p>
        <ol>
         <li data-md="">
          <p>If <var>client</var> is a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client">window client</a>, return <code class="idl"><a data-link-type="idl" href="#dom-clienttype-window" id="ref-for-dom-clienttype-window">"window"</a></code>.</p>
         <li data-md="">
          <p>Else if <var>client</var> is a <a data-link-type="dfn" href="#dfn-dedicatedworker-client" id="ref-for-dfn-dedicatedworker-client①">dedicated worker client</a>, return <code class="idl"><a data-link-type="idl" href="#dom-clienttype-worker" id="ref-for-dom-clienttype-worker">"worker"</a></code>.</p>
         <li data-md="">
          <p>Else if <var>client</var> is a <a data-link-type="dfn" href="#dfn-sharedworker-client" id="ref-for-dfn-sharedworker-client①">shared worker client</a>, return <code class="idl"><a data-link-type="idl" href="#dom-clienttype-sharedworker" id="ref-for-dom-clienttype-sharedworker">"sharedworker"</a></code>.</p>
        </ol>
       <li data-md="">
        <p>Else:</p>
        <ol>
         <li data-md="">
          <p>Return <code class="idl"><a data-link-type="idl" href="#dom-clienttype-window" id="ref-for-dom-clienttype-window①">"window"</a></code>.</p>
        </ol>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="client-postmessage">
      <h4 class="heading settled" data-level="4.2.4" id="client-postmessage"><span class="secno">4.2.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-client-postmessage" id="ref-for-dom-client-postmessage①">postMessage(message, transfer)</a></code></span><a class="self-link" href="#client-postmessage"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Client" data-dfn-type="method" data-export="" data-lt="postMessage(message, transfer)|postMessage(message)" id="dom-client-postmessage"><code>postMessage(<var>message</var>, <var>transfer</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>sourceSettings</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②④">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⓪">relevant settings object</a>.</p>
       <li data-md="">
        <p>Let <var>destination</var> be the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①④">ServiceWorkerContainer</a></code> object whose <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client⑥">service worker client</a> is the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⑤">context object</a>’s <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client④">service worker client</a>, or null if no match is found.</p>
       <li data-md="">
        <p>If <var>destination</var> is null, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑥">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>serializeWithTransferResult</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer" id="ref-for-structuredserializewithtransfer①">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). Rethrow any exceptions.</p>
       <li data-md="">
        <p>Add a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task③">task</a> that runs the following steps to <var>destination</var>’s <a data-link-type="dfn" href="#dfn-client-message-queue" id="ref-for-dfn-client-message-queue⑤">client message queue</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>origin</var> be the <a data-link-type="dfn">Unicode serialization</a> of <var>sourceSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin⑤">origin</a>.</p>
         <li data-md="">
          <p>Let <var>source</var> be a <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker②①">ServiceWorker</a></code> object, which represents the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker⑤">service worker</a> associated with <var>sourceSettings</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global⑧">global object</a>.</p>
         <li data-md="">
          <p>Let <var>deserializeRecord</var> be <a data-link-type="abstract-op" href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer" id="ref-for-structureddeserializewithtransfer①">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>destination</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm②">relevant Realm</a>).</p>
          <p>If this throws an exception, catch it, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">fire an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-messageerror" id="ref-for-eventdef-serviceworkerglobalscope-messageerror③">messageerror</a></code> at <var>destination</var>, using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent①">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin①">origin</a></code> attribute initialized to <var>origin</var> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source①">source</a></code> attribute initialized to <var>source</var>, and then abort these steps.</p>
         <li data-md="">
          <p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].</p>
         <li data-md="">
          <p>Let <var>newPorts</var> be a new <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type①">frozen array</a> consisting of all <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport①">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch③">Dispatch an event</a> named <code class="idl"><a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message">message</a></code> at <var>destination</var>, using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent②">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin②">origin</a></code> attribute initialized to <var>origin</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source" id="ref-for-dom-messageevent-source②">source</a></code> attribute initialized to <var>source</var>, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code> attribute initialized to <var>messageClone</var>, and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports" id="ref-for-dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</p>
        </ol>
      </ol>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.2.5" id="client-visibilitystate"><span class="secno">4.2.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-windowclient-visibilitystate" id="ref-for-dom-windowclient-visibilitystate①">visibilityState</a></code></span><a class="self-link" href="#client-visibilitystate"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowClient" data-dfn-type="attribute" data-export="" id="dom-windowclient-visibilitystate"><code>visibilityState</code></dfn> attribute <em>must</em> return the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⑥">context object</a>’s <a data-link-type="dfn" href="#dfn-service-worker-client-visibilitystate" id="ref-for-dfn-service-worker-client-visibilitystate">visibility state</a>.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.2.6" id="client-focused"><span class="secno">4.2.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-windowclient-focused" id="ref-for-dom-windowclient-focused①">focused</a></code></span><a class="self-link" href="#client-focused"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowClient" data-dfn-type="attribute" data-export="" id="dom-windowclient-focused"><code>focused</code></dfn> attribute <em>must</em> return the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⑦">context object</a>’s <a data-link-type="dfn" href="#dfn-service-worker-client-focusstate" id="ref-for-dfn-service-worker-client-focusstate">focus state</a>.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.2.7" id="client-ancestororigins"><span class="secno">4.2.7. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-windowclient-ancestororigins" id="ref-for-dom-windowclient-ancestororigins①">ancestorOrigins</a></code></span><a class="self-link" href="#client-ancestororigins"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowClient" data-dfn-type="attribute" data-export="" id="dom-windowclient-ancestororigins"><code>ancestorOrigins</code></dfn> attribute <em>must</em> return the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⑧">context object</a>’s associated <a data-link-type="dfn" href="#windowclient-ancestor-origins-array" id="ref-for-windowclient-ancestor-origins-array">ancestor origins array</a>.</p>
     </section>
     <section class="algorithm" data-algorithm="client-focus">
      <h4 class="heading settled" data-level="4.2.8" id="client-focus"><span class="secno">4.2.8. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-windowclient-focus" id="ref-for-dom-windowclient-focus①">focus()</a></code></span><a class="self-link" href="#client-focus"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowClient" data-dfn-type="method" data-export="" id="dom-windowclient-focus"><code>focus()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If this algorithm is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#triggered-by-user-activation" id="ref-for-triggered-by-user-activation">triggered by user activation</a>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects⑨">promise</a> rejected with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidaccesserror" id="ref-for-invalidaccesserror">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⓪">promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑧">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>browsingContext</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object②⑨">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client⑤">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global⑨">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context①">browsing context</a>.</p>
         <li data-md="">
          <p>Let <var>visibilityState</var> be null.</p>
         <li data-md="">
          <p>Let <var>focusState</var> be false.</p>
         <li data-md="">
          <p>Let <var>ancestorOriginsList</var> be the empty list.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑤">Queue a task</a> <var>task</var> to run the following substeps on the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⓪">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client⑥">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop②">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source" id="ref-for-user-interaction-task-source">user interaction task source</a>:</p>
          <ol>
           <li data-md="">
            <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps">focusing steps</a> with <var>browsingContext</var>.</p>
           <li data-md="">
            <p>Set <var>visibilityState</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document">active document</a>’s <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate①">visibilityState</a></code> attribute value.</p>
           <li data-md="">
            <p>Set <var>focusState</var> to the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps" id="ref-for-has-focus-steps">has focus steps</a> with <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①">active document</a> as the argument.</p>
           <li data-md="">
            <p>Set <var>ancestorOriginsList</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document②">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/history.html#location" id="ref-for-location">Location</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list" id="ref-for-concept-location-ancestor-origins-list">ancestor origins list</a>'s associated list.</p>
          </ol>
         <li data-md="">
          <p>Wait for <var>task</var> to have executed.</p>
         <li data-md="">
          <p>Let <var>windowClient</var> be the result of running <a data-link-type="dfn" href="#create-window-client" id="ref-for-create-window-client">Create Window Client</a> algorithm with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③①">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client⑦">service worker client</a>, <var>visibilityState</var>, <var>focusState</var>, and <var>ancestorOriginsList</var> as the arguments.</p>
         <li data-md="">
          <p>If <var>windowClient</var>’s <a data-link-type="dfn" href="#dfn-service-worker-client-focusstate" id="ref-for-dfn-service-worker-client-focusstate①">focus state</a> is true, resolve <var>promise</var> with <var>windowClient</var>.</p>
         <li data-md="">
          <p>Else, reject <var>promise</var> with a <code>TypeError</code>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="client-navigate">
      <h4 class="heading settled" data-level="4.2.9" id="client-navigate"><span class="secno">4.2.9. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-windowclient-navigate" id="ref-for-dom-windowclient-navigate">navigate(url)</a></code></span><a class="self-link" href="#client-navigate"></a></h4>
      <p>The <dfn class="idl-code" data-dfn-for="WindowClient" data-dfn-type="method" data-export="" id="dom-windowclient-navigate①"><code>navigate()</code><a class="self-link" href="#dom-windowclient-navigate①"></a></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>url</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser④">parsing</a> <var>url</var> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③②">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①①">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url③">API base URL</a>.</p>
       <li data-md="">
        <p>If <var>url</var> is failure, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①①">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>If <var>url</var> is <code>about:blank</code>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①②">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③③">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client⑧">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker③">active service worker</a> is not the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③④">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a>’s <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker⑥">service worker</a>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①③">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①④">promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel⑨">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>browsingContext</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⑤">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client⑨">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⓪">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context②">browsing context</a>.</p>
         <li data-md="">
          <p>If <var>browsingContext</var> has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#discard-a-document" id="ref-for-discard-a-document">discarded</a> its <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>, reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
         <li data-md="">
          <p>Let <var>navigateFailed</var> be false.</p>
         <li data-md="">
          <p>Let <var>visibilityState</var> be null.</p>
         <li data-md="">
          <p>Let <var>focusState</var> be false.</p>
         <li data-md="">
          <p>Let <var>ancestorOriginsList</var> be the empty list.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑥">Queue a task</a> <var>task</var> to run the following substeps on the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⑥">context object</a>’s associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①⓪">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop③">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source" id="ref-for-user-interaction-task-source①">user interaction task source</a>:</p>
          <ol>
           <li data-md="">
            <p><em>HandleNavigate</em>: <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">Navigate</a> <var>browsingContext</var> to <var>url</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#exceptions-enabled" id="ref-for-exceptions-enabled">exceptions enabled</a>. The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context" id="ref-for-source-browsing-context">source browsing context</a> must be <var>browsingContext</var>.</p>
           <li data-md="">
            <p>If the algorithm steps invoked in the step labeled <em>HandleNavigate</em> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②">throws</a> an exception, set <var>navigateFailed</var> to true.</p>
           <li data-md="">
            <p>Set <var>visibilityState</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document③">active document</a>’s <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate②">visibilityState</a></code> attribute value.</p>
           <li data-md="">
            <p>Set <var>focusState</var> to the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps" id="ref-for-has-focus-steps①">has focus steps</a> with <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document④">active document</a> as the argument.</p>
           <li data-md="">
            <p>Set <var>ancestorOriginsList</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑤">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/history.html#location" id="ref-for-location①">Location</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list" id="ref-for-concept-location-ancestor-origins-list①">ancestor origins list</a>'s associated list.</p>
          </ol>
         <li data-md="">
          <p>Wait for <var>task</var> to have executed (including its asynchronous steps).</p>
         <li data-md="">
          <p>If <var>navigateFailed</var> is true, reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
         <li data-md="">
          <p>If <var>browsingContext</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window③">Window</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url⑤">creation URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a> is not the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin①">same</a> as the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker⑦">service worker</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin⑥">origin</a>, then:</p>
          <ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with null.</p>
           <li data-md="">
            <p>Abort these steps.</p>
          </ol>
         <li data-md="">
          <p>Let <var>windowClient</var> be the result of running <a data-link-type="dfn" href="#create-window-client" id="ref-for-create-window-client①">Create Window Client</a> algorithm with <var>browsingContext</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window④">Window</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object③">environment settings object</a>, <var>visibilityState</var>, <var>focusState</var>, and <var>ancestorOriginsList</var> as the arguments.</p>
         <li data-md="">
          <p>Resolve <var>promise</var> with <var>windowClient</var>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.3" id="clients-interface"><span class="secno">4.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#clients" id="ref-for-clients②">Clients</a></code></span><a class="self-link" href="#clients-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑦">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="clients"><code>Clients</code></dfn> {
  // The objects returned will be new instances every time
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑧">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-get" id="ref-for-dom-clients-get">get</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="Clients/get(id)" data-dfn-type="argument" data-export="" id="dom-clients-get-id-id"><code>id</code><a class="self-link" href="#dom-clients-get-id-id"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑨">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client④">Client</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-matchall" id="ref-for-dom-clients-matchall">matchAll</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-clientqueryoptions" id="ref-for-dictdef-clientqueryoptions">ClientQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="Clients/matchAll(options), Clients/matchAll()" data-dfn-type="argument" data-export="" id="dom-clients-matchall-options-options"><code>options</code><a class="self-link" href="#dom-clients-matchall-options-options"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⓪">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient⑦">WindowClient</a>?> <a class="nv idl-code" data-link-type="method" href="#dom-clients-openwindow" id="ref-for-dom-clients-openwindow">openWindow</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑧"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-dfn-for="Clients/openWindow(url)" data-dfn-type="argument" data-export="" id="dom-clients-openwindow-url-url"><code>url</code><a class="self-link" href="#dom-clients-openwindow-url-url"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-claim" id="ref-for-dom-clients-claim">claim</a>();
};
</pre>
<pre class="idl highlight def" id="serviceworker-client-query-options-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-clientqueryoptions"><code>ClientQueryOptions</code></dfn> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean③"><span class="kt">boolean</span></a> <dfn class="nv dfn-paneled idl-code" data-default="false" data-dfn-for="ClientQueryOptions" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-clientqueryoptions-includeuncontrolled"><code>includeUncontrolled</code></dfn> = <span class="kt">false</span>;
  <a class="n" data-link-type="idl-name" href="#enumdef-clienttype" id="ref-for-enumdef-clienttype①">ClientType</a> <dfn class="nv dfn-paneled idl-code" data-default="&quot;window&quot;" data-dfn-for="ClientQueryOptions" data-dfn-type="dict-member" data-export="" data-type="ClientType " id="dom-clientqueryoptions-type"><code>type</code></dfn> = "window";
};
</pre>
<pre class="idl highlight def" id="client-type-enum"><span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-clienttype"><code>ClientType</code></dfn> {
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ClientType" data-dfn-type="enum-value" data-export="" data-lt="&quot;window&quot;|window" id="dom-clienttype-window"><code>"window"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ClientType" data-dfn-type="enum-value" data-export="" data-lt="&quot;worker&quot;|worker" id="dom-clienttype-worker"><code>"worker"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ClientType" data-dfn-type="enum-value" data-export="" data-lt="&quot;sharedworker&quot;|sharedworker" id="dom-clienttype-sharedworker"><code>"sharedworker"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="ClientType" data-dfn-type="enum-value" data-export="" data-lt="&quot;all&quot;|all" id="dom-clienttype-all"><code>"all"</code></dfn>
};
</pre>
     <p>The user agent <em>must</em> create a <code class="idl"><a data-link-type="idl" href="#clients" id="ref-for-clients③">Clients</a></code> object when a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①①">ServiceWorkerGlobalScope</a></code> object is created and associate it with that object.</p>
     <section class="algorithm" data-algorithm="clients-get">
      <h4 class="heading settled" data-level="4.3.1" id="clients-get"><span class="secno">4.3.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-clients-get" id="ref-for-dom-clients-get①">get(id)</a></code></span><a class="self-link" href="#clients-get"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Clients" data-dfn-type="method" data-export="" id="dom-clients-get"><code>get(<var>id</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⑤">promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⓪">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>For each <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⑧">service worker client</a> <var>client</var> whose <a data-link-type="dfn" href="#service-worker-client-origin" id="ref-for-service-worker-client-origin">origin</a> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin②">same</a> as the associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker⑧">service worker</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin⑦">origin</a>:</p>
          <ol>
           <li data-md="">
            <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" id="ref-for-concept-environment-id①">id</a> is not <var>id</var>, continue to the next iteration of the loop.</p>
           <li data-md="">
            <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object④">environment settings object</a>, then:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts">secure context</a>, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror①">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑨">DOMException</a></code> and abort these steps.</p>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url⑥">creation URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url">potentially trustworthy URL</a>, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror②">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⓪">DOMException</a></code> and abort these steps.</p>
            </ol>
           <li data-md="">
            <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑤">environment settings object</a> and is not a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client①">window client</a>, then:</p>
            <ol>
             <li data-md="">
              <p>Let <var>clientObject</var> be the result of running <a data-link-type="dfn" href="#create-client" id="ref-for-create-client">Create Client</a> algorithm with <var>client</var> as the argument.</p>
             <li data-md="">
              <p>Resolve <var>promise</var> with <var>clientObject</var> and abort these steps.</p>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>Let <var>browsingContext</var> be null.</p>
             <li data-md="">
              <p>Let <var>visibilityState</var> be null.</p>
             <li data-md="">
              <p>Let <var>focusState</var> be false.</p>
             <li data-md="">
              <p>Let <var>ancestorOriginsList</var> be the empty list.</p>
             <li data-md="">
              <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑥">environment settings object</a>, set <var>browsingContext</var> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①①">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context③">browsing context</a>.</p>
             <li data-md="">
              <p>Else, set <var>browsingContext</var> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target browsing context</a>.</p>
             <li data-md="">
              <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑦">Queue a task</a> <var>task</var> to run the following substeps on <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop⑤">event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source" id="ref-for-user-interaction-task-source②">user interaction task source</a>:</p>
              <ol>
               <li data-md="">
                <p>Set <var>visibilityState</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑥">active document</a>’s <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate③">visibilityState</a></code> attribute value.</p>
               <li data-md="">
                <p>Set <var>focusState</var> to the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps" id="ref-for-has-focus-steps②">has focus steps</a> with <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑦">active document</a> as the argument.</p>
               <li data-md="">
                <p>If <var>client</var> is a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client②">window client</a>, set <var>ancestorOriginsList</var> to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑧">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global④">relevant global object</a>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/history.html#location" id="ref-for-location②">Location</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list" id="ref-for-concept-location-ancestor-origins-list②">ancestor origins list</a>'s associated list.</p>
              </ol>
             <li data-md="">
              <p>Wait for <var>task</var> to have executed.</p>
             <li data-md="">
              <p>Let <var>windowClient</var> be the result of running <a data-link-type="dfn" href="#create-window-client" id="ref-for-create-window-client②">Create Window Client</a> algorithm with <var>client</var>, <var>visibilityState</var>, <var>focusState</var>, and <var>ancestorOriginsList</var> as the arguments.</p>
             <li data-md="">
              <p>Resolve <var>promise</var> with <var>windowClient</var> and abort these steps.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Resolve <var>promise</var> with undefined.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="clients-matchall">
      <h4 class="heading settled" data-level="4.3.2" id="clients-matchall"><span class="secno">4.3.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-clients-matchall" id="ref-for-dom-clients-matchall①">matchAll(options)</a></code></span><a class="self-link" href="#clients-matchall"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Clients" data-dfn-type="method" data-export="" data-lt="matchAll(options)|matchAll()" id="dom-clients-matchall"><code>matchAll(<var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise④">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①①">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>targetClients</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a>.</p>
         <li data-md="">
          <p>For each <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client②⑨">service worker client</a> <var>client</var> whose <a data-link-type="dfn" href="#service-worker-client-origin" id="ref-for-service-worker-client-origin①">origin</a> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin③">same</a> as the associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker⑨">service worker</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin⑧">origin</a>:</p>
          <ol>
           <li data-md="">
            <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑦">environment settings object</a>, then:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts①">secure context</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url⑦">creation URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url①">potentially trustworthy URL</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
            </ol>
           <li data-md="">
            <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-clientqueryoptions-includeuncontrolled" id="ref-for-dom-clientqueryoptions-includeuncontrolled">includeUncontrolled</a></code>"] is false, and if <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker④">active service worker</a> is not the associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⓪">service worker</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
           <li data-md="">
            <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag" id="ref-for-concept-environment-execution-ready-flag">execution ready flag</a> is unset, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
           <li data-md="">
            <p>Add <var>client</var> to <var>targetClients</var>.</p>
          </ol>
         <li data-md="">
          <p>Let <var>matchedWindowData</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>.</p>
         <li data-md="">
          <p>Let <var>matchedClients</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a>.</p>
         <li data-md="">
          <p>For each <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⓪">service worker client</a> <var>client</var> in <var>targetClients</var>:</p>
          <ol>
           <li data-md="">
            <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-clientqueryoptions-type" id="ref-for-dom-clientqueryoptions-type">type</a></code>"] is <code class="idl"><a data-link-type="idl" href="#dom-clienttype-window" id="ref-for-dom-clienttype-window②">"window"</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-clienttype-all" id="ref-for-dom-clienttype-all">"all"</a></code>, and <var>client</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑧">environment settings object</a> or is a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client③">window client</a>, then:</p>
            <ol>
             <li data-md="">
              <p>Let <var>windowData</var> be «[ "client" → <var>client</var>, "ancestorOriginsList" → a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a> ]».</p>
             <li data-md="">
              <p>Let <var>browsingContext</var> be null.</p>
             <li data-md="">
              <p>Let <var>isClientEnumerable</var> be true.</p>
             <li data-md="">
              <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object⑨">environment settings object</a>, set <var>browsingContext</var> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①②">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context④">browsing context</a>.</p>
             <li data-md="">
              <p>Else, set <var>browsingContext</var> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context①">target browsing context</a>.</p>
             <li data-md="">
              <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑧">Queue a task</a> <var>task</var> to run the following substeps on <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop⑥">event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source" id="ref-for-user-interaction-task-source③">user interaction task source</a>:</p>
              <ol>
               <li data-md="">
                <p>If <var>browsingContext</var> has been <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded" id="ref-for-a-browsing-context-is-discarded">discarded</a>, then set <var>isClientEnumerable</var> to false and abort these steps.</p>
               <li data-md="">
                <p>If <var>client</var> is a window client and <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document" id="ref-for-responsible-document①">responsible document</a> is not <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑨">active document</a>, then set <var>isClientEnumerable</var> to false and abort these steps.</p>
               <li data-md="">
                <p>Set <var>windowData</var>["<code>visibilityState</code>"] to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①⓪">active document</a>'s <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate④">visibilityState</a></code> attribute value.</p>
               <li data-md="">
                <p>Set <var>windowData</var>["<code>focusState</code>"] to the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps" id="ref-for-has-focus-steps③">has focus steps</a> with <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①①">active document</a> as the argument.</p>
               <li data-md="">
                <p>If <var>client</var> is a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client④">window client</a>, then set <var>windowData</var>["<code>ancestorOriginsList</code>"] to <var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①②">active document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑤">relevant global object</a>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/history.html#location" id="ref-for-location③">Location</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list" id="ref-for-concept-location-ancestor-origins-list③">ancestor origins list</a>'s associated list.</p>
              </ol>
             <li data-md="">
              <p>Wait for <var>task</var> to have executed.</p>
              <p class="note" role="note"><span>Note:</span> Wait is a blocking wait, but implementers may run the iterations in parallel as long as the state is not broken.</p>
             <li data-md="">
              <p>If <var>isClientEnumerable</var> is true, then:</p>
              <ol>
               <li data-md="">
                <p>Add <var>windowData</var> to <var>matchedWindowData</var>.</p>
              </ol>
            </ol>
           <li data-md="">
            <p>Else if <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-clientqueryoptions-type" id="ref-for-dom-clientqueryoptions-type①">type</a></code>"] is <code class="idl"><a data-link-type="idl" href="#dom-clienttype-worker" id="ref-for-dom-clienttype-worker①">"worker"</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-clienttype-all" id="ref-for-dom-clienttype-all①">"all"</a></code> and <var>client</var> is a <a data-link-type="dfn" href="#dfn-dedicatedworker-client" id="ref-for-dfn-dedicatedworker-client②">dedicated worker client</a>, or <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-clientqueryoptions-type" id="ref-for-dom-clientqueryoptions-type②">type</a></code>"] is <code class="idl"><a data-link-type="idl" href="#dom-clienttype-sharedworker" id="ref-for-dom-clienttype-sharedworker①">"sharedworker"</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-clienttype-all" id="ref-for-dom-clienttype-all②">"all"</a></code> and <var>client</var> is a <a data-link-type="dfn" href="#dfn-sharedworker-client" id="ref-for-dfn-sharedworker-client②">shared worker client</a>, then:</p>
            <ol>
             <li data-md="">
              <p>Add <var>client</var> to <var>matchedClients</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑨">Queue a task</a> on <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①②">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop④">responsible event loop</a>, using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source③">DOM manipulation task source</a>, to run the following steps:</p>
          <ol>
           <li data-md="">
            <p>Let <var>clientObjects</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">list</a>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>windowData</var> in <var>matchedWindowData</var>:</p>
            <ol>
             <li data-md="">
              <p>Let <var>windowClient</var> be the result of running <a data-link-type="dfn" href="#create-window-client" id="ref-for-create-window-client③">Create Window Client</a> algorithm with <var>windowData</var>["<code>client</code>"], <var>windowData</var>["<code>visibilityState</code>"], <var>windowData</var>["<code>focusState</code>"], and <var>windowData</var>["<code>ancestorOriginsList</code>"] as the arguments.</p>
             <li data-md="">
              <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>windowClient</var> to <var>clientObjects</var>.</p>
            </ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>client</var> in <var>matchedClients</var>:</p>
            <ol>
             <li data-md="">
              <p>Let <var>clientObject</var> be the result of running <a data-link-type="dfn" href="#create-client" id="ref-for-create-client①">Create Client</a> algorithm with <var>client</var> as the argument.</p>
             <li data-md="">
              <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append③">Append</a> <var>clientObject</var> to <var>clientObjects</var>.</p>
            </ol>
           <li data-md="">
            <p>Sort <var>clientObjects</var> such that:</p>
            <ul>
             <li data-md="">
              <p><code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient⑧">WindowClient</a></code> objects whose <a data-link-type="dfn" href="#dfn-service-worker-client-browsing-context" id="ref-for-dfn-service-worker-client-browsing-context">browsing context</a> has been <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps①">focused</a> are placed first, sorted in the most recently <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps②">focused</a> order.</p>
             <li data-md="">
              <p><code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient⑨">WindowClient</a></code> objects whose <a data-link-type="dfn" href="#dfn-service-worker-client-browsing-context" id="ref-for-dfn-service-worker-client-browsing-context①">browsing context</a> has never been <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps③">focused</a> are placed next, sorted in their <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①①">service worker client</a>'s creation order.</p>
             <li data-md="">
              <p><code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client⑤">Client</a></code> objects whose associated <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①②">service worker client</a> is a <a data-link-type="dfn" href="#dfn-worker-client" id="ref-for-dfn-worker-client①">worker client</a> are placed next, sorted in their <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①③">service worker client</a>'s creation order.</p>
            </ul>
            <p class="note" role="note"><span>Note:</span> <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client⑤">Window clients</a> are always placed before <a data-link-type="dfn" href="#dfn-worker-client" id="ref-for-dfn-worker-client②">worker clients</a>.</p>
           <li data-md="">
            <p>Resolve <var>promise</var> with <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-frozen-array" id="ref-for-dfn-create-frozen-array①">a new frozen array of</a> <var>clientObjects</var> in <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm③">relevant Realm</a>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="clients-openwindow">
      <h4 class="heading settled" data-level="4.3.3" id="clients-openwindow"><span class="secno">4.3.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-clients-openwindow" id="ref-for-dom-clients-openwindow①">openWindow(url)</a></code></span><a class="self-link" href="#clients-openwindow"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Clients" data-dfn-type="method" data-export="" id="dom-clients-openwindow"><code>openWindow(<var>url</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>url</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser⑤">parsing</a> <var>url</var> with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⑦">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①③">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url④">API base URL</a>.</p>
       <li data-md="">
        <p>If <var>url</var> is failure, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⑥">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>If <var>url</var> is <code>about:blank</code>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⑦">promise</a> rejected with a <code>TypeError</code>.</p>
       <li data-md="">
        <p>If this algorithm is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#triggered-by-user-activation" id="ref-for-triggered-by-user-activation①">triggered by user activation</a>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⑧">promise</a> rejected with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidaccesserror" id="ref-for-invalidaccesserror①">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①①">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects①⑨">promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①②">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>newContext</var> be a new <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>.</p>
         <li data-md="">
          <p>Let <var>openWindowFailed</var> to false.</p>
         <li data-md="">
          <p>Let <var>visibilityState</var> be null.</p>
         <li data-md="">
          <p>Let <var>focusState</var> be false.</p>
         <li data-md="">
          <p>Let <var>ancestorOriginsList</var> be the empty list.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⓪">Queue a task</a> <var>task</var> to run the following substeps on <var>newContext</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑤">Window</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⓪">environment settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop⑤">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source" id="ref-for-user-interaction-task-source④">user interaction task source</a>:</p>
          <ol>
           <li data-md="">
            <p><em>HandleNavigate</em>: <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">Navigate</a> <var>newContext</var> to <var>url</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#exceptions-enabled" id="ref-for-exceptions-enabled①">exceptions enabled</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#replacement-enabled" id="ref-for-replacement-enabled">replacement enabled</a>.</p>
           <li data-md="">
            <p>If the algorithm steps invoked in the step labeled <em>HandleNavigate</em> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw③">throws</a> an exception, set <var>openWindowFailed</var> to true.</p>
           <li data-md="">
            <p>Set <var>visibilityState</var> to <var>newContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①③">active document</a>’s <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate" id="ref-for-dom-document-visibilitystate⑤">visibilityState</a></code> attribute value.</p>
           <li data-md="">
            <p>Set <var>focusState</var> to the result of running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps" id="ref-for-has-focus-steps④">has focus steps</a> with <var>newContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①④">active document</a> as the argument.</p>
           <li data-md="">
            <p>Set <var>ancestorOriginsList</var> to <var>newContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①⑤">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑥">relevant global object</a>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/history.html#location" id="ref-for-location④">Location</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list" id="ref-for-concept-location-ancestor-origins-list④">ancestor origins list</a>'s associated list.</p>
          </ol>
         <li data-md="">
          <p>Wait for <var>task</var> to have executed (including its asynchronous steps).</p>
         <li data-md="">
          <p>If <var>openWindowFailed</var> is true, reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
         <li data-md="">
          <p>If <var>newContext</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑥">Window</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①①">environment settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url⑧">creation URL</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin⑨">origin</a> is not the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin④">same</a> as the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①①">service worker</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⓪">origin</a>, then:</p>
          <ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with null.</p>
           <li data-md="">
            <p>Abort these steps.</p>
          </ol>
         <li data-md="">
          <p>Let <var>client</var> be the result of running <a data-link-type="dfn" href="#create-window-client" id="ref-for-create-window-client④">Create Window Client</a> algorithm with <var>newContext</var>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑦">Window</a></code> object’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①②">environment settings object</a>, <var>visibilityState</var>, <var>focusState</var>, and <var>ancestorOriginsList</var> as the arguments.</p>
         <li data-md="">
          <p>Resolve <var>promise</var> with <var>client</var>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="clients-claim">
      <h4 class="heading settled" data-level="4.3.4" id="clients-claim"><span class="secno">4.3.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-clients-claim" id="ref-for-dom-clients-claim①">claim()</a></code></span><a class="self-link" href="#clients-claim"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Clients" data-dfn-type="method" data-export="" id="dom-clients-claim"><code>claim()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①②">service worker</a> is not an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⑦">active worker</a>, return a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⓪">promise</a> rejected with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑦">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①②">DOMException</a></code>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②①">promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①③">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>For each <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③①">service worker client</a> <var>client</var> whose <a data-link-type="dfn" href="#service-worker-client-origin" id="ref-for-service-worker-client-origin②">origin</a> is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin⑤">same</a> as the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①③">service worker</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①①">origin</a>:</p>
          <ol>
           <li data-md="">
            <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①③">environment settings object</a>, then:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts②">secure context</a>, continue to the next iteration of the loop.</p>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url⑨">creation URL</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url②">potentially trustworthy URL</a>, continue to the next iteration of the loop.</p>
            </ol>
           <li data-md="">
            <p>Let <var>registration</var> be the result of running <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration⑥">Match Service Worker Registration</a> algorithm passing <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①⓪">creation URL</a> as the argument.</p>
           <li data-md="">
            <p>If <var>registration</var> is not the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①④">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration⑥">containing service worker registration</a>, continue to the next iteration of the loop.</p>
           <li data-md="">
            <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker⑤">active service worker</a> is not the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⑤">service worker</a>, then:</p>
            <ol>
             <li data-md="">
              <p>Invoke <a data-link-type="dfn" href="#handle-service-worker-client-unload" id="ref-for-handle-service-worker-client-unload">Handle Service Worker Client Unload</a> with <var>client</var> as the argument.</p>
             <li data-md="">
              <p>Set <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker⑥">active service worker</a> to <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⑥">service worker</a>.</p>
             <li data-md="">
              <p>Invoke <a data-link-type="dfn" href="#notify-controller-change" id="ref-for-notify-controller-change">Notify Controller Change</a> algorithm with <var>client</var> as the argument.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Resolve <var>promise</var> with undefined.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.4" id="extendableevent-interface"><span class="secno">4.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①">ExtendableEvent</a></code></span><a class="self-link" href="#extendableevent-interface"></a></h3>
<pre class="idl highlight def">[<dfn class="nv idl-code" data-dfn-for="ExtendableEvent" data-dfn-type="constructor" data-export="" data-lt="ExtendableEvent(type, eventInitDict)|ExtendableEvent(type)" id="dom-extendableevent-extendableevent"><code>Constructor</code><a class="self-link" href="#dom-extendableevent-extendableevent"></a></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="ExtendableEvent/ExtendableEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-extendableevent-extendableevent-type-eventinitdict-type"><code>type</code><a class="self-link" href="#dom-extendableevent-extendableevent-type-eventinitdict-type"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit">ExtendableEventInit</a> <dfn class="nv idl-code" data-dfn-for="ExtendableEvent/ExtendableEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-extendableevent-extendableevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code><a class="self-link" href="#dom-extendableevent-extendableevent-type-eventinitdict-eventinitdict"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑧">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="extendableevent"><code>ExtendableEvent</code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event③">Event</a> {
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil">waitUntil</a>(<span class="kt">Promise</span>&lt;<span class="kt">any</span>> <dfn class="nv idl-code" data-dfn-for="ExtendableEvent/waitUntil(f)" data-dfn-type="argument" data-export="" id="dom-extendableevent-waituntil-f-f"><code>f</code><a class="self-link" href="#dom-extendableevent-waituntil-f-f"></a></dfn>);
};
</pre>
<pre class="idl highlight def" id="extendable-event-init-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-extendableeventinit"><code>ExtendableEventInit</code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit">EventInit</a> {
  // Defined for the forward compatibility across the derived events
};
</pre>
     <p>An <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent②">ExtendableEvent</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="ExtendableEvent" data-dfn-type="dfn" data-noexport="" id="extendableevent-extend-lifetime-promises">extend lifetime promises</dfn> (an array of <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②②">promises</a>). It is initially an empty array.</p>
     <p>An <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent③">ExtendableEvent</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="ExtendableEvent" data-dfn-type="dfn" data-noexport="" id="extendableevent-pending-promises-count">pending promises count</dfn> (the number of pending promises in the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises">extend lifetime promises</a>). It is initially set to zero.</p>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⑤">Service workers</a> have two <a data-link-type="dfn" href="#dfn-lifecycle-events" id="ref-for-dfn-lifecycle-events">lifecycle events</a>, <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event②">install</a></code> and <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event②">activate</a></code>. <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⑥">Service workers</a> use the <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent④">ExtendableEvent</a></code> interface for <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event③">activate</a></code> event and <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event③">install</a></code> event.</p>
     <p><a href="#extensibility">Service worker extensions</a> that <a href="#extension-to-service-worker-global-scope">define event handlers</a> <em>may</em> also use or extend the <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent⑤">ExtendableEvent</a></code> interface.</p>
     <section class="algorithm" data-algorithm="wait-until-method">
      <h4 class="heading settled" data-level="4.4.1" id="wait-until-method"><span class="secno">4.4.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil①">event.waitUntil(f)</a></code></span><a class="self-link" href="#wait-until-method"></a></h4>
      <p><code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil②">waitUntil()</a></code> method extends the lifetime of the event.</p>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableEvent" data-dfn-type="method" data-export="" id="dom-extendableevent-waituntil"><code>waitUntil(<var>f</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-istrusted" id="ref-for-dom-event-istrusted">isTrusted</a></code> attribute is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw④">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑧">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①③">DOMException</a></code>.</p>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count">pending promises count</a> is zero and the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#dispatch-flag" id="ref-for-dispatch-flag">dispatch flag</a> is unset, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑤">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror⑨">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①④">DOMException</a></code>.</p>
        <p class="note" role="note"><span>Note:</span> If no lifetime extension promise has been added in the task that called the event handlers, calling <code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil③">waitUntil()</a></code> in subsequent asynchronous tasks will throw.</p>
       <li data-md="">
        <p>Add <var>f</var> to the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises①">extend lifetime promises</a>.</p>
       <li data-md="">
        <p>Increment the <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count①">pending promises count</a> by one.</p>
        <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count②">pending promises count</a> is incremented even if the given promise has already been settled. The corresponding count decrement is done in the microtask queued by the reaction to the promise.</p>
       <li data-md="">
        <p>Upon <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-fulfillment" id="ref-for-upon-fulfillment">fulfillment</a> or <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-rejection" id="ref-for-upon-rejection">rejection</a> of <var>f</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask" id="ref-for-queue-a-microtask">queue a microtask</a> to run these substeps:</p>
        <ol>
         <li data-md="">
          <p>Decrement the <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count③">pending promises count</a> by one.</p>
         <li data-md="">
          <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⑧">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑦">relevant global object</a>'s associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⑦">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration⑦">containing service worker registration</a>.</p>
         <li data-md="">
          <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag①">uninstalling flag</a> is set, invoke <a data-link-type="dfn" href="#try-clear-registration" id="ref-for-try-clear-registration">Try Clear Registration</a> with <var>registration</var>.</p>
         <li data-md="">
          <p>If <var>registration</var> is not null, invoke <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate①">Try Activate</a> with <var>registration</var>.</p>
        </ol>
      </ol>
      <p>The user agent <em>should not</em> <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker②">terminate</a> the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⑦">service worker</a> associated with <var>event</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①④">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①③">global object</a> when <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#dispatch-flag" id="ref-for-dispatch-flag①">dispatch flag</a> is set or <var>event</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count④">pending promises count</a> is not zero. However, the user agent <em>may</em> impose a time limit to this lifetime extension.</p>
     </section>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⑧">Service workers</a> and <a href="#extensibility">extensions</a> that <a href="#extension-to-service-worker-global-scope">define event handlers</a> <em>may</em> define their own behaviors, allowing the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises②">extend lifetime promises</a> to suggest operation length, and the rejected state of any of the <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②③">promise</a> in <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises③">extend lifetime promises</a> to suggest operation failure.</p>
     <p class="note" role="note"><span>Note:</span> <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑤⑨">Service workers</a> delay treating the <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker④">installing worker</a> as <em>installed</em> until all the <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②④">promises</a> in the <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event④">install</a></code> event’s <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises④">extend lifetime promises</a> resolve successfully. (See the relevant <a href="#install-settle-step">Install algorithm step</a>.) If any of the promises rejects, the installation fails. This is primarily used to ensure that a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⓪">service worker</a> is not considered <em>installed</em> until all of the core caches it depends on are populated. Likewise, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥①">service workers</a> delay treating the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⑧">active worker</a> as <em>activated</em> until all the <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⑤">promises</a> in the <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event④">activate</a></code> event’s <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises⑤">extend lifetime promises</a> settle. (See the relevant <a href="#activate-settle-step">Activate algorithm step</a>.) This is primarily used to ensure that any <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events①">functional events</a> are not dispatched to the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥②">service worker</a> until it upgrades database schemas and deletes the outdated cache entries.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.5" id="fetchevent-interface"><span class="secno">4.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#fetchevent" id="ref-for-fetchevent">FetchEvent</a></code></span><a class="self-link" href="#fetchevent-interface"></a></h3>
<pre class="idl highlight def">[<dfn class="nv idl-code" data-dfn-for="FetchEvent" data-dfn-type="constructor" data-export="" data-lt="FetchEvent(type, eventInitDict)" id="dom-fetchevent-fetchevent"><code>Constructor</code><a class="self-link" href="#dom-fetchevent-fetchevent"></a></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="FetchEvent/FetchEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-fetchevent-fetchevent-type-eventinitdict-type"><code>type</code><a class="self-link" href="#dom-fetchevent-fetchevent-type-eventinitdict-type"></a></dfn>, <a class="n" data-link-type="idl-name" href="#dictdef-fetcheventinit" id="ref-for-dictdef-fetcheventinit">FetchEventInit</a> <dfn class="nv idl-code" data-dfn-for="FetchEvent/FetchEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-fetchevent-fetchevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code><a class="self-link" href="#dom-fetchevent-fetchevent-type-eventinitdict-eventinitdict"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑨">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="fetchevent"><code>FetchEvent</code></dfn> : <a class="n" data-link-type="idl-name" href="#extendableevent" id="ref-for-extendableevent⑥">ExtendableEvent</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑥">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request">Request</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Request" href="#dom-fetchevent-request" id="ref-for-dom-fetchevent-request">request</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Promise<any>" href="#dom-fetchevent-preloadresponse" id="ref-for-dom-fetchevent-preloadresponse">preloadResponse</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString④"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-clientid" id="ref-for-dom-fetchevent-clientid">clientId</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑤"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-resultingclientid" id="ref-for-dom-fetchevent-resultingclientid">resultingClientId</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑥"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-targetclientid" id="ref-for-dom-fetchevent-targetclientid">targetClientId</a>;

  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-fetchevent-respondwith" id="ref-for-dom-fetchevent-respondwith">respondWith</a>(<span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response">Response</a>> <dfn class="nv idl-code" data-dfn-for="FetchEvent/respondWith(r)" data-dfn-type="argument" data-export="" id="dom-fetchevent-respondwith-r-r"><code>r</code><a class="self-link" href="#dom-fetchevent-respondwith-r-r"></a></dfn>);
};
</pre>
<pre class="idl highlight def" id="fetch-event-init-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-fetcheventinit"><code>FetchEventInit</code></dfn> : <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit①">ExtendableEventInit</a> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①">Request</a> <dfn class="nv idl-code" data-dfn-for="FetchEventInit" data-dfn-type="dict-member" data-export="" data-type="Request " id="dom-fetcheventinit-request"><code>request</code><a class="self-link" href="#dom-fetcheventinit-request"></a></dfn>;
  <span class="kt">required</span> <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <dfn class="nv idl-code" data-dfn-for="FetchEventInit" data-dfn-type="dict-member" data-export="" data-type="Promise<any> " id="dom-fetcheventinit-preloadresponse"><code>preloadResponse</code><a class="self-link" href="#dom-fetcheventinit-preloadresponse"></a></dfn>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑦"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-default="&quot;&quot;" data-dfn-for="FetchEventInit" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-fetcheventinit-clientid"><code>clientId</code><a class="self-link" href="#dom-fetcheventinit-clientid"></a></dfn> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑧"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-default="&quot;&quot;" data-dfn-for="FetchEventInit" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-fetcheventinit-resultingclientid"><code>resultingClientId</code><a class="self-link" href="#dom-fetcheventinit-resultingclientid"></a></dfn> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑨"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-default="&quot;&quot;" data-dfn-for="FetchEventInit" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-fetcheventinit-targetclientid"><code>targetClientId</code><a class="self-link" href="#dom-fetcheventinit-targetclientid"></a></dfn> = "";
};
</pre>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥③">Service workers</a> have an essential <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events②">functional event</a> <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event③">fetch</a></code>. For <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event④">fetch</a></code> event, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥④">service workers</a> use the <code class="idl"><a data-link-type="idl" href="#fetchevent" id="ref-for-fetchevent①">FetchEvent</a></code> interface which extends the <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent⑦">ExtendableEvent</a></code> interface.</p>
     <p>Each event using <code class="idl"><a data-link-type="idl" href="#fetchevent" id="ref-for-fetchevent②">FetchEvent</a></code> interface has an associated <dfn class="dfn-paneled" data-dfn-for="FetchEvent" data-dfn-type="dfn" data-noexport="" id="fetchevent-potential-response">potential response</dfn> (a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a>), initially set to null, and the following associated flags that are initially unset:</p>
     <ul>
      <li data-md="">
       <p><dfn class="dfn-paneled" data-dfn-for="FetchEvent" data-dfn-type="dfn" data-noexport="" id="fetchevent-wait-to-respond-flag">wait to respond flag</dfn></p>
      <li data-md="">
       <p><dfn class="dfn-paneled" data-dfn-for="FetchEvent" data-dfn-type="dfn" data-noexport="" id="fetchevent-respond-with-entered-flag">respond-with entered flag</dfn></p>
      <li data-md="">
       <p><dfn class="dfn-paneled" data-dfn-for="FetchEvent" data-dfn-type="dfn" data-noexport="" id="fetchevent-respond-with-error-flag">respond-with error flag</dfn></p>
     </ul>
     <section>
      <h4 class="heading settled" data-level="4.5.1" id="fetch-event-request"><span class="secno">4.5.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-request" id="ref-for-dom-fetchevent-request①">event.request</a></code></span><a class="self-link" href="#fetch-event-request"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="attribute" data-export="" id="dom-fetchevent-request"><code>request</code></dfn> attribute <em>must</em> return the value it was initialized to.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.5.2" id="fetch-event-preloadresponse"><span class="secno">4.5.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-preloadresponse" id="ref-for-dom-fetchevent-preloadresponse①">event.preloadResponse</a></code></span><a class="self-link" href="#fetch-event-preloadresponse"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="attribute" data-export="" id="dom-fetchevent-preloadresponse"><code>preloadResponse</code></dfn> attribute <em>must</em> return the value it was initialized to.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.5.3" id="fetch-event-clientid"><span class="secno">4.5.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-clientid" id="ref-for-dom-fetchevent-clientid①">event.clientId</a></code></span><a class="self-link" href="#fetch-event-clientid"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="attribute" data-export="" id="dom-fetchevent-clientid"><code>clientId</code></dfn> attribute <em>must</em> return the value it was initialized to. When an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event" id="ref-for-concept-event">event</a> is created the attribute <em>must</em> be initialized to the empty string.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.5.4" id="fetch-event-resultingclientid"><span class="secno">4.5.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-resultingclientid" id="ref-for-dom-fetchevent-resultingclientid①">event.resultingClientId</a></code></span><a class="self-link" href="#fetch-event-resultingclientid"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="attribute" data-export="" id="dom-fetchevent-resultingclientid"><code>resultingClientId</code></dfn> attribute <em>must</em> return the value it was initialized to. When an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event" id="ref-for-concept-event①">event</a> is created the attribute <em>must</em> be initialized to the empty string.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.5.5" id="fetch-event-targetclientid"><span class="secno">4.5.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-targetclientid" id="ref-for-dom-fetchevent-targetclientid①">event.targetClientId</a></code></span><a class="self-link" href="#fetch-event-targetclientid"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="attribute" data-export="" id="dom-fetchevent-targetclientid"><code>targetClientId</code></dfn> attribute <em>must</em> return the value it was initialized to. When an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event" id="ref-for-concept-event②">event</a> is created the attribute <em>must</em> be initialized to the empty string.</p>
     </section>
     <section class="algorithm" data-algorithm="fetch-event-respondwith">
      <h4 class="heading settled" data-level="4.5.6" id="fetch-event-respondwith"><span class="secno">4.5.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-fetchevent-respondwith" id="ref-for-dom-fetchevent-respondwith①">event.respondWith(r)</a></code></span><a class="self-link" href="#fetch-event-respondwith"></a></h4>
      <p class="note" role="note"><span>Note:</span> Developers can set the argument <var>r</var> with either a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⑥">promise</a> that resolves with a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response①">Response</a></code> object or a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response②">Response</a></code> object (which is automatically cast to a promise). Otherwise, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a> is returned to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">Fetch</a>. Renderer-side security checks about tainting for cross-origin content are tied to the types of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-filtered-response" id="ref-for-concept-filtered-response">filtered responses</a> defined in <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch②">Fetch</a>.</p>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="FetchEvent" data-dfn-type="method" data-export="" id="dom-fetchevent-respondwith"><code>respondWith(<var>r</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#dispatch-flag" id="ref-for-dispatch-flag②">dispatch flag</a> is unset, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑥">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①⓪">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⑤">DOMException</a></code>.</p>
       <li data-md="">
        <p>If the <a data-link-type="dfn" href="#fetchevent-respond-with-entered-flag" id="ref-for-fetchevent-respond-with-entered-flag">respond-with entered flag</a> is set, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑦">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①①">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⑥">DOMException</a></code>.</p>
       <li data-md="">
        <p>Add <var>r</var> to the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises⑥">extend lifetime promises</a>.</p>
       <li data-md="">
        <p>Increment the <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count⑤">pending promises count</a> by one.</p>
        <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count⑥">pending promises count</a> is incremented even if the given promise has already been settled. The corresponding count decrement is done in the microtask queued by the reaction to the promise.</p>
       <li data-md="">
        <p>Upon <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-fulfillment" id="ref-for-upon-fulfillment①">fulfillment</a> or <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-rejection" id="ref-for-upon-rejection①">rejection</a> of <var>r</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask" id="ref-for-queue-a-microtask①">queue a microtask</a> to run these substeps:</p>
        <ol>
         <li data-md="">
          <p>Decrement the <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count⑦">pending promises count</a> by one.</p>
         <li data-md="">
          <p>Let <var>registration</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object③⑨">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑧">relevant global object</a>'s associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⑧">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration⑧">containing service worker registration</a>.</p>
         <li data-md="">
          <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag②">uninstalling flag</a> is set, invoke <a data-link-type="dfn" href="#try-clear-registration" id="ref-for-try-clear-registration①">Try Clear Registration</a> with <var>registration</var>.</p>
         <li data-md="">
          <p>If <var>registration</var> is not null, invoke <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate②">Try Activate</a> with <var>registration</var>.</p>
        </ol>
        <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-respondwith" id="ref-for-dom-fetchevent-respondwith②">event.respondWith(r)</a></code> extends the lifetime of the event by default as if <code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil④">event.waitUntil(r)</a></code> is called.</p>
       <li data-md="">
        <p>Set the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#stop-propagation-flag" id="ref-for-stop-propagation-flag">stop propagation flag</a> and <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#stop-immediate-propagation-flag" id="ref-for-stop-immediate-propagation-flag">stop immediate propagation flag</a>.</p>
       <li data-md="">
        <p>Set the <a data-link-type="dfn" href="#fetchevent-respond-with-entered-flag" id="ref-for-fetchevent-respond-with-entered-flag①">respond-with entered flag</a>.</p>
       <li data-md="">
        <p>Set the <a data-link-type="dfn" href="#fetchevent-wait-to-respond-flag" id="ref-for-fetchevent-wait-to-respond-flag">wait to respond flag</a>.</p>
       <li data-md="">
        <p>Let <var>targetRealm</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm④">relevant Realm</a> of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④⓪">context object</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①④">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Wait until <var>r</var> settles.</p>
         <li data-md="">
          <p>If <var>r</var> rejected, then:</p>
          <ol>
           <li data-md="">
            <p>Set the <a data-link-type="dfn" href="#fetchevent-respond-with-error-flag" id="ref-for-fetchevent-respond-with-error-flag">respond-with error flag</a>.</p>
          </ol>
         <li data-md="">
          <p>If <var>r</var> resolved with <var>response</var>, then:</p>
          <ol>
           <li data-md="">
            <p>If <var>response</var> is a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response③">Response</a></code> object, then:</p>
            <ol>
             <li data-md="">
              <p>If <var>response</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-disturbed" id="ref-for-concept-body-disturbed">disturbed</a> or <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-locked" id="ref-for-concept-body-locked">locked</a>, then:</p>
              <ol>
               <li data-md="">
                <p>Set the <a data-link-type="dfn" href="#fetchevent-respond-with-error-flag" id="ref-for-fetchevent-respond-with-error-flag①">respond-with error flag</a>.</p>
              </ol>
             <li data-md="">
              <p>Else:</p>
              <ol>
               <li data-md="">
                <p>Let <var>bytes</var> be an empty byte sequence.</p>
               <li data-md="">
                <p>Let <var>end-of-body</var> be false.</p>
               <li data-md="">
                <p>Let <var>done</var> be false.</p>
               <li data-md="">
                <p>Let <var>potentialResponse</var> be a copy of <var>response</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response">response</a>, except for its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body">body</a>.</p>
               <li data-md="">
                <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①">body</a> is non-null, run these substeps:</p>
                <ol>
                 <li data-md="">
                  <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-get-reader" id="ref-for-concept-get-reader">getting a reader</a> from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body②">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream">stream</a>.</p>
                 <li data-md="">
                  <p>Let <var>strategy</var> be an object created in <var>targetRealm</var>. The user agent may choose any object.</p>
                 <li data-md="">
                  <p>Let <var>pull</var> be an action that runs these subsubsteps:</p>
                  <ol>
                   <li data-md="">
                    <p>Let <var>promise</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-read-chunk-from-readablestream" id="ref-for-concept-read-chunk-from-readablestream">reading a chunk</a> from <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body③">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream①">stream</a> with <var>reader</var>.</p>
                   <li data-md="">
                    <p>When <var>promise</var> is fulfilled with an object whose <code>done</code> property is false and whose <code>value</code> property is a <code>Uint8Array</code> object, append the bytes represented by the <code>value</code> property to <var>bytes</var> and perform ! <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-detacharraybuffer" id="ref-for-sec-detacharraybuffer">DetachArrayBuffer</a> with the <code>ArrayBuffer</code> object wrapped by the <code>value</code> property.</p>
                   <li data-md="">
                    <p>When <var>promise</var> is fulfilled with an object whose <code>done</code> property is true, set <var>end-of-body</var> to true.</p>
                   <li data-md="">
                    <p>When <var>promise</var> is fulfilled with a value that matches with neither of the above patterns, or <var>promise</var> is rejected, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-readablestream-errored" id="ref-for-concept-readablestream-errored">error</a> <var>newStream</var> with a <code>TypeError</code>.</p>
                  </ol>
                 <li data-md="">
                  <p>Let <var>cancel</var> be an action that <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-cancel-readablestream" id="ref-for-concept-cancel-readablestream">cancels</a> <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body④">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream②">stream</a> with <var>reader</var>.</p>
                 <li data-md="">
                  <p>Let <var>newStream</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-construct-readablestream" id="ref-for-concept-construct-readablestream">construct a ReadableStream object</a> with <var>strategy</var>, <var>pull</var> and <var>cancel</var> in <var>targetRealm</var>.</p>
                 <li data-md="">
                  <p>Set <var>potentialResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑤">body</a> to a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body" id="ref-for-concept-body">body</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream③">stream</a> is <var>newStream</var>.</p>
                 <li data-md="">
                  <p>Run these subsubsteps repeatedly <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⑤">in parallel</a> while <var>done</var> is false:</p>
                  <ol>
                   <li data-md="">
                    <p>If <var>newStream</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-readablestream-errored" id="ref-for-concept-readablestream-errored①">errored</a>, then set <var>done</var> to true.</p>
                   <li data-md="">
                    <p>Otherwise, if <var>bytes</var> is empty and <var>end-of-body</var> is true, then <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-readablestream-closed" id="ref-for-concept-readablestream-closed">close</a> <var>newStream</var> and set <var>done</var> to true.</p>
                   <li data-md="">
                    <p>Otherwise, if <var>bytes</var> is not empty, run these subsubsubsteps:</p>
                    <ol>
                     <li data-md="">
                      <p>Let <var>chunk</var> be a subsequence of <var>bytes</var> starting from the beginning of <var>bytes</var>.</p>
                     <li data-md="">
                      <p>Remove <var>chunk</var> from <var>bytes</var>.</p>
                     <li data-md="">
                      <p>Let <var>buffer</var> be an <code>ArrayBuffer</code> object created in <var>targetRealm</var> and containing <var>chunk</var>.</p>
                     <li data-md="">
                      <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-enqueue-readablestream" id="ref-for-concept-enqueue-readablestream">Enqueue</a> a <code>Uint8Array</code> object created in <var>targetRealm</var> and wrapping <var>buffer</var> to <var>newStream</var>.</p>
                    </ol>
                  </ol>
                </ol>
                <p class="note" role="note"><span>Note:</span> These substeps are meant to produce the observable equivalent of "piping" <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑥">body</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream④">stream</a> into <var>potentialResponse</var>.</p>
               <li data-md="">
                <p>Set the <a data-link-type="dfn" href="#fetchevent-potential-response" id="ref-for-fetchevent-potential-response">potential response</a> to <var>potentialResponse</var>.</p>
              </ol>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>Set the <a data-link-type="dfn" href="#fetchevent-respond-with-error-flag" id="ref-for-fetchevent-respond-with-error-flag②">respond-with error flag</a>.</p>
            </ol>
            <p class="note" role="note"><span>Note:</span> If the <a data-link-type="dfn" href="#fetchevent-respond-with-error-flag" id="ref-for-fetchevent-respond-with-error-flag③">respond-with error flag</a> is set, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error①">network error</a> is returned to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch③">Fetch</a> through <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch①">Handle Fetch</a> algorithm. (See the step 21.1.) Otherwise, the value <var>response</var> is returned to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch④">Fetch</a> through <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch②">Handle Fetch</a> algorithm. (See the step 22.1.)</p>
          </ol>
         <li data-md="">
          <p>Unset the <a data-link-type="dfn" href="#fetchevent-wait-to-respond-flag" id="ref-for-fetchevent-wait-to-respond-flag①">wait to respond flag</a>.</p>
        </ol>
      </ol>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.6" id="extendablemessageevent-interface"><span class="secno">4.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#extendablemessageevent" id="ref-for-extendablemessageevent①">ExtendableMessageEvent</a></code></span><a class="self-link" href="#extendablemessageevent-interface"></a></h3>
<pre class="idl highlight def">[<dfn class="nv idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="constructor" data-export="" data-lt="ExtendableMessageEvent(type, eventInitDict)|ExtendableMessageEvent(type)" id="dom-extendablemessageevent-extendablemessageevent"><code>Constructor</code><a class="self-link" href="#dom-extendablemessageevent-extendablemessageevent"></a></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⓪"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="ExtendableMessageEvent/ExtendableMessageEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-type"><code>type</code><a class="self-link" href="#dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-type"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-extendablemessageeventinit" id="ref-for-dictdef-extendablemessageeventinit">ExtendableMessageEventInit</a> <dfn class="nv idl-code" data-dfn-for="ExtendableMessageEvent/ExtendableMessageEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code><a class="self-link" href="#dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-eventinitdict"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①⓪">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="extendablemessageevent"><code>ExtendableMessageEvent</code></dfn> : <a class="n" data-link-type="idl-name" href="#extendableevent" id="ref-for-extendableevent⑧">ExtendableEvent</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">any</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="any" href="#dom-extendablemessageevent-data" id="ref-for-dom-extendablemessageevent-data①">data</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑨"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-extendablemessageevent-origin" id="ref-for-dom-extendablemessageevent-origin①">origin</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①①"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-extendablemessageevent-lasteventid" id="ref-for-dom-extendablemessageevent-lasteventid">lastEventId</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑦">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> (<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client⑥">Client</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②②">ServiceWorker</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport②">MessagePort</a>)? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="(Client or ServiceWorker or MessagePort)?" href="#dom-extendablemessageevent-source" id="ref-for-dom-extendablemessageevent-source①">source</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport③">MessagePort</a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="FrozenArray<MessagePort>" href="#dom-extendablemessageevent-ports" id="ref-for-dom-extendablemessageevent-ports①">ports</a>;
};
</pre>
<pre class="idl highlight def" id="extendablemessage-event-init-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-extendablemessageeventinit"><code>ExtendableMessageEventInit</code></dfn> : <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit②">ExtendableEventInit</a> {
  <span class="kt">any</span> <dfn class="nv idl-code" data-default="null" data-dfn-for="ExtendableMessageEventInit" data-dfn-type="dict-member" data-export="" data-type="any " id="dom-extendablemessageeventinit-data"><code>data</code><a class="self-link" href="#dom-extendablemessageeventinit-data"></a></dfn> = <span class="kt">null</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⓪"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-default="&quot;&quot;" data-dfn-for="ExtendableMessageEventInit" data-dfn-type="dict-member" data-export="" data-type="USVString " id="dom-extendablemessageeventinit-origin"><code>origin</code><a class="self-link" href="#dom-extendablemessageeventinit-origin"></a></dfn> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①②"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-default="&quot;&quot;" data-dfn-for="ExtendableMessageEventInit" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-extendablemessageeventinit-lasteventid"><code>lastEventId</code><a class="self-link" href="#dom-extendablemessageeventinit-lasteventid"></a></dfn> = "";
  (<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client⑦">Client</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②③">ServiceWorker</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport④">MessagePort</a>)? <dfn class="nv idl-code" data-default="null" data-dfn-for="ExtendableMessageEventInit" data-dfn-type="dict-member" data-export="" data-type="(Client or ServiceWorker or MessagePort)? " id="dom-extendablemessageeventinit-source"><code>source</code><a class="self-link" href="#dom-extendablemessageeventinit-source"></a></dfn> = <span class="kt">null</span>;
  <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport⑤">MessagePort</a>> <dfn class="nv idl-code" data-default="None" data-dfn-for="ExtendableMessageEventInit" data-dfn-type="dict-member" data-export="" data-type="sequence<MessagePort> " id="dom-extendablemessageeventinit-ports"><code>ports</code><a class="self-link" href="#dom-extendablemessageeventinit-ports"></a></dfn> = [];
};
</pre>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⑤">Service workers</a> define the <a class="idl-code" data-link-type="method" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil⑤">extendable</a> <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-message" id="ref-for-eventdef-serviceworkerglobalscope-message③">message</a></code> event to allow extending the lifetime of the event. For the <code class="idl"><a class="idl-code" data-link-type="event" href="#eventdef-serviceworkerglobalscope-message" id="ref-for-eventdef-serviceworkerglobalscope-message④">message</a></code> event, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⑥">service workers</a> use the <code class="idl"><a data-link-type="idl" href="#extendablemessageevent" id="ref-for-extendablemessageevent②">ExtendableMessageEvent</a></code> interface which extends the <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent⑨">ExtendableEvent</a></code> interface.</p>
     <section>
      <h4 class="heading settled" data-level="4.6.1" id="extendablemessage-event-data"><span class="secno">4.6.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-data" id="ref-for-dom-extendablemessageevent-data②">event.data</a></code></span><a class="self-link" href="#extendablemessage-event-data"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="attribute" data-export="" id="dom-extendablemessageevent-data"><code>data</code></dfn> attribute <em>must</em> return the value it was initialized to. When the object is created, this attribute <em>must</em> be initialized to null. It represents the message being sent.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.6.2" id="extendablemessage-event-origin"><span class="secno">4.6.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-origin" id="ref-for-dom-extendablemessageevent-origin②">event.origin</a></code></span><a class="self-link" href="#extendablemessage-event-origin"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="attribute" data-export="" id="dom-extendablemessageevent-origin"><code>origin</code></dfn> attribute <em>must</em> return the value it was initialized to. When the object is created, this attribute <em>must</em> be initialized to the empty string. It represents the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①②">origin</a> of the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③②">service worker client</a> that sent the message.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.6.3" id="extendablemessage-event-lasteventid"><span class="secno">4.6.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-lasteventid" id="ref-for-dom-extendablemessageevent-lasteventid①">event.lastEventId</a></code></span><a class="self-link" href="#extendablemessage-event-lasteventid"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="attribute" data-export="" id="dom-extendablemessageevent-lasteventid"><code>lastEventId</code></dfn> attribute <em>must</em> return the value it was initialized to. When the object is created, this attribute <em>must</em> be initialized to the empty string.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.6.4" id="extendablemessage-event-source"><span class="secno">4.6.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-source" id="ref-for-dom-extendablemessageevent-source②">event.source</a></code></span><a class="self-link" href="#extendablemessage-event-source"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="attribute" data-export="" id="dom-extendablemessageevent-source"><code>source</code></dfn> attribute <em>must</em> return the value it was initialized to. When the object is created, this attribute <em>must</em> be initialized to null. It represents the <code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client⑧">Client</a></code> object from which the message is sent.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="4.6.5" id="extendablemessage-event-ports"><span class="secno">4.6.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-extendablemessageevent-ports" id="ref-for-dom-extendablemessageevent-ports②">event.ports</a></code></span><a class="self-link" href="#extendablemessage-event-ports"></a></h4>
      <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="ExtendableMessageEvent" data-dfn-type="attribute" data-export="" id="dom-extendablemessageevent-ports"><code>ports</code></dfn> attribute <em>must</em> return the value it was initialized to. When the object is created, this attribute <em>must</em> be initialized to the empty array. It represents the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport⑥">MessagePort</a></code> array being sent.</p>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="4.7" id="execution-context-events"><span class="secno">4.7. </span><span class="content">Events</span><a class="self-link" href="#execution-context-events"></a></h3>
     <p>The following events are dispatched on <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①②">ServiceWorkerGlobalScope</a></code> object:</p>
     <table class="data">
      <thead>
       <tr>
        <th>Event name
        <th>Interface
        <th>Dispatched when…
      <tbody>
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="event" data-export="" id="service-worker-global-scope-install-event"><code>install</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①⓪">ExtendableEvent</a></code>
        <td>[<a data-link-type="dfn" href="#dfn-lifecycle-events" id="ref-for-dfn-lifecycle-events①">Lifecycle event</a>] The <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker①⑨">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration⑨">containing service worker registration</a>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker⑤">installing worker</a> changes. (See step 11.2 of the <a data-link-type="dfn" href="#install" id="ref-for-install①">Install</a> algorithm.)
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="event" data-export="" id="service-worker-global-scope-activate-event"><code>activate</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①①">ExtendableEvent</a></code>
        <td>[<a data-link-type="dfn" href="#dfn-lifecycle-events" id="ref-for-dfn-lifecycle-events②">Lifecycle event</a>] The <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker②⓪">service worker</a>'s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①⓪">containing service worker registration</a>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker①⑨">active worker</a> changes. (See step 12.2 of the <a data-link-type="dfn" href="#activate" id="ref-for-activate②">Activate</a> algorithm.)
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="event" data-export="" id="service-worker-global-scope-fetch-event"><code>fetch</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="#fetchevent" id="ref-for-fetchevent③">FetchEvent</a></code>
        <td>[<a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events③">Functional event</a>] The <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-fetch" id="ref-for-concept-http-fetch">http fetch</a> invokes <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch③">Handle Fetch</a> with <var>request</var>. As a result of performing <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch④">Handle Fetch</a>, the <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker②①">service worker</a> returns a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-fetch" id="ref-for-concept-http-fetch①">http fetch</a>. The <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response③">response</a>, represented by a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response④">Response</a></code> object, can be retrieved from a <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache">Cache</a></code> object or directly from network using <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch">self.fetch(input, init)</a></code> method. (A custom <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑤">Response</a></code> object can be another option.)
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="event" data-export="" id="eventdef-serviceworkerglobalscope-message"><code>message</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="#extendablemessageevent" id="ref-for-extendablemessageevent③">ExtendableMessageEvent</a></code>
        <td>When it receives a message.
       <tr>
        <td><dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="event" data-export="" id="eventdef-serviceworkerglobalscope-messageerror"><code>messageerror</code></dfn>
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent③">MessageEvent</a></code>
        <td>When it was sent a message that cannot be deserialized.
     </table>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="cache-objects"><span class="secno">5. </span><span class="content">Caches</span><a class="self-link" href="#cache-objects"></a></h2>
    <p>To allow authors to fully manage their content caches for offline use, the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑧">Window</a></code> and the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope①">WorkerGlobalScope</a></code> provide the asynchronous caching methods that open and manipulate <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①">Cache</a></code> objects. An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①③">origin</a> can have multiple, named <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache②">Cache</a></code> objects, whose contents are entirely under the control of scripts. Caches are not shared across <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin①">origins</a>, and they are completely isolated from the browser’s HTTP cache.</p>
    <section>
     <h3 class="heading settled" data-level="5.1" id="cache-constructs"><span class="secno">5.1. </span><span class="content">Constructs</span><a class="self-link" href="#cache-constructs"></a></h3>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-request-response-list">request response list</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑦">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#pair" id="ref-for-pair">pairs</a> consisting of a request (a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a>) and a response (a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response④">response</a>).</p>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-relevant-request-response-list">relevant request response list</dfn> is the instance that the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④①">context object</a> represents.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-name-to-cache-map">name to cache map</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">ordered map</a> whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-entry" id="ref-for-map-entry">entry</a> consists of a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">key</a> (a string that represents the name of a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list">request response list</a>) and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-value" id="ref-for-map-value">value</a> (a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list①">request response list</a>).</p>
     <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin②">origin</a> has an associated <a data-link-type="dfn" href="#dfn-name-to-cache-map" id="ref-for-dfn-name-to-cache-map">name to cache map</a>.</p>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-relevant-name-to-cache-map">relevant name to cache map</dfn> is the instance of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④②">context object</a>'s associated <a data-link-type="dfn" href="#cachestorage-global-object" id="ref-for-cachestorage-global-object">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①④">environment settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①④">origin</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="5.2" id="cache-lifetimes"><span class="secno">5.2. </span><span class="content">Understanding Cache Lifetimes</span><a class="self-link" href="#cache-lifetimes"></a></h3>
     <p>The <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache③">Cache</a></code> instances are not part of the browser’s HTTP cache. The <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache④">Cache</a></code> objects are exactly what authors have to manage themselves. The <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache⑤">Cache</a></code> objects do not get updated unless authors explicitly request them to be. The <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache⑥">Cache</a></code> objects do not expire unless authors delete the entries. The <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache⑦">Cache</a></code> objects do not disappear just because the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⑦">service worker</a> script is updated. That is, caches are not updated automatically. Updates must be manually managed. This implies that authors should version their caches by name and make sure to use the caches only from the version of the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⑧">service worker</a> that can safely operate on.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="5.3" id="self-caches"><span class="secno">5.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#global-caches-attribute" id="ref-for-global-caches-attribute">self.caches</a></code></span><a class="self-link" href="#self-caches"></a></h3>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑥">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑧">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#cachestorage" id="ref-for-cachestorage">CacheStorage</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="CacheStorage" href="#global-caches-attribute" id="ref-for-global-caches-attribute①">caches</a>;
};
</pre>
     <section>
      <h4 class="heading settled" data-level="5.3.1" id="global-caches"><span class="secno">5.3.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#global-caches-attribute" id="ref-for-global-caches-attribute②">caches</a></code></span><a class="self-link" href="#global-caches"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="attribute" data-export="" id="global-caches-attribute"><code>caches</code></dfn> attribute <em>must</em> return this object’s associated <code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage①">CacheStorage</a></code> object.</p>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="5.4" id="cache-interface"><span class="secno">5.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache⑧">Cache</a></code></span><a class="self-link" href="#cache-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑦">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="cache"><code>Cache</code></dfn> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①②">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-match" id="ref-for-dom-cache-match">match</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/match(request, options), Cache/match(request)" data-dfn-type="argument" data-export="" id="dom-cache-match-request-options-request"><code>request</code><a class="self-link" href="#dom-cache-match-request-options-request"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions">CacheQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="Cache/match(request, options), Cache/match(request)" data-dfn-type="argument" data-export="" id="dom-cache-match-request-options-options"><code>options</code><a class="self-link" href="#dom-cache-match-request-options-options"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①③">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑥">Response</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-matchall" id="ref-for-dom-cache-matchall">matchAll</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo①">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/matchAll(request, options), Cache/matchAll(request), Cache/matchAll()" data-dfn-type="argument" data-export="" id="dom-cache-matchall-request-options-request"><code>request</code><a class="self-link" href="#dom-cache-matchall-request-options-request"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions①">CacheQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="Cache/matchAll(request, options), Cache/matchAll(request), Cache/matchAll()" data-dfn-type="argument" data-export="" id="dom-cache-matchall-request-options-options"><code>options</code><a class="self-link" href="#dom-cache-matchall-request-options-options"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①④">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-add" id="ref-for-dom-cache-add">add</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo②">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/add(request)" data-dfn-type="argument" data-export="" id="dom-cache-add-request-request"><code>request</code><a class="self-link" href="#dom-cache-add-request-request"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑤">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-addall" id="ref-for-dom-cache-addall">addAll</a>(<span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo③">RequestInfo</a>> <dfn class="nv idl-code" data-dfn-for="Cache/addAll(requests)" data-dfn-type="argument" data-export="" id="dom-cache-addall-requests-requests"><code>requests</code><a class="self-link" href="#dom-cache-addall-requests-requests"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑥">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-put" id="ref-for-dom-cache-put">put</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo④">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/put(request, response)" data-dfn-type="argument" data-export="" id="dom-cache-put-request-response-request"><code>request</code><a class="self-link" href="#dom-cache-put-request-response-request"></a></dfn>, <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑦">Response</a> <dfn class="nv idl-code" data-dfn-for="Cache/put(request, response)" data-dfn-type="argument" data-export="" id="dom-cache-put-request-response-response"><code>response</code><a class="self-link" href="#dom-cache-put-request-response-response"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑦">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean④"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-delete" id="ref-for-dom-cache-delete">delete</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑤">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/delete(request, options), Cache/delete(request)" data-dfn-type="argument" data-export="" id="dom-cache-delete-request-options-request"><code>request</code><a class="self-link" href="#dom-cache-delete-request-options-request"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions②">CacheQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="Cache/delete(request, options), Cache/delete(request)" data-dfn-type="argument" data-export="" id="dom-cache-delete-request-options-options"><code>options</code><a class="self-link" href="#dom-cache-delete-request-options-options"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑧">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request②">Request</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-keys" id="ref-for-dom-cache-keys">keys</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑥">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Cache/keys(request, options), Cache/keys(request), Cache/keys()" data-dfn-type="argument" data-export="" id="dom-cache-keys-request-options-request"><code>request</code><a class="self-link" href="#dom-cache-keys-request-options-request"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions③">CacheQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="Cache/keys(request, options), Cache/keys(request), Cache/keys()" data-dfn-type="argument" data-export="" id="dom-cache-keys-request-options-options"><code>options</code><a class="self-link" href="#dom-cache-keys-request-options-options"></a></dfn>);
};
</pre>
<pre class="idl highlight def" id="cache-query-options-dictionary"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-cachequeryoptions"><code>CacheQueryOptions</code></dfn> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑤"><span class="kt">boolean</span></a> <dfn class="nv dfn-paneled idl-code" data-default="false" data-dfn-for="CacheQueryOptions" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-cachequeryoptions-ignoresearch"><code>ignoreSearch</code></dfn> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑥"><span class="kt">boolean</span></a> <dfn class="nv dfn-paneled idl-code" data-default="false" data-dfn-for="CacheQueryOptions" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-cachequeryoptions-ignoremethod"><code>ignoreMethod</code></dfn> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑦"><span class="kt">boolean</span></a> <dfn class="nv dfn-paneled idl-code" data-default="false" data-dfn-for="CacheQueryOptions" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-cachequeryoptions-ignorevary"><code>ignoreVary</code></dfn> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①③"><span class="kt">DOMString</span></a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="CacheQueryOptions" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-cachequeryoptions-cachename"><code>cacheName</code></dfn>;
};
</pre>
     <p>A <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache⑨">Cache</a></code> object represents a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list②">request response list</a>. Multiple separate objects implementing the <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①⓪">Cache</a></code> interface across documents and workers can all be associated with the same <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list③">request response list</a> simultaneously.</p>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="dfn-cache-batch-operation">cache batch operation</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> that consists of:</p>
     <ul>
      <li data-md="">
       <p>A <dfn class="dfn-paneled" data-dfn-for="cache batch operation" data-dfn-type="dfn" data-export="" id="dfn-cache-batch-operation-type">type</dfn> ("<code>delete</code>" or "<code>put</code>").</p>
      <li data-md="">
       <p>A <dfn class="dfn-paneled" data-dfn-for="cache batch operation" data-dfn-type="dfn" data-export="" id="dfn-cache-batch-operation-request">request</dfn> (a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a>).</p>
      <li data-md="">
       <p>A <dfn class="dfn-paneled" data-dfn-for="cache batch operation" data-dfn-type="dfn" data-export="" id="dfn-cache-batch-operation-response">response</dfn> (a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑤">response</a>).</p>
      <li data-md="">
       <p>An <dfn class="dfn-paneled" data-dfn-for="cache batch operation" data-dfn-type="dfn" data-export="" id="dfn-cache-batch-operation-options">options</dfn> (a <code class="idl"><a data-link-type="idl" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions④">CacheQueryOptions</a></code>).</p>
     </ul>
     <section class="algorithm" data-algorithm="cache-match">
      <h4 class="heading settled" data-level="5.4.1" id="cache-match"><span class="secno">5.4.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-match" id="ref-for-dom-cache-match①">match(request, options)</a></code></span><a class="self-link" href="#cache-match"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" data-lt="match(request, options)|match(request)" id="dom-cache-match"><code>match(<var>request</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise⑤">a new promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⑥">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>p</var> be the result of running the algorithm specified in <code class="idl"><a data-link-type="idl" href="#dom-cache-matchall" id="ref-for-dom-cache-matchall①">matchAll(request, options)</a></code> method with <var>request</var> and <var>options</var>.</p>
         <li data-md="">
          <p>Wait until <var>p</var> settles.</p>
         <li data-md="">
          <p>If <var>p</var> rejects with an exception, then:</p>
          <ol>
           <li data-md="">
            <p>Reject <var>promise</var> with that exception.</p>
          </ol>
         <li data-md="">
          <p>Else if <var>p</var> resolves with an array, <var>responses</var>, then:</p>
          <ol>
           <li data-md="">
            <p>If <var>responses</var> is an empty array, then:</p>
            <ol>
             <li data-md="">
              <p>Resolve <var>promise</var> with undefined.</p>
            </ol>
           <li data-md="">
            <p>Else:</p>
            <ol>
             <li data-md="">
              <p>Resolve <var>promise</var> with the first element of <var>responses</var>.</p>
            </ol>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-matchall">
      <h4 class="heading settled" data-level="5.4.2" id="cache-matchall"><span class="secno">5.4.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-matchall" id="ref-for-dom-cache-matchall②">matchAll(request, options)</a></code></span><a class="self-link" href="#cache-matchall"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" data-lt="matchAll(request, options)|matchAll(request)|matchAll()" id="dom-cache-matchall"><code>matchAll(<var>request</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>r</var> be null.</p>
       <li data-md="">
        <p>If the optional argument <var>request</var> is not omitted, then:</p>
        <ol>
         <li data-md="">
          <p>If <var>request</var> is a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request③">Request</a></code> object, then:</p>
          <ol>
           <li data-md="">
            <p>Set <var>r</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request">request</a>.</p>
           <li data-md="">
            <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a> is not `<code>GET</code>` and <var>options</var>.ignoreMethod is false, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with">a promise resolved with</a> an empty array.</p>
          </ol>
         <li data-md="">
          <p>Else if <var>request</var> is a string, then:</p>
          <ol>
           <li data-md="">
            <p>Set <var>r</var> to the associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request①">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request④">Request</a></code> as constructor with <var>request</var> as its argument. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑧">throws</a> an exception, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected with</a> that exception.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④③">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑤">relevant realm</a>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise⑥">a new promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⑦">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>responses</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a>.</p>
         <li data-md="">
          <p>If the optional argument <var>request</var> is omitted, then:</p>
          <ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>requestResponse</var> of the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list">relevant request response list</a>:</p>
            <ol>
             <li data-md="">
              <p>Add a copy of <var>requestResponse</var>’s response to <var>responses</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Else:</p>
          <ol>
           <li data-md="">
            <p>Let <var>requestResponses</var> be the result of running <a data-link-type="dfn" href="#query-cache" id="ref-for-query-cache">Query Cache</a> with <var>r</var> and <var>options</var>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>requestResponse</var> of <var>requestResponses</var>:</p>
            <ol>
             <li data-md="">
              <p>Add a copy of <var>requestResponse</var>’s response to <var>responses</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①①">Queue a task</a>, on <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⑤">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop⑥">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source④">DOM manipulation task source</a>, to perform the following steps:</p>
          <ol>
           <li data-md="">
            <p>Let <var>responseList</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">list</a>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>response</var> of <var>responses</var>:</p>
            <ol>
             <li data-md="">
              <p>Add a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑧">Response</a></code> object associated with <var>response</var> and a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#headers" id="ref-for-headers">Headers</a></code> object whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-headers-guard" id="ref-for-concept-headers-guard">guard</a> is "<code>immutable</code>" to <var>responseList</var>.</p>
            </ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type②">frozen array</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-frozen-array" id="ref-for-dfn-create-frozen-array②">created</a> from <var>responseList</var>, in <var>realm</var>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-add">
      <h4 class="heading settled" data-level="5.4.3" id="cache-add"><span class="secno">5.4.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-add" id="ref-for-dom-cache-add①">add(request)</a></code></span><a class="self-link" href="#cache-add"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" id="dom-cache-add"><code>add(<var>request</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>requests</var> be an array containing only <var>request</var>.</p>
       <li data-md="">
        <p>Let <var>responseArrayPromise</var> be the result of running the algorithm specified in <code class="idl"><a data-link-type="idl" href="#dom-cache-addall" id="ref-for-dom-cache-addall①">addAll(requests)</a></code> passing <var>requests</var> as the argument.</p>
       <li data-md="">
        <p>Return the result of <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#transforming-by" id="ref-for-transforming-by">transforming</a> <var>responseArrayPromise</var> with a fulfillment handler that returns undefined.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-addAll">
      <h4 class="heading settled" data-level="5.4.4" id="cache-addAll"><span class="secno">5.4.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-addall" id="ref-for-dom-cache-addall②">addAll(requests)</a></code></span><a class="self-link" href="#cache-addAll"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" id="dom-cache-addall"><code>addAll(<var>requests</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>responsePromises</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⓪">list</a>.</p>
       <li data-md="">
        <p>Let <var>requestList</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①①">list</a>.</p>
       <li data-md="">
        <p>For each <var>request</var> whose type is <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request⑤">Request</a></code> in <var>requests</var>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>r</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request②">request</a>.</p>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url③">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", or <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method①">method</a> is not `<code>GET</code>`, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise rejected with</a> a <code>TypeError</code>.</p>
        </ol>
       <li data-md="">
        <p>For each <var>request</var> in <var>requests</var>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>r</var> be the associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request③">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request⑥">Request</a></code> as constructor with <var>request</var> as its argument. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw⑨">throws</a> an exception, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with④">a promise rejected with</a> that exception.</p>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url④">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", then:</p>
          <ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" id="ref-for-concept-fetch-terminate">Terminate</a> all the ongoing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch⑤">fetches</a> initiated by <var>requests</var> with the aborted flag set.</p>
           <li data-md="">
            <p>Return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑤">a promise rejected with</a> a <code>TypeError</code>.</p>
          </ol>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①④">global object</a> is a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①③">ServiceWorkerGlobalScope</a></code> object, set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode">service-workers mode</a> to "<code>none</code>".</p>
         <li data-md="">
          <p>Set <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-initiator" id="ref-for-concept-request-initiator">initiator</a> to "<code>fetch</code>" and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination">destination</a> to "<code>subresource</code>".</p>
         <li data-md="">
          <p>Add <var>r</var> to <var>requestList</var>.</p>
         <li data-md="">
          <p>Let <var>responsePromise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise⑦">a new promise</a>.</p>
         <li data-md="">
          <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⑧">in parallel</a>:</p>
          <ul>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch⑥">Fetch</a> <var>r</var>.</p>
           <li data-md="">
            <p>To <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response" id="ref-for-process-response">process response</a> for <var>response</var>, run these substeps:</p>
            <ol>
             <li data-md="">
              <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-type" id="ref-for-concept-response-type">type</a> is "<code>error</code>", or <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status">ok status</a> or is <code>206</code>, reject <var>responsePromise</var> with a <code>TypeError</code>.</p>
             <li data-md="">
              <p>Else if <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a> contains a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header">header</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name">named</a> `<code>Vary</code>`, then:</p>
              <ol>
               <li data-md="">
                <p>Let <var>fieldValues</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①②">list</a> containing the elements corresponding to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2" id="ref-for-section-3.2">field-values</a> of the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-7.1.4" id="ref-for-section-7.1.4">Vary</a> header.</p>
               <li data-md="">
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>fieldValue</var> of <var>fieldValues</var>:</p>
                <ol>
                 <li data-md="">
                  <p>If <var>fieldValue</var> matches "<code>*</code>", then:</p>
                  <ol>
                   <li data-md="">
                    <p>Reject <var>responsePromise</var> with a <code>TypeError</code>.</p>
                   <li data-md="">
                    <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" id="ref-for-concept-fetch-terminate①">Terminate</a> all the ongoing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch⑦">fetches</a> initiated by <var>requests</var> with the aborted flag set.</p>
                   <li data-md="">
                    <p>Abort these steps.</p>
                  </ol>
                </ol>
              </ol>
            </ol>
           <li data-md="">
            <p>To <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response-end-of-body" id="ref-for-process-response-end-of-body">process response end-of-body</a> for <var>response</var>, run these substeps:</p>
            <ol>
             <li data-md="">
              <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-aborted" id="ref-for-concept-response-aborted">aborted flag</a> is set, reject <var>responsePromise</var> with an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⑦">DOMException</a></code> and abort these steps.</p>
             <li data-md="">
              <p>Resolve <var>responsePromise</var> with <var>response</var>.</p>
            </ol>
            <p class="note" role="note"><span>Note:</span> The cache commit is allowed when the response’s body is fully received.</p>
          </ul>
         <li data-md="">
          <p>Add <var>responsePromise</var> to <var>responsePromises</var>.</p>
        </ol>
       <li data-md="">
        <p>Let <var>p</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#waiting-for-all" id="ref-for-waiting-for-all">waiting for all</a> of <var>responsePromises</var>.</p>
       <li data-md="">
        <p>Return the result of <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#transforming-by" id="ref-for-transforming-by①">transforming</a> <var>p</var> with a fulfillment handler that, when called with argument <var>responses</var>, performs the following substeps:</p>
        <ol>
         <li data-md="">
          <p>Let <var>operations</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①③">list</a>.</p>
         <li data-md="">
          <p>Let <var>index</var> be zero.</p>
         <li data-md="">
          <p>For each <var>response</var> in <var>responses</var>:</p>
          <ol>
           <li data-md="">
            <p>Let <var>operation</var> be a <a data-link-type="dfn" href="#dfn-cache-batch-operation" id="ref-for-dfn-cache-batch-operation">cache batch operation</a>.</p>
           <li data-md="">
            <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type">type</a> to "<code>put</code>".</p>
           <li data-md="">
            <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request">request</a> to <var>requestList</var>[<var>index</var>].</p>
           <li data-md="">
            <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response">response</a> to <var>response</var>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append④">Append</a> <var>operation</var> to <var>operations</var>.</p>
           <li data-md="">
            <p>Increment <var>index</var> by one.</p>
          </ol>
         <li data-md="">
          <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④④">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑥">relevant realm</a>.</p>
         <li data-md="">
          <p>Let <var>cacheJobPromise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise⑧">a new promise</a>.</p>
         <li data-md="">
          <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①⑨">in parallel</a>:</p>
          <ol>
           <li data-md="">
            <p>Let <var>errorData</var> be null.</p>
           <li data-md="">
            <p>Invoke <a data-link-type="dfn" href="#batch-cache-operations" id="ref-for-batch-cache-operations">Batch Cache Operations</a> with <var>operations</var>. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⓪">throws</a> an exception, set <var>errorData</var> to the exception.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①②">Queue a task</a>, on <var>cacheJobPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⑥">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop⑦">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source⑤">DOM manipulation task source</a>, to perform the following substeps:</p>
            <ol>
             <li data-md="">
              <p>If <var>errorData</var> is null, resolve <var>cacheJobPromise</var> with undefined.</p>
             <li data-md="">
              <p>Else, reject <var>cacheJobPromise</var> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception">new</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception" id="ref-for-dfn-exception">exception</a> with <var>errorData</var> and a user agent-defined <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception-message" id="ref-for-dfn-exception-message">message</a>, in <var>realm</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Return <var>cacheJobPromise</var>.</p>
        </ol>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-put">
      <h4 class="heading settled" data-level="5.4.5" id="cache-put"><span class="secno">5.4.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-put" id="ref-for-dom-cache-put①">put(request, response)</a></code></span><a class="self-link" href="#cache-put"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" id="dom-cache-put"><code>put(<var>request</var>, <var>response</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>r</var> be null.</p>
       <li data-md="">
        <p>If <var>request</var> is a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request⑦">Request</a></code> object, then:</p>
        <ol>
         <li data-md="">
          <p>Set <var>r</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request④">request</a>.</p>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url⑤">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme②">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", or <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method②">method</a> is not `<code>GET</code>`, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑥">a promise rejected with</a> a <code>TypeError</code>.</p>
        </ol>
       <li data-md="">
        <p>Else if <var>request</var> is a string, then:</p>
        <ol>
         <li data-md="">
          <p>Set <var>r</var> to the associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request⑤">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request⑧">Request</a></code> as constructor with <var>request</var> as its argument. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①①">throws</a> an exception, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑦">a promise rejected with</a> that exception.</p>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url⑥">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme③">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑧">a promise rejected with</a> a <code>TypeError</code>.</p>
        </ol>
       <li data-md="">
        <p>If <var>response</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response①">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status①">status</a> is <code>206</code>, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with⑨">a promise rejected with</a> a <code>TypeError</code>.</p>
       <li data-md="">
        <p>If <var>response</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response②">response</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①">header list</a> contains a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header①">header</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name①">named</a> `<code>Vary</code>`, then:</p>
        <ol>
         <li data-md="">
          <p>Let <var>fieldValues</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①④">list</a> containing the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item②">items</a> corresponding to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-7.1.4" id="ref-for-section-7.1.4①">Vary</a> header’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2" id="ref-for-section-3.2①">field-values</a>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑦">For each</a> <var>fieldValue</var> in <var>fieldValues</var>:</p>
          <ol>
           <li data-md="">
            <p>If <var>fieldValue</var> matches "<code>*</code>", return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①⓪">a promise rejected with</a> a <code>TypeError</code>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>If <var>response</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-disturbed" id="ref-for-concept-body-disturbed①">disturbed</a> or <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-locked" id="ref-for-concept-body-locked①">locked</a>, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①①">a promise rejected with</a> a <code>TypeError</code>.</p>
       <li data-md="">
        <p>Let <var>clonedResponse</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-clone" id="ref-for-concept-response-clone">cloning</a> <var>response</var>’s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response③">response</a>.</p>
       <li data-md="">
        <p>If <var>response</var>’s body is non-null, run these substeps:</p>
        <ol>
         <li data-md="">
          <p>Let <var>dummyStream</var> be an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-empty-readablestream" id="ref-for-concept-empty-readablestream">empty</a> <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#concept-readablestream" id="ref-for-concept-readablestream">ReadableStream</a></code> object.</p>
         <li data-md="">
          <p>Set <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑦">body</a> to a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body" id="ref-for-concept-body①">body</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-body-stream" id="ref-for-concept-body-stream⑤">stream</a> is <var>dummyStream</var>.</p>
         <li data-md="">
          <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-get-reader" id="ref-for-concept-get-reader①">getting a reader</a> from <var>dummyStream</var>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-read-all-bytes-from-readablestream" id="ref-for-concept-read-all-bytes-from-readablestream">Read all bytes</a> from <var>dummyStream</var> with <var>reader</var>.</p>
        </ol>
       <li data-md="">
        <p>Let <var>operations</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑤">list</a>.</p>
       <li data-md="">
        <p>Let <var>operation</var> be a <a data-link-type="dfn" href="#dfn-cache-batch-operation" id="ref-for-dfn-cache-batch-operation①">cache batch operation</a>.</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type①">type</a> to "<code>put</code>".</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request①">request</a> to <var>r</var>.</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response①">response</a> to <var>clonedResponse</var>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑤">Append</a> <var>operation</var> to <var>operations</var>.</p>
       <li data-md="">
        <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④⑤">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑦">relevant realm</a>.</p>
       <li data-md="">
        <p>Let <var>cacheJobPromise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise⑨">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⓪">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>errorData</var> be null.</p>
         <li data-md="">
          <p>Invoke <a data-link-type="dfn" href="#batch-cache-operations" id="ref-for-batch-cache-operations①">Batch Cache Operations</a> with <var>operations</var>. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①②">throws</a> an exception, set <var>errorData</var> to the exception.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①③">Queue a task</a>, on <var>cacheJobPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⑦">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop⑧">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source⑥">DOM manipulation task source</a>, to perform the following substeps:</p>
          <ol>
           <li data-md="">
            <p>If <var>errorData</var> is null, resolve <var>cacheJobPromise</var> with undefined.</p>
           <li data-md="">
            <p>Else, reject <var>cacheJobPromise</var> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception①">new</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception" id="ref-for-dfn-exception①">exception</a> with <var>errorData</var> and a user agent-defined <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception-message" id="ref-for-dfn-exception-message①">message</a>, in <var>realm</var>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>cacheJobPromise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-delete">
      <h4 class="heading settled" data-level="5.4.6" id="cache-delete"><span class="secno">5.4.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-delete" id="ref-for-dom-cache-delete①">delete(request, options)</a></code></span><a class="self-link" href="#cache-delete"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" data-lt="delete(request, options)|delete(request)" id="dom-cache-delete"><code>delete(<var>request</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>r</var> be null.</p>
       <li data-md="">
        <p>If <var>request</var> is a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request⑨">Request</a></code> object, then:</p>
        <ol>
         <li data-md="">
          <p>Set <var>r</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request⑥">request</a>.</p>
         <li data-md="">
          <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method③">method</a> is not `<code>GET</code>` and <var>options</var>.ignoreMethod is false, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with①">a promise resolved with</a> false.</p>
        </ol>
       <li data-md="">
        <p>Else if <var>request</var> is a string, then:</p>
        <ol>
         <li data-md="">
          <p>Set <var>r</var> to the associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request⑦">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①⓪">Request</a></code> as constructor with <var>request</var> as its argument. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①③">throws</a> an exception, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①②">a promise rejected with</a> that exception.</p>
        </ol>
       <li data-md="">
        <p>Let <var>operations</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑥">list</a>.</p>
       <li data-md="">
        <p>Let <var>operation</var> be a <a data-link-type="dfn" href="#dfn-cache-batch-operation" id="ref-for-dfn-cache-batch-operation②">cache batch operation</a>.</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type②">type</a> to "<code>delete</code>".</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request②">request</a> to <var>r</var>.</p>
       <li data-md="">
        <p>Set <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-options" id="ref-for-dfn-cache-batch-operation-options">options</a> to <var>options</var>.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑥">Append</a> <var>operation</var> to <var>operations</var>.</p>
       <li data-md="">
        <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④⑥">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑧">relevant realm</a>.</p>
       <li data-md="">
        <p>Let <var>cacheJobPromise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①⓪">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②①">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>errorData</var> be null.</p>
         <li data-md="">
          <p>Let <var>requestResponses</var> be the result of running <a data-link-type="dfn" href="#batch-cache-operations" id="ref-for-batch-cache-operations②">Batch Cache Operations</a> with <var>operations</var>. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①④">throws</a> an exception, set <var>errorData</var> to the exception.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①④">Queue a task</a>, on <var>cacheJobPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⑧">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop⑨">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source⑦">DOM manipulation task source</a>, to perform the following substeps:</p>
          <ol>
           <li data-md="">
            <p>If <var>errorData</var> is null, then:</p>
            <ol>
             <li data-md="">
              <p>If <var>requestResponses</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">is not empty</a>, resolve <var>cacheJobPromise</var> with true.</p>
             <li data-md="">
              <p>Else, resolve <var>cacheJobPromise</var> with false.</p>
            </ol>
           <li data-md="">
            <p>Else, reject <var>cacheJobPromise</var> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception②">new</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception" id="ref-for-dfn-exception②">exception</a> with <var>errorData</var> and a user agent-defined <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception-message" id="ref-for-dfn-exception-message②">message</a>, in <var>realm</var>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>cacheJobPromise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-keys">
      <h4 class="heading settled" data-level="5.4.7" id="cache-keys"><span class="secno">5.4.7. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cache-keys" id="ref-for-dom-cache-keys①">keys(request, options)</a></code></span><a class="self-link" href="#cache-keys"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="Cache" data-dfn-type="method" data-export="" data-lt="keys(request, options)|keys(request)|keys()" id="dom-cache-keys"><code>keys(<var>request</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>r</var> be null.</p>
       <li data-md="">
        <p>If the optional argument <var>request</var> is not omitted, then:</p>
        <ol>
         <li data-md="">
          <p>If <var>request</var> is a <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①①">Request</a></code> object, then:</p>
          <ol>
           <li data-md="">
            <p>Set <var>r</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request⑧">request</a>.</p>
           <li data-md="">
            <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method④">method</a> is not `<code>GET</code>` and <var>options</var>.ignoreMethod is false, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with②">a promise resolved with</a> an empty array.</p>
          </ol>
         <li data-md="">
          <p>Else if <var>request</var> is a string, then:</p>
          <ol>
           <li data-md="">
            <p>Set <var>r</var> to the associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request⑨">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①②">Request</a></code> as constructor with <var>request</var> as its argument. If this <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⑤">throws</a> an exception, return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①③">a promise rejected with</a> that exception.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Let <var>realm</var> be the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object" id="ref-for-context-object④⑦">context object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm⑨">relevant realm</a>.</p>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①①">a new promise</a>.</p>
       <li data-md="">
        <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②②">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>requests</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑦">list</a>.</p>
         <li data-md="">
          <p>If the optional argument <var>request</var> is omitted, then:</p>
          <ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑧">For each</a> <var>requestResponse</var> of the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list①">relevant request response list</a>:</p>
            <ol>
             <li data-md="">
              <p>Add <var>requestResponse</var>’s request to <var>requests</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Else:</p>
          <ol>
           <li data-md="">
            <p>Let <var>requestResponses</var> be the result of running <a data-link-type="dfn" href="#query-cache" id="ref-for-query-cache①">Query Cache</a> with <var>r</var> and <var>options</var>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑨">For each</a> <var>requestResponse</var> of <var>requestResponses</var>:</p>
            <ol>
             <li data-md="">
              <p>Add <var>requestResponse</var>’s request to <var>requests</var>.</p>
            </ol>
          </ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⑤">Queue a task</a>, on <var>promise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①⑨">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⓪">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source⑧">DOM manipulation task source</a>, to perform the following steps:</p>
          <ol>
           <li data-md="">
            <p>Let <var>requestList</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑧">list</a>.</p>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⓪">For each</a> <var>request</var> of <var>requests</var>:</p>
            <ol>
             <li data-md="">
              <p>Add a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①③">Request</a></code> object associated with <var>request</var> and a new associated <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#headers" id="ref-for-headers①">Headers</a></code> object whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-headers-guard" id="ref-for-concept-headers-guard①">guard</a> is "<code>immutable</code>" to <var>requestList</var>.</p>
            </ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type③">frozen array</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-frozen-array" id="ref-for-dfn-create-frozen-array③">created</a> from <var>requestList</var>, in <var>realm</var>.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="5.5" id="cachestorage-interface"><span class="secno">5.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage②">CacheStorage</a></code></span><a class="self-link" href="#cachestorage-interface"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑧">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①②">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="cachestorage"><code>CacheStorage</code></dfn> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑨">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-match" id="ref-for-dom-cachestorage-match">match</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑦">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="CacheStorage/match(request, options), CacheStorage/match(request)" data-dfn-type="argument" data-export="" id="dom-cachestorage-match-request-options-request"><code>request</code><a class="self-link" href="#dom-cachestorage-match-request-options-request"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions⑤">CacheQueryOptions</a> <dfn class="nv idl-code" data-dfn-for="CacheStorage/match(request, options), CacheStorage/match(request)" data-dfn-type="argument" data-export="" id="dom-cachestorage-match-request-options-options"><code>options</code><a class="self-link" href="#dom-cachestorage-match-request-options-options"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②⓪">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑧"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-has" id="ref-for-dom-cachestorage-has">has</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①④"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="CacheStorage/has(cacheName)" data-dfn-type="argument" data-export="" id="dom-cachestorage-has-cachename-cachename"><code>cacheName</code><a class="self-link" href="#dom-cachestorage-has-cachename-cachename"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#cache" id="ref-for-cache①①">Cache</a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-open" id="ref-for-dom-cachestorage-open">open</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑤"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="CacheStorage/open(cacheName)" data-dfn-type="argument" data-export="" id="dom-cachestorage-open-cachename-cachename"><code>cacheName</code><a class="self-link" href="#dom-cachestorage-open-cachename-cachename"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②②">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑨"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-delete" id="ref-for-dom-cachestorage-delete">delete</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑥"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="CacheStorage/delete(cacheName)" data-dfn-type="argument" data-export="" id="dom-cachestorage-delete-cachename-cachename"><code>cacheName</code><a class="self-link" href="#dom-cachestorage-delete-cachename-cachename"></a></dfn>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②③">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑦"><span class="kt">DOMString</span></a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-keys" id="ref-for-dom-cachestorage-keys">keys</a>();
};
</pre>
     <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage③">CacheStorage</a></code> interface is designed to largely conform to <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-map-objects" id="ref-for-sec-map-objects">ECMAScript 6 Map objects</a> but entirely async, and with additional convenience methods. The methods, <code>clear</code>, <code>forEach</code>, <code>entries</code> and <code>values</code>, are intentionally excluded from the scope of the first version resorting to the ongoing discussion about the async iteration by TC39.</p>
     <p>The user agent <em>must</em> create a <code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage④">CacheStorage</a></code> object when a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window⑨">Window</a></code> object or a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope②">WorkerGlobalScope</a></code> object is created and associate it with that <dfn class="dfn-paneled" data-dfn-for="CacheStorage" data-dfn-type="dfn" data-noexport="" id="cachestorage-global-object">global object</dfn>.</p>
     <p>A <code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage⑤">CacheStorage</a></code> object represents a <a data-link-type="dfn" href="#dfn-name-to-cache-map" id="ref-for-dfn-name-to-cache-map①">name to cache map</a> of its associated <a data-link-type="dfn" href="#cachestorage-global-object" id="ref-for-cachestorage-global-object①">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⑤">environment settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⑤">origin</a>. Multiple separate objects implementing the <code class="idl"><a data-link-type="idl" href="#cachestorage" id="ref-for-cachestorage⑥">CacheStorage</a></code> interface across documents and workers can all be associated with the same <a data-link-type="dfn" href="#dfn-name-to-cache-map" id="ref-for-dfn-name-to-cache-map②">name to cache map</a> simultaneously.</p>
     <section class="algorithm" data-algorithm="cache-storage-match">
      <h4 class="heading settled" data-level="5.5.1" id="cache-storage-match"><span class="secno">5.5.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cachestorage-match" id="ref-for-dom-cachestorage-match①">match(request, options)</a></code></span><a class="self-link" href="#cache-storage-match"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="CacheStorage" data-dfn-type="method" data-export="" data-lt="match(request, options)|match(request)" id="dom-cachestorage-match"><code>match(<var>request</var>, <var>options</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-cachequeryoptions-cachename" id="ref-for-dom-cachequeryoptions-cachename">cacheName</a></code> is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-present" id="ref-for-dfn-present①">present</a>, then:</p>
        <ol>
         <li data-md="">
          <p>Return <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①②">a new promise</a> <var>promise</var> and run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②③">in parallel</a>:</p>
          <ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate①">For each</a> <var>cacheName</var> → <var>cache</var> of the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map">relevant name to cache map</a>:</p>
            <ol>
             <li data-md="">
              <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-cachequeryoptions-cachename" id="ref-for-dom-cachequeryoptions-cachename①">cacheName</a></code> matches <var>cacheName</var>, then:</p>
              <ol>
               <li data-md="">
                <p>Resolve <var>promise</var> with the result of running the algorithm specified in <code class="idl"><a data-link-type="idl" href="#dom-cache-match" id="ref-for-dom-cache-match②">match(request, options)</a></code> method of <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①②">Cache</a></code> interface with <var>request</var> and <var>options</var> (providing <var>cache</var> as thisArgument to the <code>[[Call]]</code> internal method of <code class="idl"><a data-link-type="idl" href="#dom-cache-match" id="ref-for-dom-cache-match③">match(request, options)</a></code>.)</p>
               <li data-md="">
                <p>Abort these steps.</p>
              </ol>
            </ol>
           <li data-md="">
            <p>Resolve <var>promise</var> with undefined.</p>
          </ol>
        </ol>
       <li data-md="">
        <p>Else:</p>
        <ol>
         <li data-md="">
          <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with③">a promise resolved with</a> undefined.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate②">For each</a> <var>cacheName</var> → <var>cache</var> of the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map①">relevant name to cache map</a>:</p>
          <ol>
           <li data-md="">
            <p>Set <var>promise</var> to the result of <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#transforming-by" id="ref-for-transforming-by②">transforming</a> itself with a fulfillment handler that, when called with argument <var>response</var>, performs the following substeps:</p>
            <ol>
             <li data-md="">
              <p>If <var>response</var> is not undefined, return <var>response</var>.</p>
             <li data-md="">
              <p>Return the result of running the algorithm specified in <code class="idl"><a data-link-type="idl" href="#dom-cache-match" id="ref-for-dom-cache-match④">match(request, options)</a></code> method of <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①③">Cache</a></code> interface with <var>request</var> and <var>options</var> as the arguments (providing <var>cache</var> as thisArgument to the <code>[[Call]]</code> internal method of <code class="idl"><a data-link-type="idl" href="#dom-cache-match" id="ref-for-dom-cache-match⑤">match(request, options)</a></code>.)</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Return <var>promise</var>.</p>
        </ol>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-storage-has">
      <h4 class="heading settled" data-level="5.5.2" id="cache-storage-has"><span class="secno">5.5.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cachestorage-has" id="ref-for-dom-cachestorage-has①">has(cacheName)</a></code></span><a class="self-link" href="#cache-storage-has"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="CacheStorage" data-dfn-type="method" data-export="" id="dom-cachestorage-has"><code>has(<var>cacheName</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①③">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②④">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate③">For each</a> <var>key</var> → <var>value</var> of the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map②">relevant name to cache map</a>:</p>
          <ol>
           <li data-md="">
            <p>If <var>cacheName</var> matches <var>key</var>, resolve <var>promise</var> with true and abort these steps.</p>
          </ol>
         <li data-md="">
          <p>Resolve <var>promise</var> with false.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-storage-open">
      <h4 class="heading settled" data-level="5.5.3" id="cache-storage-open"><span class="secno">5.5.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cachestorage-open" id="ref-for-dom-cachestorage-open①">open(cacheName)</a></code></span><a class="self-link" href="#cache-storage-open"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="CacheStorage" data-dfn-type="method" data-export="" id="dom-cachestorage-open"><code>open(<var>cacheName</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①④">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⑤">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate④">For each</a> <var>key</var> → <var>value</var> of the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map③">relevant name to cache map</a>:</p>
          <ol>
           <li data-md="">
            <p>If <var>cacheName</var> matches <var>key</var>, then:</p>
            <ol>
             <li data-md="">
              <p>Resolve <var>promise</var> with a new <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①④">Cache</a></code> object that represents <var>value</var>.</p>
             <li data-md="">
              <p>Abort these steps.</p>
            </ol>
          </ol>
         <li data-md="">
          <p>Let <var>cache</var> be a new <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list④">request response list</a>.</p>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map④">relevant name to cache map</a>[<var>cacheName</var>] to <var>cache</var>. If this cache write operation failed due to exceeding the granted quota limit, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#quotaexceedederror" id="ref-for-quotaexceedederror">QuotaExceededError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⑧">DOMException</a></code> and abort these steps.</p>
         <li data-md="">
          <p>Resolve <var>promise</var> with a new <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①⑤">Cache</a></code> object that represents <var>cache</var>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-storage-delete">
      <h4 class="heading settled" data-level="5.5.4" id="cache-storage-delete"><span class="secno">5.5.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cachestorage-delete" id="ref-for-dom-cachestorage-delete①">delete(cacheName)</a></code></span><a class="self-link" href="#cache-storage-delete"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="CacheStorage" data-dfn-type="method" data-export="" id="dom-cachestorage-delete"><code>delete(<var>cacheName</var>)</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be the result of running the algorithm specified in <code class="idl"><a data-link-type="idl" href="#dom-cachestorage-has" id="ref-for-dom-cachestorage-has②">has(cacheName)</a></code> method with <var>cacheName</var>.</p>
       <li data-md="">
        <p>Return the result of <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#transforming-by" id="ref-for-transforming-by③">transforming</a> <var>promise</var> with a fulfillment handler that, when called with argument <var>cacheExists</var>, performs the following substeps:</p>
        <ol>
         <li data-md="">
          <p>If <var>cacheExists</var> is false, then:</p>
          <ol>
           <li data-md="">
            <p>Return false.</p>
          </ol>
         <li data-md="">
          <p>Let <var>cacheJobPromise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①⑤">a new promise</a>.</p>
         <li data-md="">
          <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⑥">in parallel</a>:</p>
          <ol>
           <li data-md="">
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">Remove</a> the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map⑤">relevant name to cache map</a>[<var>cacheName</var>].</p>
           <li data-md="">
            <p>Resolve <var>cacheJobPromise</var> with true.</p>
          </ol>
          <p class="note" role="note"><span>Note:</span> After this step, the existing DOM objects (i.e. the currently referenced Cache, Request, and Response objects) should remain functional.</p>
         <li data-md="">
          <p>Return <var>cacheJobPromise</var>.</p>
        </ol>
      </ol>
     </section>
     <section class="algorithm" data-algorithm="cache-storage-keys">
      <h4 class="heading settled" data-level="5.5.5" id="cache-storage-keys"><span class="secno">5.5.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-cachestorage-keys" id="ref-for-dom-cachestorage-keys①">keys()</a></code></span><a class="self-link" href="#cache-storage-keys"></a></h4>
      <p><dfn class="dfn-paneled idl-code" data-dfn-for="CacheStorage" data-dfn-type="method" data-export="" id="dom-cachestorage-keys"><code>keys()</code></dfn> method <em>must</em> run these steps:</p>
      <ol>
       <li data-md="">
        <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise" id="ref-for-a-new-promise①⑥">a new promise</a>.</p>
       <li data-md="">
        <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⑦">in parallel</a>:</p>
        <ol>
         <li data-md="">
          <p>Let <var>cacheKeys</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys">getting the keys</a> of the <a data-link-type="dfn" href="#dfn-relevant-name-to-cache-map" id="ref-for-dfn-relevant-name-to-cache-map⑥">relevant name to cache map</a>.</p>
          <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item③">items</a> in the result <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">ordered set</a> are in the order that their corresponding entry was added to the <a data-link-type="dfn" href="#dfn-name-to-cache-map" id="ref-for-dfn-name-to-cache-map③">name to cache map</a>.</p>
         <li data-md="">
          <p>Resolve <var>promise</var> with <var>cacheKeys</var>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>promise</var>.</p>
      </ol>
     </section>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
    <section>
     <h3 class="heading settled" data-level="6.1" id="secure-context"><span class="secno">6.1. </span><span class="content">Secure Context</span><a class="self-link" href="#secure-context"></a></h3>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑥⑨">Service workers</a> <em>must</em> execute in <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts③">secure contexts</a>. <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③③">Service worker clients</a> <em>must</em> also be <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts④">secure contexts</a> to register a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration④⑨">service worker registration</a>, to get access to the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⓪">service worker registrations</a> and the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⓪">service workers</a>, to do messaging with the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦①">service workers</a>, and to be manipulated by the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦②">service workers</a>.</p>
     <p class="note" role="note"><span>Note:</span> This effectively means that <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦③">service workers</a> and their <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③④">service worker clients</a> need to be hosted over HTTPS. A user agent can allow <code>localhost</code> (see <a href="https://w3c.github.io/webappsec-secure-contexts/#localhost">the requirements</a>), <code>127.0.0.0/8</code>, and <code>::1/128</code> for development purposes. The primary reason for this restriction is to protect users from the <a href="https://w3c.github.io/webappsec-secure-contexts/#threat-risks">risks associated with insecure contexts</a>.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.2" id="content-security-policy"><span class="secno">6.2. </span><span class="content">Content Security Policy</span><a class="self-link" href="#content-security-policy"></a></h3>
     <p>Whenever a user agent invokes <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker①">Run Service Worker</a> algorithm with a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦④">service worker</a> <var>serviceWorker</var>:</p>
     <ul>
      <li data-md="">
       <p>If <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource③">script resource</a> was delivered with a <code>Content-Security-Policy</code> HTTP header containing the value <var>policy</var>, the user agent <em>must</em> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#enforced" id="ref-for-enforced">enforce</a> <var>policy</var> for <var>serviceWorker</var>.</p>
      <li data-md="">
       <p>If <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource④">script resource</a> was delivered with a <code>Content-Security-Policy-Report-Only</code> HTTP header containing the value <var>policy</var>, the user agent <em>must</em> <a data-link-type="dfn" href="https://w3c.github.io/webappsec-csp/#monitored" id="ref-for-monitored">monitor</a> <var>policy</var> for <var>serviceWorker</var>.</p>
     </ul>
     <p>The primary reason for this restriction is to mitigate a broad class of content injection vulnerabilities, such as cross-site scripting (XSS).</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.3" id="origin-relativity"><span class="secno">6.3. </span><span class="content">Origin Relativity</span><a class="self-link" href="#origin-relativity"></a></h3>
     <section>
      <h4 class="heading settled" data-level="6.3.1" id="origin-restriction"><span class="secno">6.3.1. </span><span class="content">Origin restriction</span><a class="self-link" href="#origin-restriction"></a></h4>
      <p><em>This section is non-normative.</em></p>
      <p>A <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⑤">service worker</a> executes in the registering <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⑤">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⑥">origin</a>. One of the advanced concerns that major applications would encounter is whether they can be hosted from a CDN. By definition, these are servers in other places, often on other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin③">origins</a>. Therefore, <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⑥">service workers</a> cannot be hosted on CDNs. But they can include resources via <a data-link-type="functionish" href="#importscripts-method" id="ref-for-importscripts-method">importScripts()</a>. The reason for this restriction is that <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⑦">service workers</a> create the opportunity for a bad actor to turn a bad day into a bad eternity.</p>
     </section>
     <section>
      <h4 class="heading settled" data-level="6.3.2" id="importscripts"><span class="secno">6.3.2. </span><span class="content"><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-importscripts" id="ref-for-dom-workerglobalscope-importscripts">importScripts(urls)</a></code></span><a class="self-link" href="#importscripts"></a></h4>
      <p>When the <dfn class="dfn-paneled idl-code" data-dfn-for="ServiceWorkerGlobalScope" data-dfn-type="method" data-export="" id="importscripts-method"><code>importScripts(<var>urls</var>)</code></dfn> method is called on a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①④">ServiceWorkerGlobalScope</a></code> object, the user agent <em>must</em> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#import-scripts-into-worker-global-scope" id="ref-for-import-scripts-into-worker-global-scope">import scripts into worker global scope</a>, given this <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①⑤">ServiceWorkerGlobalScope</a></code> object and <var>urls</var>, and with the following steps to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#fetching-scripts-perform-fetch" id="ref-for-fetching-scripts-perform-fetch">perform the fetch</a> given the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> <var>request</var>:</p>
      <ol>
       <li data-md="">
        <p>Let <var>serviceWorker</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⑤">global object</a>'s <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker②②">service worker</a>.</p>
       <li data-md="">
        <p>If <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map">script resource map</a>[<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url⑦">url</a>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, return the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-entry" id="ref-for-map-entry①">entry</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-value" id="ref-for-map-value①">value</a>.</p>
       <li data-md="">
        <p>If <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state⑤">state</a> is not <em>parsed</em> or <em>installing</em>, return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error②">network error</a>.</p>
       <li data-md="">
        <p>Let <var>registration</var> be <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①①">containing service worker registration</a>.</p>
       <li data-md="">
        <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode①">service-workers mode</a> to "<code>none</code>".</p>
       <li data-md="">
        <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode">cache mode</a> to "<code>no-cache</code>" if any of the following are true:</p>
        <ul>
         <li data-md="">
          <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache①">update via cache mode</a> is "<code>none</code>".</p>
         <li data-md="">
          <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object">current global object</a>'s <a data-link-type="dfn" href="#serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag" id="ref-for-serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">force bypass cache for importscripts flag</a> is set.</p>
         <li data-md="">
          <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time">last update check time</a> is not null and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①">last update check time</a> is greater than 86400.</p>
        </ul>
       <li data-md="">
        <p>Let <var>response</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch⑧">fetching</a> <var>request</var>.</p>
       <li data-md="">
        <p>Set <var>response</var> to <var>response</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#unsafe-response" id="ref-for-unsafe-response">unsafe response</a>.</p>
       <li data-md="">
        <p>If <var>response</var>’s <a href="https://github.com/whatwg/fetch/issues/376">cache state</a> is not "<code>local</code>", set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time②">last update check time</a> to the current time.</p>
       <li data-md="">
        <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type" id="ref-for-concept-header-extract-mime-type">Extract a MIME type</a> from the <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list②">header list</a>. If this MIME type (ignoring parameters) is not a <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#javascript-mime-type" id="ref-for-javascript-mime-type">JavaScript MIME type</a>, return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error③">network error</a>.</p>
       <li data-md="">
        <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-type" id="ref-for-concept-response-type①">type</a> is not "<code>error</code>", and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status②">status</a> is an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status①">ok status</a>, then:</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">Set</a> <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map①">script resource map</a>[<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url⑧">url</a>] to <var>response</var>.</p>
         <li data-md="">
          <p>Set <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-classic-scripts-imported-flag" id="ref-for-dfn-classic-scripts-imported-flag">classic scripts imported flag</a>.</p>
        </ol>
       <li data-md="">
        <p>Return <var>response</var>.</p>
      </ol>
     </section>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.4" id="cross-origin-resources"><span class="secno">6.4. </span><span class="content">Cross-Origin Resources and CORS</span><a class="self-link" href="#cross-origin-resources"></a></h3>
     <p><em>This section is non-normative.</em></p>
     <p>Applications tend to cache items that come from a CDN or other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⑦">origin</a>. It is possible to request many of them directly using <code>&lt;script></code>, <code>&lt;img></code>, <code>&lt;video></code> and <code>&lt;link></code> elements. It would be hugely limiting if this sort of runtime collaboration broke when offline. Similarly, it is possible to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch⑨">fetch</a> many sorts of off-<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⑧">origin</a> resources when appropriate CORS headers are set. <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⑧">Service workers</a> enable this by allowing <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①⑥">Caches</a></code> to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①⓪">fetch</a> and cache off-origin items. Some restrictions apply, however. First, unlike same-origin resources which are managed in the <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①⑦">Cache</a></code> as <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑨">Response</a></code> objects whose corresponding <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response④">responses</a> are <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-filtered-response-basic" id="ref-for-concept-filtered-response-basic">basic filtered response</a>, the objects stored are <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response①⓪">Response</a></code> objects whose corresponding <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response⑤">responses</a> are either <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-filtered-response-cors" id="ref-for-concept-filtered-response-cors">CORS filtered responses</a> or <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-filtered-response-opaque" id="ref-for-concept-filtered-response-opaque">opaque filtered responses</a>. They can be passed to <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-respondwith" id="ref-for-dom-fetchevent-respondwith③">event.respondWith(r)</a></code> method in the same manner as the <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response①①">Response</a></code> objects whose corresponding <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response⑥">responses</a> are <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-filtered-response-basic" id="ref-for-concept-filtered-response-basic①">basic filtered responses</a>, but cannot be meaningfully created programmatically. These limitations are necessary to preserve the security invariants of the platform. Allowing <code class="idl"><a data-link-type="idl" href="#cache" id="ref-for-cache①⑧">Caches</a></code> to store them allows applications to avoid re-architecting in most cases.</p>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.5" id="implementer-concerns"><span class="secno">6.5. </span><span class="content">Implementer Concerns</span><a class="self-link" href="#implementer-concerns"></a></h3>
     <p><em>This section is non-normative.</em></p>
     <p>The implementers are encouraged to note:</p>
     <ul>
      <li data-md="">
       <p>Plug-ins should not load via <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑦⑨">service workers</a>. As plug-ins may get their security origins from their own urls, the embedding <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⓪">service worker</a> cannot handle it. For this reason, the <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch⑤">Handle Fetch</a> algorithm makes the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#potential-navigation-or-subresource-request" id="ref-for-potential-navigation-or-subresource-request">potential-navigation-or-subresource request</a> (whose context is either <code>&lt;embed></code> or <code>&lt;object></code>) immediately fallback to the network without dispatching <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event⑤">fetch</a></code> event.</p>
      <li data-md="">
       <p>Some of the legacy networking stack code may need to be carefully audited to understand the ramifications of interactions with <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧①">service workers</a>.</p>
     </ul>
    </section>
    <section>
     <h3 class="heading settled" data-level="6.6" id="privacy"><span class="secno">6.6. </span><span class="content">Privacy</span><a class="self-link" href="#privacy"></a></h3>
     <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧②">Service workers</a> introduce new persistent storage features including <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map④">scope to registration map</a> (for <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤①">service worker registrations</a> and their <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧③">service workers</a>), <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list⑤">request response list</a> and <a data-link-type="dfn" href="#dfn-name-to-cache-map" id="ref-for-dfn-name-to-cache-map④">name to cache map</a> (for caches), and <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map②">script resource map</a> (for script resources). In order to protect users from any potential <a data-link-type="biblio" href="#biblio-unsanctioned-tracking">unsanctioned tracking</a> threat, these persistent storages <em>should</em> be cleared when users intend to clear them and <em>should</em> maintain and interoperate with existing user controls e.g. purging all existing persistent storages.</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="extensibility"><span class="secno">7. </span><span class="content">Extensibility</span><a class="self-link" href="#extensibility"></a></h2>
    <p><a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧④">Service workers</a> are extensible from other specifications.</p>
    <section>
     <h3 class="heading settled" data-level="7.1" id="extension-to-service-worker-registration"><span class="secno">7.1. </span><span class="content">Define API bound to Service Worker Registration</span><a class="self-link" href="#extension-to-service-worker-registration"></a></h3>
     <p>Specifications <em>may</em> define an API tied to a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤②">service worker registration</a> by using <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-partial-interface" id="ref-for-dfn-partial-interface">partial interface</a> definition to the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⑤">ServiceWorkerRegistration</a></code> interface where it <em>may</em> define the specification specific attributes and methods:</p>
<pre class="example idl highlight def" data-no-idl="" id="example-e75a31ac"><a class="self-link" href="#example-e75a31ac"></a><span class="kt">partial</span> <span class="kt">interface</span> <span class="nv">ServiceWorkerRegistration</span> {
  // e.g. define an API namespace
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="n">APISpaceType</span> <span class="nv">APISpace</span>;
  // e.g. define a method
  <span class="kt">Promise</span>&lt;<span class="n">T</span>> <span class="nv">methodName</span>(/* list of arguments */);
};
</pre>
    </section>
    <section>
     <h3 class="heading settled" data-level="7.2" id="extension-to-extendable-event"><span class="secno">7.2. </span><span class="content">Define Functional Event</span><a class="self-link" href="#extension-to-extendable-event"></a></h3>
     <p>Specifications <em>may</em> define a <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events④">functional event</a> by extending <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①②">ExtendableEvent</a></code> interface:</p>
<pre class="example idl highlight def" data-no-idl="" id="example-85e5c3c4"><a class="self-link" href="#example-85e5c3c4"></a>// e.g. define FunctionalEvent interface
<span class="kt">interface</span> <span class="nv">FunctionalEvent</span> : <span class="n">ExtendableEvent</span> {
  // add a functional event’s own attributes and methods
};
</pre>
    </section>
    <section>
     <h3 class="heading settled" data-level="7.3" id="extension-to-service-worker-global-scope"><span class="secno">7.3. </span><span class="content">Define Event Handler</span><a class="self-link" href="#extension-to-service-worker-global-scope"></a></h3>
     <p>Specifications <em>may</em> define an event handler attribute for the corresponding <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events⑤">functional event</a> using <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-partial-interface" id="ref-for-dfn-partial-interface①">partial interface</a> definition to the <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①⑥">ServiceWorkerGlobalScope</a></code> interface:</p>
<pre class="example idl highlight def" data-no-idl="" id="example-80342678"><a class="self-link" href="#example-80342678"></a><span class="kt">partial</span> <span class="kt">interface</span> <span class="nv">ServiceWorkerGlobalScope</span> {
  <span class="kt">attribute</span> <span class="n">EventHandler</span> <span class="nv">onfunctionalevent</span>;
};
</pre>
    </section>
    <section>
     <h3 class="heading settled" data-level="7.4" id="request-functional-event-dispatch"><span class="secno">7.4. </span><span class="content">Request Functional Event Dispatch</span><a class="self-link" href="#request-functional-event-dispatch"></a></h3>
     <p>To request a <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events⑥">functional event</a> dispatch to a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⑤">service worker</a>, specifications <em>may</em> invoke <a data-link-type="dfn" href="#handle-functional-event" id="ref-for-handle-functional-event">Handle Functional Event</a> algorithm with its <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤③">service worker registration</a> <var>registration</var> and the algorithm <var>callbackSteps</var> as the arguments.</p>
     <p>Specifications <em>may</em> define an algorithm <var>callbackSteps</var> where the corresponding <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events⑦">functional event</a> can be created and fired with specification specific objects. The algorithm is passed <var>globalObject</var> (a <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①⑦">ServiceWorkerGlobalScope</a></code> object) at which it <em>may</em> fire its <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events⑧">functional events</a>. This algorithm is called on a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task④">task</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⑥">queued</a> by <a data-link-type="dfn" href="#handle-functional-event" id="ref-for-handle-functional-event①">Handle Functional Event</a> algorithm.</p>
     <p class="note" role="note"><span>Note:</span> See an <a href="https://notifications.spec.whatwg.org/#activating-a-notification">example</a> hook defined in <a data-link-type="biblio" href="#biblio-notifications">Notifications API</a>.</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" id="algorithms"><span class="content">Appendix A: Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <p>The following definitions are the user agent’s internal data structures used throughout the specification.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-scope-to-registration-map">scope to registration map</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">ordered map</a> where the keys are <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①⓪">scope urls</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer④">serialized</a>, and the values are <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤④">service worker registrations</a>.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-job">job</dfn> is an abstraction of one of register, update, and unregister request for a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⑤">service worker registration</a>.</p>
    <div>
      A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-type">job type</dfn>, which is one of <em>register</em>, <em>update</em>, and <em>unregister</em>. 
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-scope-url">scope url</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a>).</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-script-url">script url</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">URL</a>).</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job③">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-worker-type">worker type</dfn> ("<code>classic</code>" or "<code>module</code>").</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job④">job</a> has an <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-update-via-cache-mode">update via cache mode</dfn>, which is "<code>imports</code>", "<code>all</code>", or "<code>none</code>".</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job⑤">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-client">client</dfn> (a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⑥">service worker client</a>). It is initially null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job⑥">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="job-referrer">referrer</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑤">URL</a> or null).</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job⑦">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-promise">job promise</dfn> (a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⑦">promise</a>). It is initially null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job⑧">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-containing-job-queue">containing job queue</dfn> (a <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue">job queue</a> or null). It is initially null.</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job⑨">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-list-of-equivalent-jobs">list of equivalent jobs</dfn> (a list of <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⓪">jobs</a>). It is initially the empty list.</p>
     <p>A <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①①">job</a> has a <dfn class="dfn-paneled" data-dfn-for="job" data-dfn-type="dfn" data-noexport="" id="dfn-job-force-bypass-cache-flag">force bypass cache flag</dfn>. It is initially unset.</p>
    </div>
    <p>Two <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①②">jobs</a> are <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-job-equivalent">equivalent</dfn> when their <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type">job type</a> is the same and:</p>
    <ul>
     <li data-md="">
      <p>For <em>register</em> and <em>update</em> <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①③">jobs</a>, both their <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url">scope url</a> and the <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url">script url</a> are the same.</p>
     <li data-md="">
      <p>For <em>unregister</em> <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①④">jobs</a>, their <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url①">scope url</a> is the same.</p>
    </ul>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-job-queue">job queue</dfn> is a thread safe <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue" id="ref-for-queue">queue</a> used to synchronize the set of concurrent <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⑤">jobs</a>. The <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue①">job queue</a> contains <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⑥">jobs</a> as its <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item④">items</a>. A <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue②">job queue</a> is initially empty.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="dfn-scope-to-job-queue-map">scope to job queue map</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">ordered map</a> where the keys are <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①①">scope urls</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer⑤">serialized</a>, and the values are <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue③">job queues</a>.</p>
    <section class="algorithm" data-algorithm="Create Job">
     <h3 class="heading settled" id="create-job-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-job">Create Job</dfn></span><a class="self-link" href="#create-job-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>jobType</var>, a <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type①">job type</a></p>
      <dd data-md="">
       <p><var>scopeURL</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑥">URL</a></p>
      <dd data-md="">
       <p><var>scriptURL</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑦">URL</a></p>
      <dd data-md="">
       <p><var>promise</var>, a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⑧">promise</a></p>
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⑦">service worker client</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⑦">job</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>job</var> be a new <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⑧">job</a>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type②">job type</a> to <var>jobType</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url②">scope url</a> to <var>scopeURL</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url①">script url</a> to <var>scriptURL</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise">job promise</a> to <var>promise</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client">client</a> to <var>client</var>.</p>
      <li data-md="">
       <p>If <var>client</var> is not null, set <var>job</var>’s <a data-link-type="dfn" href="#job-referrer" id="ref-for-job-referrer">referrer</a> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①①">creation URL</a>.</p>
      <li data-md="">
       <p>Return <var>job</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Schedule Job">
     <h3 class="heading settled" id="schedule-job-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="schedule-job">Schedule Job</dfn></span><a class="self-link" href="#schedule-job-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job①⑨">job</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>jobQueue</var> be null.</p>
      <li data-md="">
       <p>Let <var>jobScope</var> be <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url③">scope url</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer⑥">serialized</a>.</p>
      <li data-md="">
       <p>If <a data-link-type="dfn" href="#dfn-scope-to-job-queue-map" id="ref-for-dfn-scope-to-job-queue-map">scope to job queue map</a>[<var>jobScope</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exist</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">set</a> <a data-link-type="dfn" href="#dfn-scope-to-job-queue-map" id="ref-for-dfn-scope-to-job-queue-map①">scope to job queue map</a>[<var>jobScope</var>] to a new <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue④">job queue</a>.</p>
      <li data-md="">
       <p>Set <var>jobQueue</var> to <a data-link-type="dfn" href="#dfn-scope-to-job-queue-map" id="ref-for-dfn-scope-to-job-queue-map②">scope to job queue map</a>[<var>jobScope</var>].</p>
      <li data-md="">
       <p>If <var>jobQueue</var> is empty, then:</p>
       <ol>
        <li data-md="">
         <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-containing-job-queue" id="ref-for-dfn-containing-job-queue">containing job queue</a> to <var>jobQueue</var>, and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue">enqueue</a> <var>job</var> to <var>jobQueue</var>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#run-job" id="ref-for-run-job">Run Job</a> with <var>jobQueue</var>.</p>
       </ol>
      <li data-md="">
       <p>Else:</p>
       <ol>
        <li data-md="">
         <p>Let <var>lastJob</var> be the element at the back of <var>jobQueue</var>.</p>
        <li data-md="">
         <p>If <var>job</var> is <a data-link-type="dfn" href="#dfn-job-equivalent" id="ref-for-dfn-job-equivalent">equivalent</a> to <var>lastJob</var> and <var>lastJob</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise①">job promise</a> has not settled, append <var>job</var> to <var>lastJob</var>’s <a data-link-type="dfn" href="#dfn-job-list-of-equivalent-jobs" id="ref-for-dfn-job-list-of-equivalent-jobs">list of equivalent jobs</a>.</p>
        <li data-md="">
         <p>Else, set <var>job</var>’s <a data-link-type="dfn" href="#dfn-containing-job-queue" id="ref-for-dfn-containing-job-queue①">containing job queue</a> to <var>jobQueue</var>, and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue①">enqueue</a> <var>job</var> to <var>jobQueue</var>.</p>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Run Job">
     <h3 class="heading settled" id="run-job-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="run-job">Run Job</dfn></span><a class="self-link" href="#run-job-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p>jobQueue, a <a data-link-type="dfn" href="#dfn-job-queue" id="ref-for-dfn-job-queue⑤">job queue</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p class="assertion">Assert: <var>jobQueue</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty①">is not empty</a>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⑦">Queue a task</a> to run these steps:</p>
       <ol>
        <li data-md="">
         <p>Let <var>job</var> be the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item⑤">item</a> in <var>jobQueue</var>.</p>
        <li data-md="">
         <p>If <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type③">job type</a> is <em>register</em>, run <a data-link-type="dfn" href="#register" id="ref-for-register②">Register</a> with <var>job</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⑧">in parallel</a>.</p>
        <li data-md="">
         <p>Else if <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type④">job type</a> is <em>update</em>, run <a data-link-type="dfn" href="#update" id="ref-for-update">Update</a> with <var>job</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②⑨">in parallel</a>.</p>
         <p class="note" role="note"><span>Note:</span> For a register job and an update job, the user agent delays queuing a task for running the job until after a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-domcontentloaded" id="ref-for-event-domcontentloaded">DOMContentLoaded</a></code> event has been dispatched to the document that initiated the job.</p>
        <li data-md="">
         <p>Else if <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type⑤">job type</a> is <em>unregister</em>, run <a data-link-type="dfn" href="#unregister" id="ref-for-unregister①">Unregister</a> with <var>job</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⓪">in parallel</a>.</p>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Finish Job">
     <h3 class="heading settled" id="finish-job-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="finish-job">Finish Job</dfn></span><a class="self-link" href="#finish-job-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②⓪">job</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>jobQueue</var> be <var>job</var>’s <a data-link-type="dfn" href="#dfn-containing-job-queue" id="ref-for-dfn-containing-job-queue②">containing job queue</a>.</p>
      <li data-md="">
       <p class="assertion">Assert: the first <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item⑥">item</a> in <var>jobQueue</var> is <var>job</var>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-dequeue" id="ref-for-queue-dequeue">Dequeue</a> from <var>jobQueue</var>.</p>
      <li data-md="">
       <p>If <var>jobQueue</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty②">is not empty</a>, invoke <a data-link-type="dfn" href="#run-job" id="ref-for-run-job①">Run Job</a> with <var>jobQueue</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Resolve Job Promise">
     <h3 class="heading settled" id="resolve-job-promise-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="resolve-job-promise">Resolve Job Promise</dfn></span><a class="self-link" href="#resolve-job-promise-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②①">job</a></p>
      <dd data-md="">
       <p><var>value</var>, any</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>convertedValue</var> be null.</p>
      <li data-md="">
       <p>If <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①">client</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⑧">queue a task</a>, on <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client②">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①①">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source⑨">DOM manipulation task source</a>, to run the following substeps:</p>
       <ol>
        <li data-md="">
         <p>If <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type⑥">job type</a> is either <em>register</em> or <em>update</em>, set <var>convertedValue</var> to the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⑥">ServiceWorkerRegistration</a></code> object that represents <var>value</var>, in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client③">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm">Realm</a>.</p>
        <li data-md="">
         <p>Else, set <var>convertedValue</var> to <var>value</var>, in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client④">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm①">Realm</a>.</p>
        <li data-md="">
         <p>Resolve <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise②">job promise</a> with <var>convertedValue</var>.</p>
       </ol>
      <li data-md="">
       <p>For each <var>equivalentJob</var> in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-list-of-equivalent-jobs" id="ref-for-dfn-job-list-of-equivalent-jobs①">list of equivalent jobs</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client⑤">client</a> is null, continue to the next iteration of the loop.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①⑨">Queue a task</a>, on <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client⑥">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①②">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①⓪">DOM manipulation task source</a>, to run the following substeps:</p>
         <ol>
          <li data-md="">
           <p>If <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type⑦">job type</a> is either <em>register</em> or <em>update</em>, set <var>convertedValue</var> to the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⑦">ServiceWorkerRegistration</a></code> object that represents <var>value</var>, in <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client⑦">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm②">Realm</a>.</p>
          <li data-md="">
           <p>Else, set <var>convertedValue</var> to <var>value</var>, in <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client⑧">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm③">Realm</a>.</p>
          <li data-md="">
           <p>Resolve <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise③">job promise</a> with <var>convertedValue</var>.</p>
         </ol>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Reject Job Promise">
     <h3 class="heading settled" id="reject-job-promise-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="reject-job-promise">Reject Job Promise</dfn></span><a class="self-link" href="#reject-job-promise-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②②">job</a></p>
      <dd data-md="">
       <p><var>errorData</var>, the information necessary to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception③">create an exception</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client⑨">client</a> is not null, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⓪">queue a task</a>, on <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①⓪">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①③">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①①">DOM manipulation task source</a>, to reject <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise④">job promise</a> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception④">new</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception" id="ref-for-dfn-exception③">exception</a> with <var>errorData</var> and a user agent-defined <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception-message" id="ref-for-dfn-exception-message③">message</a>, in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①①">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm④">Realm</a>.</p>
      <li data-md="">
       <p>For each <var>equivalentJob</var> in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-list-of-equivalent-jobs" id="ref-for-dfn-job-list-of-equivalent-jobs②">list of equivalent jobs</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①②">client</a> is null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②①">Queue a task</a>, on <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①③">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①④">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①②">DOM manipulation task source</a>, to reject <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise⑤">job promise</a> with a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception⑤">new</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception" id="ref-for-dfn-exception④">exception</a> with <var>errorData</var> and a user agent-defined <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-exception-message" id="ref-for-dfn-exception-message④">message</a>, in <var>equivalentJob</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①④">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm" id="ref-for-environment-settings-object&apos;s-realm⑤">Realm</a>.</p>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Start Register">
     <h3 class="heading settled" id="start-register-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="start-register">Start Register</dfn></span><a class="self-link" href="#start-register-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>scopeURL</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑧">URL</a> or failure or null</p>
      <dd data-md="">
       <p><var>scriptURL</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑨">URL</a> or failure</p>
      <dd data-md="">
       <p><var>promise</var>, a <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects②⑨">promise</a></p>
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⑧">service worker client</a></p>
      <dd data-md="">
       <p><var>referrer</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①⓪">URL</a></p>
      <dd data-md="">
       <p><var>workerType</var>, a <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type①">worker type</a></p>
      <dd data-md="">
       <p><var>updateViaCache</var>, an <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache②">update via cache mode</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If <var>scriptURL</var> is failure, reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>Set <var>scriptURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment①">fragment</a> to null.</p>
       <p class="note" role="note"><span>Note:</span> The user agent does not store the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment②">fragment</a> of the script’s url. This means that the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment③">fragment</a> does not have an effect on identifying <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⑥">service workers</a>.</p>
      <li data-md="">
       <p>If <var>scriptURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme④">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>If any of the strings in <var>scriptURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a> contains either <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> "<code>%2f</code>" or <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive①">ASCII case-insensitive</a> "<code>%5c</code>", reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>If <var>scopeURL</var> is null, set <var>scopeURL</var> to the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser⑥">parsing</a> the string "<code>./</code>" with <var>scriptURL</var>.</p>
       <p class="note" role="note"><span>Note:</span> The scope url for the registration is set to the location of the service worker script by default.</p>
      <li data-md="">
       <p>If <var>scopeURL</var> is failure, reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>Set <var>scopeURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment④">fragment</a> to null.</p>
       <p class="note" role="note"><span>Note:</span> The user agent does not store the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment⑤">fragment</a> of the scope url. This means that the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment⑥">fragment</a> does not have an effect on identifying <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⑥">service worker registrations</a>.</p>
      <li data-md="">
       <p>If <var>scopeURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme⑤">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>If any of the strings in <var>scopeURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path①">path</a> contains either <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive②">ASCII case-insensitive</a> "<code>%2f</code>" or <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive③">ASCII case-insensitive</a> "<code>%5c</code>", reject <var>promise</var> with a <code>TypeError</code> and abort these steps.</p>
      <li data-md="">
       <p>Let <var>job</var> be the result of running <a data-link-type="dfn" href="#create-job" id="ref-for-create-job②">Create Job</a> with <em>register</em>, <var>scopeURL</var>, <var>scriptURL</var>, <var>promise</var>, and <var>client</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type②">worker type</a> to <var>workerType</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-update-via-cache-mode" id="ref-for-dfn-job-update-via-cache-mode">update via cache mode</a> to <var>updateViaCache</var>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#job-referrer" id="ref-for-job-referrer①">referrer</a> to <var>referrer</var>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#schedule-job" id="ref-for-schedule-job②">Schedule Job</a> with <var>job</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Register">
     <h3 class="heading settled" id="register-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="register">Register</dfn></span><a class="self-link" href="#register-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②③">job</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If the result of running <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin">potentially trustworthy origin</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①⑨">origin</a> of <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url②">script url</a> as the argument is <code>Not Trusted</code>, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror③">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①⑨">DOMException</a></code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②⓪">origin</a> of <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url③">script url</a> is not <var>job</var>’s <a data-link-type="dfn" href="#job-referrer" id="ref-for-job-referrer②">referrer</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②①">origin</a>, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise①">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror④">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②⓪">DOMException</a></code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job①">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②②">origin</a> of <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url④">scope url</a> is not <var>job</var>’s <a data-link-type="dfn" href="#job-referrer" id="ref-for-job-referrer③">referrer</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②③">origin</a>, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise②">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror⑤">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②①">DOMException</a></code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job②">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Let <var>registration</var> be the result of running the <a data-link-type="dfn" href="#get-registration" id="ref-for-get-registration">Get Registration</a> algorithm passing <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url⑤">scope url</a> as the argument.</p>
      <li data-md="">
       <p>If <var>registration</var> is not null, then:</p>
       <ol>
        <li data-md="">
         <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag③">uninstalling flag</a> is set, unset it.</p>
        <li data-md="">
         <p>Let <var>newestWorker</var> be the result of running the <a data-link-type="dfn" href="#get-newest-worker" id="ref-for-get-newest-worker①">Get Newest Worker</a> algorithm passing <var>registration</var> as the argument.</p>
        <li data-md="">
         <p>If <var>newestWorker</var> is not null, <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url④">script url</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-equals" id="ref-for-concept-url-equals">equals</a> <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url②">script url</a>, and <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-update-via-cache-mode" id="ref-for-dfn-job-update-via-cache-mode①">update via cache mode</a>'s value equals <var>registration</var>’s <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache③">update via cache mode</a>, then:</p>
         <ol>
          <li data-md="">
           <p>Invoke <a data-link-type="dfn" href="#resolve-job-promise" id="ref-for-resolve-job-promise">Resolve Job Promise</a> with <var>job</var> and <var>registration</var>.</p>
          <li data-md="">
           <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job③">Finish Job</a> with <var>job</var> and abort these steps.</p>
         </ol>
       </ol>
      <li data-md="">
       <p>Else:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#set-registration" id="ref-for-set-registration">Set Registration</a> algorithm with <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url⑥">scope url</a> and <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-update-via-cache-mode" id="ref-for-dfn-job-update-via-cache-mode②">update via cache mode</a>.</p>
       </ol>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#update" id="ref-for-update①">Update</a> algorithm passing <var>job</var> as the argument.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Update">
     <h3 class="heading settled" id="update-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="update">Update</dfn></span><a class="self-link" href="#update-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②④">job</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>registration</var> be the result of running the <a data-link-type="dfn" href="#get-registration" id="ref-for-get-registration①">Get Registration</a> algorithm passing <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url⑦">scope url</a> as the argument.</p>
      <li data-md="">
       <p>If <var>registration</var> is null or <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag④">uninstalling flag</a> is set, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise③">Reject Job Promise</a> with <var>job</var> and <code>TypeError</code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job④">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Let <var>newestWorker</var> be the result of running <a data-link-type="dfn" href="#get-newest-worker" id="ref-for-get-newest-worker②">Get Newest Worker</a> algorithm passing <var>registration</var> as the argument.</p>
      <li data-md="">
       <p>If <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-type" id="ref-for-dfn-job-type⑧">job type</a> is <em>update</em>, and <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url③">script url</a> does not <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-equals" id="ref-for-concept-url-equals①">equal</a> <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url⑤">script url</a>, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise④">Reject Job Promise</a> with <var>job</var> and <code>TypeError</code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job⑤">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Let <var>httpsState</var> be "<code>none</code>".</p>
      <li data-md="">
       <p>Let <var>referrerPolicy</var> be the empty string.</p>
      <li data-md="">
       <p>Let <var>hasUpdatedResources</var> be false.</p>
      <li data-md="">
       <p>Let <var>updatedResourceMap</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">ordered map</a> where the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key①">keys</a> are <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①①">URLs</a> and the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-value" id="ref-for-map-value②">values</a> are <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑥">responses</a>.</p>
      <li data-md="">
       <p>Switching on <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type③">worker type</a>, run these substeps with the following options:</p>
       <dl>
        <dt data-md="">"<code>classic</code>"
        <dd data-md="">
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#fetch-a-classic-worker-script" id="ref-for-fetch-a-classic-worker-script">Fetch a classic worker script</a> given <var>job</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer⑦">serialized</a> <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url⑥">script url</a>, <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①⑤">client</a>, "<code>serviceworker</code>", and the to-be-created <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⑥">environment settings object</a> for this service worker.</p>
        <dt data-md="">"<code>module</code>"
        <dd data-md="">
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#fetch-a-module-worker-script-tree" id="ref-for-fetch-a-module-worker-script-tree">Fetch a module worker script graph</a> given <var>job</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer⑧">serialized</a> <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url⑦">script url</a>, <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①⑥">client</a>, "<code>serviceworker</code>", "<code>omit</code>", and the to-be-created <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⑦">environment settings object</a> for this service worker.</p>
       </dl>
       <p>To <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#fetching-scripts-perform-fetch" id="ref-for-fetching-scripts-perform-fetch①">perform the fetch</a> given <var>request</var>, run the following steps:</p>
       <ol>
        <li data-md="">
         <p>Append `<code>Service-Worker</code>`/`<code>script</code>` to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>.</p>
         <p class="note" role="note"><span>Note:</span> See the definition of the Service-Worker header in Appendix B: Extended HTTP headers.</p>
        <li data-md="">
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode①">cache mode</a> to "<code>no-cache</code>" if any of the following are true:</p>
         <ul>
          <li data-md="">
           <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache④">update via cache mode</a> is not "<code>all</code>".</p>
          <li data-md="">
           <p><var>job</var>’s <a data-link-type="dfn" href="#dfn-job-force-bypass-cache-flag" id="ref-for-dfn-job-force-bypass-cache-flag">force bypass cache flag</a> is set.</p>
          <li data-md="">
           <p><var>newestWorker</var> is not null, and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time③">last update check time</a> is not null and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time④">last update check time</a> is greater than 86400.</p>
         </ul>
         <p class="note" role="note"><span>Note:</span> Even if the cache mode is not set to "<code>no-cache</code>", the user agent obeys Cache-Control header’s max-age value in the network layer to determine if it should bypass the browser cache.</p>
        <li data-md="">
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode②">service-workers mode</a> to "<code>none</code>".</p>
        <li data-md="">
         <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#fetching-scripts-is-top-level" id="ref-for-fetching-scripts-is-top-level">is top-level</a> flag is unset, then return the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①①">fetching</a> <var>request</var>.</p>
        <li data-md="">
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode">redirect mode</a> to "<code>error</code>".</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①②">Fetch</a> <var>request</var>, and asynchronously wait to run the remaining steps as part of fetch’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response" id="ref-for-process-response①">process response</a> for the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑦">response</a> <var>response</var>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type" id="ref-for-concept-header-extract-mime-type①">Extract a MIME type</a> from the <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list③">header list</a>. If this MIME type (ignoring parameters) is not a <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#javascript-mime-type" id="ref-for-javascript-mime-type①">JavaScript MIME type</a>, then:</p>
         <ol>
          <li data-md="">
           <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise⑤">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror⑥">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②②">DOMException</a></code>.</p>
          <li data-md="">
           <p>Asynchronously complete these steps with a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error④">network error</a>.</p>
         </ol>
        <li data-md="">
         <p>Let <var>serviceWorkerAllowed</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#extract-header-list-values" id="ref-for-extract-header-list-values">extracting header list values</a> given `<code>Service-Worker-Allowed</code>` and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list④">header list</a>.</p>
         <p class="note" role="note"><span>Note:</span> See the definition of the Service-Worker-Allowed header in Appendix B: Extended HTTP headers.</p>
        <li data-md="">
         <p>Set <var>httpsState</var> to <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-https-state" id="ref-for-concept-response-https-state">HTTPS state</a>.</p>
        <li data-md="">
         <p>Set <var>referrerPolicy</var> to the result of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header" id="ref-for-parse-referrer-policy-from-header">parse a referrer policy from a <code>Referrer-Policy</code> header</a> of <var>response</var>.</p>
        <li data-md="">
         <p>If <var>serviceWorkerAllowed</var> is failure, then:</p>
         <ol>
          <li data-md="">
           <p>Asynchronously complete these steps with a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error⑤">network error</a>.</p>
         </ol>
        <li data-md="">
         <p>Let <var>scopeURL</var> be <var>registration</var>’s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①②">scope url</a>.</p>
        <li data-md="">
         <p>Let <var>maxScopeString</var> be null.</p>
        <li data-md="">
         <p>If <var>serviceWorkerAllowed</var> is null, then:</p>
         <ol>
          <li data-md="">
           <p>Set <var>maxScopeString</var> to "<code>/</code>" concatenated with the strings, except the last string that denotes the script’s file name, in <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url⑧">script url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path②">path</a> (including empty strings), separated from each other by "<code>/</code>".</p>
         </ol>
        <li data-md="">
         <p>Else:</p>
         <ol>
          <li data-md="">
           <p>Let <var>maxScope</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser⑦">parsing</a> <var>serviceWorkerAllowed</var> with <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url⑨">script url</a>.</p>
          <li data-md="">
           <p>Set <var>maxScopeString</var> to "<code>/</code>" concatenated with the strings in <var>maxScope</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path③">path</a> (including empty strings), separated from each other by "<code>/</code>".</p>
         </ol>
        <li data-md="">
         <p>Let <var>scopeString</var> be "<code>/</code>" concatenated with the strings in <var>scopeURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path④">path</a> (including empty strings), separated from each other by "<code>/</code>".</p>
        <li data-md="">
         <p>If <var>scopeString</var> starts with <var>maxScopeString</var>, do nothing.</p>
        <li data-md="">
         <p>Else:</p>
         <ol>
          <li data-md="">
           <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise⑥">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror⑦">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②③">DOMException</a></code>.</p>
          <li data-md="">
           <p>Asynchronously complete these steps with a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error⑥">network error</a>.</p>
         </ol>
        <li data-md="">
         <p>Set <var>updatedResourceMap</var>[<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url⑨">url</a>] to <var>response</var>.</p>
        <li data-md="">
         <p>If <var>response</var>’s <a href="https://github.com/whatwg/fetch/issues/376">cache state</a> is not "<code>local</code>", set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time⑤">last update check time</a> to the current time.</p>
         <p class="issue" id="issue-3c7457a0"><a class="self-link" href="#issue-3c7457a0"></a> The response’s cache state concept had been removed from fetch. The fetch issue <a href="https://github.com/whatwg/fetch/issues/376">#376</a> tracks the request to restore the concept or add some similar way to check this state.</p>
        <li data-md="">
         <p>If <var>newestWorker</var> is null, or <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map③">script resource map</a>[<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①⓪">url</a>]'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑧">body</a> is not byte-for-byte identical with <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑨">body</a>, set <var>hasUpdatedResources</var> to true.</p>
        <li data-md="">
         <p>Else if <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-classic-scripts-imported-flag" id="ref-for-dfn-classic-scripts-imported-flag①">classic scripts imported flag</a> is set, then:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑤">For each</a> <var>url</var> → <var>storedResponse</var> of <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map④">script resource map</a>:</p>
           <ol>
            <li data-md="">
             <p>Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request③">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①①">url</a> is <var>url</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client②">client</a> is <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①⑦">client</a>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination①">destination</a> is "<code>script</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-parser-metadata" id="ref-for-concept-request-parser-metadata">parser metadata</a> is "<code>not parser-inserted</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#synchronous-flag" id="ref-for-synchronous-flag">synchronous flag</a> is set, and whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag" id="ref-for-concept-request-use-url-credentials-flag">use-URL-credentials flag</a> is set.</p>
            <li data-md="">
             <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode②">cache mode</a> to "<code>no-cache</code>" if any of the following are true:</p>
             <ul>
              <li data-md="">
               <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache⑤">update via cache mode</a> is "<code>none</code>".</p>
              <li data-md="">
               <p><var>job</var>’s <a data-link-type="dfn" href="#dfn-job-force-bypass-cache-flag" id="ref-for-dfn-job-force-bypass-cache-flag①">force bypass cache flag</a> is set.</p>
              <li data-md="">
               <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time⑥">last update check time</a> is not null and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time⑦">last update check time</a> is greater than 86400.</p>
             </ul>
            <li data-md="">
             <p>Let <var>fetchedResponse</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①③">fetching</a> <var>request</var>.</p>
            <li data-md="">
             <p>Set <var>fetchedResponse</var> to <var>fetchedResponse</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#unsafe-response" id="ref-for-unsafe-response①">unsafe response</a>.</p>
            <li data-md="">
             <p>Set <var>updatedResourceMap</var>[<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①②">url</a>] to <var>fetchedResponse</var>.</p>
            <li data-md="">
             <p>If <var>fetchedResponse</var>’s <a href="https://github.com/whatwg/fetch/issues/376">cache state</a> is not "<code>local</code>", set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time⑧">last update check time</a> to the current time.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type" id="ref-for-concept-header-extract-mime-type②">Extract a MIME type</a> from the <var>fetchedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑤">header list</a>. If this MIME type (ignoring parameters) is not a <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#javascript-mime-type" id="ref-for-javascript-mime-type②">JavaScript MIME type</a>, asynchronously complete these steps with a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error⑦">network error</a>.</p>
            <li data-md="">
             <p>If <var>fetchedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-type" id="ref-for-concept-response-type②">type</a> is "<code>error</code>", or <var>fetchedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status③">status</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#ok-status" id="ref-for-ok-status②">ok status</a>, asynchronously complete these steps with a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error⑧">network error</a>.</p>
            <li data-md="">
             <p>If <var>fetchedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①⓪">body</a> is not byte-for-byte identical with <var>storedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①①">body</a>, set <var>hasUpdatedResources</var> to true.</p>
             <p class="note" role="note"><span>Note:</span> The control does not break the loop in this step to continue with all the imported scripts to populate the cache.</p>
           </ol>
         </ol>
        <li data-md="">
         <p>Return true.</p>
       </ol>
       <p>If the algorithm asynchronously completes with null, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise⑦">Reject Job Promise</a> with <var>job</var> and <code>TypeError</code>.</p>
         <p class="note" role="note"><span>Note:</span> This will do nothing if <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise⑧">Reject Job Promise</a> was previously invoked with "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror⑧">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②④">DOMException</a></code>.</p>
        <li data-md="">
         <p>If <var>newestWorker</var> is null, invoke <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration">Clear Registration</a> algorithm passing <var>registration</var> as its argument.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job⑥">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
       <p>Else, continue the rest of these steps after the algorithm’s asynchronous completion, with <var>script</var> being the asynchronous completion value.</p>
      <li data-md="">
       <p>If <var>hasUpdatedResources</var> is false, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#resolve-job-promise" id="ref-for-resolve-job-promise①">Resolve Job Promise</a> with <var>job</var> and <var>registration</var>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job⑦">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Let <var>worker</var> be a new <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⑦">service worker</a>.</p>
      <li data-md="">
       <p>Set <var>worker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url④">script url</a> to <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-script-url" id="ref-for-dfn-job-script-url①⓪">script url</a>, <var>worker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource⑤">script resource</a> to <var>script</var>, and <var>worker</var>’s <a data-link-type="dfn" href="#dfn-type" id="ref-for-dfn-type①">type</a> to <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type④">worker type</a>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑥">For each</a> <var>url</var> → <var>response</var> of <var>updatedResourceMap</var>:</p>
       <ol>
        <li data-md="">
         <p>Set <var>worker</var>’s <a data-link-type="dfn" href="#dfn-script-resource-map" id="ref-for-dfn-script-resource-map⑤">script resource map</a>[<var>url</var>] to <var>response</var>.</p>
       </ol>
      <li data-md="">
       <p>Set <var>worker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource⑥">script resource</a>’s <a data-link-type="dfn" href="#dfn-https-state" id="ref-for-dfn-https-state">HTTPS state</a> to <var>httpsState</var>.</p>
      <li data-md="">
       <p>Set <var>worker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource⑦">script resource</a>’s <a data-link-type="dfn" href="#dfn-referrer-policy" id="ref-for-dfn-referrer-policy">referrer policy</a> to <var>referrerPolicy</var>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker②">Run Service Worker</a> algorithm given <var>worker</var>, and with the <em>force bypass cache for importscripts flag</em> set if <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-force-bypass-cache-flag" id="ref-for-dfn-job-force-bypass-cache-flag②">force bypass cache flag</a> is set.</p>
      <li data-md="">
       <p>If an uncaught runtime script error occurs during the above step, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise⑨">Reject Job Promise</a> with <var>job</var> and <code>TypeError</code>.</p>
        <li data-md="">
         <p>If <var>newestWorker</var> is null, invoke <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration①">Clear Registration</a> algorithm passing <var>registration</var> as its argument.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job⑧">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#install" id="ref-for-install②">Install</a> algorithm with <var>job</var>, <var>worker</var>, and <var>registration</var> as its arguments.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Soft Update">
     <h3 class="heading settled" id="soft-update-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="soft-update">Soft Update</dfn></span><a class="self-link" href="#soft-update-algorithm"></a></h3>
     <p>The user agent <em>may</em> call this as often as it likes to check for updates.</p>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⑦">service worker registration</a></p>
      <dd data-md="">
       <p><em>force bypass cache flag</em>, an optional flag unset by default</p>
       <p class="note" role="note"><span>Note:</span> Implementers may use the <em>force bypass cache flag</em> to aid debugging (e.g. invocations from developer tools), and other specifications that extend service workers may also use the flag on their own needs.</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>newestWorker</var> be the result of running <a data-link-type="dfn" href="#get-newest-worker" id="ref-for-get-newest-worker③">Get Newest Worker</a> algorithm passing <var>registration</var> as its argument.</p>
      <li data-md="">
       <p>If <var>newestWorker</var> is null, abort these steps.</p>
      <li data-md="">
       <p>Let <var>job</var> be the result of running <a data-link-type="dfn" href="#create-job" id="ref-for-create-job③">Create Job</a> with <em>update</em>, <var>registration</var>’s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①③">scope url</a>, <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url⑤">script url</a>, null, and null.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-worker-type" id="ref-for-dfn-job-worker-type⑤">worker type</a> to <var>newestWorker</var>’s <a data-link-type="dfn" href="#dfn-type" id="ref-for-dfn-type②">type</a>.</p>
      <li data-md="">
       <p>Set <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-force-bypass-cache-flag" id="ref-for-dfn-job-force-bypass-cache-flag③">force bypass cache flag</a> if the <em>force bypass cache flag</em> is set.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#schedule-job" id="ref-for-schedule-job③">Schedule Job</a> with <var>job</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Install">
     <h3 class="heading settled" id="installation-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="install">Install</dfn></span><a class="self-link" href="#installation-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②⑤">job</a></p>
      <dd data-md="">
       <p><var>worker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⑧">service worker</a></p>
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⑧">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>installFailed</var> be false.</p>
      <li data-md="">
       <p>Let <var>newestWorker</var> be the result of running <a data-link-type="dfn" href="#get-newest-worker" id="ref-for-get-newest-worker④">Get Newest Worker</a> algorithm passing <var>registration</var> as its argument.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state">Update Registration State</a> algorithm passing <var>registration</var>, "<code>installing</code>" and <var>worker</var> as the arguments.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker⑥">installing worker</a> and <em>installing</em> as the arguments.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-promise" id="ref-for-dfn-job-promise⑥">job promise</a> is not null.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#resolve-job-promise" id="ref-for-resolve-job-promise②">Resolve Job Promise</a> with <var>job</var> and <var>registration</var>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②②">Queue a task</a> to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">fire an event</a> named <code>updatefound</code> at all the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⑧">ServiceWorkerRegistration</a></code> objects for all the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client③⑨">service worker clients</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①②">creation URL</a> <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration⑦">matches</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①④">scope url</a> and all the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑧⑨">service workers</a> whose <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①②">containing service worker registration</a> is <var>registration</var>.</p>
      <li data-md="">
       <p>Let <var>installingWorker</var> be <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker⑦">installing worker</a>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker③">Run Service Worker</a> algorithm given <var>installingWorker</var>, and with the <em>force bypass cache for importscripts flag</em> set if <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-force-bypass-cache-flag" id="ref-for-dfn-job-force-bypass-cache-flag④">force bypass cache flag</a> is set.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②③">Queue a task</a> <var>task</var> to run the following substeps:</p>
       <ol>
        <li data-md="">
         <p>Let <var>e</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create①">creating an event</a> with <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①③">ExtendableEvent</a></code>.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-install-event" id="ref-for-service-worker-global-scope-install-event⑤">install</a></code>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch④">Dispatch</a> <var>e</var> at <var>installingWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object">global object</a>.</p>
        <li data-md="">
         <p><em>WaitForAsynchronousExtensions</em>: Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③①">in parallel</a>:</p>
         <ol>
          <li data-md="">
           <p><span id="install-settle-step">Wait until <var>e</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count⑧">pending promises count</a> is zero.</span></p>
          <li data-md="">
           <p>If the result of <a data-link-type="dfn" href="https://www.w3.org/2001/tag/doc/promises-guide/#waiting-for-all" id="ref-for-waiting-for-all①">waiting for all</a> of <var>e</var>’s <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises⑦">extend lifetime promises</a> rejected, set <var>installFailed</var> to true.</p>
         </ol>
       </ol>
       <p>If <var>task</var> is discarded or the script has been aborted by the <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker③">termination</a> of <var>installingWorker</var>, set <var>installFailed</var> to true.</p>
      <li data-md="">
       <p>Wait for <var>task</var> to have executed or been discarded.</p>
      <li data-md="">
       <p>Wait for the step labeled <em>WaitForAsynchronousExtensions</em> to complete.</p>
      <li data-md="">
       <p>If <var>installFailed</var> is true, then:</p>
       <ol>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state①">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker⑧">installing worker</a> and <em>redundant</em> as the arguments.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state①">Update Registration State</a> algorithm passing <var>registration</var>, "<code>installing</code>" and null as the arguments.</p>
        <li data-md="">
         <p>If <var>newestWorker</var> is null, invoke <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration②">Clear Registration</a> algorithm passing <var>registration</var> as its argument.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job⑨">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker③">waiting worker</a> is not null, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker④">Terminate</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker④">waiting worker</a>.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state②">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker⑤">waiting worker</a> and <em>redundant</em> as the arguments.</p>
       </ol>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state②">Update Registration State</a> algorithm passing <var>registration</var>, "<code>waiting</code>" and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker⑨">installing worker</a> as the arguments.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state③">Update Registration State</a> algorithm passing <var>registration</var>, "<code>installing</code>" and null as the arguments.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state③">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker⑥">waiting worker</a> and <em>installed</em> as the arguments.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job①⓪">Finish Job</a> with <var>job</var>.</p>
      <li data-md="">
       <p>Wait for all the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑤">tasks</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②④">queued</a> by <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state④">Update Worker State</a> invoked in this algorithm to have executed.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate③">Try Activate</a> with <var>registration</var>.</p>
       <p class="note" role="note"><span>Note:</span> If <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate④">Try Activate</a> does not trigger <a data-link-type="dfn" href="#activate" id="ref-for-activate③">Activate</a> here, <a data-link-type="dfn" href="#activate" id="ref-for-activate④">Activate</a> is tried again when the last client controlled by the existing <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⓪">active worker</a> is <a data-link-type="dfn" href="#handle-service-worker-client-unload" id="ref-for-handle-service-worker-client-unload①">unloaded</a>, <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-skipwaiting" id="ref-for-dom-serviceworkerglobalscope-skipwaiting③">skipWaiting()</a></code> is asynchronously called, or the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises⑧">extend lifetime promises</a> for the existing <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②①">active worker</a> settle.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Activate">
     <h3 class="heading settled" id="activation-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="activate">Activate</dfn></span><a class="self-link" href="#activation-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑤⑨">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker⑦">waiting worker</a> is null, abort these steps.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②②">active worker</a> is not null, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker⑤">Terminate</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②③">active worker</a>.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state⑤">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②④">active worker</a> and <em>redundant</em> as the arguments.</p>
       </ol>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state④">Update Registration State</a> algorithm passing <var>registration</var>, "<code>active</code>" and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker⑧">waiting worker</a> as the arguments.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state⑤">Update Registration State</a> algorithm passing <var>registration</var>, "<code>waiting</code>" and null as the arguments.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state⑥">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⑤">active worker</a> and <em>activating</em> as the arguments.</p>
       <p class="note" role="note"><span>Note:</span> Once an active worker is activating, neither a runtime script error nor a force termination of the active worker prevents the active worker from getting activated.</p>
      <li data-md="">
       <p>Let <var>matchedClients</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑨">list</a> of <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⓪">service worker clients</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①③">creation URL</a> <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration⑧">matches</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①⑤">scope url</a>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①①">For each</a> <var>client</var> of <var>matchedClients</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⑤">queue a task</a> on <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⑤">responsible event loop</a>, using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①③">DOM manipulation task source</a>, to run the following substeps:</p>
       <ol>
        <li data-md="">
         <p>Let <var>readyPromise</var> be <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⑥">global object</a>'s <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①⑤">ServiceWorkerContainer</a></code> object’s <a data-link-type="dfn" href="#serviceworkercontainer-ready-promise" id="ref-for-serviceworkercontainer-ready-promise②">ready promise</a>.</p>
        <li data-md="">
         <p><span id="activate-resolve-ready-step">If <var>readyPromise</var> is pending, resolve <var>readyPromise</var> with the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①⑨">ServiceWorkerRegistration</a></code> object that represents <var>registration</var> in <var>readyPromise</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm①⓪">relevant Realm</a></span>.</p>
       </ol>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①②">For each</a> <var>client</var> of <var>matchedClients</var>:</p>
       <ol>
        <li data-md="">
         <p>If <var>client</var> is a <a data-link-type="dfn" href="#dfn-window-client" id="ref-for-dfn-window-client⑥">window client</a>, unassociate <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document" id="ref-for-responsible-document②">responsible document</a> from its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/offline.html#application-cache" id="ref-for-application-cache①">application cache</a>, if it has one.</p>
        <li data-md="">
         <p>Else if <var>client</var> is a <a data-link-type="dfn" href="#dfn-sharedworker-client" id="ref-for-dfn-sharedworker-client③">shared worker client</a>, unassociate <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⑦">global object</a> from its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/offline.html#application-cache" id="ref-for-application-cache②">application cache</a>, if it has one.</p>
       </ol>
       <p class="note" role="note"><span>Note:</span> Resources will now use the service worker registration instead of the existing application cache.</p>
      <li data-md="">
       <p>For each <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④①">service worker client</a> <var>client</var> who is <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use③">using</a> <var>registration</var>:</p>
       <ol>
        <li data-md="">
         <p>Set <var>client</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⑥">active worker</a> to <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⑦">active worker</a>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#notify-controller-change" id="ref-for-notify-controller-change①">Notify Controller Change</a> algorithm with <var>client</var> as the argument.</p>
       </ol>
      <li data-md="">
       <p>Let <var>activeWorker</var> be <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⑧">active worker</a>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker④">Run Service Worker</a> algorithm with <var>activeWorker</var> as the argument.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⑥">Queue a task</a> <var>task</var> to run the following substeps:</p>
       <ol>
        <li data-md="">
         <p>Let <var>e</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create②">creating an event</a> with <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①④">ExtendableEvent</a></code>.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type①">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-activate-event" id="ref-for-service-worker-global-scope-activate-event⑤">activate</a></code>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑤">Dispatch</a> <var>e</var> at <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object①">global object</a>.</p>
        <li data-md="">
         <p><span id="activate-settle-step"><em>WaitForAsynchronousExtensions</em>: Wait, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③②">in parallel</a>, until <var>e</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count⑨">pending promises count</a> is zero.</span></p>
       </ol>
      <li data-md="">
       <p>Wait for <var>task</var> to have executed or been discarded, or the script to have been aborted by the <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker⑥">termination</a> of <var>activeWorker</var>.</p>
      <li data-md="">
       <p>Wait for the step labeled <em>WaitForAsynchronousExtensions</em> to complete.</p>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state⑦">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker②⑨">active worker</a> and <em>activated</em> as the arguments.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Try Activate">
     <h3 class="heading settled" id="try-activate-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="try-activate">Try Activate</dfn></span><a class="self-link" href="#try-activate-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⓪">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker⑨">waiting worker</a> is null, return.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⓪">active worker</a> is not null and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③①">active worker</a>'s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state⑥">state</a> is <em>activating</em>, return.</p>
       <p class="note" role="note"><span>Note:</span> If the existing active worker is still in activating state, the activation of the waiting worker is delayed.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#activate" id="ref-for-activate⑤">Activate</a> with <var>registration</var> if either of the following is true:</p>
       <ul>
        <li data-md="">
         <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③②">active worker</a> is null.</p>
        <li data-md="">
         <p>The result of running <a data-link-type="dfn" href="#service-worker-has-no-pending-events" id="ref-for-service-worker-has-no-pending-events">Service Worker Has No Pending Events</a> with <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③③">active worker</a> is true, and no <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④②">service worker client</a> is <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use④">using</a> <var>registration</var> or <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⓪">waiting worker</a>'s <a data-link-type="dfn" href="#dfn-skip-waiting-flag" id="ref-for-dfn-skip-waiting-flag②">skip waiting flag</a> is set.</p>
       </ul>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Run Service Worker">
     <h3 class="heading settled" id="run-service-worker-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="run-service-worker">Run Service Worker</dfn></span><a class="self-link" href="#run-service-worker-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>serviceWorker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⓪">service worker</a></p>
      <dd data-md="">
       <p><em>force bypass cache for importscripts flag</em>, an optional flag unset by default</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>script</var> be <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource⑧">script resource</a>.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>script</var> is not null.</p>
      <li data-md="">
       <p>If <var>serviceWorker</var> is already running, abort these steps.</p>
      <li data-md="">
       <p>Create a separate parallel execution environment (i.e. a separate thread or process or equivalent construct), and run the rest of these steps in that context.</p>
      <li data-md="">
       <p>Call the JavaScript <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-initializehostdefinedrealm" id="ref-for-sec-initializehostdefinedrealm">InitializeHostDefinedRealm()</a> abstract operation with the following customizations:</p>
       <ul>
        <li data-md="">
         <p>For the global object, create a new <code class="idl"><a data-link-type="idl" href="#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope①⑧">ServiceWorkerGlobalScope</a></code> object. Let <var>workerGlobalScope</var> be the created object.</p>
        <li data-md="">
         <p>Let <var>realmExecutionContext</var> be the created <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-execution-contexts" id="ref-for-sec-execution-contexts">JavaScript execution context</a>.</p>
       </ul>
      <li data-md="">
       <p>Set <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object②">global object</a> to <var>workerGlobalScope</var>.</p>
      <li data-md="">
       <p>Let <var>workerEventLoop</var> be a newly created <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop⑦">event loop</a>.</p>
      <li data-md="">
       <p>Let <var>settingsObject</var> be a new <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⑧">environment settings object</a> whose algorithms are defined as follows:</p>
       <dl>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context" id="ref-for-realm-execution-context">realm execution context</a>
        <dd data-md="">
         <p>Return <var>realmExecutionContext</var>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⑧">global object</a>
        <dd data-md="">
         <p>Return <var>workerGlobalScope</var>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⑥">responsible event loop</a>
        <dd data-md="">
         <p>Return <var>workerEventLoop</var>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-referrer-policy" id="ref-for-concept-settings-object-referrer-policy">referrer policy</a>
        <dd data-md="">
         <p>Return <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-referrer-policy" id="ref-for-concept-workerglobalscope-referrer-policy">referrer policy</a>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-url-character-encoding" id="ref-for-api-url-character-encoding">API URL character encoding</a>
        <dd data-md="">
         <p>Return UTF-8.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url⑤">API base URL</a>
        <dd data-md="">
         <p>Return <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url⑥">script url</a>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②④">origin</a>
        <dd data-md="">
         <p>Return its registering <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④③">service worker client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②⑤">origin</a>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url" id="ref-for-concept-environment-creation-url①④">creation URL</a>
        <dd data-md="">
         <p>Return <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url" id="ref-for-concept-workerglobalscope-url">url</a>.</p>
        <dt data-md="">The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state" id="ref-for-https-state">HTTPS state</a>
        <dd data-md="">
         <p>Return <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-https-state" id="ref-for-concept-workerglobalscope-https-state">HTTPS state</a>.</p>
       </dl>
      <li data-md="">
       <p>Set <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url" id="ref-for-concept-workerglobalscope-url①">url</a> to <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-url" id="ref-for-dfn-script-url⑦">script url</a>.</p>
      <li data-md="">
       <p>Set <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-https-state" id="ref-for-concept-workerglobalscope-https-state①">HTTPS state</a> to <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource⑨">script resource</a>’s <a data-link-type="dfn" href="#dfn-https-state" id="ref-for-dfn-https-state①">HTTPS state</a>.</p>
      <li data-md="">
       <p>Set <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-referrer-policy" id="ref-for-concept-workerglobalscope-referrer-policy①">referrer policy</a> to <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①⓪">script resource</a>’s <a data-link-type="dfn" href="#dfn-referrer-policy" id="ref-for-dfn-referrer-policy①">referrer policy</a>.</p>
      <li data-md="">
       <p>Set <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-type" id="ref-for-concept-workerglobalscope-type">type</a> to <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-type" id="ref-for-dfn-type③">type</a>.</p>
      <li data-md="">
       <p>Set <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="#serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag" id="ref-for-serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag①">force bypass cache for importscripts flag</a> if the <em>force bypass cache for importscripts flag</em> is set.</p>
      <li data-md="">
       <p>Create a new <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerlocation" id="ref-for-workerlocation">WorkerLocation</a></code> object and associate it with <var>workerGlobalScope</var>.</p>
      <li data-md="">
       <p>If <var>serviceWorker</var> is an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③④">active worker</a>, and there are any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑥">tasks</a> queued in <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①③">containing service worker registration</a>’s <a data-link-type="dfn" href="#dfn-service-worker-registration-task-queue" id="ref-for-dfn-service-worker-registration-task-queue②">task queues</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⑦">queue</a> them to <var>serviceWorker</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop⑧">event loop</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue③">task queues</a> in the same order using their original <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑤">task sources</a>.</p>
      <li data-md="">
       <p>If <var>script</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#classic-script" id="ref-for-classic-script">classic script</a>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#run-a-classic-script" id="ref-for-run-a-classic-script">run the classic script</a> <var>script</var>. Otherwise, it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-script" id="ref-for-module-script">module script</a>; <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#run-a-module-script" id="ref-for-run-a-module-script">run the module script</a> <var>script</var>.</p>
       <p class="note" role="note"><span>Note:</span> In addition to the usual possibilities of returning a value or failing due to an exception, this could be prematurely aborted by the <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker⑦">terminate service worker</a> algorithm.</p>
      <li data-md="">
       <p>If <var>script</var>’s <a data-link-type="dfn" href="#dfn-has-ever-been-evaluated-flag" id="ref-for-dfn-has-ever-been-evaluated-flag">has ever been evaluated flag</a> is unset, then:</p>
       <ol>
        <li data-md="">
         <p>For each <var>eventType</var> of <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①⑨">global object</a>'s associated list of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-listener" id="ref-for-concept-event-listener①">event listeners</a>' event types:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>eventType</var> to <var>workerGlobalScope</var>’s associated <a data-link-type="dfn" href="#serviceworkerglobalscope-service-worker" id="ref-for-serviceworkerglobalscope-service-worker②③">service worker</a>'s <a data-link-type="dfn" href="#dfn-set-of-event-types-to-handle" id="ref-for-dfn-set-of-event-types-to-handle">set of event types to handle</a>.</p>
         </ol>
       </ol>
       <p class="note" role="note"><span>Note:</span> If the global object’s associated list of event listeners does not have any event listener added at this moment, the service worker’s set of event types to handle remains an empty set. The user agents are encouraged to show a warning that the event listeners must be added on the very first evaluation of the worker script.</p>
       <ol>
        <li data-md="">
         <p>Set <var>script</var>’s <a data-link-type="dfn" href="#dfn-has-ever-been-evaluated-flag" id="ref-for-dfn-has-ever-been-evaluated-flag①">has ever been evaluated flag</a>.</p>
       </ol>
      <li data-md="">
       <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⑦">responsible event loop</a> specified by <var>settingsObject</var> until it is destroyed.</p>
      <li data-md="">
       <p>Empty <var>workerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#list-of-active-timers" id="ref-for-list-of-active-timers">list of active timers</a>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Terminate Service Worker">
     <h3 class="heading settled" id="terminate-service-worker-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="terminate-service-worker">Terminate Service Worker</dfn></span><a class="self-link" href="#terminate-service-worker-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>serviceWorker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨①">service worker</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If <var>serviceWorker</var> is not running, abort these steps.</p>
      <li data-md="">
       <p>Let <var>serviceWorkerGlobalScope</var> be <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object③">global object</a>.</p>
      <li data-md="">
       <p>Set <var>serviceWorkerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing" id="ref-for-dom-workerglobalscope-closing">closing</a> flag to true.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">Remove</a> all the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item⑦">items</a> from <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-set-of-extended-events" id="ref-for-dfn-set-of-extended-events">set of extended events</a>.</p>
      <li data-md="">
       <p>If there are any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑦">tasks</a>, whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑥">task source</a> is either the <a data-link-type="dfn" href="#dfn-handle-fetch-task-source" id="ref-for-dfn-handle-fetch-task-source①">handle fetch task source</a> or the <a data-link-type="dfn" href="#dfn-handle-functional-event-task-source" id="ref-for-dfn-handle-functional-event-task-source①">handle functional event task source</a>, queued in <var>serviceWorkerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop⑨">event loop</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue④">task queues</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⑧">queue</a> them to <var>serviceWorker</var>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①④">containing service worker registration</a>’s corresponding <a data-link-type="dfn" href="#dfn-service-worker-registration-task-queue" id="ref-for-dfn-service-worker-registration-task-queue③">task queues</a> in the same order using their original <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑦">task sources</a>, and discard all the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑧">tasks</a> (including <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑨">tasks</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source⑧">task source</a> is neither the <a data-link-type="dfn" href="#dfn-handle-fetch-task-source" id="ref-for-dfn-handle-fetch-task-source②">handle fetch task source</a> nor the <a data-link-type="dfn" href="#dfn-handle-functional-event-task-source" id="ref-for-dfn-handle-functional-event-task-source②">handle functional event task source</a>) from <var>serviceWorkerGlobalScope</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①⓪">event loop</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue⑤">task queues</a> without processing them.</p>
       <p class="note" role="note"><span>Note:</span> This effectively means that the fetch events and the other functional events such as push events are backed up by the registration’s task queues while the other tasks including message events are discarded.</p>
      <li data-md="">
       <p>Abort the script currently running in <var>serviceWorker</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Handle Fetch">
     <h3 class="heading settled" id="on-fetch-request-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="handle-fetch">Handle Fetch</dfn></span><a class="self-link" href="#on-fetch-request-algorithm"></a></h3>
     <p>The <a data-link-type="dfn" href="#handle-fetch" id="ref-for-handle-fetch⑥">Handle Fetch</a> algorithm is the entry point for the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①④">fetch</a> handling handed to the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨②">service worker</a> context.</p>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>request</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request④">request</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>response</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response⑧">response</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>handleFetchFailed</var> be false.</p>
      <li data-md="">
       <p>Let <var>respondWithEntered</var> be false.</p>
      <li data-md="">
       <p>Let <var>eventCanceled</var> be false.</p>
      <li data-md="">
       <p>Let <var>response</var> be null.</p>
      <li data-md="">
       <p>Let <var>registration</var> be null.</p>
      <li data-md="">
       <p>Let <var>client</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client③">client</a>.</p>
      <li data-md="">
       <p>Let <var>reservedClient</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-reserved-client" id="ref-for-concept-request-reserved-client">reserved client</a>.</p>
      <li data-md="">
       <p>Let <var>preloadResponse</var> be a new <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects③⓪">promise</a>.</p>
      <li data-md="">
       <p>Let <var>fetchInstance</var> be the instance of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①⑤">fetch</a> algorithm representing the ongoing fetch.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination②">destination</a> is not "<code>serviceworker</code>".</p>
      <li data-md="">
       <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#potential-navigation-or-subresource-request" id="ref-for-potential-navigation-or-subresource-request①">potential-navigation-or-subresource request</a>, then:</p>
       <ol>
        <li data-md="">
         <p>Return null.</p>
       </ol>
      <li data-md="">
       <p>Else if <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request①">non-subresource request</a>, then:</p>
       <p class="note" role="note"><span>Note:</span> If the non-subresource request is under the scope of a service worker registration, application cache is completely bypassed regardless of whether the non-subresource request uses the service worker registration.</p>
       <ol>
        <li data-md="">
         <p>If <var>reservedClient</var> is not null and is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①⑨">environment settings object</a>, then:</p>
         <ol>
          <li data-md="">
           <p>If <var>reservedClient</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts" id="ref-for-secure-contexts⑤">secure context</a>, return null.</p>
         </ol>
        <li data-md="">
         <p>Else:</p>
         <ol>
          <li data-md="">
           <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①③">url</a> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url③">potentially trustworthy URL</a>, return null.</p>
         </ol>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request">navigation request</a> and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate③">navigation</a> triggering it was initiated with a shift+reload or equivalent, return null.</p>
        <li data-md="">
         <p>Set <var>registration</var> to the result of running <a data-link-type="dfn" href="#match-service-worker-registration" id="ref-for-match-service-worker-registration⑨">Match Service Worker Registration</a> algorithm passing <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①④">url</a> as the argument.</p>
        <li data-md="">
         <p>If <var>registration</var> is null or <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⑤">active worker</a> is null, return null.</p>
        <li data-md="">
         <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination③">destination</a> is not <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-requestdestination-report" id="ref-for-dom-requestdestination-report">"report"</a></code>, set <var>reservedClient</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker⑦">active service worker</a> to <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⑥">active worker</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request①">navigation request</a>, <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-enabled-flag" id="ref-for-service-worker-registration-navigation-preload-enabled-flag③">navigation preload enabled flag</a> is set, <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method⑤">method</a> is `<code>GET</code>`, and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⑦">active worker</a>'s <a data-link-type="dfn" href="#dfn-set-of-event-types-to-handle" id="ref-for-dfn-set-of-event-types-to-handle①">set of event types to handle</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contains</a> <code>fetch</code>, then:</p>
         <p class="note" role="note"><span>Note:</span> If the above is true except <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⑧">active worker</a>'s <a data-link-type="dfn" href="#dfn-set-of-event-types-to-handle" id="ref-for-dfn-set-of-event-types-to-handle②">set of event types to handle</a> <strong>does not</strong> contain <code>fetch</code>, then the user agent may wish to show a console warning, as the developer’s intent isn’t clear.</p>
         <ol>
          <li data-md="">
           <p>Let <var>preloadRequest</var> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-clone" id="ref-for-concept-request-clone">cloning</a> the request <var>request</var>.</p>
          <li data-md="">
           <p>Let <var>preloadRequestHeaders</var> be <var>preloadRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list①">header list</a>.</p>
          <li data-md="">
           <p>Let <var>preloadResponseObject</var> be a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response①②">Response</a></code> object associated with a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#headers" id="ref-for-headers②">Headers</a></code> object whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-headers-guard" id="ref-for-concept-headers-guard②">guard</a> is "<code>immutable</code>".</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">Append</a> to <var>preloadRequestHeaders</var> a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header②">header</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name②">name</a> is `<code>Service-Worker-Navigation-Preload</code>` and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value" id="ref-for-concept-header-value">value</a> is <var>registration</var>’s <a data-link-type="dfn" href="#service-worker-registration-navigation-preload-header-value" id="ref-for-service-worker-registration-navigation-preload-header-value②">navigation preload header value</a>.</p>
          <li data-md="">
           <p>Set <var>preloadRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode③">service-workers mode</a> to "<code>none</code>".</p>
          <li data-md="">
           <p>Run the following substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③③">in parallel</a>:</p>
           <ol>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①⑥">Fetch</a> <var>preloadRequest</var> and let <var>preloadFetchInstance</var> be the instance of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①⑦">fetch</a> algorithm.</p>
             <p>To <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response" id="ref-for-process-response②">process response</a> for <var>navigationPreloadResponse</var>, run these substeps:</p>
             <ol>
              <li data-md="">
               <p>If <var>navigationPreloadResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-type" id="ref-for-concept-response-type③">type</a> is "<code>error</code>", reject <var>preloadResponse</var> with a <code>TypeError</code> and terminate these substeps.</p>
              <li data-md="">
               <p>Associate <var>preloadResponseObject</var> with <var>navigationPreloadResponse</var>.</p>
              <li data-md="">
               <p>Resolve <var>preloadResponse</var> with <var>navigationPreloadResponse</var>.</p>
             </ol>
            <li data-md="">
             <p>If <var>fetchInstance</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" id="ref-for-concept-fetch-terminate②">terminated</a>, then <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" id="ref-for-concept-fetch-terminate③">terminate</a> <var>preloadFetchInstance</var> with the aborted flag set.</p>
           </ol>
         </ol>
        <li data-md="">
         <p>Else, resolve <var>preloadResponse</var> with undefined.</p>
       </ol>
       <p class="note" role="note"><span>Note:</span> From this point, the <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④④">service worker client</a> starts to <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use⑤">use</a> its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker⑧">active service worker</a>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①⑤">containing service worker registration</a>.</p>
      <li data-md="">
       <p>Else if <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request">subresource request</a>, then:</p>
       <ol>
        <li data-md="">
         <p>If <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker⑨">active service worker</a> is non-null, set <var>registration</var> to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker" id="ref-for-concept-environment-active-service-worker①⓪">active service worker</a>’s <a data-link-type="dfn" href="#dfn-containing-service-worker-registration" id="ref-for-dfn-containing-service-worker-registration①⑥">containing service worker registration</a>.</p>
        <li data-md="">
         <p>Else, return null.</p>
       </ol>
      <li data-md="">
       <p>Let <var>activeWorker</var> be <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker③⑨">active worker</a>.</p>
      <li data-md="">
       <p>If <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-set-of-event-types-to-handle" id="ref-for-dfn-set-of-event-types-to-handle③">set of event types to handle</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contain</a> <code>fetch</code>, then:</p>
       <ol>
        <li data-md="">
         <p>Return null and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③④">in parallel</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request②">non-subresource request</a>, or <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request①">subresource request</a> and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time⑨">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update">Soft Update</a> algorithm with <var>registration</var>.</p>
        <li data-md="">
         <p>Abort these steps.</p>
       </ol>
       <p class="note" role="note"><span>Note:</span> To avoid unnecessary delays, the Handle Fetch enforces early return when no event listeners have been deterministically added in the service worker’s global during the very first script execution.</p>
      <li data-md="">
       <p>If <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state⑦">state</a> is <em>activating</em>, wait for <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state⑧">state</a> to become <em>activated</em>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker⑤">Run Service Worker</a> algorithm with <var>activeWorker</var> as the argument.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②⑨">Queue a task</a> <var>task</var> to run the following substeps:</p>
       <ol>
        <li data-md="">
         <p>Let <var>e</var> be the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-create" id="ref-for-concept-event-create③">creating an event</a> with <code class="idl"><a data-link-type="idl" href="#fetchevent" id="ref-for-fetchevent④">FetchEvent</a></code>.</p>
        <li data-md="">
         <p>Let <var>requestObject</var> be a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①④">Request</a></code> object associated with <var>request</var> and a new associated <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#headers" id="ref-for-headers③">Headers</a></code> object whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-headers-guard" id="ref-for-concept-headers-guard③">guard</a> is "<code>immutable</code>".</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type②">type</a></code> attribute to <code class="idl"><a class="idl-code" data-link-type="event" href="#service-worker-global-scope-fetch-event" id="ref-for-service-worker-global-scope-fetch-event⑥">fetch</a></code>.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-cancelable" id="ref-for-dom-event-cancelable">cancelable</a></code> attribute to true.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-request" id="ref-for-dom-fetchevent-request②">request</a></code> attribute to <var>requestObject</var>.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-preloadresponse" id="ref-for-dom-fetchevent-preloadresponse②">preloadResponse</a></code> to <var>preloadResponse</var>.</p>
        <li data-md="">
         <p>Initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-clientid" id="ref-for-dom-fetchevent-clientid②">clientId</a></code> attribute to <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" id="ref-for-concept-environment-id②">id</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request③">non-subresource request</a> and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination④">destination</a> is not <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-requestdestination-report" id="ref-for-dom-requestdestination-report①">"report"</a></code>, initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-resultingclientid" id="ref-for-dom-fetchevent-resultingclientid②">resultingClientId</a></code> attribute to <var>reservedClient</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id" id="ref-for-concept-environment-id③">id</a>, and to the empty string otherwise.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request②">navigation request</a>, initialize <var>e</var>’s <code class="idl"><a data-link-type="idl" href="#dom-fetchevent-targetclientid" id="ref-for-dom-fetchevent-targetclientid②">targetClientId</a></code> attribute to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-target-client-id" id="ref-for-concept-request-target-client-id">target client id</a>, and to the empty string otherwise.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑥">Dispatch</a> <var>e</var> at <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object④">global object</a>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#update-service-worker-extended-events-set" id="ref-for-update-service-worker-extended-events-set①">Update Service Worker Extended Events Set</a> with <var>activeWorker</var> and <var>e</var>.</p>
        <li data-md="">
         <p>If <var>e</var>’s <a data-link-type="dfn" href="#fetchevent-respond-with-entered-flag" id="ref-for-fetchevent-respond-with-entered-flag②">respond-with entered flag</a> is set, set <var>respondWithEntered</var> to true.</p>
        <li data-md="">
         <p>If <var>e</var>’s <a data-link-type="dfn" href="#fetchevent-wait-to-respond-flag" id="ref-for-fetchevent-wait-to-respond-flag②">wait to respond flag</a> is set, then:</p>
         <ol>
          <li data-md="">
           <p>Wait until <var>e</var>’s <a data-link-type="dfn" href="#fetchevent-wait-to-respond-flag" id="ref-for-fetchevent-wait-to-respond-flag③">wait to respond flag</a> is unset.</p>
          <li data-md="">
           <p>If <var>e</var>’s <a data-link-type="dfn" href="#fetchevent-respond-with-error-flag" id="ref-for-fetchevent-respond-with-error-flag④">respond-with error flag</a> is set, set <var>handleFetchFailed</var> to true.</p>
          <li data-md="">
           <p>Else, set <var>response</var> to <var>e</var>’s <a data-link-type="dfn" href="#fetchevent-potential-response" id="ref-for-fetchevent-potential-response①">potential response</a>.</p>
         </ol>
        <li data-md="">
         <p>If <var>e</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#canceled-flag" id="ref-for-canceled-flag">canceled flag</a> is set, set <var>eventCanceled</var> to true.</p>
        <li data-md="">
         <p>If <var>fetchInstance</var> is <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" id="ref-for-concept-fetch-terminate④">terminated</a>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③⓪">queue a task</a> to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-signal-abort" id="ref-for-abortsignal-signal-abort">signal abort</a> on <var>requestObject</var>’s <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-request-signal" id="ref-for-dom-request-signal">signal</a></code>.</p>
       </ol>
       <p>If <var>task</var> is discarded or the script has been aborted by the <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker⑧">termination</a> of <var>activeWorker</var>, set <var>handleFetchFailed</var> to true.</p>
       <p>The <var>task</var> <em>must</em> use <var>activeWorker</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①①">event loop</a> and the <a data-link-type="dfn" href="#dfn-handle-fetch-task-source" id="ref-for-dfn-handle-fetch-task-source③">handle fetch task source</a>.</p>
      <li data-md="">
       <p>Wait for <var>task</var> to have executed or been discarded.</p>
      <li data-md="">
       <p>If <var>respondWithEntered</var> is false, then:</p>
       <ol>
        <li data-md="">
         <p>If <var>eventCanceled</var> is true, return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error⑨">network error</a> and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⑤">in parallel</a>.</p>
        <li data-md="">
         <p>Else, return null and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⑥">in parallel</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request④">non-subresource request</a>, or <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request②">subresource request</a> and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①⓪">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update①">Soft Update</a> algorithm with <var>registration</var>.</p>
        <li data-md="">
         <p>Abort these steps.</p>
       </ol>
      <li data-md="">
       <p>If <var>handleFetchFailed</var> is true, then:</p>
       <ol>
        <li data-md="">
         <p>Return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error①⓪">network error</a> and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⑦">in parallel</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request⑤">non-subresource request</a>, or <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request③">subresource request</a> and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①①">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update②">Soft Update</a> algorithm with <var>registration</var>.</p>
       </ol>
      <li data-md="">
       <p>Else:</p>
       <ol>
        <li data-md="">
         <p>Return <var>response</var> and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⑧">in parallel</a>.</p>
        <li data-md="">
         <p>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request⑥">non-subresource request</a>, or <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#subresource-request" id="ref-for-subresource-request④">subresource request</a> and the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①②">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update③">Soft Update</a> algorithm with <var>registration</var>.</p>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Handle Functional Event">
     <h3 class="heading settled" id="handle-functional-event-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="handle-functional-event">Handle Functional Event</dfn></span><a class="self-link" href="#handle-functional-event-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>event</var>, an <code class="idl"><a data-link-type="idl" href="#extendableevent" id="ref-for-extendableevent①⑤">ExtendableEvent</a></code> object</p>
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥①">service worker registration</a></p>
      <dd data-md="">
       <p><var>callbackSteps</var>, an algorithm</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p class="assertion">Assert: <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map⑤">scope to registration map</a> contains a value equal to <var>registration</var>.</p>
      <li data-md="">
       <p class="assertion">Assert: <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⓪">active worker</a> is not null.</p>
      <li data-md="">
       <p>Let <var>activeWorker</var> be <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④①">active worker</a>.</p>
      <li data-md="">
       <p>If <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-set-of-event-types-to-handle" id="ref-for-dfn-set-of-event-types-to-handle④">set of event types to handle</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">contain</a> <var>event</var>’s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type③">type</a></code>, then:</p>
       <ol>
        <li data-md="">
         <p>Return and continue running these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③⑨">in parallel</a>.</p>
        <li data-md="">
         <p>If the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①③">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update④">Soft Update</a> algorithm with <var>registration</var>.</p>
        <li data-md="">
         <p>Abort these steps.</p>
       </ol>
       <p class="note" role="note"><span>Note:</span> To avoid unnecessary delays, the Handle Functional Event enforces early return when no event listeners have been deterministically added in the service worker’s global during the very first script execution.</p>
      <li data-md="">
       <p>If <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state⑨">state</a> is <em>activating</em>, wait for <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state①⓪">state</a> to become <em>activated</em>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#run-service-worker" id="ref-for-run-service-worker⑥">Run Service Worker</a> algorithm with <var>activeWorker</var> as the argument.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③①">Queue a task</a> <var>task</var> to run these substeps:</p>
       <ol>
        <li data-md="">
         <p>Invoke <var>callbackSteps</var> with <var>activeWorker</var>’s <a data-link-type="dfn" href="#dfn-service-worker-global-object" id="ref-for-dfn-service-worker-global-object⑤">global object</a> as its argument.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#update-service-worker-extended-events-set" id="ref-for-update-service-worker-extended-events-set②">Update Service Worker Extended Events Set</a> with <var>activeWorker</var> and <var>event</var>.</p>
       </ol>
       <p>The <var>task</var> <em>must</em> use <var>activeWorker</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①②">event loop</a> and the <a data-link-type="dfn" href="#dfn-handle-functional-event-task-source" id="ref-for-dfn-handle-functional-event-task-source③">handle functional event task source</a>.</p>
      <li data-md="">
       <p>Wait for <var>task</var> to have executed or been discarded.</p>
      <li data-md="">
       <p>If the time difference in seconds calculated by the current time minus <var>registration</var>’s <a data-link-type="dfn" href="#dfn-last-update-check-time" id="ref-for-dfn-last-update-check-time①④">last update check time</a> is greater than 86400, invoke <a data-link-type="dfn" href="#soft-update" id="ref-for-soft-update⑤">Soft Update</a> algorithm with <var>registration</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Handle Service Worker Client Unload">
     <h3 class="heading settled" id="on-client-unload-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="handle-service-worker-client-unload">Handle Service Worker Client Unload</dfn></span><a class="self-link" href="#on-client-unload-algorithm"></a></h3>
     <p>The user agent <em>must</em> run these steps when a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⑤">service worker client</a> unloads by <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document" id="ref-for-unload-a-document">unloading</a> or <a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker⑨">terminating</a>.</p>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⑥">service worker client</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>Let <var>registration</var> be the <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥②">service worker registration</a> <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use⑥">used</a> by <var>client</var>.</p>
      <li data-md="">
       <p>If <var>registration</var> is null, abort these steps.</p>
      <li data-md="">
       <p>If any other <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⑦">service worker client</a> is <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use⑦">using</a> <var>registration</var>, abort these steps.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag⑤">uninstalling flag</a> is set, invoke <a data-link-type="dfn" href="#try-clear-registration" id="ref-for-try-clear-registration②">Try Clear Registration</a> with <var>registration</var>.</p>
      <li data-md="">
       <p>If <var>registration</var> is not null, invoke <a data-link-type="dfn" href="#try-activate" id="ref-for-try-activate⑤">Try Activate</a> with <var>registration</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Handle User Agent Shutdown">
     <h3 class="heading settled" id="on-user-agent-shutdown-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="handle-user-agent-shutdown">Handle User Agent Shutdown</dfn></span><a class="self-link" href="#on-user-agent-shutdown-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p>None</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑦">For each</a> <var>scope</var> → <var>registration</var> of <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map⑥">scope to registration map</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⓪">installing worker</a> <var>installingWorker</var> is not null, then:</p>
         <ol>
          <li data-md="">
           <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①①">waiting worker</a> is null and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④②">active worker</a> is null, invoke <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration③">Clear Registration</a> with <var>registration</var> and continue to the next iteration of the loop.</p>
          <li data-md="">
           <p>Else, set <var>installingWorker</var> to null.</p>
         </ol>
        <li data-md="">
         <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①②">waiting worker</a> is not null, run the following substep <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel④⓪">in parallel</a>:</p>
         <ol>
          <li data-md="">
           <p>Invoke <a data-link-type="dfn" href="#activate" id="ref-for-activate⑥">Activate</a> with <var>registration</var>.</p>
         </ol>
       </ol>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Update Service Worker Extended Events Set">
     <h3 class="heading settled" id="update-service-worker-extended-events-set-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="update-service-worker-extended-events-set">Update Service Worker Extended Events Set</dfn></span><a class="self-link" href="#update-service-worker-extended-events-set-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>worker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨③">service worker</a></p>
      <dd data-md="">
       <p><var>event</var>, an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event" id="ref-for-concept-event③">event</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p class="assertion">Assert: <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#dispatch-flag" id="ref-for-dispatch-flag③">dispatch flag</a> is unset.</p>
      <li data-md="">
       <p>For each <var>item</var> of <var>worker</var>’s <a data-link-type="dfn" href="#dfn-set-of-extended-events" id="ref-for-dfn-set-of-extended-events①">set of extended events</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>item</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count①⓪">pending promises count</a> is zero, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">remove</a> <var>item</var> from <var>worker</var>’s <a data-link-type="dfn" href="#dfn-set-of-extended-events" id="ref-for-dfn-set-of-extended-events②">set of extended events</a>.</p>
       </ol>
      <li data-md="">
       <p>If <var>event</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count①①">pending promises count</a> is not zero, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">append</a> <var>event</var> to <var>worker</var>’s <a data-link-type="dfn" href="#dfn-set-of-extended-events" id="ref-for-dfn-set-of-extended-events③">set of extended events</a>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Unregister">
     <h3 class="heading settled" id="unregister-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="unregister">Unregister</dfn></span><a class="self-link" href="#unregister-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>job</var>, a <a data-link-type="dfn" href="#dfn-job" id="ref-for-dfn-job②⑥">job</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>none</p>
     </dl>
     <ol>
      <li data-md="">
       <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②⑥">origin</a> of <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url⑧">scope url</a> is not <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-client" id="ref-for-dfn-job-client①⑧">client</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②⑦">origin</a>, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#reject-job-promise" id="ref-for-reject-job-promise①⓪">Reject Job Promise</a> with <var>job</var> and "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror⑨">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②⑤">DOMException</a></code>.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job①①">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Let <var>registration</var> be the result of running <a data-link-type="dfn" href="#get-registration" id="ref-for-get-registration②">Get Registration</a> algorithm passing <var>job</var>’s <a data-link-type="dfn" href="#dfn-job-scope-url" id="ref-for-dfn-job-scope-url⑨">scope url</a> as the argument.</p>
      <li data-md="">
       <p>If <var>registration</var> is null, then:</p>
       <ol>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#resolve-job-promise" id="ref-for-resolve-job-promise③">Resolve Job Promise</a> with <var>job</var> and false.</p>
        <li data-md="">
         <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job①②">Finish Job</a> with <var>job</var> and abort these steps.</p>
       </ol>
      <li data-md="">
       <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag⑥">uninstalling flag</a>.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#resolve-job-promise" id="ref-for-resolve-job-promise④">Resolve Job Promise</a> with <var>job</var> and true.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#try-clear-registration" id="ref-for-try-clear-registration③">Try Clear Registration</a> with <var>registration</var>.</p>
       <p class="note" role="note"><span>Note:</span> If <a data-link-type="dfn" href="#try-clear-registration" id="ref-for-try-clear-registration④">Try Clear Registration</a> does not trigger <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration④">Clear Registration</a> here, <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration⑤">Clear Registration</a> is tried again when the last client <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use⑧">using</a> the registration is <a data-link-type="dfn" href="#handle-service-worker-client-unload" id="ref-for-handle-service-worker-client-unload②">unloaded</a> or the <a data-link-type="dfn" href="#extendableevent-extend-lifetime-promises" id="ref-for-extendableevent-extend-lifetime-promises⑨">extend lifetime promises</a> for the registration’s service workers settle.</p>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#finish-job" id="ref-for-finish-job①③">Finish Job</a> with <var>job</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Set Registration">
     <h3 class="heading settled" id="set-registration-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="set-registration">Set Registration</dfn></span><a class="self-link" href="#set-registration-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>scope</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①②">URL</a></p>
      <dd data-md="">
       <p><var>updateViaCache</var>, an <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache⑥">update via cache mode</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥③">service worker registration</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>Let <var>scopeString</var> be <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer⑨">serialized</a> <var>scope</var> with the <em>exclude fragment flag</em> set.</p>
      <li data-md="">
       <p>Let <var>registration</var> be a new <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥④">service worker registration</a> whose <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①⑥">scope url</a> is set to <var>scope</var> and <a data-link-type="dfn" href="#dfn-update-via-cache" id="ref-for-dfn-update-via-cache⑦">update via cache mode</a> is set to <var>updateViaCache</var>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map⑦">scope to registration map</a>[<var>scopeString</var>] to <var>registration</var>.</p>
      <li data-md="">
       <p>Return <var>registration</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Clear Registration">
     <h3 class="heading settled" id="clear-registration-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="clear-registration">Clear Registration</dfn></span><a class="self-link" href="#clear-registration-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⑤">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①①">installing worker</a> is not null, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker①⓪">Terminate</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①②">installing worker</a>.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state⑧">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①③">installing worker</a> and <em>redundant</em> as the arguments.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state⑥">Update Registration State</a> algorithm passing <var>registration</var>, "<code>installing</code>" and null as the arguments.</p>
       </ol>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①③">waiting worker</a> is not null, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker①①">Terminate</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①④">waiting worker</a>.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state⑨">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⑤">waiting worker</a> and <em>redundant</em> as the arguments.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state⑦">Update Registration State</a> algorithm passing <var>registration</var>, "<code>waiting</code>" and null as the arguments.</p>
       </ol>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④③">active worker</a> is not null, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="#terminate-service-worker" id="ref-for-terminate-service-worker①②">Terminate</a> <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④④">active worker</a>.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-worker-state" id="ref-for-update-worker-state①⓪">Update Worker State</a> algorithm passing <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⑤">active worker</a> and <em>redundant</em> as the arguments.</p>
        <li data-md="">
         <p>Run the <a data-link-type="dfn" href="#update-registration-state" id="ref-for-update-registration-state⑧">Update Registration State</a> algorithm passing <var>registration</var>, "<code>active</code>" and null as the arguments.</p>
       </ol>
      <li data-md="">
       <p>Let <var>scopeString</var> be <var>registration</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①⓪">serialized</a> <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①⑦">scope url</a>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove①">Remove</a> <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map⑧">scope to registration map</a>[<var>scopeString</var>].</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Try Clear Registration">
     <h3 class="heading settled" id="try-clear-registration-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="try-clear-registration">Try Clear Registration</dfn></span><a class="self-link" href="#try-clear-registration-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⑥">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Invoke <a data-link-type="dfn" href="#clear-registration" id="ref-for-clear-registration⑥">Clear Registration</a> with <var>registration</var> if no <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⑧">service worker client</a> is <a data-link-type="dfn" href="#dfn-use" id="ref-for-dfn-use⑨">using</a> <var>registration</var> and all of the following conditions are true:</p>
       <ul>
        <li data-md="">
         <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①④">installing worker</a> is null or the result of running <a data-link-type="dfn" href="#service-worker-has-no-pending-events" id="ref-for-service-worker-has-no-pending-events①">Service Worker Has No Pending Events</a> with <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⑤">installing worker</a> is true.</p>
        <li data-md="">
         <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⑥">waiting worker</a> is null or the result of running <a data-link-type="dfn" href="#service-worker-has-no-pending-events" id="ref-for-service-worker-has-no-pending-events②">Service Worker Has No Pending Events</a> with <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⑦">waiting worker</a> is true.</p>
        <li data-md="">
         <p><var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⑥">active worker</a> is null or the result of running <a data-link-type="dfn" href="#service-worker-has-no-pending-events" id="ref-for-service-worker-has-no-pending-events③">Service Worker Has No Pending Events</a> with <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⑦">active worker</a> is true.</p>
       </ul>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Update Registration State">
     <h3 class="heading settled" id="update-registration-state-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="update-registration-state">Update Registration State</dfn></span><a class="self-link" href="#update-registration-state-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⑦">service worker registration</a></p>
      <dd data-md="">
       <p><var>target</var>, a string (one of "<code>installing</code>", "<code>waiting</code>", and "<code>active</code>")</p>
      <dd data-md="">
       <p><var>source</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨④">service worker</a> or null</p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>registrationObjects</var> be an array containing all the <code class="idl"><a data-link-type="idl" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration②⓪">ServiceWorkerRegistration</a></code> objects associated with <var>registration</var>.</p>
      <li data-md="">
       <p>If <var>target</var> is "<code>installing</code>", then:</p>
       <ol>
        <li data-md="">
         <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⑥">installing worker</a> to <var>source</var>.</p>
        <li data-md="">
         <p>For each <var>registrationObject</var> in <var>registrationObjects</var>:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③②">Queue a task</a> to set the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-installing" id="ref-for-dom-serviceworkerregistration-installing②">installing</a></code> attribute of <var>registrationObject</var> to the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker②④">ServiceWorker</a></code> object that represents <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⑦">installing worker</a>, or null if <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⑧">installing worker</a> is null.</p>
         </ol>
       </ol>
      <li data-md="">
       <p>Else if <var>target</var> is "<code>waiting</code>", then:</p>
       <ol>
        <li data-md="">
         <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⑧">waiting worker</a> to <var>source</var>.</p>
        <li data-md="">
         <p>For each <var>registrationObject</var> in <var>registrationObjects</var>:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③③">Queue a task</a> to set the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-waiting" id="ref-for-dom-serviceworkerregistration-waiting②">waiting</a></code> attribute of <var>registrationObject</var> to the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker②⑤">ServiceWorker</a></code> object that represents <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker①⑨">waiting worker</a>, or null if <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker②⓪">waiting worker</a> is null.</p>
         </ol>
       </ol>
      <li data-md="">
       <p>Else if <var>target</var> is "<code>active</code>", then:</p>
       <ol>
        <li data-md="">
         <p>Set <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⑧">active worker</a> to <var>source</var>.</p>
        <li data-md="">
         <p>For each <var>registrationObject</var> in <var>registrationObjects</var>:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③④">Queue a task</a> to set the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerregistration-active" id="ref-for-dom-serviceworkerregistration-active②">active</a></code> attribute of <var>registrationObject</var> to the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker②⑥">ServiceWorker</a></code> object that represents <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker④⑨">active worker</a>, or null if <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤⓪">active worker</a> is null.</p>
         </ol>
       </ol>
       <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①⓪">task</a> <em>must</em> use <var>registrationObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②⓪">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⑧">responsible event loop</a> and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①④">DOM manipulation task source</a>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Update Worker State">
     <h3 class="heading settled" id="update-state-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="update-worker-state">Update Worker State</dfn></span><a class="self-link" href="#update-state-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>worker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⑤">service worker</a></p>
      <dd data-md="">
       <p><var>state</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⑥">service worker</a>'s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state①①">state</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Set <var>worker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state①②">state</a> to <var>state</var>.</p>
      <li data-md="">
       <p>Let <var>workerObjects</var> be an array containing all the <code class="idl"><a data-link-type="idl" href="#serviceworker" id="ref-for-serviceworker②⑦">ServiceWorker</a></code> objects associated with <var>worker</var>.</p>
      <li data-md="">
       <p>For each <var>workerObject</var> in <var>workerObjects</var>:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③⑤">Queue a task</a> to run these substeps:</p>
         <ol>
          <li data-md="">
           <p>Set the <code class="idl"><a data-link-type="idl" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state④">state</a></code> attribute of <var>workerObject</var> to the value (in <code class="idl"><a data-link-type="idl" href="#enumdef-serviceworkerstate" id="ref-for-enumdef-serviceworkerstate③">ServiceWorkerState</a></code> enumeration) corresponding to the first matching statement, switching on <var>worker</var>’s <a data-link-type="dfn" href="#dfn-state" id="ref-for-dfn-state①③">state</a>:</p>
           <dl>
            <dt data-md=""><em>installing</em>
            <dd data-md="">
             <p><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-installing" id="ref-for-dom-serviceworkerstate-installing">"installing"</a></code></p>
             <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⑦">service worker</a> in this state is considered an <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker①⑨">installing worker</a>. During this state, <code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil⑥">waitUntil()</a></code> can be called inside the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-oninstall" id="ref-for-dom-serviceworkerglobalscope-oninstall①">oninstall</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers⑧">event handler</a> to extend the life of the <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker②⓪">installing worker</a> until the passed <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects③①">promise</a> resolves successfully. This is primarily used to ensure that the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⑧">service worker</a> is not active until all of the core caches are populated.</p>
            <dt data-md=""><em>installed</em>
            <dd data-md="">
             <p><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-installed" id="ref-for-dom-serviceworkerstate-installed">"installed"</a></code></p>
             <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker⑨⑨">service worker</a> in this state is considered a <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker②①">waiting worker</a>.</p>
            <dt data-md=""><em>activating</em>
            <dd data-md="">
             <p><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-activating" id="ref-for-dom-serviceworkerstate-activating">"activating"</a></code></p>
             <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⓪">service worker</a> in this state is considered an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤①">active worker</a>. During this state, <code class="idl"><a data-link-type="idl" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil⑦">waitUntil()</a></code> can be called inside the <code class="idl"><a data-link-type="idl" href="#dom-serviceworkerglobalscope-onactivate" id="ref-for-dom-serviceworkerglobalscope-onactivate①">onactivate</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers⑨">event handler</a> to extend the life of the <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤②">active worker</a> until the passed <a data-link-type="dfn" href="http://tc39.github.io/ecma262/#sec-promise-objects" id="ref-for-sec-promise-objects③②">promise</a> resolves successfully. No <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events⑨">functional events</a> are dispatched until the state becomes <em>activated</em>.</p>
            <dt data-md=""><em>activated</em>
            <dd data-md="">
             <p><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-activated" id="ref-for-dom-serviceworkerstate-activated">"activated"</a></code></p>
             <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪①">service worker</a> in this state is considered an <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤③">active worker</a> ready to handle <a data-link-type="dfn" href="#dfn-functional-events" id="ref-for-dfn-functional-events①⓪">functional events</a>.</p>
            <dt data-md=""><em>redundant</em>
            <dd data-md="">
             <p><code class="idl"><a data-link-type="idl" href="#dom-serviceworkerstate-redundant" id="ref-for-dom-serviceworkerstate-redundant①">"redundant"</a></code></p>
             <p class="note" role="note"><span>Note:</span> A new <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪②">service worker</a> is replacing the current <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪③">service worker</a>, or the current <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪④">service worker</a> is being discarded due to an install failure.</p>
           </dl>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">Fire an event</a> named <code>statechange</code> at <var>workerObject</var>.</p>
         </ol>
       </ol>
       <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①①">task</a> <em>must</em> use <var>workerObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②①">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop①⑨">responsible event loop</a> and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①⑤">DOM manipulation task source</a>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Notify Controller Change">
     <h3 class="heading settled" id="notify-controller-change-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="notify-controller-change">Notify Controller Change</dfn></span><a class="self-link" href="#notify-controller-change-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client④⑨">service worker client</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>None</p>
     </dl>
     <ol>
      <li data-md="">
       <p class="assertion">Assert: <var>client</var> is not null.</p>
      <li data-md="">
       <p>If <var>client</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②⓪">environment settings object</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③⑥">queue a task</a> to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire④">fire an event</a> named <code>controllerchange</code> at the <code class="idl"><a data-link-type="idl" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①⑥">ServiceWorkerContainer</a></code> object that <var>client</var> is <a data-link-type="dfn" href="#serviceworkercontainer-service-worker-client" id="ref-for-serviceworkercontainer-service-worker-client⑦">associated</a> with.</p>
     </ol>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①②">task</a> <em>must</em> use <var>client</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" id="ref-for-responsible-event-loop②⓪">responsible event loop</a> and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source①⑥">DOM manipulation task source</a>.</p>
    </section>
    <section class="algorithm" data-algorithm="Match Service Worker Registration">
     <h3 class="heading settled" id="scope-match-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="match-service-worker-registration">Match Service Worker Registration</dfn></span><a class="self-link" href="#scope-match-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>clientURL</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①③">URL</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⑧">service worker registration</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>Let <var>clientURLString</var> be <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①①">serialized</a> <var>clientURL</var>.</p>
      <li data-md="">
       <p>Let <var>matchingScopeString</var> be the empty string.</p>
      <li data-md="">
       <p>Let <var>scopeStringSet</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys①">getting the keys</a> from <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map⑨">scope to registration map</a>.</p>
      <li data-md="">
       <p>Set <var>matchingScopeString</var> to the longest value in <var>scopeStringSet</var> which the value of <var>clientURLString</var> starts with, if it exists.</p>
       <p class="note" role="note"><span>Note:</span> The URL string matching in this step is prefix-based rather than path-structural. E.g. a client URL string with "https://example.com/prefix-of/resource.html" will match a registration for a scope with "https://example.com/prefix". The URL string comparison is safe for the same-origin security as HTTP(S) URLs are always <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①②">serialized</a> with a trailing slash at the end of the origin part of the URLs.</p>
      <li data-md="">
       <p>Let <var>matchingScope</var> be null.</p>
      <li data-md="">
       <p>If <var>matchingScopeString</var> is not the empty string, then:</p>
       <ol>
        <li data-md="">
         <p>Set <var>matchingScope</var> to the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser⑧">parsing</a> <var>matchingScopeString</var>.</p>
        <li data-md="">
         <p class="assertion">Assert: <var>matchingScope</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin③">origin</a> and <var>clientURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin④">origin</a> are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin⑥">same origin</a>.</p>
       </ol>
      <li data-md="">
       <p>Let <var>registration</var> be the result of running <a data-link-type="dfn" href="#get-registration" id="ref-for-get-registration③">Get Registration</a> algorithm passing <var>matchingScope</var> as the argument.</p>
      <li data-md="">
       <p>If <var>registration</var> is not null and <var>registration</var>’s <a data-link-type="dfn" href="#dfn-uninstalling-flag" id="ref-for-dfn-uninstalling-flag⑦">uninstalling flag</a> is set, return null.</p>
      <li data-md="">
       <p>Return <var>registration</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Get Registration">
     <h3 class="heading settled" id="get-registration-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="get-registration">Get Registration</dfn></span><a class="self-link" href="#get-registration-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>scope</var>, a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①④">URL</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑥⑨">service worker registration</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>Let <var>scopeString</var> be the empty string.</p>
      <li data-md="">
       <p>If <var>scope</var> is not null, set <var>scopeString</var> to <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①③">serialized</a> <var>scope</var> with the <em>exclude fragment flag</em> set.</p>
      <li data-md="">
       <p>Let <var>registration</var> be null.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑧">For each</a> <var>key</var> → <var>value</var> of <a data-link-type="dfn" href="#dfn-scope-to-registration-map" id="ref-for-dfn-scope-to-registration-map①⓪">scope to registration map</a>:</p>
       <ol>
        <li data-md="">
         <p>If <var>scopeString</var> matches <var>key</var>, set <var>registration</var> to <var>value</var>.</p>
       </ol>
      <li data-md="">
       <p>Return <var>registration</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Get Newest Worker">
     <h3 class="heading settled" id="get-newest-worker-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="get-newest-worker">Get Newest Worker</dfn></span><a class="self-link" href="#get-newest-worker-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>registration</var>, a <a data-link-type="dfn" href="#dfn-service-worker-registration" id="ref-for-dfn-service-worker-registration⑦⓪">service worker registration</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>newestWorker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⑤">service worker</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Run the following steps atomically.</p>
      <li data-md="">
       <p>Let <var>newestWorker</var> be null.</p>
      <li data-md="">
       <p>If <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker②①">installing worker</a> is not null, set <var>newestWorker</var> to <var>registration</var>’s <a data-link-type="dfn" href="#dfn-installing-worker" id="ref-for-dfn-installing-worker②②">installing worker</a>.</p>
      <li data-md="">
       <p>Else if <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker②②">waiting worker</a> is not null, set <var>newestWorker</var> to <var>registration</var>’s <a data-link-type="dfn" href="#dfn-waiting-worker" id="ref-for-dfn-waiting-worker②③">waiting worker</a>.</p>
      <li data-md="">
       <p>Else if <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤④">active worker</a> is not null, set <var>newestWorker</var> to <var>registration</var>’s <a data-link-type="dfn" href="#dfn-active-worker" id="ref-for-dfn-active-worker⑤⑤">active worker</a>.</p>
      <li data-md="">
       <p>Return <var>newestWorker</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Service Worker Has No Pending Events">
     <h3 class="heading settled" id="service-worker-has-no-pending-events-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="service-worker-has-no-pending-events">Service Worker Has No Pending Events</dfn></span><a class="self-link" href="#service-worker-has-no-pending-events-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>worker</var>, a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⑥">service worker</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p>True or false, a boolean</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>sum</var> be zero.</p>
      <li data-md="">
       <p>For each <var>item</var> of <var>worker</var>’s <a data-link-type="dfn" href="#dfn-set-of-extended-events" id="ref-for-dfn-set-of-extended-events④">set of extended events</a>:</p>
       <ol>
        <li data-md="">
         <p>Add <var>item</var>’s <a data-link-type="dfn" href="#extendableevent-pending-promises-count" id="ref-for-extendableevent-pending-promises-count①②">pending promises count</a> to <var>sum</var>.</p>
       </ol>
      <li data-md="">
       <p>If <var>sum</var> is zero, return true.</p>
      <li data-md="">
       <p>Else, return false.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Create Client">
     <h3 class="heading settled" id="create-client-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-client">Create Client</dfn></span><a class="self-link" href="#create-client-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑤⓪">service worker client</a></p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>clientObject</var>, a <code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client⑨">Client</a></code> object</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>clientObject</var> be a new <code class="idl"><a data-link-type="idl" href="#client" id="ref-for-client①⓪">Client</a></code> object.</p>
      <li data-md="">
       <p>Set <var>clientObject</var>’s <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①④">service worker client</a> to <var>client</var>.</p>
      <li data-md="">
       <p>Return <var>clientObject</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Create Window Client">
     <h3 class="heading settled" id="create-windowclient-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-window-client">Create Window Client</dfn></span><a class="self-link" href="#create-windowclient-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>client</var>, a <a data-link-type="dfn" href="#dfn-service-worker-client" id="ref-for-dfn-service-worker-client⑤①">service worker client</a></p>
      <dd data-md="">
       <p><var>visibilityState</var>, a string</p>
      <dd data-md="">
       <p><var>focusState</var>, a boolean</p>
      <dd data-md="">
       <p><var>ancestorOriginsList</var>, a list</p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>windowClient</var>, a <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient①⓪">WindowClient</a></code> object</p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>windowClient</var> be a new <code class="idl"><a data-link-type="idl" href="#windowclient" id="ref-for-windowclient①①">WindowClient</a></code> object.</p>
      <li data-md="">
       <p>Set <var>windowClient</var>’s <a data-link-type="dfn" href="#client-service-worker-client" id="ref-for-client-service-worker-client①⑤">service worker client</a> to <var>client</var>.</p>
      <li data-md="">
       <p>Set <var>windowClient</var>’s <a data-link-type="dfn" href="#dfn-service-worker-client-visibilitystate" id="ref-for-dfn-service-worker-client-visibilitystate①">visibility state</a> to <var>visibilityState</var>.</p>
      <li data-md="">
       <p>Set <var>windowClient</var>’s <a data-link-type="dfn" href="#dfn-service-worker-client-focusstate" id="ref-for-dfn-service-worker-client-focusstate②">focus state</a> to <var>focusState</var>.</p>
      <li data-md="">
       <p>Set <var>windowClient</var>’s <a data-link-type="dfn" href="#windowclient-ancestor-origins-array" id="ref-for-windowclient-ancestor-origins-array①">ancestor origins array</a> to a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-frozen-array-type" id="ref-for-dfn-frozen-array-type④">frozen array</a> created from <var>ancestorOriginsList</var>.</p>
      <li data-md="">
       <p>Return <var>windowClient</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Query Cache">
     <h3 class="heading settled" id="query-cache-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="query-cache">Query Cache</dfn></span><a class="self-link" href="#query-cache-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>request</var>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑤">request</a></p>
      <dd data-md="">
       <p><var>options</var>, a <code class="idl"><a data-link-type="idl" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions⑥">CacheQueryOptions</a></code> object, optional</p>
      <dd data-md="">
       <p><var>targetStorage</var>, a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list⑥">request response list</a>, optional</p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>resultList</var>, a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list⑦">request response list</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>requests</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②⓪">list</a>.</p>
      <li data-md="">
       <p>Let <var>responses</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②①">list</a>.</p>
      <li data-md="">
       <p>Let <var>resultList</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②②">list</a>.</p>
      <li data-md="">
       <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-cachequeryoptions-ignoremethod" id="ref-for-dom-cachequeryoptions-ignoremethod">ignoreMethod</a></code> is false and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method⑥">method</a> is not `<code>GET</code>`, return <var>resultList</var>.</p>
      <li data-md="">
       <p>Let <var>cachedURL</var> and <var>requestURL</var> be null.</p>
      <li data-md="">
       <p>Let <var>storage</var> be null.</p>
      <li data-md="">
       <p>If the optional argument <var>targetStorage</var> is omitted, set <var>storage</var> to the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list②">relevant request response list</a>.</p>
      <li data-md="">
       <p>Else, set <var>storage</var> to <var>targetStorage</var>.</p>
      <li data-md="">
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①③">For each</a> <var>requestResponse</var> of <var>storage</var>:</p>
       <ol>
        <li data-md="">
         <p>Set <var>cachedURL</var> to <var>requestResponse</var>’s request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①⑤">url</a>.</p>
        <li data-md="">
         <p>Set <var>requestURL</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①⑥">url</a>.</p>
        <li data-md="">
         <p>If <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-cachequeryoptions-ignoresearch" id="ref-for-dom-cachequeryoptions-ignoresearch">ignoreSearch</a></code> is true, then:</p>
         <ol>
          <li data-md="">
           <p>Set <var>cachedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query" id="ref-for-concept-url-query">query</a> to the empty string.</p>
          <li data-md="">
           <p>Set <var>requestURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query" id="ref-for-concept-url-query①">query</a> to the empty string.</p>
         </ol>
        <li data-md="">
         <p>If <var>cachedURL</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-equals" id="ref-for-concept-url-equals②">equals</a> <var>requestURL</var> with the <em>exclude fragment flag</em> set, then:</p>
         <ol>
          <li data-md="">
           <p>Add a copy of <var>requestResponse</var>’s request to <var>requests</var>.</p>
          <li data-md="">
           <p>Add a copy of <var>requestResponse</var>’s response to <var>responses</var>.</p>
         </ol>
       </ol>
      <li data-md="">
       <p>Let <var>index</var> be zero.</p>
      <li data-md="">
       <p>For each <var>cachedResponse</var> in <var>responses</var>:</p>
       <ol>
        <li data-md="">
         <p>Let <var>cachedRequest</var> be <var>requests</var>[<var>index</var>].</p>
        <li data-md="">
         <p>Increment <var>index</var> by one.</p>
        <li data-md="">
         <p>If <var>cachedResponse</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list⑥">header list</a> contains no <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header③">header</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name③">named</a> `<code>Vary</code>`, or <var>options</var>.<code class="idl"><a data-link-type="idl" href="#dom-cachequeryoptions-ignorevary" id="ref-for-dom-cachequeryoptions-ignorevary">ignoreVary</a></code> is true, then:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑦">Append</a> <var>cachedRequest</var>/<var>cachedResponse</var> to <var>resultList</var>.</p>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">Continue</a>.</p>
         </ol>
        <li data-md="">
         <p>Let <var>fieldValues</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②③">list</a> containing the elements corresponding to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2" id="ref-for-section-3.2②">field-values</a> of the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7231#section-7.1.4" id="ref-for-section-7.1.4②">Vary</a> header.</p>
        <li data-md="">
         <p>Let <var>isMatched</var> be true.</p>
        <li data-md="">
         <p>For each <var>fieldValue</var> in <var>fieldValues</var>:</p>
         <ol>
          <li data-md="">
           <p>If <var>fieldValue</var> matches "<code>*</code>", or the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value-combined" id="ref-for-concept-header-value-combined">combined value</a> given <var>fieldValue</var> and <var>cachedRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list②">header list</a> does not match the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value-combined" id="ref-for-concept-header-value-combined①">combined value</a> given <var>fieldValue</var> and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list③">header list</a>, then:</p>
           <ol>
            <li data-md="">
             <p>Set <var>isMatched</var> to false.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">Break</a>.</p>
           </ol>
         </ol>
        <li data-md="">
         <p>If <var>isMatched</var> is true, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑧">append</a> <var>cachedRequest</var>/<var>cachedResponse</var> to <var>resultList</var>.</p>
       </ol>
      <li data-md="">
       <p>Return <var>resultList</var>.</p>
     </ol>
    </section>
    <section class="algorithm" data-algorithm="Batch Cache Operations">
     <h3 class="heading settled" id="batch-cache-operations-algorithm"><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="batch-cache-operations">Batch Cache Operations</dfn></span><a class="self-link" href="#batch-cache-operations-algorithm"></a></h3>
     <dl>
      <dt data-md="">Input
      <dd data-md="">
       <p><var>operations</var>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②④">list</a> of <a data-link-type="dfn" href="#dfn-cache-batch-operation" id="ref-for-dfn-cache-batch-operation③">cache batch operation</a> objects</p>
      <dt data-md="">Output
      <dd data-md="">
       <p><var>resultList</var>, a <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list⑧">request response list</a></p>
     </dl>
     <ol>
      <li data-md="">
       <p>Let <var>cache</var> be the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list③">relevant request response list</a>.</p>
      <li data-md="">
       <p>Let <var>backupCache</var> be a new <a data-link-type="dfn" href="#dfn-request-response-list" id="ref-for-dfn-request-response-list⑨">request response list</a> that is a copy of <var>cache</var>.</p>
      <li data-md="">
       <p>Let <var>addedItems</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②⑤">list</a>.</p>
      <li data-md="">
       <p>Try running the following substeps atomically:</p>
       <ol>
        <li data-md="">
         <p>Let <var>resultList</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②⑥">list</a>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①④">For each</a> <var>operation</var> in <var>operations</var>:</p>
         <ol>
          <li data-md="">
           <p>If <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type③">type</a> matches neither "<code>delete</code>" nor "<code>put</code>", <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⑥">throw</a> a <code>TypeError</code>.</p>
          <li data-md="">
           <p>If <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type④">type</a> matches "<code>delete</code>" and <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response②">response</a> is not null, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⑦">throw</a> a <code>TypeError</code>.</p>
          <li data-md="">
           <p>If the result of running <a data-link-type="dfn" href="#query-cache" id="ref-for-query-cache②">Query Cache</a> with <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request③">request</a>, <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-options" id="ref-for-dfn-cache-batch-operation-options①">options</a>, and <var>addedItems</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty③">is not empty</a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⑧">throw</a> an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①②">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②⑥">DOMException</a></code>.</p>
          <li data-md="">
           <p>Let <var>requestResponses</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②⑦">list</a>.</p>
          <li data-md="">
           <p>If <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type⑤">type</a> matches "<code>delete</code>", then:</p>
           <ol>
            <li data-md="">
             <p>Set <var>requestResponses</var> to the result of running <a data-link-type="dfn" href="#query-cache" id="ref-for-query-cache③">Query Cache</a> with <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request④">request</a> and <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-options" id="ref-for-dfn-cache-batch-operation-options②">options</a>.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⑤">For each</a> <var>requestResponse</var> in <var>requestResponses</var>:</p>
             <ol>
              <li data-md="">
               <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove②">Remove</a> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item⑧">item</a> whose value matches <var>requestResponse</var> from <var>cache</var>.</p>
             </ol>
           </ol>
          <li data-md="">
           <p>Else if <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-type" id="ref-for-dfn-cache-batch-operation-type⑥">type</a> matches "<code>put</code>", then:</p>
           <ol>
            <li data-md="">
             <p>If <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response③">response</a> is null, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw①⑨">throw</a> a <code>TypeError</code>.</p>
            <li data-md="">
             <p>Let <var>r</var> be <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request⑤">request</a>'s associated <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request①⓪">request</a>.</p>
            <li data-md="">
             <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①⑦">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme⑥">scheme</a> is not one of "<code>http</code>" and "<code>https</code>", <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②⓪">throw</a> a <code>TypeError</code>.</p>
            <li data-md="">
             <p>If <var>r</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method⑦">method</a> is not `<code>GET</code>`, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②①">throw</a> a <code>TypeError</code>.</p>
            <li data-md="">
             <p>If <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-options" id="ref-for-dfn-cache-batch-operation-options③">options</a> is not null, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②②">throw</a> a <code>TypeError</code>.</p>
            <li data-md="">
             <p>Set <var>requestResponses</var> to the result of running <a data-link-type="dfn" href="#query-cache" id="ref-for-query-cache④">Query Cache</a> with <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request⑥">request</a>.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⑥">For each</a> <var>requestResponse</var> of <var>requestResponses</var>:</p>
             <ol>
              <li data-md="">
               <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove③">Remove</a> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item⑨">item</a> whose value matches <var>requestResponse</var> from <var>cache</var>.</p>
             </ol>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑨">Append</a> <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request⑦">request</a>/<var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response④">response</a> to <var>cache</var>.</p>
            <li data-md="">
             <p>If the cache write operation in the previous two steps failed due to exceeding the granted quota limit, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②③">throw</a> a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#quotaexceedederror" id="ref-for-quotaexceedederror①">QuotaExceededError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②⑦">DOMException</a></code>.</p>
            <li data-md="">
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①⓪">Append</a> <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request⑧">request</a>/<var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response⑤">response</a> to <var>addedItems</var>.</p>
           </ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①①">Append</a> <var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-request" id="ref-for-dfn-cache-batch-operation-request⑨">request</a>/<var>operation</var>’s <a data-link-type="dfn" href="#dfn-cache-batch-operation-response" id="ref-for-dfn-cache-batch-operation-response⑥">response</a> to <var>resultList</var>.</p>
         </ol>
        <li data-md="">
         <p>Return <var>resultList</var>.</p>
       </ol>
      <li data-md="">
       <p>And then, if an exception was <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②④">thrown</a>, then:</p>
       <ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove④">Remove</a> all the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item①⓪">items</a> from the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list④">relevant request response list</a>.</p>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⑦">For each</a> <var>requestResponse</var> of <var>backupCache</var>:</p>
         <ol>
          <li data-md="">
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①②">Append</a> <var>requestResponse</var> to the <a data-link-type="dfn" href="#dfn-relevant-request-response-list" id="ref-for-dfn-relevant-request-response-list⑤">relevant request response list</a>.</p>
         </ol>
        <li data-md="">
         <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②⑤">Throw</a> the exception.</p>
       </ol>
       <p class="note" role="note"><span>Note:</span> When an exception is <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw②⑥">thrown</a>, the implementation does undo (roll back) any changes made to the cache storage during the batch operation job.</p>
     </ol>
    </section>
   </section>
   <section>
    <h2 class="heading settled" id="extended-http-headers"><span class="content">Appendix B: Extended HTTP headers</span><a class="self-link" href="#extended-http-headers"></a></h2>
    <section>
     <h3 class="heading settled" id="service-worker-script-request"><span class="content">Service Worker Script Request</span><a class="self-link" href="#service-worker-script-request"></a></h3>
     <p>An HTTP request to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①⑧">fetch</a> a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⑦">service worker</a>'s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①①">script resource</a> will include the following <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header④">header</a>:</p>
     <dl>
      <dt data-md="">`<dfn data-dfn-type="dfn" data-noexport="" id="service-worker"><code>Service-Worker</code><a class="self-link" href="#service-worker"></a></dfn>`
      <dd data-md="">
       <p>Indicates this request is a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⑧">service worker</a>'s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①②">script resource</a> request.</p>
       <p class="note" role="note"><span>Note:</span> This header helps administrators log the requests and detect threats.</p>
     </dl>
    </section>
    <section>
     <h3 class="heading settled" id="service-worker-script-response"><span class="content">Service Worker Script Response</span><a class="self-link" href="#service-worker-script-response"></a></h3>
     <p>An HTTP response to a <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①⓪⑨">service worker</a>'s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①③">script resource</a> request can include the following <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header⑤">header</a>:</p>
     <dl>
      <dt data-md="">`<dfn data-dfn-type="dfn" data-noexport="" id="service-worker-allowed"><code>Service-Worker-Allowed</code><a class="self-link" href="#service-worker-allowed"></a></dfn>`
      <dd data-md="">
       <p>Indicates the user agent will override the path restriction, which limits the maximum allowed <a data-link-type="dfn" href="#dfn-scope-url" id="ref-for-dfn-scope-url①⑧">scope url</a> that the script can <a data-link-type="dfn" href="#dfn-control" id="ref-for-dfn-control③">control</a>, to the given value.</p>
       <p class="note" role="note"><span>Note:</span> The value is a URL. If a relative URL is given, it is parsed against the script’s URL.</p>
     </dl>
     <div class="example" id="example-d8e8f5c5">
      <a class="self-link" href="#example-d8e8f5c5"></a> Default scope: 
<pre class="highlight"><span class="c1">// Maximum allowed scope defaults to the path the script sits in</span>
<span class="c1">// "/js" in this example</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/js/sw.js"</span><span class="p">).</span>then<span class="p">(()</span> <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>log<span class="p">(</span><span class="s2">"Install succeeded with the default scope '/js'."</span><span class="p">);</span>
<span class="p">});</span>
</pre>
     </div>
     <div class="example" id="example-b5b4fb41">
      <a class="self-link" href="#example-b5b4fb41"></a> Upper path without Service-Worker-Allowed header: 
<pre class="highlight"><span class="c1">// Set the scope to an upper path of the script location</span>
<span class="c1">// Response has no Service-Worker-Allowed header</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/js/sw.js"</span><span class="p">,</span> <span class="p">{</span> scope<span class="o">:</span> <span class="s2">"/"</span> <span class="p">}).</span><span class="k">catch</span><span class="p">(()</span> <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>error<span class="p">(</span><span class="s2">"Install failed due to the path restriction violation."</span><span class="p">);</span>
<span class="p">});</span>
</pre>
     </div>
     <div class="example" id="example-c2113402">
      <a class="self-link" href="#example-c2113402"></a> Upper path with Service-Worker-Allowed header: 
<pre class="highlight"><span class="c1">// Set the scope to an upper path of the script location</span>
<span class="c1">// Response included "Service-Worker-Allowed : /"</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/js/sw.js"</span><span class="p">,</span> <span class="p">{</span> scope<span class="o">:</span> <span class="s2">"/"</span> <span class="p">}).</span>then<span class="p">(()</span> <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>log<span class="p">(</span><span class="s2">"Install succeeded as the max allowed scope was overriden to '/'."</span><span class="p">);</span>
<span class="p">});</span>
</pre>
     </div>
     <div class="example" id="example-cd476c4d">
      <a class="self-link" href="#example-cd476c4d"></a> A path restriction voliation even with Service-Worker-Allowed header: 
<pre class="highlight"><span class="c1">// Set the scope to an upper path of the script location</span>
<span class="c1">// Response included "Service-Worker-Allowed : /foo"</span>
<span class="c1"></span>navigator<span class="p">.</span>serviceWorker<span class="p">.</span>register<span class="p">(</span><span class="s2">"/foo/bar/sw.js"</span><span class="p">,</span> <span class="p">{</span> scope<span class="o">:</span> <span class="s2">"/"</span> <span class="p">}).</span><span class="k">catch</span><span class="p">(()</span> <span class="p">=></span> <span class="p">{</span>
  console<span class="p">.</span>error<span class="p">(</span><span class="s2">"Install failed as the scope is still out of the overriden maximum allowed scope."</span><span class="p">);</span>
<span class="p">});</span>
</pre>
     </div>
    </section>
    <section>
     <h3 class="heading settled" id="syntax"><span class="content">Syntax</span><a class="self-link" href="#syntax"></a></h3>
     <p><a data-link-type="biblio" href="#biblio-rfc5234">ABNF</a> for the values of the headers used by the <a data-link-type="dfn" href="#dfn-service-worker" id="ref-for-dfn-service-worker①①⓪">service worker</a>'s <a data-link-type="dfn" href="#dfn-script-resource" id="ref-for-dfn-script-resource①④">script resource</a> requests and responses:</p>
<pre>Service-Worker = %x73.63.72.69.70.74 ; "script", case-sensitive
</pre>
     <p class="note" role="note"><span>Note:</span> The validation of the Service-Worker-Allowed header’s values is done by URL parsing algorithm (in Update algorithm) instead of using ABNF.</p>
    </section>
   </section>
   <section>
    <h2 class="heading settled" data-level="8" id="acknowledgements"><span class="secno">8. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
    <p>Deep thanks go to Andrew Betts for organizing and hosting a small workshop of like-minded individuals including: Jake Archibald, Jackson Gabbard, Tobie Langel, Robin Berjon, Patrick Lauke, Christian Heilmann. From the clarity of the day’s discussions and the use-cases outlined there, much has become possible. Further thanks to Andrew for raising consciousness about the offline problem. His organization of EdgeConf and inclusion of Offline as a persistent topic there has created many opportunities and connections that have enabled this work to progress.</p>
    <p>Anne van Kesteren has generously lent his encyclopedic knowledge of Web Platform arcana and standards development experience throughout the development of the service worker. This specification would be incomplete without his previous work in describing the real-world behavior of URLs, HTTP Fetch, Promises, and DOM. Similarly, this specification would not be possible without Ian Hickson’s rigorous Web Worker spec. Much thanks to him.</p>
    <p>In no particular order, deep gratitude for design guidance and discussion goes to: Jungkee Song, Alec Flett, David Barrett-Kahn, Aaron Boodman, Michael Nordman, Tom Ashworth, Kinuko Yasuda, Darin Fisher, Jonas Sicking, Jesús Leganés Combarro, Mark Christian, Dave Hermann, Yehuda Katz, François Remy, Ilya Grigorik, Will Chan, Domenic Denicola, Nikhil Marathe, Yves Lafon, Adam Barth, Greg Simon, Devdatta Akhawe, Dominic Cooney, Jeffrey Yasskin, Joshua Bell, Boris Zbarsky, Matt Falkenhagen, Tobie Langel, Gavin Peters, Ben Kelly, Hiroki Nakagawa, Jake Archibald, Josh Soref, Jinho Bang, Yutaka Hirano, Michael(tm) Smith, isonmad, Ali Alabbas, Philip Jägenstedt, Mike Pennisi, and Eric Willigers.</p>
    <p>Jason Weber, Chris Wilson, Paul Kinlan, Ehsan Akhgari, and Daniel Austin have provided valuable, well-timed feedback on requirements and the standardization process.</p>
    <p>The authors would also like to thank Dimitri Glazkov for his scripts and formatting tools which have been essential in the production of this specification. The authors are also grateful for his considerable guidance.</p>
    <p>Thanks also to Vivian Cromwell, Greg Simon, Alex Komoroske, Wonsuk Lee, and Seojin Kim for their considerable professional support.</p>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
   <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
   <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="example-f839f6c8">
    <a class="self-link" href="#example-f839f6c8"></a> 
    <p>This is an example of an informative example.</p>
   </div>
   <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
   <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is <dfn data-dfn-type="dfn" data-lt="processing equivalence" data-noexport="" id="dfn-processing-equivalence">equivalent<a class="self-link" href="#dfn-processing-equivalence"></a></dfn>. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
  </div>
  <p id="back-to-top" role="navigation"><a href="#toc"><abbr title="Back to top">↑</abbr></a></p>
  . 
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#service-worker-global-scope-activate-event">activate</a><span>, in §4.7</span>
   <li><a href="#activate">Activate</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkerstate-activated">activated</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-activated">"activated"</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-activating">activating</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-activating">"activating"</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerregistration-active">active</a><span>, in §3.2.3</span>
   <li><a href="#dfn-active-worker">active worker</a><span>, in §2.2</span>
   <li><a href="#dom-cache-addall">addAll(requests)</a><span>, in §5.4.4</span>
   <li><a href="#dom-cache-add">add(request)</a><span>, in §5.4.3</span>
   <li>
    all
    <ul>
     <li><a href="#dom-clienttype-all">enum-value for ClientType</a><span>, in §4.3</span>
     <li><a href="#dom-serviceworkerupdateviacache-all">enum-value for ServiceWorkerUpdateViaCache</a><span>, in §3.2</span>
    </ul>
   <li>
    "all"
    <ul>
     <li><a href="#dom-clienttype-all">enum-value for ClientType</a><span>, in §4.3</span>
     <li><a href="#dom-serviceworkerupdateviacache-all">enum-value for ServiceWorkerUpdateViaCache</a><span>, in §3.2</span>
    </ul>
   <li><a href="#dom-windowclient-ancestororigins">ancestorOrigins</a><span>, in §4.2.7</span>
   <li><a href="#windowclient-ancestor-origins-array">ancestor origins array</a><span>, in §4.2</span>
   <li><a href="#batch-cache-operations">Batch Cache Operations</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-service-worker-client-browsing-context">browsing context</a><span>, in §4.2</span>
   <li><a href="#cache">Cache</a><span>, in §5.4</span>
   <li><a href="#dfn-cache-batch-operation">cache batch operation</a><span>, in §5.4</span>
   <li><a href="#dom-cachequeryoptions-cachename">cacheName</a><span>, in §5.4</span>
   <li><a href="#dictdef-cachequeryoptions">CacheQueryOptions</a><span>, in §5.4</span>
   <li><a href="#global-caches-attribute">caches</a><span>, in §5.3.1</span>
   <li><a href="#cachestorage">CacheStorage</a><span>, in §5.5</span>
   <li><a href="#dom-clients-claim">claim()</a><span>, in §4.3.4</span>
   <li><a href="#dfn-classic-scripts-imported-flag">classic scripts imported flag</a><span>, in §2.1</span>
   <li><a href="#clear-registration">Clear Registration</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-job-client">client</a><span>, in §Unnumbered section</span>
   <li><a href="#client">Client</a><span>, in §4.2</span>
   <li>
    clientId
    <ul>
     <li><a href="#dom-fetchevent-clientid">attribute for FetchEvent</a><span>, in §4.5.3</span>
     <li><a href="#dom-fetcheventinit-clientid">dict-member for FetchEventInit</a><span>, in §4.5</span>
    </ul>
   <li><a href="#dfn-client-message-queue">client message queue</a><span>, in §3.4</span>
   <li><a href="#dictdef-clientqueryoptions">ClientQueryOptions</a><span>, in §4.3</span>
   <li><a href="#clients">Clients</a><span>, in §4.3</span>
   <li><a href="#dom-serviceworkerglobalscope-clients">clients</a><span>, in §4.1.1</span>
   <li><a href="#enumdef-clienttype">ClientType</a><span>, in §4.3</span>
   <li><a href="#dfn-containing-job-queue">containing job queue</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-containing-service-worker-registration">containing service worker registration</a><span>, in §2.1</span>
   <li><a href="#dfn-control">control</a><span>, in §2.4</span>
   <li><a href="#dom-serviceworkercontainer-controller">controller</a><span>, in §3.4.1</span>
   <li><a href="#service-worker-container-controllerchange-event">controllerchange</a><span>, in §3.5</span>
   <li><a href="#create-client">Create Client</a><span>, in §Unnumbered section</span>
   <li><a href="#create-job">Create Job</a><span>, in §Unnumbered section</span>
   <li><a href="#create-window-client">Create Window Client</a><span>, in §Unnumbered section</span>
   <li>
    data
    <ul>
     <li><a href="#dom-extendablemessageevent-data">attribute for ExtendableMessageEvent</a><span>, in §4.6.1</span>
     <li><a href="#dom-extendablemessageeventinit-data">dict-member for ExtendableMessageEventInit</a><span>, in §4.6</span>
    </ul>
   <li><a href="#dfn-dedicatedworker-client">dedicated worker client</a><span>, in §2.3</span>
   <li><a href="#dom-cachestorage-delete">delete(cacheName)</a><span>, in §5.5.4</span>
   <li><a href="#dom-cache-delete">delete(request)</a><span>, in §5.4.6</span>
   <li><a href="#dom-cache-delete">delete(request, options)</a><span>, in §5.4.6</span>
   <li><a href="#dom-navigationpreloadmanager-disable">disable()</a><span>, in §3.6.2</span>
   <li><a href="#dom-navigationpreloadmanager-enable">enable()</a><span>, in §3.6.1</span>
   <li><a href="#dom-navigationpreloadstate-enabled">enabled</a><span>, in §3.6</span>
   <li><a href="#dfn-job-equivalent">equivalent</a><span>, in §Unnumbered section</span>
   <li><a href="#extendableevent">ExtendableEvent</a><span>, in §4.4</span>
   <li><a href="#dictdef-extendableeventinit">ExtendableEventInit</a><span>, in §4.4</span>
   <li><a href="#dom-extendableevent-extendableevent">ExtendableEvent(type)</a><span>, in §4.4</span>
   <li><a href="#dom-extendableevent-extendableevent">ExtendableEvent(type, eventInitDict)</a><span>, in §4.4</span>
   <li><a href="#extendablemessageevent">ExtendableMessageEvent</a><span>, in §4.6</span>
   <li><a href="#dictdef-extendablemessageeventinit">ExtendableMessageEventInit</a><span>, in §4.6</span>
   <li><a href="#dom-extendablemessageevent-extendablemessageevent">ExtendableMessageEvent(type)</a><span>, in §4.6</span>
   <li><a href="#dom-extendablemessageevent-extendablemessageevent">ExtendableMessageEvent(type, eventInitDict)</a><span>, in §4.6</span>
   <li><a href="#extendableevent-extend-lifetime-promises">extend lifetime promises</a><span>, in §4.4</span>
   <li><a href="#service-worker-global-scope-fetch-event">fetch</a><span>, in §4.7</span>
   <li><a href="#fetchevent">FetchEvent</a><span>, in §4.5</span>
   <li><a href="#dictdef-fetcheventinit">FetchEventInit</a><span>, in §4.5</span>
   <li><a href="#dom-fetchevent-fetchevent">FetchEvent(type, eventInitDict)</a><span>, in §4.5</span>
   <li><a href="#finish-job">Finish Job</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-windowclient-focus">focus()</a><span>, in §4.2.8</span>
   <li><a href="#dom-windowclient-focused">focused</a><span>, in §4.2.6</span>
   <li><a href="#dfn-service-worker-client-focusstate">focus state</a><span>, in §4.2</span>
   <li><a href="#dfn-job-force-bypass-cache-flag">force bypass cache flag</a><span>, in §Unnumbered section</span>
   <li><a href="#serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">force bypass cache for importscripts flag</a><span>, in §4.1</span>
   <li><a href="#dfn-functional-events">functional events</a><span>, in §2.1</span>
   <li><a href="#dom-clients-get">get(id)</a><span>, in §4.3.1</span>
   <li><a href="#get-newest-worker">Get Newest Worker</a><span>, in §Unnumbered section</span>
   <li><a href="#get-registration">Get Registration</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkercontainer-getregistration">getRegistration()</a><span>, in §3.4.4</span>
   <li><a href="#dom-serviceworkercontainer-getregistration">getRegistration(clientURL)</a><span>, in §3.4.4</span>
   <li><a href="#dom-serviceworkercontainer-getregistrations">getRegistrations()</a><span>, in §3.4.5</span>
   <li><a href="#dom-navigationpreloadmanager-getstate">getState()</a><span>, in §3.6.4</span>
   <li>
    global object
    <ul>
     <li><a href="#cachestorage-global-object">dfn for CacheStorage</a><span>, in §5.5</span>
     <li><a href="#dfn-service-worker-global-object">dfn for service worker</a><span>, in §2.1</span>
    </ul>
   <li><a href="#handle-fetch">Handle Fetch</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-handle-fetch-task-source">handle fetch task source</a><span>, in §2.5</span>
   <li><a href="#handle-functional-event">Handle Functional Event</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-handle-functional-event-task-source">handle functional event task source</a><span>, in §2.5</span>
   <li><a href="#handle-service-worker-client-unload">Handle Service Worker Client Unload</a><span>, in §Unnumbered section</span>
   <li><a href="#handle-user-agent-shutdown">Handle User Agent Shutdown</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-cachestorage-has">has(cacheName)</a><span>, in §5.5.2</span>
   <li><a href="#dfn-has-ever-been-evaluated-flag">has ever been evaluated flag</a><span>, in §2.1</span>
   <li><a href="#dom-navigationpreloadstate-headervalue">headerValue</a><span>, in §3.6</span>
   <li><a href="#dfn-https-state">HTTPS state</a><span>, in §2.1</span>
   <li><a href="#dom-client-id">id</a><span>, in §4.2.2</span>
   <li><a href="#dom-cachequeryoptions-ignoremethod">ignoreMethod</a><span>, in §5.4</span>
   <li><a href="#dom-cachequeryoptions-ignoresearch">ignoreSearch</a><span>, in §5.4</span>
   <li><a href="#dom-cachequeryoptions-ignorevary">ignoreVary</a><span>, in §5.4</span>
   <li><a href="#dom-serviceworkerupdateviacache-imports">"imports"</a><span>, in §3.2</span>
   <li><a href="#dom-serviceworkerupdateviacache-imports">imports</a><span>, in §3.2</span>
   <li><a href="#importscripts-method">importScripts(urls)</a><span>, in §6.3.2</span>
   <li><a href="#dom-clientqueryoptions-includeuncontrolled">includeUncontrolled</a><span>, in §4.3</span>
   <li><a href="#install">Install</a><span>, in §Unnumbered section</span>
   <li><a href="#service-worker-global-scope-install-event">install</a><span>, in §4.7</span>
   <li><a href="#dom-serviceworkerstate-installed">installed</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-installed">"installed"</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-installing">"installing"</a><span>, in §3.1</span>
   <li>
    installing
    <ul>
     <li><a href="#dom-serviceworkerregistration-installing">attribute for ServiceWorkerRegistration</a><span>, in §3.2.1</span>
     <li><a href="#dom-serviceworkerstate-installing">enum-value for ServiceWorkerState</a><span>, in §3.1</span>
    </ul>
   <li><a href="#dfn-installing-worker">installing worker</a><span>, in §2.2</span>
   <li><a href="#dfn-job">job</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-job-promise">job promise</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-job-queue">job queue</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-job-type">job type</a><span>, in §Unnumbered section</span>
   <li>
    keys()
    <ul>
     <li><a href="#dom-cache-keys">method for Cache</a><span>, in §5.4.7</span>
     <li><a href="#dom-cachestorage-keys">method for CacheStorage</a><span>, in §5.5.5</span>
    </ul>
   <li><a href="#dom-cache-keys">keys(request)</a><span>, in §5.4.7</span>
   <li><a href="#dom-cache-keys">keys(request, options)</a><span>, in §5.4.7</span>
   <li>
    lastEventId
    <ul>
     <li><a href="#dom-extendablemessageevent-lasteventid">attribute for ExtendableMessageEvent</a><span>, in §4.6.3</span>
     <li><a href="#dom-extendablemessageeventinit-lasteventid">dict-member for ExtendableMessageEventInit</a><span>, in §4.6</span>
    </ul>
   <li><a href="#dfn-last-update-check-time">last update check time</a><span>, in §2.2</span>
   <li><a href="#dfn-lifecycle-events">lifecycle events</a><span>, in §2.1</span>
   <li><a href="#dfn-job-list-of-equivalent-jobs">list of equivalent jobs</a><span>, in §Unnumbered section</span>
   <li>
    matchAll()
    <ul>
     <li><a href="#dom-cache-matchall">method for Cache</a><span>, in §5.4.2</span>
     <li><a href="#dom-clients-matchall">method for Clients</a><span>, in §4.3.2</span>
    </ul>
   <li><a href="#dom-clients-matchall">matchAll(options)</a><span>, in §4.3.2</span>
   <li><a href="#dom-cache-matchall">matchAll(request)</a><span>, in §5.4.2</span>
   <li><a href="#dom-cache-matchall">matchAll(request, options)</a><span>, in §5.4.2</span>
   <li>
    match(request)
    <ul>
     <li><a href="#dom-cache-match">method for Cache</a><span>, in §5.4.1</span>
     <li><a href="#dom-cachestorage-match">method for CacheStorage</a><span>, in §5.5.1</span>
    </ul>
   <li>
    match(request, options)
    <ul>
     <li><a href="#dom-cache-match">method for Cache</a><span>, in §5.4.1</span>
     <li><a href="#dom-cachestorage-match">method for CacheStorage</a><span>, in §5.5.1</span>
    </ul>
   <li><a href="#match-service-worker-registration">Match Service Worker Registration</a><span>, in §Unnumbered section</span>
   <li><a href="#eventdef-serviceworkerglobalscope-message">message</a><span>, in §4.7</span>
   <li><a href="#eventdef-serviceworkerglobalscope-messageerror">messageerror</a><span>, in §4.7</span>
   <li><a href="#dfn-name-to-cache-map">name to cache map</a><span>, in §5.1</span>
   <li><a href="#dom-windowclient-navigate①">navigate()</a><span>, in §4.2.9</span>
   <li><a href="#dom-windowclient-navigate">navigate(url)</a><span>, in §4.2</span>
   <li><a href="#dom-serviceworkerregistration-navigationpreload">navigationPreload</a><span>, in §3.2.4</span>
   <li><a href="#service-worker-registration-navigation-preload-enabled-flag">navigation preload enabled flag</a><span>, in §2.2</span>
   <li><a href="#service-worker-registration-navigation-preload-header-value">navigation preload header value</a><span>, in §2.2</span>
   <li>
    NavigationPreloadManager
    <ul>
     <li><a href="#navigationpreloadmanager">(interface)</a><span>, in §3.6</span>
     <li><a href="#service-worker-registration-navigationpreloadmanager">dfn for service worker registration</a><span>, in §2.2</span>
    </ul>
   <li><a href="#dictdef-navigationpreloadstate">NavigationPreloadState</a><span>, in §3.6</span>
   <li><a href="#dom-serviceworkerupdateviacache-none">"none"</a><span>, in §3.2</span>
   <li><a href="#dom-serviceworkerupdateviacache-none">none</a><span>, in §3.2</span>
   <li><a href="#notify-controller-change">Notify Controller Change</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkerglobalscope-onactivate">onactivate</a><span>, in §4.1.4</span>
   <li><a href="#dom-serviceworkercontainer-oncontrollerchange">oncontrollerchange</a><span>, in §3.4.7</span>
   <li><a href="#dom-serviceworkerglobalscope-onfetch">onfetch</a><span>, in §4.1.4</span>
   <li><a href="#dom-serviceworkerglobalscope-oninstall">oninstall</a><span>, in §4.1.4</span>
   <li>
    onmessage
    <ul>
     <li><a href="#dom-serviceworkercontainer-onmessage">attribute for ServiceWorkerContainer</a><span>, in §3.4.7</span>
     <li><a href="#dom-serviceworkerglobalscope-onmessage">attribute for ServiceWorkerGlobalScope</a><span>, in §4.1.4</span>
    </ul>
   <li>
    onmessageerror
    <ul>
     <li><a href="#dom-serviceworkercontainer-onmessageerror">attribute for ServiceWorkerContainer</a><span>, in §3.4.7</span>
     <li><a href="#dom-serviceworkerglobalscope-onmessageerror">attribute for ServiceWorkerGlobalScope</a><span>, in §4.1.4</span>
    </ul>
   <li><a href="#dom-serviceworker-onstatechange">onstatechange</a><span>, in §3.1.4</span>
   <li><a href="#dom-serviceworkerregistration-onupdatefound">onupdatefound</a><span>, in §3.2.9</span>
   <li><a href="#dom-cachestorage-open">open(cacheName)</a><span>, in §5.5.3</span>
   <li><a href="#dom-clients-openwindow">openWindow(url)</a><span>, in §4.3.3</span>
   <li><a href="#dfn-cache-batch-operation-options">options</a><span>, in §5.4</span>
   <li>
    origin
    <ul>
     <li><a href="#dom-extendablemessageevent-origin">attribute for ExtendableMessageEvent</a><span>, in §4.6.2</span>
     <li><a href="#service-worker-client-origin">dfn for service worker client</a><span>, in §2.3</span>
     <li><a href="#dom-extendablemessageeventinit-origin">dict-member for ExtendableMessageEventInit</a><span>, in §4.6</span>
    </ul>
   <li><a href="#extendableevent-pending-promises-count">pending promises count</a><span>, in §4.4</span>
   <li>
    ports
    <ul>
     <li><a href="#dom-extendablemessageevent-ports">attribute for ExtendableMessageEvent</a><span>, in §4.6.5</span>
     <li><a href="#dom-extendablemessageeventinit-ports">dict-member for ExtendableMessageEventInit</a><span>, in §4.6</span>
    </ul>
   <li><a href="#dom-client-postmessage">postMessage(message)</a><span>, in §4.2.4</span>
   <li>
    postMessage(message, transfer)
    <ul>
     <li><a href="#dom-client-postmessage">method for Client</a><span>, in §4.2.4</span>
     <li><a href="#dom-serviceworker-postmessage">method for ServiceWorker</a><span>, in §3.1.3</span>
    </ul>
   <li><a href="#fetchevent-potential-response">potential response</a><span>, in §4.5</span>
   <li>
    preloadResponse
    <ul>
     <li><a href="#dom-fetchevent-preloadresponse">attribute for FetchEvent</a><span>, in §4.5.2</span>
     <li><a href="#dom-fetcheventinit-preloadresponse">dict-member for FetchEventInit</a><span>, in §4.5</span>
    </ul>
   <li><a href="#dfn-processing-equivalence">processing equivalence</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-cache-put">put(request, response)</a><span>, in §5.4.5</span>
   <li><a href="#query-cache">Query Cache</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkercontainer-ready">ready</a><span>, in §3.4.2</span>
   <li><a href="#serviceworkercontainer-ready-promise">ready promise</a><span>, in §3.4</span>
   <li><a href="#dom-serviceworkerstate-redundant">"redundant"</a><span>, in §3.1</span>
   <li><a href="#dom-serviceworkerstate-redundant">redundant</a><span>, in §3.1</span>
   <li><a href="#job-referrer">referrer</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-referrer-policy">referrer policy</a><span>, in §2.1</span>
   <li><a href="#register">Register</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkercontainer-register">register(scriptURL)</a><span>, in §3.4.3</span>
   <li><a href="#dom-serviceworkercontainer-register">register(scriptURL, options)</a><span>, in §3.4.3</span>
   <li>
    registration
    <ul>
     <li><a href="#dom-serviceworkerglobalscope-registration">attribute for ServiceWorkerGlobalScope</a><span>, in §4.1.2</span>
     <li><a href="#dfn-containing-service-worker-registration">dfn for service worker</a><span>, in §2.1</span>
    </ul>
   <li><a href="#dictdef-registrationoptions">RegistrationOptions</a><span>, in §3.4</span>
   <li><a href="#reject-job-promise">Reject Job Promise</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-relevant-name-to-cache-map">relevant name to cache map</a><span>, in §5.1</span>
   <li><a href="#dfn-relevant-request-response-list">relevant request response list</a><span>, in §5.1</span>
   <li>
    request
    <ul>
     <li><a href="#dom-fetchevent-request">attribute for FetchEvent</a><span>, in §4.5.1</span>
     <li><a href="#dfn-cache-batch-operation-request">dfn for cache batch operation</a><span>, in §5.4</span>
     <li><a href="#dom-fetcheventinit-request">dict-member for FetchEventInit</a><span>, in §4.5</span>
    </ul>
   <li><a href="#dfn-request-response-list">request response list</a><span>, in §5.1</span>
   <li><a href="#resolve-job-promise">Resolve Job Promise</a><span>, in §Unnumbered section</span>
   <li><a href="#fetchevent-respond-with-entered-flag">respond-with entered flag</a><span>, in §4.5</span>
   <li><a href="#fetchevent-respond-with-error-flag">respond-with error flag</a><span>, in §4.5</span>
   <li><a href="#dom-fetchevent-respondwith">respondWith(r)</a><span>, in §4.5.6</span>
   <li><a href="#dfn-cache-batch-operation-response">response</a><span>, in §5.4</span>
   <li>
    resultingClientId
    <ul>
     <li><a href="#dom-fetchevent-resultingclientid">attribute for FetchEvent</a><span>, in §4.5.4</span>
     <li><a href="#dom-fetcheventinit-resultingclientid">dict-member for FetchEventInit</a><span>, in §4.5</span>
    </ul>
   <li><a href="#run-job">Run Job</a><span>, in §Unnumbered section</span>
   <li><a href="#run-service-worker">Run Service Worker</a><span>, in §Unnumbered section</span>
   <li><a href="#schedule-job">Schedule Job</a><span>, in §Unnumbered section</span>
   <li>
    scope
    <ul>
     <li><a href="#dom-serviceworkerregistration-scope">attribute for ServiceWorkerRegistration</a><span>, in §3.2.5</span>
     <li><a href="#dom-registrationoptions-scope">dict-member for RegistrationOptions</a><span>, in §3.4</span>
    </ul>
   <li><a href="#dfn-scope-to-job-queue-map">scope to job queue map</a><span>, in §Unnumbered section</span>
   <li><a href="#dfn-scope-to-registration-map">scope to registration map</a><span>, in §Unnumbered section</span>
   <li>
    scope url
    <ul>
     <li><a href="#dfn-job-scope-url">dfn for job</a><span>, in §Unnumbered section</span>
     <li><a href="#dfn-scope-url">dfn for service worker registration</a><span>, in §2.2</span>
    </ul>
   <li><a href="#dfn-script-resource">script resource</a><span>, in §2.1</span>
   <li><a href="#dfn-script-resource-map">script resource map</a><span>, in §2.1</span>
   <li>
    script url
    <ul>
     <li><a href="#dfn-job-script-url">dfn for job</a><span>, in §Unnumbered section</span>
     <li><a href="#dfn-script-url">dfn for service worker</a><span>, in §2.1</span>
    </ul>
   <li><a href="#dom-serviceworker-scripturl">scriptURL</a><span>, in §3.1.1</span>
   <li><a href="#dfn-service-worker-registration-selection">selection</a><span>, in §2.4</span>
   <li><a href="#serviceworker">ServiceWorker</a><span>, in §3.1</span>
   <li><a href="#service-worker">Service-Worker</a><span>, in §Unnumbered section</span>
   <li><a href="#navigator-service-worker-attribute">serviceWorker</a><span>, in §3.3</span>
   <li>
    service worker
    <ul>
     <li><a href="#dfn-service-worker">dfn for </a><span>, in §2.1</span>
     <li><a href="#serviceworkerglobalscope-service-worker">dfn for ServiceWorkerGlobalScope</a><span>, in §4.1</span>
    </ul>
   <li><a href="#service-worker-allowed">Service-Worker-Allowed</a><span>, in §Unnumbered section</span>
   <li>
    service worker client
    <ul>
     <li><a href="#dfn-service-worker-client">dfn for </a><span>, in §2.3</span>
     <li><a href="#client-service-worker-client">dfn for Client</a><span>, in §4.2</span>
     <li><a href="#serviceworkercontainer-service-worker-client">dfn for ServiceWorkerContainer</a><span>, in §3.4</span>
    </ul>
   <li><a href="#serviceworkercontainer">ServiceWorkerContainer</a><span>, in §3.4</span>
   <li><a href="#serviceworkerglobalscope">ServiceWorkerGlobalScope</a><span>, in §4.1</span>
   <li><a href="#service-worker-has-no-pending-events">Service Worker Has No Pending Events</a><span>, in §Unnumbered section</span>
   <li><a href="#serviceworkerregistration">ServiceWorkerRegistration</a><span>, in §3.2</span>
   <li>
    service worker registration
    <ul>
     <li><a href="#dfn-service-worker-registration">dfn for </a><span>, in §2.2</span>
     <li><a href="#serviceworkerregistration-service-worker-registration">dfn for ServiceWorkerRegistration</a><span>, in §3.2</span>
    </ul>
   <li><a href="#enumdef-serviceworkerstate">ServiceWorkerState</a><span>, in §3.1</span>
   <li><a href="#enumdef-serviceworkerupdateviacache">ServiceWorkerUpdateViaCache</a><span>, in §3.2</span>
   <li><a href="#dom-navigationpreloadmanager-setheadervalue">setHeaderValue(value)</a><span>, in §3.6.3</span>
   <li><a href="#dfn-set-of-event-types-to-handle">set of event types to handle</a><span>, in §2.1</span>
   <li><a href="#dfn-set-of-extended-events">set of extended events</a><span>, in §2.1</span>
   <li><a href="#set-registration">Set Registration</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-clienttype-sharedworker">sharedworker</a><span>, in §4.3</span>
   <li><a href="#dom-clienttype-sharedworker">"sharedworker"</a><span>, in §4.3</span>
   <li><a href="#dfn-sharedworker-client">shared worker client</a><span>, in §2.3</span>
   <li><a href="#dom-serviceworkerglobalscope-skipwaiting">skipWaiting()</a><span>, in §4.1.3</span>
   <li><a href="#dfn-skip-waiting-flag">skip waiting flag</a><span>, in §2.1</span>
   <li><a href="#soft-update">Soft Update</a><span>, in §Unnumbered section</span>
   <li>
    source
    <ul>
     <li><a href="#dom-extendablemessageevent-source">attribute for ExtendableMessageEvent</a><span>, in §4.6.4</span>
     <li><a href="#dom-extendablemessageeventinit-source">dict-member for ExtendableMessageEventInit</a><span>, in §4.6</span>
    </ul>
   <li><a href="#dom-serviceworkercontainer-startmessages">startMessages()</a><span>, in §3.4.6</span>
   <li><a href="#start-register">Start Register</a><span>, in §Unnumbered section</span>
   <li>
    state
    <ul>
     <li><a href="#dom-serviceworker-state">attribute for ServiceWorker</a><span>, in §3.1.2</span>
     <li><a href="#dfn-state">dfn for service worker</a><span>, in §2.1</span>
    </ul>
   <li><a href="#eventdef-serviceworker-statechange">statechange</a><span>, in §3.5</span>
   <li>
    targetClientId
    <ul>
     <li><a href="#dom-fetchevent-targetclientid">attribute for FetchEvent</a><span>, in §4.5.5</span>
     <li><a href="#dom-fetcheventinit-targetclientid">dict-member for FetchEventInit</a><span>, in §4.5</span>
    </ul>
   <li><a href="#dfn-service-worker-registration-task-queue">task queues</a><span>, in §2.2</span>
   <li><a href="#terminate-service-worker">Terminate Service Worker</a><span>, in §Unnumbered section</span>
   <li><a href="#try-activate">Try Activate</a><span>, in §Unnumbered section</span>
   <li><a href="#try-clear-registration">Try Clear Registration</a><span>, in §Unnumbered section</span>
   <li>
    type
    <ul>
     <li><a href="#dom-client-type">attribute for Client</a><span>, in §4.2.3</span>
     <li><a href="#dfn-cache-batch-operation-type">dfn for cache batch operation</a><span>, in §5.4</span>
     <li><a href="#dfn-type">dfn for service worker</a><span>, in §2.1</span>
     <li><a href="#dom-clientqueryoptions-type">dict-member for ClientQueryOptions</a><span>, in §4.3</span>
     <li><a href="#dom-registrationoptions-type">dict-member for RegistrationOptions</a><span>, in §3.4</span>
    </ul>
   <li><a href="#dfn-uninstalling-flag">uninstalling flag</a><span>, in §2.2</span>
   <li><a href="#dom-serviceworkerregistration-unregister">unregister()</a><span>, in §3.2.8</span>
   <li><a href="#unregister">Unregister</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-serviceworkerregistration-update">update()</a><span>, in §3.2.7</span>
   <li><a href="#update">Update</a><span>, in §Unnumbered section</span>
   <li><a href="#service-worker-registration-updatefound-event">updatefound</a><span>, in §3.5</span>
   <li><a href="#update-registration-state">Update Registration State</a><span>, in §Unnumbered section</span>
   <li><a href="#update-service-worker-extended-events-set">Update Service Worker Extended Events Set</a><span>, in §Unnumbered section</span>
   <li>
    updateViaCache
    <ul>
     <li><a href="#dom-serviceworkerregistration-updateviacache">attribute for ServiceWorkerRegistration</a><span>, in §3.2.6</span>
     <li><a href="#dom-registrationoptions-updateviacache">dict-member for RegistrationOptions</a><span>, in §3.4</span>
    </ul>
   <li>
    update via cache mode
    <ul>
     <li><a href="#dfn-job-update-via-cache-mode">dfn for job</a><span>, in §Unnumbered section</span>
     <li><a href="#dfn-update-via-cache">dfn for service worker registration</a><span>, in §2.2</span>
    </ul>
   <li><a href="#update-worker-state">Update Worker State</a><span>, in §Unnumbered section</span>
   <li><a href="#dom-client-url">url</a><span>, in §4.2.1</span>
   <li><a href="#dfn-use">used</a><span>, in §2.4</span>
   <li><a href="#dfn-use">uses</a><span>, in §2.4</span>
   <li><a href="#dfn-use">using</a><span>, in §2.4</span>
   <li><a href="#dfn-service-worker-client-visibilitystate">visibility state</a><span>, in §4.2</span>
   <li><a href="#dom-windowclient-visibilitystate">visibilityState</a><span>, in §4.2.5</span>
   <li><a href="#dom-serviceworkerregistration-waiting">waiting</a><span>, in §3.2.2</span>
   <li><a href="#dfn-waiting-worker">waiting worker</a><span>, in §2.2</span>
   <li><a href="#fetchevent-wait-to-respond-flag">wait to respond flag</a><span>, in §4.5</span>
   <li><a href="#dom-extendableevent-waituntil">waitUntil(f)</a><span>, in §4.4.1</span>
   <li><a href="#dom-clienttype-window">window</a><span>, in §4.3</span>
   <li><a href="#dom-clienttype-window">"window"</a><span>, in §4.3</span>
   <li><a href="#dfn-window-client">window client</a><span>, in §2.3</span>
   <li><a href="#windowclient">WindowClient</a><span>, in §4.2</span>
   <li><a href="#dom-clienttype-worker">worker</a><span>, in §4.3</span>
   <li><a href="#dom-clienttype-worker">"worker"</a><span>, in §4.3</span>
   <li><a href="#dfn-worker-client">worker client</a><span>, in §2.3</span>
   <li><a href="#dfn-job-worker-type">worker type</a><span>, in §Unnumbered section</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[csp-3]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-csp/#enforced">enforced</a>
     <li><a href="https://w3c.github.io/webappsec-csp/#monitored">monitored</a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#document">Document</a>
     <li><a href="https://dom.spec.whatwg.org/#event">Event</a>
     <li><a href="https://dom.spec.whatwg.org/#dictdef-eventinit">EventInit</a>
     <li><a href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a>
     <li><a href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a>
     <li><a href="https://dom.spec.whatwg.org/#canceled-flag">canceled flag</a>
     <li><a href="https://dom.spec.whatwg.org/#context-object">context object</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event-create">creating an event</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event-dispatch">dispatch</a>
     <li><a href="https://dom.spec.whatwg.org/#dispatch-flag">dispatch flag</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event">event</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event-listener">event listener</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a>
     <li><a href="https://dom.spec.whatwg.org/#dom-event-istrusted">isTrusted</a>
     <li><a href="https://dom.spec.whatwg.org/#abortsignal-signal-abort">signal abort</a>
     <li><a href="https://dom.spec.whatwg.org/#stop-immediate-propagation-flag">stop immediate propagation flag</a>
     <li><a href="https://dom.spec.whatwg.org/#stop-propagation-flag">stop propagation flag</a>
     <li><a href="https://dom.spec.whatwg.org/#dom-event-type">type</a>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><a href="http://tc39.github.io/ecma262/#sec-detacharraybuffer">detacharraybuffer</a>
     <li><a href="http://tc39.github.io/ecma262/#sec-execution-contexts">execution context</a>
     <li><a href="http://tc39.github.io/ecma262/#sec-initializehostdefinedrealm">initializehostdefinedrealm</a>
     <li><a href="http://tc39.github.io/ecma262/#sec-map-objects">map objects</a>
     <li><a href="http://tc39.github.io/ecma262/#sec-promise-objects">promise</a>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#dom-requestdestination-report">"report"</a>
     <li><a href="https://fetch.spec.whatwg.org/#headers">Headers</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-readablestream">ReadableStream</a>
     <li><a href="https://fetch.spec.whatwg.org/#request">Request</a>
     <li><a href="https://fetch.spec.whatwg.org/#requestinfo">RequestInfo</a>
     <li><a href="https://fetch.spec.whatwg.org/#response">Response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-aborted">aborted flag</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-list-append">append</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-filtered-response-basic">basic filtered response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-body">body</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-body">body <small>(for response)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-cache-mode">cache mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-cancel-readablestream">cancel</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-client">client</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-clone">clone <small>(for request)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-clone">clone <small>(for response)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-readablestream-closed">closed</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-value-combined">combined value</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-construct-readablestream">construct a readablestream object</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-filtered-response-cors">cors filtered response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-destination">destination</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-body-disturbed">disturbed</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-empty-readablestream">empty</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-enqueue-readablestream">enqueue</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-readablestream-errored">errored</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-extract-mime-type">extract a mime type</a>
     <li><a href="https://fetch.spec.whatwg.org/#extract-header-list-values">extracting header list values</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-fetch">fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#dom-global-fetch">fetch(input, init)</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-filtered-response">filtered response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-get-reader">get a reader</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-headers-guard">guard</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header">header</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-header-list">header list <small>(for request)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list <small>(for response)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-http-fetch">http fetch</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-https-state">https state</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-https-state-value">https state value</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-initiator">initiator</a>
     <li><a href="https://fetch.spec.whatwg.org/#is-local">is local</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-body-locked">locked</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-method">method</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-name">name</a>
     <li><a href="https://fetch.spec.whatwg.org/#navigation-request">navigation request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>
     <li><a href="https://fetch.spec.whatwg.org/#non-subresource-request">non-subresource request</a>
     <li><a href="https://fetch.spec.whatwg.org/#ok-status">ok status</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-filtered-response-opaque">opaque filtered response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-parser-metadata">parser metadata</a>
     <li><a href="https://fetch.spec.whatwg.org/#potential-navigation-or-subresource-request">potential-navigation-or-subresource request</a>
     <li><a href="https://fetch.spec.whatwg.org/#process-response">process response</a>
     <li><a href="https://fetch.spec.whatwg.org/#process-response-end-of-body">process response end-of-body</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-read-chunk-from-readablestream">read a chunk</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-read-all-bytes-from-readablestream">read all bytes</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode">redirect mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request">request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-request">request <small>(for Request)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-reserved-client">reserved client</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-response">response <small>(for Response)</small></a>
     <li><a href="https://fetch.spec.whatwg.org/#request-service-workers-mode">service-workers mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#dom-request-signal">signal</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-status">status</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-body-stream">stream</a>
     <li><a href="https://fetch.spec.whatwg.org/#subresource-request">subresource request</a>
     <li><a href="https://fetch.spec.whatwg.org/#synchronous-flag">synchronous flag</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-target-client-id">target client id</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-fetch-terminate">terminated</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-type">type</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag">use-url-credentials flag</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header-value">value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#abstractworker">AbstractWorker</a>
     <li><a href="https://html.spec.whatwg.org/multipage/indices.html#event-domcontentloaded">DOMContentLoaded</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a>
     <li><a href="https://html.spec.whatwg.org/multipage/history.html#location">Location</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">MessageEvent</a>
     <li><a href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport">MessagePort</a>
     <li><a href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">Navigator</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope">SharedWorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>
     <li><a href="https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer">StructuredSerializeWithTransfer</a>
     <li><a href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#worker">Worker</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">WorkerGlobalScope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workerlocation">WorkerLocation</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">WorkerNavigator</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workertype">WorkerType</a>
     <li><a href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">a browsing context is discarded</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">active document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-active-service-worker">active service worker</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-location-ancestor-origins-list">ancestor origins list</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">api base url</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#api-url-character-encoding">api url character encoding</a>
     <li><a href="https://html.spec.whatwg.org/multipage/offline.html#application-cache">application cache</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#classic-script">classic script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing">closing</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-creation-url">creation url</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">current global object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data">data</a>
     <li><a href="https://html.spec.whatwg.org/multipage/window-object.html#discard-a-document">discard a document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source">dom manipulation task source</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment">environment</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">event handler</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">event handler event type</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">event handler idl attribute</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">event loop</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#exceptions-enabled">exceptions enabled flag</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag">execution ready flag</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#fetch-a-classic-worker-script">fetch a classic worker script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#fetch-a-module-worker-script-tree">fetch a module worker script graph</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps">focusing steps</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">global object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps">has focus steps</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-https-state">https state <small>(for WorkerGlobalScope)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">https state <small>(for environment settings object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id">id</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#import-scripts-into-worker-global-scope">import scripts into worker global scope</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-importscripts">importScripts(urls)</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object">incumbent settings object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#fetching-scripts-is-top-level">is top-level</a>
     <li><a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#list-of-active-timers">list of active timers</a>
     <li><a href="https://html.spec.whatwg.org/multipage/indices.html#event-message">message</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#module-script">module script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate">navigate</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin">origin <small>(for MessageEvent)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">origin <small>(for environment settings object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set">owner set</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#parent-browsing-context">parent browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#fetching-scripts-perform-fetch">perform the fetch</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-ports">ports</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask">queue a microtask</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object&apos;s-realm">realm <small>(for environment settings object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm">realm <small>(for global object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context">realm execution context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-referrer-policy">referrer policy <small>(for WorkerGlobalScope)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-referrer-policy">referrer policy <small>(for environment settings object)</small></a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">relevant global object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm">relevant realm</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#replacement-enabled">replacement enabled</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context">responsible browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document">responsible document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop">responsible event loop</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#run-a-classic-script">run a classic script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#run-a-module-script">run a module script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">same origin</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-script">script</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#shared-workers">shared worker</a>
     <li><a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-source">source</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context">source browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context">target browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">task queues</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">task source</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">top-level browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#triggered-by-user-activation">triggered by user activation</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-type">type</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document">unload a document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#unsafe-response">unsafe response</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url">url</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">user interaction task source</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workers">web worker</a>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><a href="https://infra.spec.whatwg.org/#list-append">append <small>(for list)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#set-append">append <small>(for set)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#ascii-case-insensitive">ascii case-insensitive</a>
     <li><a href="https://infra.spec.whatwg.org/#iteration-break">break</a>
     <li><a href="https://infra.spec.whatwg.org/#byte-sequence">byte sequence</a>
     <li><a href="https://infra.spec.whatwg.org/#list-contain">contain</a>
     <li><a href="https://infra.spec.whatwg.org/#iteration-continue">continue</a>
     <li><a href="https://infra.spec.whatwg.org/#queue-dequeue">dequeue</a>
     <li><a href="https://infra.spec.whatwg.org/#queue-enqueue">enqueue</a>
     <li><a href="https://infra.spec.whatwg.org/#map-entry">entry</a>
     <li><a href="https://infra.spec.whatwg.org/#map-exists">exist</a>
     <li><a href="https://infra.spec.whatwg.org/#list-iterate">for each <small>(for list)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#map-iterate">for each <small>(for map)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#map-getting-the-keys">get the keys</a>
     <li><a href="https://infra.spec.whatwg.org/#list-is-empty">is not empty</a>
     <li><a href="https://infra.spec.whatwg.org/#list-item">item</a>
     <li><a href="https://infra.spec.whatwg.org/#map-key">key</a>
     <li><a href="https://infra.spec.whatwg.org/#list">list</a>
     <li><a href="https://infra.spec.whatwg.org/#ordered-map">ordered map</a>
     <li><a href="https://infra.spec.whatwg.org/#ordered-set">ordered set</a>
     <li><a href="https://infra.spec.whatwg.org/#pair">pair</a>
     <li><a href="https://infra.spec.whatwg.org/#queue">queue</a>
     <li><a href="https://infra.spec.whatwg.org/#list-remove">remove <small>(for list)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#map-remove">remove <small>(for map)</small></a>
     <li><a href="https://infra.spec.whatwg.org/#map-set">set</a>
     <li><a href="https://infra.spec.whatwg.org/#struct">struct</a>
     <li><a href="https://infra.spec.whatwg.org/#map-value">value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[MIMESNIFF]</a> defines the following terms:
    <ul>
     <li><a href="https://mimesniff.spec.whatwg.org/#javascript-mime-type">javascript mime type</a>
    </ul>
   <li>
    <a data-link-type="biblio">[page-visibility]</a> defines the following terms:
    <ul>
     <li><a href="https://www.w3.org/TR/page-visibility/#VisibilityState">VisibilityState</a>
     <li><a href="https://www.w3.org/TR/page-visibility/#dom-document-visibilitystate">visibilityState</a>
    </ul>
   <li>
    <a data-link-type="biblio">[promises-guide]</a> defines the following terms:
    <ul>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#a-new-promise">a new promise</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-rejected-with">a promise rejected with</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#a-promise-resolved-with">a promise resolved with</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#reject-promise">reject</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#transforming-by">transforming</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-fulfillment">upon fulfillment</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#upon-rejection">upon rejection</a>
     <li><a href="https://www.w3.org/2001/tag/doc/promises-guide/#waiting-for-all">waiting for all</a>
    </ul>
   <li>
    <a data-link-type="biblio">[push]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/push-api/#h-the-push-event">push</a>
    </ul>
   <li>
    <a data-link-type="biblio">[referrer-policy]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy">referrer policy</a>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc7230]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7230#section-3.2">field-value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc7231]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc7231#section-7.1.4">vary</a>
    </ul>
   <li>
    <a data-link-type="biblio">[secure-contexts]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin">potentially trustworthy origin</a>
     <li><a href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url">potentially trustworthy url</a>
     <li><a href="https://w3c.github.io/webappsec-secure-contexts/#secure-contexts">secure contexts</a>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><a href="https://url.spec.whatwg.org/#concept-url-equals">equal</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-fragment">fragment</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-path">path</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-query">query</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url">url</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-parser">url parser</a>
     <li><a href="https://url.spec.whatwg.org/#concept-url-serializer">url serializer</a>
    </ul>
   <li>
    <a data-link-type="biblio">[webappsec-referrer-policy]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header">parse a referrer policy from a referrer-policy header</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#aborterror">AbortError</a>
     <li><a href="https://heycam.github.io/webidl/#idl-ByteString">ByteString</a>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMException">DOMException</a>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#Exposed">Exposed</a>
     <li><a href="https://heycam.github.io/webidl/#Global">Global</a>
     <li><a href="https://heycam.github.io/webidl/#invalidaccesserror">InvalidAccessError</a>
     <li><a href="https://heycam.github.io/webidl/#invalidstateerror">InvalidStateError</a>
     <li><a href="https://heycam.github.io/webidl/#NewObject">NewObject</a>
     <li><a href="https://heycam.github.io/webidl/#quotaexceedederror">QuotaExceededError</a>
     <li><a href="https://heycam.github.io/webidl/#SameObject">SameObject</a>
     <li><a href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a>
     <li><a href="https://heycam.github.io/webidl/#securityerror">SecurityError</a>
     <li><a href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>
     <li><a href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-create-frozen-array">create a frozen array</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-create-exception">created</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-exception">exception</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-frozen-array-type">frozen array type</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-exception-message">message</a>
     <li><a href="https://heycam.github.io/webidl/#idl-object">object</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-partial-interface">partial interface</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-present">present</a>
     <li><a href="https://heycam.github.io/webidl/#dfn-throw">throw</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp-3">[CSP-3]
   <dd>Content Security Policy Level 3 URL: <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.github.io/ecma262/">ECMAScript Language Specification</a>. URL: <a href="https://tc39.github.io/ecma262/">https://tc39.github.io/ecma262/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-mimesniff">[MIMESNIFF]
   <dd>Gordon P. Hemsley. <a href="https://mimesniff.spec.whatwg.org/">MIME Sniffing Standard</a>. Living Standard. URL: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a>
   <dt id="biblio-page-visibility">[PAGE-VISIBILITY]
   <dd>Jatinder Mann; Arvind Jain. <a href="https://www.w3.org/TR/page-visibility/">Page Visibility (Second Edition)</a>. 29 October 2013. REC. URL: <a href="https://www.w3.org/TR/page-visibility/">https://www.w3.org/TR/page-visibility/</a>
   <dt id="biblio-promises-guide">[PROMISES-GUIDE]
   <dd>Domenic Denicola. <a href="https://www.w3.org/2001/tag/doc/promises-guide">Writing Promise-Using Specifications</a>. 16 February 2016. Finding of the W3C TAG. URL: <a href="https://www.w3.org/2001/tag/doc/promises-guide">https://www.w3.org/2001/tag/doc/promises-guide</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Emily Stark. <a href="https://www.w3.org/TR/referrer-policy/">Referrer Policy</a>. 26 January 2017. CR. URL: <a href="https://www.w3.org/TR/referrer-policy/">https://www.w3.org/TR/referrer-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-rfc7230">[RFC7230]
   <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a>
   <dt id="biblio-rfc7231">[RFC7231]
   <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7231">https://tools.ietf.org/html/rfc7231</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://www.w3.org/TR/secure-contexts/">Secure Contexts</a>. 15 September 2016. CR. URL: <a href="https://www.w3.org/TR/secure-contexts/">https://www.w3.org/TR/secure-contexts/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-notifications">[NOTIFICATIONS]
   <dd>Anne van Kesteren. <a href="https://notifications.spec.whatwg.org/">Notifications API Standard</a>. Living Standard. URL: <a href="https://notifications.spec.whatwg.org/">https://notifications.spec.whatwg.org/</a>
   <dt id="biblio-unsanctioned-tracking">[UNSANCTIONED-TRACKING]
   <dd><a href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/">Unsanctioned Web Tracking</a>. 17 July 2015. Finding of the W3C TAG. URL: <a href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/">https://www.w3.org/2001/tag/doc/unsanctioned-tracking/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑨">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①③">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#serviceworker"><code>ServiceWorker</code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget③">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①①"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-serviceworker-scripturl" id="ref-for-dom-serviceworker-scripturl②">scriptURL</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerstate" id="ref-for-enumdef-serviceworkerstate④">ServiceWorkerState</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerState" href="#dom-serviceworker-state" id="ref-for-dom-serviceworker-state⑤">state</a>;
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworker-postmessage" id="ref-for-dom-serviceworker-postmessage②">postMessage</a>(<span class="kt">any</span> <a class="nv" href="#dom-serviceworker-postmessage-message-transfer-message"><code>message</code></a>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-object" id="ref-for-idl-object②"><span class="kt">object</span></a>> <a class="nv" href="#dom-serviceworker-postmessage-message-transfer-transfer"><code>transfer</code></a> = []);

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①⓪">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworker-onstatechange" id="ref-for-dom-serviceworker-onstatechange①">onstatechange</a>;
};
<a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②⑧">ServiceWorker</a> <span class="kt">includes</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#abstractworker" id="ref-for-abstractworker①">AbstractWorker</a>;

<span class="kt">enum</span> <a class="nv" href="#enumdef-serviceworkerstate"><code>ServiceWorkerState</code></a> {
  <a class="s" href="#dom-serviceworkerstate-installing"><code>"installing"</code></a>,
  <a class="s" href="#dom-serviceworkerstate-installed"><code>"installed"</code></a>,
  <a class="s" href="#dom-serviceworkerstate-activating"><code>"activating"</code></a>,
  <a class="s" href="#dom-serviceworkerstate-activated"><code>"activated"</code></a>,
  <a class="s" href="#dom-serviceworkerstate-redundant"><code>"redundant"</code></a>
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext①①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①④">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#serviceworkerregistration"><code>ServiceWorkerRegistration</code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①①">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker⑨①">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-installing" id="ref-for-dom-serviceworkerregistration-installing③">installing</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①⓪①">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-waiting" id="ref-for-dom-serviceworkerregistration-waiting③">waiting</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①①①">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkerregistration-active" id="ref-for-dom-serviceworkerregistration-active③">active</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑨">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#navigationpreloadmanager" id="ref-for-navigationpreloadmanager①①">NavigationPreloadManager</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="NavigationPreloadManager" href="#dom-serviceworkerregistration-navigationpreload" id="ref-for-dom-serviceworkerregistration-navigationpreload②">navigationPreload</a>;

  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①②"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-serviceworkerregistration-scope" id="ref-for-dom-serviceworkerregistration-scope②">scope</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerupdateviacache" id="ref-for-enumdef-serviceworkerupdateviacache②">ServiceWorkerUpdateViaCache</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerUpdateViaCache" href="#dom-serviceworkerregistration-updateviacache" id="ref-for-dom-serviceworkerregistration-updateviacache②">updateViaCache</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②④">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerregistration-update" id="ref-for-dom-serviceworkerregistration-update②">update</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①①⓪">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①⓪"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerregistration-unregister" id="ref-for-dom-serviceworkerregistration-unregister④">unregister</a>();

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerregistration-onupdatefound" id="ref-for-dom-serviceworkerregistration-onupdatefound①">onupdatefound</a>;
};

<span class="kt">enum</span> <a class="nv" href="#enumdef-serviceworkerupdateviacache"><code>ServiceWorkerUpdateViaCache</code></a> {
  <a class="s" href="#dom-serviceworkerupdateviacache-imports"><code>"imports"</code></a>,
  <a class="s" href="#dom-serviceworkerupdateviacache-all"><code>"all"</code></a>,
  <a class="s" href="#dom-serviceworkerupdateviacache-none"><code>"none"</code></a>
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator③">Navigator</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext②①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject①①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①⑧">ServiceWorkerContainer</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerContainer" href="#navigator-service-worker-attribute" id="ref-for-navigator-service-worker-attribute①①">serviceWorker</a>;
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator③">WorkerNavigator</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext③①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject②①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkercontainer" id="ref-for-serviceworkercontainer①⑦">ServiceWorkerContainer</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerContainer" href="#navigator-service-worker-attribute" id="ref-for-navigator-service-worker-attribute②①">serviceWorker</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext④①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#serviceworkercontainer"><code>ServiceWorkerContainer</code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget②①">EventTarget</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker①⑤①">ServiceWorker</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorker?" href="#dom-serviceworkercontainer-controller" id="ref-for-dom-serviceworkercontainer-controller④">controller</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑥①">ServiceWorkerRegistration</a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Promise<ServiceWorkerRegistration>" href="#dom-serviceworkercontainer-ready" id="ref-for-dom-serviceworkercontainer-ready②">ready</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②⑤">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑦①">ServiceWorkerRegistration</a>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-register" id="ref-for-dom-serviceworkercontainer-register③">register</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②①"><span class="kt">USVString</span></a> <a class="nv" href="#dom-serviceworkercontainer-register-scripturl-options-scripturl"><code>scriptURL</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-registrationoptions" id="ref-for-dictdef-registrationoptions①">RegistrationOptions</a> <a class="nv" href="#dom-serviceworkercontainer-register-scripturl-options-options"><code>options</code></a>);

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject③①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-getregistration" id="ref-for-dom-serviceworkercontainer-getregistration②">getRegistration</a>(<span class="kt">optional</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString③①"><span class="kt">USVString</span></a> <a class="nv" href="#dom-serviceworkercontainer-getregistration-clienturl-clienturl"><code>clientURL</code></a> = "");
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject④①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration⑧①">ServiceWorkerRegistration</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-getregistrations" id="ref-for-dom-serviceworkercontainer-getregistrations②">getRegistrations</a>();

  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkercontainer-startmessages" id="ref-for-dom-serviceworkercontainer-startmessages②">startMessages</a>();


  // events
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-oncontrollerchange" id="ref-for-dom-serviceworkercontainer-oncontrollerchange①">oncontrollerchange</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-onmessage" id="ref-for-dom-serviceworkercontainer-onmessage②">onmessage</a>; // event.source of message events is ServiceWorker object
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler④①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkercontainer-onmessageerror" id="ref-for-dom-serviceworkercontainer-onmessageerror①">onmessageerror</a>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-registrationoptions"><code>RegistrationOptions</code></a> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString④①"><span class="kt">USVString</span></a> <a class="nv" data-type="USVString " href="#dom-registrationoptions-scope"><code>scope</code></a>;
  <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workertype" id="ref-for-workertype①">WorkerType</a> <a class="nv" data-default="&quot;classic&quot;" data-type="WorkerType " href="#dom-registrationoptions-type"><code>type</code></a> = "classic";
  <a class="n" data-link-type="idl-name" href="#enumdef-serviceworkerupdateviacache" id="ref-for-enumdef-serviceworkerupdateviacache①①">ServiceWorkerUpdateViaCache</a> <a class="nv" data-default="&quot;imports&quot;" data-type="ServiceWorkerUpdateViaCache " href="#dom-registrationoptions-updateviacache"><code>updateViaCache</code></a> = "imports";
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑤①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#navigationpreloadmanager"><code>NavigationPreloadManager</code></a> {
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-enable" id="ref-for-dom-navigationpreloadmanager-enable②">enable</a>();
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-disable" id="ref-for-dom-navigationpreloadmanager-disable②">disable</a>();
  <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-setheadervalue" id="ref-for-dom-navigationpreloadmanager-setheadervalue②">setHeaderValue</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-ByteString" id="ref-for-idl-ByteString②"><span class="kt">ByteString</span></a> <a class="nv" href="#dom-navigationpreloadmanager-setheadervalue-value-value"><code>value</code></a>);
  <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#dictdef-navigationpreloadstate" id="ref-for-dictdef-navigationpreloadstate②">NavigationPreloadState</a>> <a class="nv idl-code" data-link-type="method" href="#dom-navigationpreloadmanager-getstate" id="ref-for-dom-navigationpreloadmanager-getstate②">getState</a>();
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-navigationpreloadstate"><code>NavigationPreloadState</code></a> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①①"><span class="kt">boolean</span></a> <a class="nv" data-default="false" data-type="boolean " href="#dom-navigationpreloadstate-enabled"><code>enabled</code></a> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-ByteString" id="ref-for-idl-ByteString①①"><span class="kt">ByteString</span></a> <a class="nv" data-type="ByteString " href="#dom-navigationpreloadstate-headervalue"><code>headerValue</code></a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①">Global</a>=(<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#worker" id="ref-for-worker①">Worker</a>,<a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②⓪①">ServiceWorker</a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#serviceworkerglobalscope"><code>ServiceWorkerGlobalScope</code></a> : <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope③">WorkerGlobalScope</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject③①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#clients" id="ref-for-clients④">Clients</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Clients" href="#dom-serviceworkerglobalscope-clients" id="ref-for-dom-serviceworkerglobalscope-clients②">clients</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject④①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#serviceworkerregistration" id="ref-for-serviceworkerregistration①③①">ServiceWorkerRegistration</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ServiceWorkerRegistration" href="#dom-serviceworkerglobalscope-registration" id="ref-for-dom-serviceworkerglobalscope-registration②">registration</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑤①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-serviceworkerglobalscope-skipwaiting" id="ref-for-dom-serviceworkerglobalscope-skipwaiting④">skipWaiting</a>();

  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑤①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-oninstall" id="ref-for-dom-serviceworkerglobalscope-oninstall②">oninstall</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑥①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onactivate" id="ref-for-dom-serviceworkerglobalscope-onactivate②">onactivate</a>;
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑦①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onfetch" id="ref-for-dom-serviceworkerglobalscope-onfetch①">onfetch</a>;

  // event
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑧①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onmessage" id="ref-for-dom-serviceworkerglobalscope-onmessage①">onmessage</a>; // event.source of the message events is Client object
  <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler⑨①">EventHandler</a> <a class="nv idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-serviceworkerglobalscope-onmessageerror" id="ref-for-dom-serviceworkerglobalscope-onmessageerror①">onmessageerror</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#client"><code>Client</code></a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑤①"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-client-url" id="ref-for-dom-client-url②">url</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑨"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-client-id" id="ref-for-dom-client-id②">id</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-clienttype" id="ref-for-enumdef-clienttype②">ClientType</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ClientType" href="#dom-client-type" id="ref-for-dom-client-type②">type</a>;
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-client-postmessage" id="ref-for-dom-client-postmessage②">postMessage</a>(<span class="kt">any</span> <a class="nv" href="#dom-client-postmessage-message-transfer-message"><code>message</code></a>, <span class="kt">optional</span> <span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-object" id="ref-for-idl-object①①"><span class="kt">object</span></a>> <a class="nv" href="#dom-client-postmessage-message-transfer-transfer"><code>transfer</code></a> = []);
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#windowclient"><code>WindowClient</code></a> : <a class="n" data-link-type="idl-name" href="#client" id="ref-for-client②①">Client</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/page-visibility/#VisibilityState" id="ref-for-VisibilityState①">VisibilityState</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="VisibilityState" href="#dom-windowclient-visibilitystate" id="ref-for-dom-windowclient-visibilitystate②">visibilityState</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean②①"><span class="kt">boolean</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-windowclient-focused" id="ref-for-dom-windowclient-focused②">focused</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑤①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">FrozenArray</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑥①"><span class="kt">USVString</span></a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="FrozenArray<USVString>" href="#dom-windowclient-ancestororigins" id="ref-for-dom-windowclient-ancestororigins②">ancestorOrigins</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑥①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient①②">WindowClient</a>> <a class="nv idl-code" data-link-type="method" href="#dom-windowclient-focus" id="ref-for-dom-windowclient-focus②">focus</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑦①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient②①">WindowClient</a>?> <a class="nv" href="#dom-windowclient-navigate"><code>navigate</code></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑦①"><span class="kt">USVString</span></a> <a class="nv" href="#dom-windowclient-navigate-url-url"><code>url</code></a>);
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑦①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#clients"><code>Clients</code></a> {
  // The objects returned will be new instances every time
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑧①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-get" id="ref-for-dom-clients-get②">get</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑧"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-clients-get-id-id"><code>id</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject⑨①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client④①">Client</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-matchall" id="ref-for-dom-clients-matchall②">matchAll</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-clientqueryoptions" id="ref-for-dictdef-clientqueryoptions①">ClientQueryOptions</a> <a class="nv" href="#dom-clients-matchall-options-options"><code>options</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⓪①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#windowclient" id="ref-for-windowclient⑦①">WindowClient</a>?> <a class="nv idl-code" data-link-type="method" href="#dom-clients-openwindow" id="ref-for-dom-clients-openwindow②">openWindow</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑧①"><span class="kt">USVString</span></a> <a class="nv" href="#dom-clients-openwindow-url-url"><code>url</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①①①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-clients-claim" id="ref-for-dom-clients-claim②">claim</a>();
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-clientqueryoptions"><code>ClientQueryOptions</code></a> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean③①"><span class="kt">boolean</span></a> <a class="nv" data-default="false" data-type="boolean " href="#dom-clientqueryoptions-includeuncontrolled"><code>includeUncontrolled</code></a> = <span class="kt">false</span>;
  <a class="n" data-link-type="idl-name" href="#enumdef-clienttype" id="ref-for-enumdef-clienttype①①">ClientType</a> <a class="nv" data-default="&quot;window&quot;" data-type="ClientType " href="#dom-clientqueryoptions-type"><code>type</code></a> = "window";
};

<span class="kt">enum</span> <a class="nv" href="#enumdef-clienttype"><code>ClientType</code></a> {
  <a class="s" href="#dom-clienttype-window"><code>"window"</code></a>,
  <a class="s" href="#dom-clienttype-worker"><code>"worker"</code></a>,
  <a class="s" href="#dom-clienttype-sharedworker"><code>"sharedworker"</code></a>,
  <a class="s" href="#dom-clienttype-all"><code>"all"</code></a>
};

[<a class="nv" href="#dom-extendableevent-extendableevent"><code>Constructor</code></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-extendableevent-extendableevent-type-eventinitdict-type"><code>type</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit③">ExtendableEventInit</a> <a class="nv" href="#dom-extendableevent-extendableevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code></a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑧①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#extendableevent"><code>ExtendableEvent</code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event③①">Event</a> {
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-extendableevent-waituntil" id="ref-for-dom-extendableevent-waituntil⑧">waitUntil</a>(<span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv" href="#dom-extendableevent-waituntil-f-f"><code>f</code></a>);
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-extendableeventinit"><code>ExtendableEventInit</code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit①">EventInit</a> {
  // Defined for the forward compatibility across the derived events
};

[<a class="nv" href="#dom-fetchevent-fetchevent"><code>Constructor</code></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-fetchevent-fetchevent-type-eventinitdict-type"><code>type</code></a>, <a class="n" data-link-type="idl-name" href="#dictdef-fetcheventinit" id="ref-for-dictdef-fetcheventinit①">FetchEventInit</a> <a class="nv" href="#dom-fetchevent-fetchevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code></a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑨①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#fetchevent"><code>FetchEvent</code></a> : <a class="n" data-link-type="idl-name" href="#extendableevent" id="ref-for-extendableevent⑥①">ExtendableEvent</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑥①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①⑤">Request</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Request" href="#dom-fetchevent-request" id="ref-for-dom-fetchevent-request③">request</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Promise<any>" href="#dom-fetchevent-preloadresponse" id="ref-for-dom-fetchevent-preloadresponse③">preloadResponse</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString④①"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-clientid" id="ref-for-dom-fetchevent-clientid③">clientId</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑤①"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-resultingclientid" id="ref-for-dom-fetchevent-resultingclientid③">resultingClientId</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑥①"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-fetchevent-targetclientid" id="ref-for-dom-fetchevent-targetclientid③">targetClientId</a>;

  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-fetchevent-respondwith" id="ref-for-dom-fetchevent-respondwith④">respondWith</a>(<span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response①③">Response</a>> <a class="nv" href="#dom-fetchevent-respondwith-r-r"><code>r</code></a>);
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-fetcheventinit"><code>FetchEventInit</code></a> : <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit①①">ExtendableEventInit</a> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request①⑥">Request</a> <a class="nv" data-type="Request " href="#dom-fetcheventinit-request"><code>request</code></a>;
  <span class="kt">required</span> <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv" data-type="Promise<any> " href="#dom-fetcheventinit-preloadresponse"><code>preloadResponse</code></a>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑦①"><span class="kt">DOMString</span></a> <a class="nv" data-default="&quot;&quot;" data-type="DOMString " href="#dom-fetcheventinit-clientid"><code>clientId</code></a> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑧①"><span class="kt">DOMString</span></a> <a class="nv" data-default="&quot;&quot;" data-type="DOMString " href="#dom-fetcheventinit-resultingclientid"><code>resultingClientId</code></a> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑨①"><span class="kt">DOMString</span></a> <a class="nv" data-default="&quot;&quot;" data-type="DOMString " href="#dom-fetcheventinit-targetclientid"><code>targetClientId</code></a> = "";
};

[<a class="nv" href="#dom-extendablemessageevent-extendablemessageevent"><code>Constructor</code></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⓪①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-type"><code>type</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-extendablemessageeventinit" id="ref-for-dictdef-extendablemessageeventinit①">ExtendableMessageEventInit</a> <a class="nv" href="#dom-extendablemessageevent-extendablemessageevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code></a>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①⓪①">Exposed</a>=<span class="n">ServiceWorker</span>]
<span class="kt">interface</span> <a class="nv" href="#extendablemessageevent"><code>ExtendableMessageEvent</code></a> : <a class="n" data-link-type="idl-name" href="#extendableevent" id="ref-for-extendableevent⑧①">ExtendableEvent</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">any</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="any" href="#dom-extendablemessageevent-data" id="ref-for-dom-extendablemessageevent-data①①">data</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑨①"><span class="kt">USVString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-extendablemessageevent-origin" id="ref-for-dom-extendablemessageevent-origin①①">origin</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①①①"><span class="kt">DOMString</span></a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-extendablemessageevent-lasteventid" id="ref-for-dom-extendablemessageevent-lasteventid②">lastEventId</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑦①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> (<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client⑥①">Client</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②②①">ServiceWorker</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport②①">MessagePort</a>)? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="(Client or ServiceWorker or MessagePort)?" href="#dom-extendablemessageevent-source" id="ref-for-dom-extendablemessageevent-source①①">source</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport③①">MessagePort</a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="FrozenArray<MessagePort>" href="#dom-extendablemessageevent-ports" id="ref-for-dom-extendablemessageevent-ports①①">ports</a>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-extendablemessageeventinit"><code>ExtendableMessageEventInit</code></a> : <a class="n" data-link-type="idl-name" href="#dictdef-extendableeventinit" id="ref-for-dictdef-extendableeventinit②①">ExtendableEventInit</a> {
  <span class="kt">any</span> <a class="nv" data-default="null" data-type="any " href="#dom-extendablemessageeventinit-data"><code>data</code></a> = <span class="kt">null</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⓪①"><span class="kt">USVString</span></a> <a class="nv" data-default="&quot;&quot;" data-type="USVString " href="#dom-extendablemessageeventinit-origin"><code>origin</code></a> = "";
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①②①"><span class="kt">DOMString</span></a> <a class="nv" data-default="&quot;&quot;" data-type="DOMString " href="#dom-extendablemessageeventinit-lasteventid"><code>lastEventId</code></a> = "";
  (<a class="n" data-link-type="idl-name" href="#client" id="ref-for-client⑦①">Client</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="#serviceworker" id="ref-for-serviceworker②③①">ServiceWorker</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport④①">MessagePort</a>)? <a class="nv" data-default="null" data-type="(Client or ServiceWorker or MessagePort)? " href="#dom-extendablemessageeventinit-source"><code>source</code></a> = <span class="kt">null</span>;
  <span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messageport" id="ref-for-messageport⑤①">MessagePort</a>> <a class="nv" data-default="None" data-type="sequence<MessagePort> " href="#dom-extendablemessageeventinit-ports"><code>ports</code></a> = [];
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope①">WindowOrWorkerGlobalScope</a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑥①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject⑧①">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#cachestorage" id="ref-for-cachestorage⑦">CacheStorage</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="CacheStorage" href="#global-caches-attribute" id="ref-for-global-caches-attribute①①">caches</a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑦①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①①①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#cache"><code>Cache</code></a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①②①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-match" id="ref-for-dom-cache-match⑥">match</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑧">RequestInfo</a> <a class="nv" href="#dom-cache-match-request-options-request"><code>request</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions⑦">CacheQueryOptions</a> <a class="nv" href="#dom-cache-match-request-options-options"><code>options</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①③①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑥①">Response</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-matchall" id="ref-for-dom-cache-matchall③">matchAll</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo①①">RequestInfo</a> <a class="nv" href="#dom-cache-matchall-request-options-request"><code>request</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions①①">CacheQueryOptions</a> <a class="nv" href="#dom-cache-matchall-request-options-options"><code>options</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①④①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-add" id="ref-for-dom-cache-add②">add</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo②①">RequestInfo</a> <a class="nv" href="#dom-cache-add-request-request"><code>request</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑤①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-addall" id="ref-for-dom-cache-addall③">addAll</a>(<span class="kt">sequence</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo③①">RequestInfo</a>> <a class="nv" href="#dom-cache-addall-requests-requests"><code>requests</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑥①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-put" id="ref-for-dom-cache-put②">put</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo④①">RequestInfo</a> <a class="nv" href="#dom-cache-put-request-response-request"><code>request</code></a>, <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response" id="ref-for-response⑦①">Response</a> <a class="nv" href="#dom-cache-put-request-response-response"><code>response</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑦①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean④①"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-delete" id="ref-for-dom-cache-delete②">delete</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑤①">RequestInfo</a> <a class="nv" href="#dom-cache-delete-request-options-request"><code>request</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions②①">CacheQueryOptions</a> <a class="nv" href="#dom-cache-delete-request-options-options"><code>options</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑧①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">FrozenArray</span>&lt;<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#request" id="ref-for-request②①">Request</a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cache-keys" id="ref-for-dom-cache-keys②">keys</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑥①">RequestInfo</a> <a class="nv" href="#dom-cache-keys-request-options-request"><code>request</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions③①">CacheQueryOptions</a> <a class="nv" href="#dom-cache-keys-request-options-options"><code>options</code></a>);
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-cachequeryoptions"><code>CacheQueryOptions</code></a> {
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑤①"><span class="kt">boolean</span></a> <a class="nv" data-default="false" data-type="boolean " href="#dom-cachequeryoptions-ignoresearch"><code>ignoreSearch</code></a> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑥①"><span class="kt">boolean</span></a> <a class="nv" data-default="false" data-type="boolean " href="#dom-cachequeryoptions-ignoremethod"><code>ignoreMethod</code></a> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑦①"><span class="kt">boolean</span></a> <a class="nv" data-default="false" data-type="boolean " href="#dom-cachequeryoptions-ignorevary"><code>ignoreVary</code></a> = <span class="kt">false</span>;
  <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①③①"><span class="kt">DOMString</span></a> <a class="nv" data-type="DOMString " href="#dom-cachequeryoptions-cachename"><code>cacheName</code></a>;
};

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext" id="ref-for-SecureContext⑧①">SecureContext</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①②①">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <a class="nv" href="#cachestorage"><code>CacheStorage</code></a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject①⑨①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-match" id="ref-for-dom-cachestorage-match②">match</a>(<a class="n" data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#requestinfo" id="ref-for-requestinfo⑦①">RequestInfo</a> <a class="nv" href="#dom-cachestorage-match-request-options-request"><code>request</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-cachequeryoptions" id="ref-for-dictdef-cachequeryoptions⑤①">CacheQueryOptions</a> <a class="nv" href="#dom-cachestorage-match-request-options-options"><code>options</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②⓪①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑧①"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-has" id="ref-for-dom-cachestorage-has③">has</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①④①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-cachestorage-has-cachename-cachename"><code>cacheName</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②①①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#cache" id="ref-for-cache①①①">Cache</a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-open" id="ref-for-dom-cachestorage-open②">open</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑤①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-cachestorage-open-cachename-cachename"><code>cacheName</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②②①">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean⑨①"><span class="kt">boolean</span></a>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-delete" id="ref-for-dom-cachestorage-delete②">delete</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑥①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-cachestorage-delete-cachename-cachename"><code>cacheName</code></a>);
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject" id="ref-for-NewObject②③①">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">sequence</span>&lt;<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①⑦①"><span class="kt">DOMString</span></a>>> <a class="nv idl-code" data-link-type="method" href="#dom-cachestorage-keys" id="ref-for-dom-cachestorage-keys②">keys</a>();
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> The response’s cache state concept had been removed from fetch. The fetch issue <a href="https://github.com/whatwg/fetch/issues/376">#376</a> tracks the request to restore the concept or add some similar way to check this state.<a href="#issue-3c7457a0"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="dfn-service-worker">
   <b><a href="#dfn-service-worker">#dfn-service-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker">1. Motivations</a> <a href="#ref-for-dfn-service-worker①">(2)</a> <a href="#ref-for-dfn-service-worker②">(3)</a> <a href="#ref-for-dfn-service-worker③">(4)</a> <a href="#ref-for-dfn-service-worker④">(5)</a> <a href="#ref-for-dfn-service-worker⑤">(6)</a> <a href="#ref-for-dfn-service-worker⑥">(7)</a> <a href="#ref-for-dfn-service-worker⑦">(8)</a> <a href="#ref-for-dfn-service-worker⑧">(9)</a> <a href="#ref-for-dfn-service-worker⑨">(10)</a> <a href="#ref-for-dfn-service-worker①⓪">(11)</a> <a href="#ref-for-dfn-service-worker①①">(12)</a> <a href="#ref-for-dfn-service-worker①②">(13)</a> <a href="#ref-for-dfn-service-worker①③">(14)</a>
    <li><a href="#ref-for-dfn-service-worker①④">2.1. Service Worker</a> <a href="#ref-for-dfn-service-worker①⑤">(2)</a> <a href="#ref-for-dfn-service-worker①⑥">(3)</a> <a href="#ref-for-dfn-service-worker①⑦">(4)</a> <a href="#ref-for-dfn-service-worker①⑧">(5)</a> <a href="#ref-for-dfn-service-worker①⑨">(6)</a> <a href="#ref-for-dfn-service-worker②⓪">(7)</a> <a href="#ref-for-dfn-service-worker②①">(8)</a> <a href="#ref-for-dfn-service-worker②②">(9)</a> <a href="#ref-for-dfn-service-worker②③">(10)</a> <a href="#ref-for-dfn-service-worker②④">(11)</a> <a href="#ref-for-dfn-service-worker②⑤">(12)</a> <a href="#ref-for-dfn-service-worker②⑥">(13)</a>
    <li><a href="#ref-for-dfn-service-worker②⑦">2.1.1. Lifetime</a> <a href="#ref-for-dfn-service-worker②⑧">(2)</a>
    <li><a href="#ref-for-dfn-service-worker②⑨">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-service-worker③⓪">(2)</a> <a href="#ref-for-dfn-service-worker③①">(3)</a> <a href="#ref-for-dfn-service-worker③②">(4)</a>
    <li><a href="#ref-for-dfn-service-worker③③">2.5. Task Sources</a> <a href="#ref-for-dfn-service-worker③④">(2)</a> <a href="#ref-for-dfn-service-worker③⑤">(3)</a>
    <li><a href="#ref-for-dfn-service-worker③⑥">2.6. User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-service-worker③⑦">3.1. ServiceWorker</a> <a href="#ref-for-dfn-service-worker③⑧">(2)</a> <a href="#ref-for-dfn-service-worker③⑨">(3)</a> <a href="#ref-for-dfn-service-worker④⓪">(4)</a>
    <li><a href="#ref-for-dfn-service-worker④①">3.1.1. scriptURL</a>
    <li><a href="#ref-for-dfn-service-worker④②">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dfn-service-worker④③">3.2.1. installing</a>
    <li><a href="#ref-for-dfn-service-worker④④">3.2.2. waiting</a>
    <li><a href="#ref-for-dfn-service-worker④⑤">3.2.3. active</a>
    <li><a href="#ref-for-dfn-service-worker④⑥">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dfn-service-worker④⑦">3.4.1. controller</a>
    <li><a href="#ref-for-dfn-service-worker④⑧">3.5. Events</a> <a href="#ref-for-dfn-service-worker④⑨">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑤⓪">4.1. ServiceWorkerGlobalScope</a> <a href="#ref-for-dfn-service-worker⑤①">(2)</a> <a href="#ref-for-dfn-service-worker⑤②">(3)</a> <a href="#ref-for-dfn-service-worker⑤③">(4)</a>
    <li><a href="#ref-for-dfn-service-worker⑤④">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-service-worker⑤⑤">4.4. ExtendableEvent</a> <a href="#ref-for-dfn-service-worker⑤⑥">(2)</a> <a href="#ref-for-dfn-service-worker⑤⑧">(3)</a> <a href="#ref-for-dfn-service-worker⑤⑨">(4)</a> <a href="#ref-for-dfn-service-worker⑥⓪">(5)</a> <a href="#ref-for-dfn-service-worker⑥①">(6)</a> <a href="#ref-for-dfn-service-worker⑥②">(7)</a>
    <li><a href="#ref-for-dfn-service-worker⑤⑦">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-dfn-service-worker⑥③">4.5. FetchEvent</a> <a href="#ref-for-dfn-service-worker⑥④">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑥⑤">4.6. ExtendableMessageEvent</a> <a href="#ref-for-dfn-service-worker⑥⑥">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑥⑦">5.2. Understanding Cache Lifetimes</a> <a href="#ref-for-dfn-service-worker⑥⑧">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑥⑨">6.1. Secure Context</a> <a href="#ref-for-dfn-service-worker⑦⓪">(2)</a> <a href="#ref-for-dfn-service-worker⑦①">(3)</a> <a href="#ref-for-dfn-service-worker⑦②">(4)</a> <a href="#ref-for-dfn-service-worker⑦③">(5)</a>
    <li><a href="#ref-for-dfn-service-worker⑦④">6.2. Content Security Policy</a>
    <li><a href="#ref-for-dfn-service-worker⑦⑤">6.3.1. Origin restriction</a> <a href="#ref-for-dfn-service-worker⑦⑥">(2)</a> <a href="#ref-for-dfn-service-worker⑦⑦">(3)</a>
    <li><a href="#ref-for-dfn-service-worker⑦⑧">6.4. Cross-Origin Resources and CORS</a>
    <li><a href="#ref-for-dfn-service-worker⑦⑨">6.5. Implementer Concerns</a> <a href="#ref-for-dfn-service-worker⑧⓪">(2)</a> <a href="#ref-for-dfn-service-worker⑧①">(3)</a>
    <li><a href="#ref-for-dfn-service-worker⑧②">6.6. Privacy</a> <a href="#ref-for-dfn-service-worker⑧③">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑧④">7. Extensibility</a>
    <li><a href="#ref-for-dfn-service-worker⑧⑤">7.4. Request Functional Event Dispatch</a>
    <li><a href="#ref-for-dfn-service-worker⑧⑥">Start Register</a>
    <li><a href="#ref-for-dfn-service-worker⑧⑦">Update</a>
    <li><a href="#ref-for-dfn-service-worker⑧⑧">Install</a> <a href="#ref-for-dfn-service-worker⑧⑨">(2)</a>
    <li><a href="#ref-for-dfn-service-worker⑨⓪">Run Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker⑨①">Terminate Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker⑨②">Handle Fetch</a>
    <li><a href="#ref-for-dfn-service-worker⑨③">Update Service Worker Extended Events Set</a>
    <li><a href="#ref-for-dfn-service-worker⑨④">Update Registration State</a>
    <li><a href="#ref-for-dfn-service-worker⑨⑤">Update Worker State</a> <a href="#ref-for-dfn-service-worker⑨⑥">(2)</a> <a href="#ref-for-dfn-service-worker⑨⑦">(3)</a> <a href="#ref-for-dfn-service-worker⑨⑧">(4)</a> <a href="#ref-for-dfn-service-worker⑨⑨">(5)</a> <a href="#ref-for-dfn-service-worker①⓪⓪">(6)</a> <a href="#ref-for-dfn-service-worker①⓪①">(7)</a> <a href="#ref-for-dfn-service-worker①⓪②">(8)</a> <a href="#ref-for-dfn-service-worker①⓪③">(9)</a> <a href="#ref-for-dfn-service-worker①⓪④">(10)</a>
    <li><a href="#ref-for-dfn-service-worker①⓪⑤">Get Newest Worker</a>
    <li><a href="#ref-for-dfn-service-worker①⓪⑥">Service Worker Has No Pending Events</a>
    <li><a href="#ref-for-dfn-service-worker①⓪⑦">Service Worker Script Request</a> <a href="#ref-for-dfn-service-worker①⓪⑧">(2)</a>
    <li><a href="#ref-for-dfn-service-worker①⓪⑨">Service Worker Script Response</a>
    <li><a href="#ref-for-dfn-service-worker①①⓪">Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-state">
   <b><a href="#dfn-state">#dfn-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-state">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-state①">(2)</a> <a href="#ref-for-dfn-state②">(3)</a>
    <li><a href="#ref-for-dfn-state③">3.1. ServiceWorker</a>
    <li><a href="#ref-for-dfn-state④">3.2.7. update()</a>
    <li><a href="#ref-for-dfn-state⑤">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-dfn-state⑥">Try Activate</a>
    <li><a href="#ref-for-dfn-state⑦">Handle Fetch</a> <a href="#ref-for-dfn-state⑧">(2)</a>
    <li><a href="#ref-for-dfn-state⑨">Handle Functional Event</a> <a href="#ref-for-dfn-state①⓪">(2)</a>
    <li><a href="#ref-for-dfn-state①①">Update Worker State</a> <a href="#ref-for-dfn-state①②">(2)</a> <a href="#ref-for-dfn-state①③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-script-url">
   <b><a href="#dfn-script-url">#dfn-script-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-script-url">3.1.1. scriptURL</a>
    <li><a href="#ref-for-dfn-script-url①">3.2.7. update()</a>
    <li><a href="#ref-for-dfn-script-url②">Register</a>
    <li><a href="#ref-for-dfn-script-url③">Update</a> <a href="#ref-for-dfn-script-url④">(2)</a>
    <li><a href="#ref-for-dfn-script-url⑤">Soft Update</a>
    <li><a href="#ref-for-dfn-script-url⑥">Run Service Worker</a> <a href="#ref-for-dfn-script-url⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-type">
   <b><a href="#dfn-type">#dfn-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-type">3.2.7. update()</a>
    <li><a href="#ref-for-dfn-type①">Update</a>
    <li><a href="#ref-for-dfn-type②">Soft Update</a>
    <li><a href="#ref-for-dfn-type③">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-containing-service-worker-registration">
   <b><a href="#dfn-containing-service-worker-registration">#dfn-containing-service-worker-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-containing-service-worker-registration">2.4. Selection and Use</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①">3.2.8. unregister()</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration②">4.1.2. registration</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration③">4.1.3. skipWaiting()</a> <a href="#ref-for-dfn-containing-service-worker-registration④">(2)</a> <a href="#ref-for-dfn-containing-service-worker-registration⑤">(3)</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration⑥">4.3.4. claim()</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration⑦">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration⑧">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration⑨">4.7. Events</a> <a href="#ref-for-dfn-containing-service-worker-registration①⓪">(2)</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①①">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①②">Install</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①③">Run Service Worker</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①④">Terminate Service Worker</a>
    <li><a href="#ref-for-dfn-containing-service-worker-registration①⑤">Handle Fetch</a> <a href="#ref-for-dfn-containing-service-worker-registration①⑥">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-global-object">
   <b><a href="#dfn-service-worker-global-object">#dfn-service-worker-global-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-global-object">Install</a>
    <li><a href="#ref-for-dfn-service-worker-global-object①">Activate</a>
    <li><a href="#ref-for-dfn-service-worker-global-object②">Run Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-global-object③">Terminate Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-global-object④">Handle Fetch</a>
    <li><a href="#ref-for-dfn-service-worker-global-object⑤">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-lifecycle-events">
   <b><a href="#dfn-lifecycle-events">#dfn-lifecycle-events</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-lifecycle-events">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dfn-lifecycle-events①">4.7. Events</a> <a href="#ref-for-dfn-lifecycle-events②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-functional-events">
   <b><a href="#dfn-functional-events">#dfn-functional-events</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-functional-events">2.5. Task Sources</a>
    <li><a href="#ref-for-dfn-functional-events①">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dfn-functional-events②">4.5. FetchEvent</a>
    <li><a href="#ref-for-dfn-functional-events③">4.7. Events</a>
    <li><a href="#ref-for-dfn-functional-events④">7.2. Define Functional Event</a>
    <li><a href="#ref-for-dfn-functional-events⑤">7.3. Define Event Handler</a>
    <li><a href="#ref-for-dfn-functional-events⑥">7.4. Request Functional Event Dispatch</a> <a href="#ref-for-dfn-functional-events⑦">(2)</a> <a href="#ref-for-dfn-functional-events⑧">(3)</a>
    <li><a href="#ref-for-dfn-functional-events⑨">Update Worker State</a> <a href="#ref-for-dfn-functional-events①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-script-resource">
   <b><a href="#dfn-script-resource">#dfn-script-resource</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-script-resource">2.1. Service Worker</a> <a href="#ref-for-dfn-script-resource①">(2)</a> <a href="#ref-for-dfn-script-resource②">(3)</a>
    <li><a href="#ref-for-dfn-script-resource③">6.2. Content Security Policy</a> <a href="#ref-for-dfn-script-resource④">(2)</a>
    <li><a href="#ref-for-dfn-script-resource⑤">Update</a> <a href="#ref-for-dfn-script-resource⑥">(2)</a> <a href="#ref-for-dfn-script-resource⑦">(3)</a>
    <li><a href="#ref-for-dfn-script-resource⑧">Run Service Worker</a> <a href="#ref-for-dfn-script-resource⑨">(2)</a> <a href="#ref-for-dfn-script-resource①⓪">(3)</a>
    <li><a href="#ref-for-dfn-script-resource①①">Service Worker Script Request</a> <a href="#ref-for-dfn-script-resource①②">(2)</a>
    <li><a href="#ref-for-dfn-script-resource①③">Service Worker Script Response</a>
    <li><a href="#ref-for-dfn-script-resource①④">Syntax</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-has-ever-been-evaluated-flag">
   <b><a href="#dfn-has-ever-been-evaluated-flag">#dfn-has-ever-been-evaluated-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-has-ever-been-evaluated-flag">Run Service Worker</a> <a href="#ref-for-dfn-has-ever-been-evaluated-flag①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-https-state">
   <b><a href="#dfn-https-state">#dfn-https-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-https-state">Update</a>
    <li><a href="#ref-for-dfn-https-state①">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-referrer-policy">
   <b><a href="#dfn-referrer-policy">#dfn-referrer-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-referrer-policy">Update</a>
    <li><a href="#ref-for-dfn-referrer-policy①">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-script-resource-map">
   <b><a href="#dfn-script-resource-map">#dfn-script-resource-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-script-resource-map">6.3.2. importScripts(urls)</a> <a href="#ref-for-dfn-script-resource-map①">(2)</a>
    <li><a href="#ref-for-dfn-script-resource-map②">6.6. Privacy</a>
    <li><a href="#ref-for-dfn-script-resource-map③">Update</a> <a href="#ref-for-dfn-script-resource-map④">(2)</a> <a href="#ref-for-dfn-script-resource-map⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-skip-waiting-flag">
   <b><a href="#dfn-skip-waiting-flag">#dfn-skip-waiting-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-skip-waiting-flag">3.5. Events</a>
    <li><a href="#ref-for-dfn-skip-waiting-flag①">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-skip-waiting-flag②">Try Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-classic-scripts-imported-flag">
   <b><a href="#dfn-classic-scripts-imported-flag">#dfn-classic-scripts-imported-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-classic-scripts-imported-flag">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-dfn-classic-scripts-imported-flag①">Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-set-of-event-types-to-handle">
   <b><a href="#dfn-set-of-event-types-to-handle">#dfn-set-of-event-types-to-handle</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-set-of-event-types-to-handle">Run Service Worker</a>
    <li><a href="#ref-for-dfn-set-of-event-types-to-handle①">Handle Fetch</a> <a href="#ref-for-dfn-set-of-event-types-to-handle②">(2)</a> <a href="#ref-for-dfn-set-of-event-types-to-handle③">(3)</a>
    <li><a href="#ref-for-dfn-set-of-event-types-to-handle④">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-set-of-extended-events">
   <b><a href="#dfn-set-of-extended-events">#dfn-set-of-extended-events</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-set-of-extended-events">Terminate Service Worker</a>
    <li><a href="#ref-for-dfn-set-of-extended-events①">Update Service Worker Extended Events Set</a> <a href="#ref-for-dfn-set-of-extended-events②">(2)</a> <a href="#ref-for-dfn-set-of-extended-events③">(3)</a>
    <li><a href="#ref-for-dfn-set-of-extended-events④">Service Worker Has No Pending Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-registration">
   <b><a href="#dfn-service-worker-registration">#dfn-service-worker-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-registration">2.1. Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-registration①">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-service-worker-registration②">(2)</a> <a href="#ref-for-dfn-service-worker-registration③">(3)</a> <a href="#ref-for-dfn-service-worker-registration④">(4)</a> <a href="#ref-for-dfn-service-worker-registration⑤">(5)</a> <a href="#ref-for-dfn-service-worker-registration⑥">(6)</a> <a href="#ref-for-dfn-service-worker-registration⑦">(7)</a> <a href="#ref-for-dfn-service-worker-registration⑧">(8)</a> <a href="#ref-for-dfn-service-worker-registration⑨">(9)</a> <a href="#ref-for-dfn-service-worker-registration①⓪">(10)</a> <a href="#ref-for-dfn-service-worker-registration①①">(11)</a> <a href="#ref-for-dfn-service-worker-registration①②">(12)</a> <a href="#ref-for-dfn-service-worker-registration①③">(13)</a> <a href="#ref-for-dfn-service-worker-registration①④">(14)</a> <a href="#ref-for-dfn-service-worker-registration①⑤">(15)</a> <a href="#ref-for-dfn-service-worker-registration①⑥">(16)</a> <a href="#ref-for-dfn-service-worker-registration①⑦">(17)</a>
    <li><a href="#ref-for-dfn-service-worker-registration①⑧">2.2.1. Lifetime</a> <a href="#ref-for-dfn-service-worker-registration①⑨">(2)</a> <a href="#ref-for-dfn-service-worker-registration②⓪">(3)</a> <a href="#ref-for-dfn-service-worker-registration②①">(4)</a>
    <li><a href="#ref-for-dfn-service-worker-registration②②">2.4. Selection and Use</a> <a href="#ref-for-dfn-service-worker-registration②③">(2)</a> <a href="#ref-for-dfn-service-worker-registration②④">(3)</a> <a href="#ref-for-dfn-service-worker-registration②⑤">(4)</a> <a href="#ref-for-dfn-service-worker-registration②⑥">(5)</a> <a href="#ref-for-dfn-service-worker-registration②⑦">(6)</a> <a href="#ref-for-dfn-service-worker-registration②⑧">(7)</a> <a href="#ref-for-dfn-service-worker-registration②⑨">(8)</a>
    <li><a href="#ref-for-dfn-service-worker-registration③⓪">2.6. User Agent Shutdown</a> <a href="#ref-for-dfn-service-worker-registration③①">(2)</a> <a href="#ref-for-dfn-service-worker-registration③②">(3)</a>
    <li><a href="#ref-for-dfn-service-worker-registration③③">3.2. ServiceWorkerRegistration</a> <a href="#ref-for-dfn-service-worker-registration③④">(2)</a> <a href="#ref-for-dfn-service-worker-registration③⑤">(3)</a>
    <li><a href="#ref-for-dfn-service-worker-registration③⑥">3.2.8. unregister()</a> <a href="#ref-for-dfn-service-worker-registration③⑦">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration③⑧">3.4. ServiceWorkerContainer</a> <a href="#ref-for-dfn-service-worker-registration③⑨">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⓪">3.4.2. ready</a>
    <li><a href="#ref-for-dfn-service-worker-registration④①">3.4.3. register(scriptURL, options)</a> <a href="#ref-for-dfn-service-worker-registration④②">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration④③">3.5. Events</a> <a href="#ref-for-dfn-service-worker-registration④④">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⑤">3.6.1. enable()</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⑥">3.6.2. disable()</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⑦">3.6.3. setHeaderValue(value)</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⑧">3.6.4. getState()</a>
    <li><a href="#ref-for-dfn-service-worker-registration④⑨">6.1. Secure Context</a> <a href="#ref-for-dfn-service-worker-registration⑤⓪">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤①">6.6. Privacy</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤②">7.1. Define API bound to Service Worker Registration</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤③">7.4. Request Functional Event Dispatch</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤④">Appendix A: Algorithms</a> <a href="#ref-for-dfn-service-worker-registration⑤⑤">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤⑥">Start Register</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤⑦">Soft Update</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤⑧">Install</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑤⑨">Activate</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⓪">Try Activate</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥①">Handle Functional Event</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥②">Handle Service Worker Client Unload</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥③">Set Registration</a> <a href="#ref-for-dfn-service-worker-registration⑥④">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⑤">Clear Registration</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⑥">Try Clear Registration</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⑦">Update Registration State</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⑧">Match Service Worker Registration</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑥⑨">Get Registration</a>
    <li><a href="#ref-for-dfn-service-worker-registration⑦⓪">Get Newest Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-scope-url">
   <b><a href="#dfn-scope-url">#dfn-scope-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-scope-url">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-scope-url①">(2)</a> <a href="#ref-for-dfn-scope-url②">(3)</a>
    <li><a href="#ref-for-dfn-scope-url③">2.2.1. Lifetime</a>
    <li><a href="#ref-for-dfn-scope-url④">2.4. Selection and Use</a>
    <li><a href="#ref-for-dfn-scope-url⑤">3.2.5. scope</a>
    <li><a href="#ref-for-dfn-scope-url⑥">3.2.7. update()</a>
    <li><a href="#ref-for-dfn-scope-url⑦">3.2.8. unregister()</a>
    <li><a href="#ref-for-dfn-scope-url⑧">3.4.3. register(scriptURL, options)</a> <a href="#ref-for-dfn-scope-url⑨">(2)</a>
    <li><a href="#ref-for-dfn-scope-url①⓪">Appendix A: Algorithms</a> <a href="#ref-for-dfn-scope-url①①">(2)</a>
    <li><a href="#ref-for-dfn-scope-url①②">Update</a>
    <li><a href="#ref-for-dfn-scope-url①③">Soft Update</a>
    <li><a href="#ref-for-dfn-scope-url①④">Install</a>
    <li><a href="#ref-for-dfn-scope-url①⑤">Activate</a>
    <li><a href="#ref-for-dfn-scope-url①⑥">Set Registration</a>
    <li><a href="#ref-for-dfn-scope-url①⑦">Clear Registration</a>
    <li><a href="#ref-for-dfn-scope-url①⑧">Service Worker Script Response</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-installing-worker">
   <b><a href="#dfn-installing-worker">#dfn-installing-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-installing-worker">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-dfn-installing-worker①">2.6. User Agent Shutdown</a> <a href="#ref-for-dfn-installing-worker②">(2)</a>
    <li><a href="#ref-for-dfn-installing-worker③">3.5. Events</a>
    <li><a href="#ref-for-dfn-installing-worker④">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dfn-installing-worker⑤">4.7. Events</a>
    <li><a href="#ref-for-dfn-installing-worker⑥">Install</a> <a href="#ref-for-dfn-installing-worker⑦">(2)</a> <a href="#ref-for-dfn-installing-worker⑧">(3)</a> <a href="#ref-for-dfn-installing-worker⑨">(4)</a>
    <li><a href="#ref-for-dfn-installing-worker①⓪">Handle User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-installing-worker①①">Clear Registration</a> <a href="#ref-for-dfn-installing-worker①②">(2)</a> <a href="#ref-for-dfn-installing-worker①③">(3)</a>
    <li><a href="#ref-for-dfn-installing-worker①④">Try Clear Registration</a> <a href="#ref-for-dfn-installing-worker①⑤">(2)</a>
    <li><a href="#ref-for-dfn-installing-worker①⑥">Update Registration State</a> <a href="#ref-for-dfn-installing-worker①⑦">(2)</a> <a href="#ref-for-dfn-installing-worker①⑧">(3)</a>
    <li><a href="#ref-for-dfn-installing-worker①⑨">Update Worker State</a> <a href="#ref-for-dfn-installing-worker②⓪">(2)</a>
    <li><a href="#ref-for-dfn-installing-worker②①">Get Newest Worker</a> <a href="#ref-for-dfn-installing-worker②②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-waiting-worker">
   <b><a href="#dfn-waiting-worker">#dfn-waiting-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-waiting-worker">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-dfn-waiting-worker①">2.6. User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-waiting-worker②">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-waiting-worker③">Install</a> <a href="#ref-for-dfn-waiting-worker④">(2)</a> <a href="#ref-for-dfn-waiting-worker⑤">(3)</a> <a href="#ref-for-dfn-waiting-worker⑥">(4)</a>
    <li><a href="#ref-for-dfn-waiting-worker⑦">Activate</a> <a href="#ref-for-dfn-waiting-worker⑧">(2)</a>
    <li><a href="#ref-for-dfn-waiting-worker⑨">Try Activate</a> <a href="#ref-for-dfn-waiting-worker①⓪">(2)</a>
    <li><a href="#ref-for-dfn-waiting-worker①①">Handle User Agent Shutdown</a> <a href="#ref-for-dfn-waiting-worker①②">(2)</a>
    <li><a href="#ref-for-dfn-waiting-worker①③">Clear Registration</a> <a href="#ref-for-dfn-waiting-worker①④">(2)</a> <a href="#ref-for-dfn-waiting-worker①⑤">(3)</a>
    <li><a href="#ref-for-dfn-waiting-worker①⑥">Try Clear Registration</a> <a href="#ref-for-dfn-waiting-worker①⑦">(2)</a>
    <li><a href="#ref-for-dfn-waiting-worker①⑧">Update Registration State</a> <a href="#ref-for-dfn-waiting-worker①⑨">(2)</a> <a href="#ref-for-dfn-waiting-worker②⓪">(3)</a>
    <li><a href="#ref-for-dfn-waiting-worker②①">Update Worker State</a>
    <li><a href="#ref-for-dfn-waiting-worker②②">Get Newest Worker</a> <a href="#ref-for-dfn-waiting-worker②③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-active-worker">
   <b><a href="#dfn-active-worker">#dfn-active-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-active-worker">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-active-worker①">(2)</a> <a href="#ref-for-dfn-active-worker②">(3)</a> <a href="#ref-for-dfn-active-worker③">(4)</a> <a href="#ref-for-dfn-active-worker④">(5)</a> <a href="#ref-for-dfn-active-worker⑤">(6)</a>
    <li><a href="#ref-for-dfn-active-worker⑥">2.4. Selection and Use</a> <a href="#ref-for-dfn-active-worker⑦">(2)</a> <a href="#ref-for-dfn-active-worker⑧">(3)</a>
    <li><a href="#ref-for-dfn-active-worker⑨">2.6. User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-active-worker①⓪">3.4.2. ready</a> <a href="#ref-for-dfn-active-worker①①">(2)</a>
    <li><a href="#ref-for-dfn-active-worker①②">3.5. Events</a>
    <li><a href="#ref-for-dfn-active-worker①③">3.6.1. enable()</a>
    <li><a href="#ref-for-dfn-active-worker①④">3.6.2. disable()</a>
    <li><a href="#ref-for-dfn-active-worker①⑤">3.6.3. setHeaderValue(value)</a>
    <li><a href="#ref-for-dfn-active-worker①⑥">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-active-worker①⑦">4.3.4. claim()</a>
    <li><a href="#ref-for-dfn-active-worker①⑧">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dfn-active-worker①⑨">4.7. Events</a>
    <li><a href="#ref-for-dfn-active-worker②⓪">Install</a> <a href="#ref-for-dfn-active-worker②①">(2)</a>
    <li><a href="#ref-for-dfn-active-worker②②">Activate</a> <a href="#ref-for-dfn-active-worker②③">(2)</a> <a href="#ref-for-dfn-active-worker②④">(3)</a> <a href="#ref-for-dfn-active-worker②⑤">(4)</a> <a href="#ref-for-dfn-active-worker②⑥">(5)</a> <a href="#ref-for-dfn-active-worker②⑦">(6)</a> <a href="#ref-for-dfn-active-worker②⑧">(7)</a> <a href="#ref-for-dfn-active-worker②⑨">(8)</a>
    <li><a href="#ref-for-dfn-active-worker③⓪">Try Activate</a> <a href="#ref-for-dfn-active-worker③①">(2)</a> <a href="#ref-for-dfn-active-worker③②">(3)</a> <a href="#ref-for-dfn-active-worker③③">(4)</a>
    <li><a href="#ref-for-dfn-active-worker③④">Run Service Worker</a>
    <li><a href="#ref-for-dfn-active-worker③⑤">Handle Fetch</a> <a href="#ref-for-dfn-active-worker③⑥">(2)</a> <a href="#ref-for-dfn-active-worker③⑦">(3)</a> <a href="#ref-for-dfn-active-worker③⑧">(4)</a> <a href="#ref-for-dfn-active-worker③⑨">(5)</a>
    <li><a href="#ref-for-dfn-active-worker④⓪">Handle Functional Event</a> <a href="#ref-for-dfn-active-worker④①">(2)</a>
    <li><a href="#ref-for-dfn-active-worker④②">Handle User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-active-worker④③">Clear Registration</a> <a href="#ref-for-dfn-active-worker④④">(2)</a> <a href="#ref-for-dfn-active-worker④⑤">(3)</a>
    <li><a href="#ref-for-dfn-active-worker④⑥">Try Clear Registration</a> <a href="#ref-for-dfn-active-worker④⑦">(2)</a>
    <li><a href="#ref-for-dfn-active-worker④⑧">Update Registration State</a> <a href="#ref-for-dfn-active-worker④⑨">(2)</a> <a href="#ref-for-dfn-active-worker⑤⓪">(3)</a>
    <li><a href="#ref-for-dfn-active-worker⑤①">Update Worker State</a> <a href="#ref-for-dfn-active-worker⑤②">(2)</a> <a href="#ref-for-dfn-active-worker⑤③">(3)</a>
    <li><a href="#ref-for-dfn-active-worker⑤④">Get Newest Worker</a> <a href="#ref-for-dfn-active-worker⑤⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-last-update-check-time">
   <b><a href="#dfn-last-update-check-time">#dfn-last-update-check-time</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-last-update-check-time">6.3.2. importScripts(urls)</a> <a href="#ref-for-dfn-last-update-check-time①">(2)</a> <a href="#ref-for-dfn-last-update-check-time②">(3)</a>
    <li><a href="#ref-for-dfn-last-update-check-time③">Update</a> <a href="#ref-for-dfn-last-update-check-time④">(2)</a> <a href="#ref-for-dfn-last-update-check-time⑤">(3)</a> <a href="#ref-for-dfn-last-update-check-time⑥">(4)</a> <a href="#ref-for-dfn-last-update-check-time⑦">(5)</a> <a href="#ref-for-dfn-last-update-check-time⑧">(6)</a>
    <li><a href="#ref-for-dfn-last-update-check-time⑨">Handle Fetch</a> <a href="#ref-for-dfn-last-update-check-time①⓪">(2)</a> <a href="#ref-for-dfn-last-update-check-time①①">(3)</a> <a href="#ref-for-dfn-last-update-check-time①②">(4)</a>
    <li><a href="#ref-for-dfn-last-update-check-time①③">Handle Functional Event</a> <a href="#ref-for-dfn-last-update-check-time①④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-update-via-cache">
   <b><a href="#dfn-update-via-cache">#dfn-update-via-cache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-update-via-cache">3.2.6. updateViaCache</a>
    <li><a href="#ref-for-dfn-update-via-cache①">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-dfn-update-via-cache②">Start Register</a>
    <li><a href="#ref-for-dfn-update-via-cache③">Register</a>
    <li><a href="#ref-for-dfn-update-via-cache④">Update</a> <a href="#ref-for-dfn-update-via-cache⑤">(2)</a>
    <li><a href="#ref-for-dfn-update-via-cache⑥">Set Registration</a> <a href="#ref-for-dfn-update-via-cache⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-uninstalling-flag">
   <b><a href="#dfn-uninstalling-flag">#dfn-uninstalling-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-uninstalling-flag">3.4.5. getRegistrations()</a>
    <li><a href="#ref-for-dfn-uninstalling-flag①">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-dfn-uninstalling-flag②">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-dfn-uninstalling-flag③">Register</a>
    <li><a href="#ref-for-dfn-uninstalling-flag④">Update</a>
    <li><a href="#ref-for-dfn-uninstalling-flag⑤">Handle Service Worker Client Unload</a>
    <li><a href="#ref-for-dfn-uninstalling-flag⑥">Unregister</a>
    <li><a href="#ref-for-dfn-uninstalling-flag⑦">Match Service Worker Registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-registration-task-queue">
   <b><a href="#dfn-service-worker-registration-task-queue">#dfn-service-worker-registration-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-registration-task-queue">2.2. Service Worker Registration</a> <a href="#ref-for-dfn-service-worker-registration-task-queue①">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-registration-task-queue②">Run Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-registration-task-queue③">Terminate Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-registration-navigation-preload-enabled-flag">
   <b><a href="#service-worker-registration-navigation-preload-enabled-flag">#service-worker-registration-navigation-preload-enabled-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-enabled-flag">3.6.1. enable()</a>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-enabled-flag①">3.6.2. disable()</a>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-enabled-flag②">3.6.4. getState()</a>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-enabled-flag③">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-registration-navigation-preload-header-value">
   <b><a href="#service-worker-registration-navigation-preload-header-value">#service-worker-registration-navigation-preload-header-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-header-value">3.6.3. setHeaderValue(value)</a>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-header-value①">3.6.4. getState()</a>
    <li><a href="#ref-for-service-worker-registration-navigation-preload-header-value②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-client">
   <b><a href="#dfn-service-worker-client">#dfn-service-worker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-client">2.1. Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-client①">2.1.1. Lifetime</a>
    <li><a href="#ref-for-dfn-service-worker-client②">2.2.1. Lifetime</a>
    <li><a href="#ref-for-dfn-service-worker-client③">2.3. Service Worker Client</a> <a href="#ref-for-dfn-service-worker-client④">(2)</a> <a href="#ref-for-dfn-service-worker-client⑤">(3)</a> <a href="#ref-for-dfn-service-worker-client⑥">(4)</a> <a href="#ref-for-dfn-service-worker-client⑦">(5)</a> <a href="#ref-for-dfn-service-worker-client⑧">(6)</a> <a href="#ref-for-dfn-service-worker-client⑨">(7)</a>
    <li><a href="#ref-for-dfn-service-worker-client①⓪">2.4. Selection and Use</a> <a href="#ref-for-dfn-service-worker-client①①">(2)</a> <a href="#ref-for-dfn-service-worker-client①②">(3)</a> <a href="#ref-for-dfn-service-worker-client①③">(4)</a> <a href="#ref-for-dfn-service-worker-client①④">(5)</a> <a href="#ref-for-dfn-service-worker-client①⑤">(6)</a> <a href="#ref-for-dfn-service-worker-client①⑥">(7)</a> <a href="#ref-for-dfn-service-worker-client①⑦">(8)</a> <a href="#ref-for-dfn-service-worker-client①⑧">(9)</a> <a href="#ref-for-dfn-service-worker-client①⑨">(10)</a>
    <li><a href="#ref-for-dfn-service-worker-client②⓪">3.2.8. unregister()</a> <a href="#ref-for-dfn-service-worker-client②①">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-client②②">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dfn-service-worker-client②③">3.5. Events</a> <a href="#ref-for-dfn-service-worker-client②④">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-client②⑤">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dfn-service-worker-client②⑥">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-service-worker-client②⑦">4.2. Client</a>
    <li><a href="#ref-for-dfn-service-worker-client②⑧">4.3.1. get(id)</a>
    <li><a href="#ref-for-dfn-service-worker-client②⑨">4.3.2. matchAll(options)</a> <a href="#ref-for-dfn-service-worker-client③⓪">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-client③①">4.3.4. claim()</a>
    <li><a href="#ref-for-dfn-service-worker-client③②">4.6.2. event.origin</a>
    <li><a href="#ref-for-dfn-service-worker-client③③">6.1. Secure Context</a> <a href="#ref-for-dfn-service-worker-client③④">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-client③⑤">6.3.1. Origin restriction</a>
    <li><a href="#ref-for-dfn-service-worker-client③⑥">Appendix A: Algorithms</a>
    <li><a href="#ref-for-dfn-service-worker-client③⑦">Create Job</a>
    <li><a href="#ref-for-dfn-service-worker-client③⑧">Start Register</a>
    <li><a href="#ref-for-dfn-service-worker-client③⑨">Install</a>
    <li><a href="#ref-for-dfn-service-worker-client④⓪">Activate</a> <a href="#ref-for-dfn-service-worker-client④①">(2)</a>
    <li><a href="#ref-for-dfn-service-worker-client④②">Try Activate</a>
    <li><a href="#ref-for-dfn-service-worker-client④③">Run Service Worker</a>
    <li><a href="#ref-for-dfn-service-worker-client④④">Handle Fetch</a>
    <li><a href="#ref-for-dfn-service-worker-client④⑤">Handle Service Worker Client Unload</a> <a href="#ref-for-dfn-service-worker-client④⑥">(2)</a> <a href="#ref-for-dfn-service-worker-client④⑦">(3)</a>
    <li><a href="#ref-for-dfn-service-worker-client④⑧">Try Clear Registration</a>
    <li><a href="#ref-for-dfn-service-worker-client④⑨">Notify Controller Change</a>
    <li><a href="#ref-for-dfn-service-worker-client⑤⓪">Create Client</a>
    <li><a href="#ref-for-dfn-service-worker-client⑤①">Create Window Client</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-client-origin">
   <b><a href="#service-worker-client-origin">#service-worker-client-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-client-origin">4.3.1. get(id)</a>
    <li><a href="#ref-for-service-worker-client-origin①">4.3.2. matchAll(options)</a>
    <li><a href="#ref-for-service-worker-client-origin②">4.3.4. claim()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-window-client">
   <b><a href="#dfn-window-client">#dfn-window-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-window-client">4.2.3. type</a>
    <li><a href="#ref-for-dfn-window-client①">4.3.1. get(id)</a> <a href="#ref-for-dfn-window-client②">(2)</a>
    <li><a href="#ref-for-dfn-window-client③">4.3.2. matchAll(options)</a> <a href="#ref-for-dfn-window-client④">(2)</a> <a href="#ref-for-dfn-window-client⑤">(3)</a>
    <li><a href="#ref-for-dfn-window-client⑥">Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-dedicatedworker-client">
   <b><a href="#dfn-dedicatedworker-client">#dfn-dedicatedworker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-dedicatedworker-client">2.3. Service Worker Client</a>
    <li><a href="#ref-for-dfn-dedicatedworker-client①">4.2.3. type</a>
    <li><a href="#ref-for-dfn-dedicatedworker-client②">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-sharedworker-client">
   <b><a href="#dfn-sharedworker-client">#dfn-sharedworker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-sharedworker-client">2.3. Service Worker Client</a>
    <li><a href="#ref-for-dfn-sharedworker-client①">4.2.3. type</a>
    <li><a href="#ref-for-dfn-sharedworker-client②">4.3.2. matchAll(options)</a>
    <li><a href="#ref-for-dfn-sharedworker-client③">Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-worker-client">
   <b><a href="#dfn-worker-client">#dfn-worker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-worker-client">2.4. Selection and Use</a>
    <li><a href="#ref-for-dfn-worker-client①">4.3.2. matchAll(options)</a> <a href="#ref-for-dfn-worker-client②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-registration-selection">
   <b><a href="#dfn-service-worker-registration-selection">#dfn-service-worker-registration-selection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-registration-selection">2.4. Selection and Use</a> <a href="#ref-for-dfn-service-worker-registration-selection①">(2)</a> <a href="#ref-for-dfn-service-worker-registration-selection②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-control">
   <b><a href="#dfn-control">#dfn-control</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-control">2.4. Selection and Use</a>
    <li><a href="#ref-for-dfn-control①">3.2.8. unregister()</a>
    <li><a href="#ref-for-dfn-control②">3.5. Events</a>
    <li><a href="#ref-for-dfn-control③">Service Worker Script Response</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-use">
   <b><a href="#dfn-use">#dfn-use</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-use">2.4. Selection and Use</a>
    <li><a href="#ref-for-dfn-use①">3.5. Events</a>
    <li><a href="#ref-for-dfn-use②">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-dfn-use③">Activate</a>
    <li><a href="#ref-for-dfn-use④">Try Activate</a>
    <li><a href="#ref-for-dfn-use⑤">Handle Fetch</a>
    <li><a href="#ref-for-dfn-use⑥">Handle Service Worker Client Unload</a> <a href="#ref-for-dfn-use⑦">(2)</a>
    <li><a href="#ref-for-dfn-use⑧">Unregister</a>
    <li><a href="#ref-for-dfn-use⑨">Try Clear Registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-handle-fetch-task-source">
   <b><a href="#dfn-handle-fetch-task-source">#dfn-handle-fetch-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-handle-fetch-task-source">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-dfn-handle-fetch-task-source①">Terminate Service Worker</a> <a href="#ref-for-dfn-handle-fetch-task-source②">(2)</a>
    <li><a href="#ref-for-dfn-handle-fetch-task-source③">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-handle-functional-event-task-source">
   <b><a href="#dfn-handle-functional-event-task-source">#dfn-handle-functional-event-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-handle-functional-event-task-source">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-dfn-handle-functional-event-task-source①">Terminate Service Worker</a> <a href="#ref-for-dfn-handle-functional-event-task-source②">(2)</a>
    <li><a href="#ref-for-dfn-handle-functional-event-task-source③">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworker">
   <b><a href="#serviceworker">#serviceworker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworker">2.1.1. Lifetime</a>
    <li><a href="#ref-for-serviceworker①">3.1. ServiceWorker</a> <a href="#ref-for-serviceworker②">(2)</a> <a href="#ref-for-serviceworker③">(3)</a> <a href="#ref-for-serviceworker④">(4)</a> <a href="#ref-for-serviceworker⑤">(5)</a> <a href="#ref-for-serviceworker⑥">(6)</a>
    <li><a href="#ref-for-serviceworker⑦">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworker⑧">3.1.4. Event handler</a>
    <li><a href="#ref-for-serviceworker⑨">3.2. ServiceWorkerRegistration</a> <a href="#ref-for-serviceworker①⓪">(2)</a> <a href="#ref-for-serviceworker①①">(3)</a>
    <li><a href="#ref-for-serviceworker①②">3.2.1. installing</a>
    <li><a href="#ref-for-serviceworker①③">3.2.2. waiting</a>
    <li><a href="#ref-for-serviceworker①④">3.2.3. active</a>
    <li><a href="#ref-for-serviceworker①⑤">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-serviceworker①⑥">3.4.1. controller</a> <a href="#ref-for-serviceworker①⑦">(2)</a>
    <li><a href="#ref-for-serviceworker①⑧">3.5. Events</a> <a href="#ref-for-serviceworker①⑨">(2)</a>
    <li><a href="#ref-for-serviceworker②⓪">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-serviceworker②①">4.2.4. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworker②②">4.6. ExtendableMessageEvent</a> <a href="#ref-for-serviceworker②③">(2)</a>
    <li><a href="#ref-for-serviceworker②④">Update Registration State</a> <a href="#ref-for-serviceworker②⑤">(2)</a> <a href="#ref-for-serviceworker②⑥">(3)</a>
    <li><a href="#ref-for-serviceworker②⑦">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-serviceworkerstate">
   <b><a href="#enumdef-serviceworkerstate">#enumdef-serviceworkerstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-serviceworkerstate">3.1. ServiceWorker</a> <a href="#ref-for-enumdef-serviceworkerstate①">(2)</a>
    <li><a href="#ref-for-enumdef-serviceworkerstate②">3.1.2. state</a>
    <li><a href="#ref-for-enumdef-serviceworkerstate③">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerstate-installing">
   <b><a href="#dom-serviceworkerstate-installing">#dom-serviceworkerstate-installing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerstate-installing">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerstate-installed">
   <b><a href="#dom-serviceworkerstate-installed">#dom-serviceworkerstate-installed</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerstate-installed">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerstate-activating">
   <b><a href="#dom-serviceworkerstate-activating">#dom-serviceworkerstate-activating</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerstate-activating">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerstate-activated">
   <b><a href="#dom-serviceworkerstate-activated">#dom-serviceworkerstate-activated</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerstate-activated">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerstate-redundant">
   <b><a href="#dom-serviceworkerstate-redundant">#dom-serviceworkerstate-redundant</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerstate-redundant">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-serviceworkerstate-redundant①">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworker-scripturl">
   <b><a href="#dom-serviceworker-scripturl">#dom-serviceworker-scripturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworker-scripturl">3.1. ServiceWorker</a>
    <li><a href="#ref-for-dom-serviceworker-scripturl①">3.1.1. scriptURL</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworker-state">
   <b><a href="#dom-serviceworker-state">#dom-serviceworker-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworker-state">3.1. ServiceWorker</a>
    <li><a href="#ref-for-dom-serviceworker-state①">3.1.2. state</a>
    <li><a href="#ref-for-dom-serviceworker-state②">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-serviceworker-state③">3.5. Events</a>
    <li><a href="#ref-for-dom-serviceworker-state④">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworker-postmessage">
   <b><a href="#dom-serviceworker-postmessage">#dom-serviceworker-postmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworker-postmessage">3.1. ServiceWorker</a>
    <li><a href="#ref-for-dom-serviceworker-postmessage①">3.1.3. postMessage(message, transfer)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworker-onstatechange">
   <b><a href="#dom-serviceworker-onstatechange">#dom-serviceworker-onstatechange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworker-onstatechange">3.1. ServiceWorker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkerregistration">
   <b><a href="#serviceworkerregistration">#serviceworkerregistration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkerregistration">2.2.1. Lifetime</a>
    <li><a href="#ref-for-serviceworkerregistration①">3.2. ServiceWorkerRegistration</a> <a href="#ref-for-serviceworkerregistration②">(2)</a> <a href="#ref-for-serviceworkerregistration③">(3)</a> <a href="#ref-for-serviceworkerregistration④">(4)</a>
    <li><a href="#ref-for-serviceworkerregistration⑤">3.2.9. Event handler</a>
    <li><a href="#ref-for-serviceworkerregistration⑥">3.4. ServiceWorkerContainer</a> <a href="#ref-for-serviceworkerregistration⑦">(2)</a> <a href="#ref-for-serviceworkerregistration⑧">(3)</a>
    <li><a href="#ref-for-serviceworkerregistration⑨">3.4.2. ready</a>
    <li><a href="#ref-for-serviceworkerregistration①⓪">3.4.4. getRegistration(clientURL)</a>
    <li><a href="#ref-for-serviceworkerregistration①①">3.4.5. getRegistrations()</a>
    <li><a href="#ref-for-serviceworkerregistration①②">3.5. Events</a>
    <li><a href="#ref-for-serviceworkerregistration①③">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-serviceworkerregistration①④">4.1.2. registration</a>
    <li><a href="#ref-for-serviceworkerregistration①⑤">7.1. Define API bound to Service Worker Registration</a>
    <li><a href="#ref-for-serviceworkerregistration①⑥">Resolve Job Promise</a> <a href="#ref-for-serviceworkerregistration①⑦">(2)</a>
    <li><a href="#ref-for-serviceworkerregistration①⑧">Install</a>
    <li><a href="#ref-for-serviceworkerregistration①⑨">Activate</a>
    <li><a href="#ref-for-serviceworkerregistration②⓪">Update Registration State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-serviceworkerupdateviacache">
   <b><a href="#enumdef-serviceworkerupdateviacache">#enumdef-serviceworkerupdateviacache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-serviceworkerupdateviacache">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-enumdef-serviceworkerupdateviacache①">3.4. ServiceWorkerContainer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkerregistration-service-worker-registration">
   <b><a href="#serviceworkerregistration-service-worker-registration">#serviceworkerregistration-service-worker-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration">3.2.4. navigationPreload</a>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration①">3.2.5. scope</a>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration②">3.2.6. updateViaCache</a>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration③">3.2.7. update()</a>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration④">3.2.8. unregister()</a>
    <li><a href="#ref-for-serviceworkerregistration-service-worker-registration⑤">3.5. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-installing">
   <b><a href="#dom-serviceworkerregistration-installing">#dom-serviceworkerregistration-installing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-installing">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-installing①">3.2.1. installing</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-installing②">Update Registration State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-waiting">
   <b><a href="#dom-serviceworkerregistration-waiting">#dom-serviceworkerregistration-waiting</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-waiting">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-waiting①">3.2.2. waiting</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-waiting②">Update Registration State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-active">
   <b><a href="#dom-serviceworkerregistration-active">#dom-serviceworkerregistration-active</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-active">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-active①">3.2.3. active</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-active②">Update Registration State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-navigationpreload">
   <b><a href="#dom-serviceworkerregistration-navigationpreload">#dom-serviceworkerregistration-navigationpreload</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-navigationpreload">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-navigationpreload①">3.2.4. navigationPreload</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-scope">
   <b><a href="#dom-serviceworkerregistration-scope">#dom-serviceworkerregistration-scope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-scope">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-scope①">3.2.5. scope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-updateviacache">
   <b><a href="#dom-serviceworkerregistration-updateviacache">#dom-serviceworkerregistration-updateviacache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-updateviacache">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-updateviacache①">3.2.6. updateViaCache</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-update">
   <b><a href="#dom-serviceworkerregistration-update">#dom-serviceworkerregistration-update</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-update">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-update①">3.2.7. update()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-unregister">
   <b><a href="#dom-serviceworkerregistration-unregister">#dom-serviceworkerregistration-unregister</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-unregister">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-dom-serviceworkerregistration-unregister①">3.2.8. unregister()</a> <a href="#ref-for-dom-serviceworkerregistration-unregister②">(2)</a> <a href="#ref-for-dom-serviceworkerregistration-unregister③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerregistration-onupdatefound">
   <b><a href="#dom-serviceworkerregistration-onupdatefound">#dom-serviceworkerregistration-onupdatefound</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerregistration-onupdatefound">3.2. ServiceWorkerRegistration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigator-service-worker-attribute">
   <b><a href="#navigator-service-worker-attribute">#navigator-service-worker-attribute</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigator-service-worker-attribute">3.3. navigator.serviceWorker</a> <a href="#ref-for-navigator-service-worker-attribute①">(2)</a> <a href="#ref-for-navigator-service-worker-attribute②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkercontainer">
   <b><a href="#serviceworkercontainer">#serviceworkercontainer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkercontainer">3.3. navigator.serviceWorker</a> <a href="#ref-for-serviceworkercontainer①">(2)</a> <a href="#ref-for-serviceworkercontainer②">(3)</a>
    <li><a href="#ref-for-serviceworkercontainer③">3.4. ServiceWorkerContainer</a> <a href="#ref-for-serviceworkercontainer④">(2)</a> <a href="#ref-for-serviceworkercontainer⑤">(3)</a> <a href="#ref-for-serviceworkercontainer⑥">(4)</a> <a href="#ref-for-serviceworkercontainer⑦">(5)</a> <a href="#ref-for-serviceworkercontainer⑧">(6)</a> <a href="#ref-for-serviceworkercontainer⑨">(7)</a> <a href="#ref-for-serviceworkercontainer①⓪">(8)</a> <a href="#ref-for-serviceworkercontainer①①">(9)</a>
    <li><a href="#ref-for-serviceworkercontainer①②">3.4.7. Event handlers</a>
    <li><a href="#ref-for-serviceworkercontainer①③">3.5. Events</a>
    <li><a href="#ref-for-serviceworkercontainer①④">4.2.4. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworkercontainer①⑤">Activate</a>
    <li><a href="#ref-for-serviceworkercontainer①⑥">Notify Controller Change</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-registrationoptions">
   <b><a href="#dictdef-registrationoptions">#dictdef-registrationoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-registrationoptions">3.4. ServiceWorkerContainer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-registrationoptions-scope">
   <b><a href="#dom-registrationoptions-scope">#dom-registrationoptions-scope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-registrationoptions-scope">3.4.3. register(scriptURL, options)</a> <a href="#ref-for-dom-registrationoptions-scope①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-registrationoptions-type">
   <b><a href="#dom-registrationoptions-type">#dom-registrationoptions-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-registrationoptions-type">3.4.3. register(scriptURL, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-registrationoptions-updateviacache">
   <b><a href="#dom-registrationoptions-updateviacache">#dom-registrationoptions-updateviacache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-registrationoptions-updateviacache">3.4.3. register(scriptURL, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkercontainer-service-worker-client">
   <b><a href="#serviceworkercontainer-service-worker-client">#serviceworkercontainer-service-worker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client">3.4.1. controller</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client①">3.4.2. ready</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client②">3.4.3. register(scriptURL, options)</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client③">3.4.4. getRegistration(clientURL)</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client④">3.4.5. getRegistrations()</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client⑤">3.5. Events</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client⑥">4.2.4. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworkercontainer-service-worker-client⑦">Notify Controller Change</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkercontainer-ready-promise">
   <b><a href="#serviceworkercontainer-ready-promise">#serviceworkercontainer-ready-promise</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkercontainer-ready-promise">3.4.2. ready</a> <a href="#ref-for-serviceworkercontainer-ready-promise①">(2)</a>
    <li><a href="#ref-for-serviceworkercontainer-ready-promise②">Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-client-message-queue">
   <b><a href="#dfn-client-message-queue">#dfn-client-message-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-client-message-queue">3.4. ServiceWorkerContainer</a> <a href="#ref-for-dfn-client-message-queue①">(2)</a> <a href="#ref-for-dfn-client-message-queue②">(3)</a>
    <li><a href="#ref-for-dfn-client-message-queue③">3.4.6. startMessages()</a>
    <li><a href="#ref-for-dfn-client-message-queue④">3.4.7. Event handlers</a>
    <li><a href="#ref-for-dfn-client-message-queue⑤">4.2.4. postMessage(message, transfer)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-controller">
   <b><a href="#dom-serviceworkercontainer-controller">#dom-serviceworkercontainer-controller</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-controller">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-controller①">3.4.1. controller</a> <a href="#ref-for-dom-serviceworkercontainer-controller②">(2)</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-controller③">3.5. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-ready">
   <b><a href="#dom-serviceworkercontainer-ready">#dom-serviceworkercontainer-ready</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-ready">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-ready①">3.4.2. ready</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-register">
   <b><a href="#dom-serviceworkercontainer-register">#dom-serviceworkercontainer-register</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-register">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-register①">3.4.3. register(scriptURL, options)</a> <a href="#ref-for-dom-serviceworkercontainer-register②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-getregistration">
   <b><a href="#dom-serviceworkercontainer-getregistration">#dom-serviceworkercontainer-getregistration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-getregistration">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-getregistration①">3.4.4. getRegistration(clientURL)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-getregistrations">
   <b><a href="#dom-serviceworkercontainer-getregistrations">#dom-serviceworkercontainer-getregistrations</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-getregistrations">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-getregistrations①">3.4.5. getRegistrations()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-startmessages">
   <b><a href="#dom-serviceworkercontainer-startmessages">#dom-serviceworkercontainer-startmessages</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-startmessages">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-startmessages①">3.4.6. startMessages()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-oncontrollerchange">
   <b><a href="#dom-serviceworkercontainer-oncontrollerchange">#dom-serviceworkercontainer-oncontrollerchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-oncontrollerchange">3.4. ServiceWorkerContainer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-onmessage">
   <b><a href="#dom-serviceworkercontainer-onmessage">#dom-serviceworkercontainer-onmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-onmessage">3.4. ServiceWorkerContainer</a>
    <li><a href="#ref-for-dom-serviceworkercontainer-onmessage①">3.4.7. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkercontainer-onmessageerror">
   <b><a href="#dom-serviceworkercontainer-onmessageerror">#dom-serviceworkercontainer-onmessageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkercontainer-onmessageerror">3.4. ServiceWorkerContainer</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-serviceworker-statechange">
   <b><a href="#eventdef-serviceworker-statechange">#eventdef-serviceworker-statechange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-serviceworker-statechange">3.1.4. Event handler</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-registration-updatefound-event">
   <b><a href="#service-worker-registration-updatefound-event">#service-worker-registration-updatefound-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-registration-updatefound-event">3.2.9. Event handler</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-container-controllerchange-event">
   <b><a href="#service-worker-container-controllerchange-event">#service-worker-container-controllerchange-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-container-controllerchange-event">3.4.7. Event handlers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigationpreloadmanager">
   <b><a href="#navigationpreloadmanager">#navigationpreloadmanager</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigationpreloadmanager">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-navigationpreloadmanager①">3.2. ServiceWorkerRegistration</a>
    <li><a href="#ref-for-navigationpreloadmanager②">3.2.4. navigationPreload</a>
    <li><a href="#ref-for-navigationpreloadmanager③">3.6. NavigationPreloadManager</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-navigationpreloadstate">
   <b><a href="#dictdef-navigationpreloadstate">#dictdef-navigationpreloadstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-navigationpreloadstate">3.6. NavigationPreloadManager</a>
    <li><a href="#ref-for-dictdef-navigationpreloadstate①">3.6.4. getState()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadstate-enabled">
   <b><a href="#dom-navigationpreloadstate-enabled">#dom-navigationpreloadstate-enabled</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadstate-enabled">3.6.4. getState()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadstate-headervalue">
   <b><a href="#dom-navigationpreloadstate-headervalue">#dom-navigationpreloadstate-headervalue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadstate-headervalue">3.6.4. getState()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadmanager-enable">
   <b><a href="#dom-navigationpreloadmanager-enable">#dom-navigationpreloadmanager-enable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadmanager-enable">3.6. NavigationPreloadManager</a>
    <li><a href="#ref-for-dom-navigationpreloadmanager-enable①">3.6.1. enable()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadmanager-disable">
   <b><a href="#dom-navigationpreloadmanager-disable">#dom-navigationpreloadmanager-disable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadmanager-disable">3.6. NavigationPreloadManager</a>
    <li><a href="#ref-for-dom-navigationpreloadmanager-disable①">3.6.2. disable()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadmanager-setheadervalue">
   <b><a href="#dom-navigationpreloadmanager-setheadervalue">#dom-navigationpreloadmanager-setheadervalue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadmanager-setheadervalue">3.6. NavigationPreloadManager</a>
    <li><a href="#ref-for-dom-navigationpreloadmanager-setheadervalue①">3.6.3. setHeaderValue(value)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationpreloadmanager-getstate">
   <b><a href="#dom-navigationpreloadmanager-getstate">#dom-navigationpreloadmanager-getstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationpreloadmanager-getstate">3.6. NavigationPreloadManager</a>
    <li><a href="#ref-for-dom-navigationpreloadmanager-getstate①">3.6.4. getState()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkerglobalscope">
   <b><a href="#serviceworkerglobalscope">#serviceworkerglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkerglobalscope">2.1. Service Worker</a> <a href="#ref-for-serviceworkerglobalscope①">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope②">3.1.3. postMessage(message, transfer)</a> <a href="#ref-for-serviceworkerglobalscope③">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope④">3.2.7. update()</a>
    <li><a href="#ref-for-serviceworkerglobalscope⑤">4.1. ServiceWorkerGlobalScope</a> <a href="#ref-for-serviceworkerglobalscope⑥">(2)</a> <a href="#ref-for-serviceworkerglobalscope⑦">(3)</a> <a href="#ref-for-serviceworkerglobalscope⑧">(4)</a> <a href="#ref-for-serviceworkerglobalscope⑨">(5)</a>
    <li><a href="#ref-for-serviceworkerglobalscope①⓪">4.1.4. Event handlers</a>
    <li><a href="#ref-for-serviceworkerglobalscope①①">4.3. Clients</a>
    <li><a href="#ref-for-serviceworkerglobalscope①②">4.7. Events</a>
    <li><a href="#ref-for-serviceworkerglobalscope①③">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-serviceworkerglobalscope①④">6.3.2. importScripts(urls)</a> <a href="#ref-for-serviceworkerglobalscope①⑤">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope①⑥">7.3. Define Event Handler</a>
    <li><a href="#ref-for-serviceworkerglobalscope①⑦">7.4. Request Functional Event Dispatch</a>
    <li><a href="#ref-for-serviceworkerglobalscope①⑧">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkerglobalscope-service-worker">
   <b><a href="#serviceworkerglobalscope-service-worker">#serviceworkerglobalscope-service-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①">3.2.7. update()</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker②">4.1.2. registration</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker③">4.1.3. skipWaiting()</a> <a href="#ref-for-serviceworkerglobalscope-service-worker④">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker⑤">4.2.4. postMessage(message, transfer)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker⑥">4.2.9. navigate(url)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker⑦">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker⑧">4.3.1. get(id)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker⑨">4.3.2. matchAll(options)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker①⓪">(2)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①①">4.3.3. openWindow(url)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①②">4.3.4. claim()</a> <a href="#ref-for-serviceworkerglobalscope-service-worker①③">(2)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker①④">(3)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker①⑤">(4)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker①⑥">(5)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①⑦">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①⑧">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker①⑨">4.7. Events</a> <a href="#ref-for-serviceworkerglobalscope-service-worker②⓪">(2)</a> <a href="#ref-for-serviceworkerglobalscope-service-worker②①">(3)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker②②">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-service-worker②③">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">
   <b><a href="#serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">#serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag">6.3.2. importScripts(urls)</a>
    <li><a href="#ref-for-serviceworkerglobalscope-force-bypass-cache-for-importscripts-flag①">Run Service Worker</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-clients">
   <b><a href="#dom-serviceworkerglobalscope-clients">#dom-serviceworkerglobalscope-clients</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-clients">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-clients①">4.1.1. clients</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-registration">
   <b><a href="#dom-serviceworkerglobalscope-registration">#dom-serviceworkerglobalscope-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-registration">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-registration①">4.1.2. registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-skipwaiting">
   <b><a href="#dom-serviceworkerglobalscope-skipwaiting">#dom-serviceworkerglobalscope-skipwaiting</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-skipwaiting">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-skipwaiting①">4.1.3. skipWaiting()</a> <a href="#ref-for-dom-serviceworkerglobalscope-skipwaiting②">(2)</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-skipwaiting③">Install</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-oninstall">
   <b><a href="#dom-serviceworkerglobalscope-oninstall">#dom-serviceworkerglobalscope-oninstall</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-oninstall">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-oninstall①">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-onactivate">
   <b><a href="#dom-serviceworkerglobalscope-onactivate">#dom-serviceworkerglobalscope-onactivate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-onactivate">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-onactivate①">Update Worker State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-onfetch">
   <b><a href="#dom-serviceworkerglobalscope-onfetch">#dom-serviceworkerglobalscope-onfetch</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-onfetch">4.1. ServiceWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-onmessage">
   <b><a href="#dom-serviceworkerglobalscope-onmessage">#dom-serviceworkerglobalscope-onmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-onmessage">4.1. ServiceWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-serviceworkerglobalscope-onmessageerror">
   <b><a href="#dom-serviceworkerglobalscope-onmessageerror">#dom-serviceworkerglobalscope-onmessageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serviceworkerglobalscope-onmessageerror">4.1. ServiceWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="client">
   <b><a href="#client">#client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-client">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-client①">4.2. Client</a> <a href="#ref-for-client②">(2)</a> <a href="#ref-for-client③">(3)</a>
    <li><a href="#ref-for-client④">4.3. Clients</a>
    <li><a href="#ref-for-client⑤">4.3.2. matchAll(options)</a>
    <li><a href="#ref-for-client⑥">4.6. ExtendableMessageEvent</a> <a href="#ref-for-client⑦">(2)</a>
    <li><a href="#ref-for-client⑧">4.6.4. event.source</a>
    <li><a href="#ref-for-client⑨">Create Client</a> <a href="#ref-for-client①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="windowclient">
   <b><a href="#windowclient">#windowclient</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windowclient">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-windowclient①">4.2. Client</a> <a href="#ref-for-windowclient②">(2)</a> <a href="#ref-for-windowclient③">(3)</a> <a href="#ref-for-windowclient④">(4)</a> <a href="#ref-for-windowclient⑤">(5)</a> <a href="#ref-for-windowclient⑥">(6)</a>
    <li><a href="#ref-for-windowclient⑦">4.3. Clients</a>
    <li><a href="#ref-for-windowclient⑧">4.3.2. matchAll(options)</a> <a href="#ref-for-windowclient⑨">(2)</a>
    <li><a href="#ref-for-windowclient①⓪">Create Window Client</a> <a href="#ref-for-windowclient①①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowclient-navigate">
   <b><a href="#dom-windowclient-navigate">#dom-windowclient-navigate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowclient-navigate">4.2.9. navigate(url)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="client-service-worker-client">
   <b><a href="#client-service-worker-client">#client-service-worker-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-client-service-worker-client">4.2. Client</a>
    <li><a href="#ref-for-client-service-worker-client①">4.2.1. url</a>
    <li><a href="#ref-for-client-service-worker-client②">4.2.2. id</a>
    <li><a href="#ref-for-client-service-worker-client③">4.2.3. type</a>
    <li><a href="#ref-for-client-service-worker-client④">4.2.4. postMessage(message, transfer)</a>
    <li><a href="#ref-for-client-service-worker-client⑤">4.2.8. focus()</a> <a href="#ref-for-client-service-worker-client⑥">(2)</a> <a href="#ref-for-client-service-worker-client⑦">(3)</a>
    <li><a href="#ref-for-client-service-worker-client⑧">4.2.9. navigate(url)</a> <a href="#ref-for-client-service-worker-client⑨">(2)</a> <a href="#ref-for-client-service-worker-client①⓪">(3)</a>
    <li><a href="#ref-for-client-service-worker-client①①">4.3.2. matchAll(options)</a> <a href="#ref-for-client-service-worker-client①②">(2)</a> <a href="#ref-for-client-service-worker-client①③">(3)</a>
    <li><a href="#ref-for-client-service-worker-client①④">Create Client</a>
    <li><a href="#ref-for-client-service-worker-client①⑤">Create Window Client</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-client-browsing-context">
   <b><a href="#dfn-service-worker-client-browsing-context">#dfn-service-worker-client-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-client-browsing-context">4.3.2. matchAll(options)</a> <a href="#ref-for-dfn-service-worker-client-browsing-context①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-client-visibilitystate">
   <b><a href="#dfn-service-worker-client-visibilitystate">#dfn-service-worker-client-visibilitystate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-client-visibilitystate">4.2.5. visibilityState</a>
    <li><a href="#ref-for-dfn-service-worker-client-visibilitystate①">Create Window Client</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-service-worker-client-focusstate">
   <b><a href="#dfn-service-worker-client-focusstate">#dfn-service-worker-client-focusstate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-service-worker-client-focusstate">4.2.6. focused</a>
    <li><a href="#ref-for-dfn-service-worker-client-focusstate①">4.2.8. focus()</a>
    <li><a href="#ref-for-dfn-service-worker-client-focusstate②">Create Window Client</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="windowclient-ancestor-origins-array">
   <b><a href="#windowclient-ancestor-origins-array">#windowclient-ancestor-origins-array</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windowclient-ancestor-origins-array">4.2.7. ancestorOrigins</a>
    <li><a href="#ref-for-windowclient-ancestor-origins-array①">Create Window Client</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-client-url">
   <b><a href="#dom-client-url">#dom-client-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-client-url">4.2. Client</a>
    <li><a href="#ref-for-dom-client-url①">4.2.1. url</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-client-id">
   <b><a href="#dom-client-id">#dom-client-id</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-client-id">4.2. Client</a>
    <li><a href="#ref-for-dom-client-id①">4.2.2. id</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-client-type">
   <b><a href="#dom-client-type">#dom-client-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-client-type">4.2. Client</a>
    <li><a href="#ref-for-dom-client-type①">4.2.3. type</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-client-postmessage">
   <b><a href="#dom-client-postmessage">#dom-client-postmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-client-postmessage">4.2. Client</a>
    <li><a href="#ref-for-dom-client-postmessage①">4.2.4. postMessage(message, transfer)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowclient-visibilitystate">
   <b><a href="#dom-windowclient-visibilitystate">#dom-windowclient-visibilitystate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowclient-visibilitystate">4.2. Client</a>
    <li><a href="#ref-for-dom-windowclient-visibilitystate①">4.2.5. visibilityState</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowclient-focused">
   <b><a href="#dom-windowclient-focused">#dom-windowclient-focused</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowclient-focused">4.2. Client</a>
    <li><a href="#ref-for-dom-windowclient-focused①">4.2.6. focused</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowclient-ancestororigins">
   <b><a href="#dom-windowclient-ancestororigins">#dom-windowclient-ancestororigins</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowclient-ancestororigins">4.2. Client</a>
    <li><a href="#ref-for-dom-windowclient-ancestororigins①">4.2.7. ancestorOrigins</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowclient-focus">
   <b><a href="#dom-windowclient-focus">#dom-windowclient-focus</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowclient-focus">4.2. Client</a>
    <li><a href="#ref-for-dom-windowclient-focus①">4.2.8. focus()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="clients">
   <b><a href="#clients">#clients</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-clients">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-clients①">4.1.1. clients</a>
    <li><a href="#ref-for-clients②">4.3. Clients</a> <a href="#ref-for-clients③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-clientqueryoptions">
   <b><a href="#dictdef-clientqueryoptions">#dictdef-clientqueryoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-clientqueryoptions">4.3. Clients</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clientqueryoptions-includeuncontrolled">
   <b><a href="#dom-clientqueryoptions-includeuncontrolled">#dom-clientqueryoptions-includeuncontrolled</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clientqueryoptions-includeuncontrolled">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clientqueryoptions-type">
   <b><a href="#dom-clientqueryoptions-type">#dom-clientqueryoptions-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clientqueryoptions-type">4.3.2. matchAll(options)</a> <a href="#ref-for-dom-clientqueryoptions-type①">(2)</a> <a href="#ref-for-dom-clientqueryoptions-type②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-clienttype">
   <b><a href="#enumdef-clienttype">#enumdef-clienttype</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-clienttype">4.2. Client</a>
    <li><a href="#ref-for-enumdef-clienttype①">4.3. Clients</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clienttype-window">
   <b><a href="#dom-clienttype-window">#dom-clienttype-window</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clienttype-window">4.2.3. type</a> <a href="#ref-for-dom-clienttype-window①">(2)</a>
    <li><a href="#ref-for-dom-clienttype-window②">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clienttype-worker">
   <b><a href="#dom-clienttype-worker">#dom-clienttype-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clienttype-worker">4.2.3. type</a>
    <li><a href="#ref-for-dom-clienttype-worker①">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clienttype-sharedworker">
   <b><a href="#dom-clienttype-sharedworker">#dom-clienttype-sharedworker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clienttype-sharedworker">4.2.3. type</a>
    <li><a href="#ref-for-dom-clienttype-sharedworker①">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clienttype-all">
   <b><a href="#dom-clienttype-all">#dom-clienttype-all</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clienttype-all">4.3.2. matchAll(options)</a> <a href="#ref-for-dom-clienttype-all①">(2)</a> <a href="#ref-for-dom-clienttype-all②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clients-get">
   <b><a href="#dom-clients-get">#dom-clients-get</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clients-get">4.3. Clients</a>
    <li><a href="#ref-for-dom-clients-get①">4.3.1. get(id)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clients-matchall">
   <b><a href="#dom-clients-matchall">#dom-clients-matchall</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clients-matchall">4.3. Clients</a>
    <li><a href="#ref-for-dom-clients-matchall①">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clients-openwindow">
   <b><a href="#dom-clients-openwindow">#dom-clients-openwindow</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clients-openwindow">4.3. Clients</a>
    <li><a href="#ref-for-dom-clients-openwindow①">4.3.3. openWindow(url)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-clients-claim">
   <b><a href="#dom-clients-claim">#dom-clients-claim</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-clients-claim">4.3. Clients</a>
    <li><a href="#ref-for-dom-clients-claim①">4.3.4. claim()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extendableevent">
   <b><a href="#extendableevent">#extendableevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extendableevent">2.1. Service Worker</a>
    <li><a href="#ref-for-extendableevent①">4.4. ExtendableEvent</a> <a href="#ref-for-extendableevent②">(2)</a> <a href="#ref-for-extendableevent③">(3)</a> <a href="#ref-for-extendableevent④">(4)</a> <a href="#ref-for-extendableevent⑤">(5)</a>
    <li><a href="#ref-for-extendableevent⑥">4.5. FetchEvent</a> <a href="#ref-for-extendableevent⑦">(2)</a>
    <li><a href="#ref-for-extendableevent⑧">4.6. ExtendableMessageEvent</a> <a href="#ref-for-extendableevent⑨">(2)</a>
    <li><a href="#ref-for-extendableevent①⓪">4.7. Events</a> <a href="#ref-for-extendableevent①①">(2)</a>
    <li><a href="#ref-for-extendableevent①②">7.2. Define Functional Event</a>
    <li><a href="#ref-for-extendableevent①③">Install</a>
    <li><a href="#ref-for-extendableevent①④">Activate</a>
    <li><a href="#ref-for-extendableevent①⑤">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-extendableeventinit">
   <b><a href="#dictdef-extendableeventinit">#dictdef-extendableeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-extendableeventinit">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dictdef-extendableeventinit①">4.5. FetchEvent</a>
    <li><a href="#ref-for-dictdef-extendableeventinit②">4.6. ExtendableMessageEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extendableevent-extend-lifetime-promises">
   <b><a href="#extendableevent-extend-lifetime-promises">#extendableevent-extend-lifetime-promises</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extendableevent-extend-lifetime-promises">4.4. ExtendableEvent</a> <a href="#ref-for-extendableevent-extend-lifetime-promises②">(2)</a> <a href="#ref-for-extendableevent-extend-lifetime-promises③">(3)</a> <a href="#ref-for-extendableevent-extend-lifetime-promises④">(4)</a> <a href="#ref-for-extendableevent-extend-lifetime-promises⑤">(5)</a>
    <li><a href="#ref-for-extendableevent-extend-lifetime-promises①">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-extendableevent-extend-lifetime-promises⑥">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-extendableevent-extend-lifetime-promises⑦">Install</a> <a href="#ref-for-extendableevent-extend-lifetime-promises⑧">(2)</a>
    <li><a href="#ref-for-extendableevent-extend-lifetime-promises⑨">Unregister</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extendableevent-pending-promises-count">
   <b><a href="#extendableevent-pending-promises-count">#extendableevent-pending-promises-count</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extendableevent-pending-promises-count">4.4.1. event.waitUntil(f)</a> <a href="#ref-for-extendableevent-pending-promises-count①">(2)</a> <a href="#ref-for-extendableevent-pending-promises-count②">(3)</a> <a href="#ref-for-extendableevent-pending-promises-count③">(4)</a> <a href="#ref-for-extendableevent-pending-promises-count④">(5)</a>
    <li><a href="#ref-for-extendableevent-pending-promises-count⑤">4.5.6. event.respondWith(r)</a> <a href="#ref-for-extendableevent-pending-promises-count⑥">(2)</a> <a href="#ref-for-extendableevent-pending-promises-count⑦">(3)</a>
    <li><a href="#ref-for-extendableevent-pending-promises-count⑧">Install</a>
    <li><a href="#ref-for-extendableevent-pending-promises-count⑨">Activate</a>
    <li><a href="#ref-for-extendableevent-pending-promises-count①⓪">Update Service Worker Extended Events Set</a> <a href="#ref-for-extendableevent-pending-promises-count①①">(2)</a>
    <li><a href="#ref-for-extendableevent-pending-promises-count①②">Service Worker Has No Pending Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendableevent-waituntil">
   <b><a href="#dom-extendableevent-waituntil">#dom-extendableevent-waituntil</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendableevent-waituntil">4.4. ExtendableEvent</a>
    <li><a href="#ref-for-dom-extendableevent-waituntil①">4.4.1. event.waitUntil(f)</a> <a href="#ref-for-dom-extendableevent-waituntil②">(2)</a> <a href="#ref-for-dom-extendableevent-waituntil③">(3)</a>
    <li><a href="#ref-for-dom-extendableevent-waituntil④">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-dom-extendableevent-waituntil⑤">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendableevent-waituntil⑥">Update Worker State</a> <a href="#ref-for-dom-extendableevent-waituntil⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetchevent">
   <b><a href="#fetchevent">#fetchevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent">4.5. FetchEvent</a> <a href="#ref-for-fetchevent①">(2)</a> <a href="#ref-for-fetchevent②">(3)</a>
    <li><a href="#ref-for-fetchevent③">4.7. Events</a>
    <li><a href="#ref-for-fetchevent④">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-fetcheventinit">
   <b><a href="#dictdef-fetcheventinit">#dictdef-fetcheventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-fetcheventinit">4.5. FetchEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetchevent-potential-response">
   <b><a href="#fetchevent-potential-response">#fetchevent-potential-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent-potential-response">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-fetchevent-potential-response①">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetchevent-wait-to-respond-flag">
   <b><a href="#fetchevent-wait-to-respond-flag">#fetchevent-wait-to-respond-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent-wait-to-respond-flag">4.5.6. event.respondWith(r)</a> <a href="#ref-for-fetchevent-wait-to-respond-flag①">(2)</a>
    <li><a href="#ref-for-fetchevent-wait-to-respond-flag②">Handle Fetch</a> <a href="#ref-for-fetchevent-wait-to-respond-flag③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetchevent-respond-with-entered-flag">
   <b><a href="#fetchevent-respond-with-entered-flag">#fetchevent-respond-with-entered-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent-respond-with-entered-flag">4.5.6. event.respondWith(r)</a> <a href="#ref-for-fetchevent-respond-with-entered-flag①">(2)</a>
    <li><a href="#ref-for-fetchevent-respond-with-entered-flag②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fetchevent-respond-with-error-flag">
   <b><a href="#fetchevent-respond-with-error-flag">#fetchevent-respond-with-error-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetchevent-respond-with-error-flag">4.5.6. event.respondWith(r)</a> <a href="#ref-for-fetchevent-respond-with-error-flag①">(2)</a> <a href="#ref-for-fetchevent-respond-with-error-flag②">(3)</a> <a href="#ref-for-fetchevent-respond-with-error-flag③">(4)</a>
    <li><a href="#ref-for-fetchevent-respond-with-error-flag④">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-request">
   <b><a href="#dom-fetchevent-request">#dom-fetchevent-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-request">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-request①">4.5.1. event.request</a>
    <li><a href="#ref-for-dom-fetchevent-request②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-preloadresponse">
   <b><a href="#dom-fetchevent-preloadresponse">#dom-fetchevent-preloadresponse</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-preloadresponse">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-preloadresponse①">4.5.2. event.preloadResponse</a>
    <li><a href="#ref-for-dom-fetchevent-preloadresponse②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-clientid">
   <b><a href="#dom-fetchevent-clientid">#dom-fetchevent-clientid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-clientid">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-clientid①">4.5.3. event.clientId</a>
    <li><a href="#ref-for-dom-fetchevent-clientid②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-resultingclientid">
   <b><a href="#dom-fetchevent-resultingclientid">#dom-fetchevent-resultingclientid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-resultingclientid">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-resultingclientid①">4.5.4. event.resultingClientId</a>
    <li><a href="#ref-for-dom-fetchevent-resultingclientid②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-targetclientid">
   <b><a href="#dom-fetchevent-targetclientid">#dom-fetchevent-targetclientid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-targetclientid">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-targetclientid①">4.5.5. event.targetClientId</a>
    <li><a href="#ref-for-dom-fetchevent-targetclientid②">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-fetchevent-respondwith">
   <b><a href="#dom-fetchevent-respondwith">#dom-fetchevent-respondwith</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-fetchevent-respondwith">4.5. FetchEvent</a>
    <li><a href="#ref-for-dom-fetchevent-respondwith①">4.5.6. event.respondWith(r)</a> <a href="#ref-for-dom-fetchevent-respondwith②">(2)</a>
    <li><a href="#ref-for-dom-fetchevent-respondwith③">6.4. Cross-Origin Resources and CORS</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extendablemessageevent">
   <b><a href="#extendablemessageevent">#extendablemessageevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extendablemessageevent">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-extendablemessageevent①">4.6. ExtendableMessageEvent</a> <a href="#ref-for-extendablemessageevent②">(2)</a>
    <li><a href="#ref-for-extendablemessageevent③">4.7. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-extendablemessageeventinit">
   <b><a href="#dictdef-extendablemessageeventinit">#dictdef-extendablemessageeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-extendablemessageeventinit">4.6. ExtendableMessageEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendablemessageevent-data">
   <b><a href="#dom-extendablemessageevent-data">#dom-extendablemessageevent-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendablemessageevent-data">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-extendablemessageevent-data①">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendablemessageevent-data②">4.6.1. event.data</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendablemessageevent-origin">
   <b><a href="#dom-extendablemessageevent-origin">#dom-extendablemessageevent-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendablemessageevent-origin">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-extendablemessageevent-origin①">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendablemessageevent-origin②">4.6.2. event.origin</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendablemessageevent-lasteventid">
   <b><a href="#dom-extendablemessageevent-lasteventid">#dom-extendablemessageevent-lasteventid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendablemessageevent-lasteventid">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendablemessageevent-lasteventid①">4.6.3. event.lastEventId</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendablemessageevent-source">
   <b><a href="#dom-extendablemessageevent-source">#dom-extendablemessageevent-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendablemessageevent-source">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-extendablemessageevent-source①">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendablemessageevent-source②">4.6.4. event.source</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-extendablemessageevent-ports">
   <b><a href="#dom-extendablemessageevent-ports">#dom-extendablemessageevent-ports</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-extendablemessageevent-ports">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-dom-extendablemessageevent-ports①">4.6. ExtendableMessageEvent</a>
    <li><a href="#ref-for-dom-extendablemessageevent-ports②">4.6.5. event.ports</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-global-scope-install-event">
   <b><a href="#service-worker-global-scope-install-event">#service-worker-global-scope-install-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-global-scope-install-event">2.1. Service Worker</a>
    <li><a href="#ref-for-service-worker-global-scope-install-event①">4.1.4. Event handlers</a>
    <li><a href="#ref-for-service-worker-global-scope-install-event②">4.4. ExtendableEvent</a> <a href="#ref-for-service-worker-global-scope-install-event③">(2)</a> <a href="#ref-for-service-worker-global-scope-install-event④">(3)</a>
    <li><a href="#ref-for-service-worker-global-scope-install-event⑤">Install</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-global-scope-activate-event">
   <b><a href="#service-worker-global-scope-activate-event">#service-worker-global-scope-activate-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-global-scope-activate-event">2.1. Service Worker</a>
    <li><a href="#ref-for-service-worker-global-scope-activate-event①">4.1.4. Event handlers</a>
    <li><a href="#ref-for-service-worker-global-scope-activate-event②">4.4. ExtendableEvent</a> <a href="#ref-for-service-worker-global-scope-activate-event③">(2)</a> <a href="#ref-for-service-worker-global-scope-activate-event④">(3)</a>
    <li><a href="#ref-for-service-worker-global-scope-activate-event⑤">Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-global-scope-fetch-event">
   <b><a href="#service-worker-global-scope-fetch-event">#service-worker-global-scope-fetch-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event">2.1. Service Worker</a>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event①">2.5. Task Sources</a>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event②">4.1.4. Event handlers</a>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event③">4.5. FetchEvent</a> <a href="#ref-for-service-worker-global-scope-fetch-event④">(2)</a>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event⑤">6.5. Implementer Concerns</a>
    <li><a href="#ref-for-service-worker-global-scope-fetch-event⑥">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-serviceworkerglobalscope-message">
   <b><a href="#eventdef-serviceworkerglobalscope-message">#eventdef-serviceworkerglobalscope-message</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-message">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-message①">3.4.7. Event handlers</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-message②">4.1.4. Event handlers</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-message③">4.6. ExtendableMessageEvent</a> <a href="#ref-for-eventdef-serviceworkerglobalscope-message④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-serviceworkerglobalscope-messageerror">
   <b><a href="#eventdef-serviceworkerglobalscope-messageerror">#eventdef-serviceworkerglobalscope-messageerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-messageerror">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-messageerror①">3.4.7. Event handlers</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-messageerror②">4.1.4. Event handlers</a>
    <li><a href="#ref-for-eventdef-serviceworkerglobalscope-messageerror③">4.2.4. postMessage(message, transfer)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-request-response-list">
   <b><a href="#dfn-request-response-list">#dfn-request-response-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-request-response-list">5.1. Constructs</a> <a href="#ref-for-dfn-request-response-list①">(2)</a>
    <li><a href="#ref-for-dfn-request-response-list②">5.4. Cache</a> <a href="#ref-for-dfn-request-response-list③">(2)</a>
    <li><a href="#ref-for-dfn-request-response-list④">5.5.3. open(cacheName)</a>
    <li><a href="#ref-for-dfn-request-response-list⑤">6.6. Privacy</a>
    <li><a href="#ref-for-dfn-request-response-list⑥">Query Cache</a> <a href="#ref-for-dfn-request-response-list⑦">(2)</a>
    <li><a href="#ref-for-dfn-request-response-list⑧">Batch Cache Operations</a> <a href="#ref-for-dfn-request-response-list⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-relevant-request-response-list">
   <b><a href="#dfn-relevant-request-response-list">#dfn-relevant-request-response-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-relevant-request-response-list">5.4.2. matchAll(request, options)</a>
    <li><a href="#ref-for-dfn-relevant-request-response-list①">5.4.7. keys(request, options)</a>
    <li><a href="#ref-for-dfn-relevant-request-response-list②">Query Cache</a>
    <li><a href="#ref-for-dfn-relevant-request-response-list③">Batch Cache Operations</a> <a href="#ref-for-dfn-relevant-request-response-list④">(2)</a> <a href="#ref-for-dfn-relevant-request-response-list⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-name-to-cache-map">
   <b><a href="#dfn-name-to-cache-map">#dfn-name-to-cache-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-name-to-cache-map">5.1. Constructs</a>
    <li><a href="#ref-for-dfn-name-to-cache-map①">5.5. CacheStorage</a> <a href="#ref-for-dfn-name-to-cache-map②">(2)</a>
    <li><a href="#ref-for-dfn-name-to-cache-map③">5.5.5. keys()</a>
    <li><a href="#ref-for-dfn-name-to-cache-map④">6.6. Privacy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-relevant-name-to-cache-map">
   <b><a href="#dfn-relevant-name-to-cache-map">#dfn-relevant-name-to-cache-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-relevant-name-to-cache-map">5.5.1. match(request, options)</a> <a href="#ref-for-dfn-relevant-name-to-cache-map①">(2)</a>
    <li><a href="#ref-for-dfn-relevant-name-to-cache-map②">5.5.2. has(cacheName)</a>
    <li><a href="#ref-for-dfn-relevant-name-to-cache-map③">5.5.3. open(cacheName)</a> <a href="#ref-for-dfn-relevant-name-to-cache-map④">(2)</a>
    <li><a href="#ref-for-dfn-relevant-name-to-cache-map⑤">5.5.4. delete(cacheName)</a>
    <li><a href="#ref-for-dfn-relevant-name-to-cache-map⑥">5.5.5. keys()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="global-caches-attribute">
   <b><a href="#global-caches-attribute">#global-caches-attribute</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-global-caches-attribute">5.3. self.caches</a> <a href="#ref-for-global-caches-attribute①">(2)</a>
    <li><a href="#ref-for-global-caches-attribute②">5.3.1. caches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cache">
   <b><a href="#cache">#cache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cache">4.7. Events</a>
    <li><a href="#ref-for-cache①">5. Caches</a> <a href="#ref-for-cache②">(2)</a>
    <li><a href="#ref-for-cache③">5.2. Understanding Cache Lifetimes</a> <a href="#ref-for-cache④">(2)</a> <a href="#ref-for-cache⑤">(3)</a> <a href="#ref-for-cache⑥">(4)</a> <a href="#ref-for-cache⑦">(5)</a>
    <li><a href="#ref-for-cache⑧">5.4. Cache</a> <a href="#ref-for-cache⑨">(2)</a> <a href="#ref-for-cache①⓪">(3)</a>
    <li><a href="#ref-for-cache①①">5.5. CacheStorage</a>
    <li><a href="#ref-for-cache①②">5.5.1. match(request, options)</a> <a href="#ref-for-cache①③">(2)</a>
    <li><a href="#ref-for-cache①④">5.5.3. open(cacheName)</a> <a href="#ref-for-cache①⑤">(2)</a>
    <li><a href="#ref-for-cache①⑥">6.4. Cross-Origin Resources and CORS</a> <a href="#ref-for-cache①⑦">(2)</a> <a href="#ref-for-cache①⑧">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-cachequeryoptions">
   <b><a href="#dictdef-cachequeryoptions">#dictdef-cachequeryoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-cachequeryoptions">5.4. Cache</a> <a href="#ref-for-dictdef-cachequeryoptions①">(2)</a> <a href="#ref-for-dictdef-cachequeryoptions②">(3)</a> <a href="#ref-for-dictdef-cachequeryoptions③">(4)</a> <a href="#ref-for-dictdef-cachequeryoptions④">(5)</a>
    <li><a href="#ref-for-dictdef-cachequeryoptions⑤">5.5. CacheStorage</a>
    <li><a href="#ref-for-dictdef-cachequeryoptions⑥">Query Cache</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachequeryoptions-ignoresearch">
   <b><a href="#dom-cachequeryoptions-ignoresearch">#dom-cachequeryoptions-ignoresearch</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachequeryoptions-ignoresearch">Query Cache</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachequeryoptions-ignoremethod">
   <b><a href="#dom-cachequeryoptions-ignoremethod">#dom-cachequeryoptions-ignoremethod</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachequeryoptions-ignoremethod">Query Cache</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachequeryoptions-ignorevary">
   <b><a href="#dom-cachequeryoptions-ignorevary">#dom-cachequeryoptions-ignorevary</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachequeryoptions-ignorevary">Query Cache</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachequeryoptions-cachename">
   <b><a href="#dom-cachequeryoptions-cachename">#dom-cachequeryoptions-cachename</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachequeryoptions-cachename">5.5.1. match(request, options)</a> <a href="#ref-for-dom-cachequeryoptions-cachename①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-cache-batch-operation">
   <b><a href="#dfn-cache-batch-operation">#dfn-cache-batch-operation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-cache-batch-operation">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation①">5.4.5. put(request, response)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation②">5.4.6. delete(request, options)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation③">Batch Cache Operations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-cache-batch-operation-type">
   <b><a href="#dfn-cache-batch-operation-type">#dfn-cache-batch-operation-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-cache-batch-operation-type">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-type①">5.4.5. put(request, response)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-type②">5.4.6. delete(request, options)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-type③">Batch Cache Operations</a> <a href="#ref-for-dfn-cache-batch-operation-type④">(2)</a> <a href="#ref-for-dfn-cache-batch-operation-type⑤">(3)</a> <a href="#ref-for-dfn-cache-batch-operation-type⑥">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-cache-batch-operation-request">
   <b><a href="#dfn-cache-batch-operation-request">#dfn-cache-batch-operation-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-cache-batch-operation-request">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-request①">5.4.5. put(request, response)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-request②">5.4.6. delete(request, options)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-request③">Batch Cache Operations</a> <a href="#ref-for-dfn-cache-batch-operation-request④">(2)</a> <a href="#ref-for-dfn-cache-batch-operation-request⑤">(3)</a> <a href="#ref-for-dfn-cache-batch-operation-request⑥">(4)</a> <a href="#ref-for-dfn-cache-batch-operation-request⑦">(5)</a> <a href="#ref-for-dfn-cache-batch-operation-request⑧">(6)</a> <a href="#ref-for-dfn-cache-batch-operation-request⑨">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-cache-batch-operation-response">
   <b><a href="#dfn-cache-batch-operation-response">#dfn-cache-batch-operation-response</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-cache-batch-operation-response">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-response①">5.4.5. put(request, response)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-response②">Batch Cache Operations</a> <a href="#ref-for-dfn-cache-batch-operation-response③">(2)</a> <a href="#ref-for-dfn-cache-batch-operation-response④">(3)</a> <a href="#ref-for-dfn-cache-batch-operation-response⑤">(4)</a> <a href="#ref-for-dfn-cache-batch-operation-response⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-cache-batch-operation-options">
   <b><a href="#dfn-cache-batch-operation-options">#dfn-cache-batch-operation-options</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-cache-batch-operation-options">5.4.6. delete(request, options)</a>
    <li><a href="#ref-for-dfn-cache-batch-operation-options①">Batch Cache Operations</a> <a href="#ref-for-dfn-cache-batch-operation-options②">(2)</a> <a href="#ref-for-dfn-cache-batch-operation-options③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-match">
   <b><a href="#dom-cache-match">#dom-cache-match</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-match">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-match①">5.4.1. match(request, options)</a>
    <li><a href="#ref-for-dom-cache-match②">5.5.1. match(request, options)</a> <a href="#ref-for-dom-cache-match③">(2)</a> <a href="#ref-for-dom-cache-match④">(3)</a> <a href="#ref-for-dom-cache-match⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-matchall">
   <b><a href="#dom-cache-matchall">#dom-cache-matchall</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-matchall">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-matchall①">5.4.1. match(request, options)</a>
    <li><a href="#ref-for-dom-cache-matchall②">5.4.2. matchAll(request, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-add">
   <b><a href="#dom-cache-add">#dom-cache-add</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-add">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-add①">5.4.3. add(request)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-addall">
   <b><a href="#dom-cache-addall">#dom-cache-addall</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-addall">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-addall①">5.4.3. add(request)</a>
    <li><a href="#ref-for-dom-cache-addall②">5.4.4. addAll(requests)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-put">
   <b><a href="#dom-cache-put">#dom-cache-put</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-put">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-put①">5.4.5. put(request, response)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-delete">
   <b><a href="#dom-cache-delete">#dom-cache-delete</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-delete">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-delete①">5.4.6. delete(request, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cache-keys">
   <b><a href="#dom-cache-keys">#dom-cache-keys</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cache-keys">5.4. Cache</a>
    <li><a href="#ref-for-dom-cache-keys①">5.4.7. keys(request, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cachestorage">
   <b><a href="#cachestorage">#cachestorage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cachestorage">5.3. self.caches</a>
    <li><a href="#ref-for-cachestorage①">5.3.1. caches</a>
    <li><a href="#ref-for-cachestorage②">5.5. CacheStorage</a> <a href="#ref-for-cachestorage③">(2)</a> <a href="#ref-for-cachestorage④">(3)</a> <a href="#ref-for-cachestorage⑤">(4)</a> <a href="#ref-for-cachestorage⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="cachestorage-global-object">
   <b><a href="#cachestorage-global-object">#cachestorage-global-object</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cachestorage-global-object">5.1. Constructs</a>
    <li><a href="#ref-for-cachestorage-global-object①">5.5. CacheStorage</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachestorage-match">
   <b><a href="#dom-cachestorage-match">#dom-cachestorage-match</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachestorage-match">5.5. CacheStorage</a>
    <li><a href="#ref-for-dom-cachestorage-match①">5.5.1. match(request, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachestorage-has">
   <b><a href="#dom-cachestorage-has">#dom-cachestorage-has</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachestorage-has">5.5. CacheStorage</a>
    <li><a href="#ref-for-dom-cachestorage-has①">5.5.2. has(cacheName)</a>
    <li><a href="#ref-for-dom-cachestorage-has②">5.5.4. delete(cacheName)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachestorage-open">
   <b><a href="#dom-cachestorage-open">#dom-cachestorage-open</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachestorage-open">5.5. CacheStorage</a>
    <li><a href="#ref-for-dom-cachestorage-open①">5.5.3. open(cacheName)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachestorage-delete">
   <b><a href="#dom-cachestorage-delete">#dom-cachestorage-delete</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachestorage-delete">5.5. CacheStorage</a>
    <li><a href="#ref-for-dom-cachestorage-delete①">5.5.4. delete(cacheName)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-cachestorage-keys">
   <b><a href="#dom-cachestorage-keys">#dom-cachestorage-keys</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-cachestorage-keys">5.5. CacheStorage</a>
    <li><a href="#ref-for-dom-cachestorage-keys①">5.5.5. keys()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="importscripts-method">
   <b><a href="#importscripts-method">#importscripts-method</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-importscripts-method">6.3.1. Origin restriction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-scope-to-registration-map">
   <b><a href="#dfn-scope-to-registration-map">#dfn-scope-to-registration-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-scope-to-registration-map">2.2.1. Lifetime</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map①">2.4. Selection and Use</a> <a href="#ref-for-dfn-scope-to-registration-map②">(2)</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map③">3.4.5. getRegistrations()</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map④">6.6. Privacy</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map⑤">Handle Functional Event</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map⑥">Handle User Agent Shutdown</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map⑦">Set Registration</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map⑧">Clear Registration</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map⑨">Match Service Worker Registration</a>
    <li><a href="#ref-for-dfn-scope-to-registration-map①⓪">Get Registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job">
   <b><a href="#dfn-job">#dfn-job</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job">Appendix A: Algorithms</a> <a href="#ref-for-dfn-job①">(2)</a> <a href="#ref-for-dfn-job②">(3)</a> <a href="#ref-for-dfn-job③">(4)</a> <a href="#ref-for-dfn-job④">(5)</a> <a href="#ref-for-dfn-job⑤">(6)</a> <a href="#ref-for-dfn-job⑥">(7)</a> <a href="#ref-for-dfn-job⑦">(8)</a> <a href="#ref-for-dfn-job⑧">(9)</a> <a href="#ref-for-dfn-job⑨">(10)</a> <a href="#ref-for-dfn-job①⓪">(11)</a> <a href="#ref-for-dfn-job①①">(12)</a> <a href="#ref-for-dfn-job①②">(13)</a> <a href="#ref-for-dfn-job①③">(14)</a> <a href="#ref-for-dfn-job①④">(15)</a> <a href="#ref-for-dfn-job①⑤">(16)</a> <a href="#ref-for-dfn-job①⑥">(17)</a>
    <li><a href="#ref-for-dfn-job①⑦">Create Job</a> <a href="#ref-for-dfn-job①⑧">(2)</a>
    <li><a href="#ref-for-dfn-job①⑨">Schedule Job</a>
    <li><a href="#ref-for-dfn-job②⓪">Finish Job</a>
    <li><a href="#ref-for-dfn-job②①">Resolve Job Promise</a>
    <li><a href="#ref-for-dfn-job②②">Reject Job Promise</a>
    <li><a href="#ref-for-dfn-job②③">Register</a>
    <li><a href="#ref-for-dfn-job②④">Update</a>
    <li><a href="#ref-for-dfn-job②⑤">Install</a>
    <li><a href="#ref-for-dfn-job②⑥">Unregister</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-type">
   <b><a href="#dfn-job-type">#dfn-job-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-type">Appendix A: Algorithms</a>
    <li><a href="#ref-for-dfn-job-type①">Create Job</a> <a href="#ref-for-dfn-job-type②">(2)</a>
    <li><a href="#ref-for-dfn-job-type③">Run Job</a> <a href="#ref-for-dfn-job-type④">(2)</a> <a href="#ref-for-dfn-job-type⑤">(3)</a>
    <li><a href="#ref-for-dfn-job-type⑥">Resolve Job Promise</a> <a href="#ref-for-dfn-job-type⑦">(2)</a>
    <li><a href="#ref-for-dfn-job-type⑧">Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-scope-url">
   <b><a href="#dfn-job-scope-url">#dfn-job-scope-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-scope-url">Appendix A: Algorithms</a> <a href="#ref-for-dfn-job-scope-url①">(2)</a>
    <li><a href="#ref-for-dfn-job-scope-url②">Create Job</a>
    <li><a href="#ref-for-dfn-job-scope-url③">Schedule Job</a>
    <li><a href="#ref-for-dfn-job-scope-url④">Register</a> <a href="#ref-for-dfn-job-scope-url⑤">(2)</a> <a href="#ref-for-dfn-job-scope-url⑥">(3)</a>
    <li><a href="#ref-for-dfn-job-scope-url⑦">Update</a>
    <li><a href="#ref-for-dfn-job-scope-url⑧">Unregister</a> <a href="#ref-for-dfn-job-scope-url⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-script-url">
   <b><a href="#dfn-job-script-url">#dfn-job-script-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-script-url">Appendix A: Algorithms</a>
    <li><a href="#ref-for-dfn-job-script-url①">Create Job</a>
    <li><a href="#ref-for-dfn-job-script-url②">Register</a> <a href="#ref-for-dfn-job-script-url③">(2)</a> <a href="#ref-for-dfn-job-script-url④">(3)</a>
    <li><a href="#ref-for-dfn-job-script-url⑤">Update</a> <a href="#ref-for-dfn-job-script-url⑥">(2)</a> <a href="#ref-for-dfn-job-script-url⑦">(3)</a> <a href="#ref-for-dfn-job-script-url⑧">(4)</a> <a href="#ref-for-dfn-job-script-url⑨">(5)</a> <a href="#ref-for-dfn-job-script-url①⓪">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-worker-type">
   <b><a href="#dfn-job-worker-type">#dfn-job-worker-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-worker-type">3.2.7. update()</a>
    <li><a href="#ref-for-dfn-job-worker-type①">Start Register</a> <a href="#ref-for-dfn-job-worker-type②">(2)</a>
    <li><a href="#ref-for-dfn-job-worker-type③">Update</a> <a href="#ref-for-dfn-job-worker-type④">(2)</a>
    <li><a href="#ref-for-dfn-job-worker-type⑤">Soft Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-update-via-cache-mode">
   <b><a href="#dfn-job-update-via-cache-mode">#dfn-job-update-via-cache-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-update-via-cache-mode">Start Register</a>
    <li><a href="#ref-for-dfn-job-update-via-cache-mode①">Register</a> <a href="#ref-for-dfn-job-update-via-cache-mode②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-client">
   <b><a href="#dfn-job-client">#dfn-job-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-client">Create Job</a>
    <li><a href="#ref-for-dfn-job-client①">Resolve Job Promise</a> <a href="#ref-for-dfn-job-client②">(2)</a> <a href="#ref-for-dfn-job-client③">(3)</a> <a href="#ref-for-dfn-job-client④">(4)</a> <a href="#ref-for-dfn-job-client⑤">(5)</a> <a href="#ref-for-dfn-job-client⑥">(6)</a> <a href="#ref-for-dfn-job-client⑦">(7)</a> <a href="#ref-for-dfn-job-client⑧">(8)</a>
    <li><a href="#ref-for-dfn-job-client⑨">Reject Job Promise</a> <a href="#ref-for-dfn-job-client①⓪">(2)</a> <a href="#ref-for-dfn-job-client①①">(3)</a> <a href="#ref-for-dfn-job-client①②">(4)</a> <a href="#ref-for-dfn-job-client①③">(5)</a> <a href="#ref-for-dfn-job-client①④">(6)</a>
    <li><a href="#ref-for-dfn-job-client①⑤">Update</a> <a href="#ref-for-dfn-job-client①⑥">(2)</a> <a href="#ref-for-dfn-job-client①⑦">(3)</a>
    <li><a href="#ref-for-dfn-job-client①⑧">Unregister</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="job-referrer">
   <b><a href="#job-referrer">#job-referrer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-job-referrer">Create Job</a>
    <li><a href="#ref-for-job-referrer①">Start Register</a>
    <li><a href="#ref-for-job-referrer②">Register</a> <a href="#ref-for-job-referrer③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-promise">
   <b><a href="#dfn-job-promise">#dfn-job-promise</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-promise">Create Job</a>
    <li><a href="#ref-for-dfn-job-promise①">Schedule Job</a>
    <li><a href="#ref-for-dfn-job-promise②">Resolve Job Promise</a> <a href="#ref-for-dfn-job-promise③">(2)</a>
    <li><a href="#ref-for-dfn-job-promise④">Reject Job Promise</a> <a href="#ref-for-dfn-job-promise⑤">(2)</a>
    <li><a href="#ref-for-dfn-job-promise⑥">Install</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-containing-job-queue">
   <b><a href="#dfn-containing-job-queue">#dfn-containing-job-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-containing-job-queue">Schedule Job</a> <a href="#ref-for-dfn-containing-job-queue①">(2)</a>
    <li><a href="#ref-for-dfn-containing-job-queue②">Finish Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-list-of-equivalent-jobs">
   <b><a href="#dfn-job-list-of-equivalent-jobs">#dfn-job-list-of-equivalent-jobs</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-list-of-equivalent-jobs">Schedule Job</a>
    <li><a href="#ref-for-dfn-job-list-of-equivalent-jobs①">Resolve Job Promise</a>
    <li><a href="#ref-for-dfn-job-list-of-equivalent-jobs②">Reject Job Promise</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-force-bypass-cache-flag">
   <b><a href="#dfn-job-force-bypass-cache-flag">#dfn-job-force-bypass-cache-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-force-bypass-cache-flag">Update</a> <a href="#ref-for-dfn-job-force-bypass-cache-flag①">(2)</a> <a href="#ref-for-dfn-job-force-bypass-cache-flag②">(3)</a>
    <li><a href="#ref-for-dfn-job-force-bypass-cache-flag③">Soft Update</a>
    <li><a href="#ref-for-dfn-job-force-bypass-cache-flag④">Install</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-equivalent">
   <b><a href="#dfn-job-equivalent">#dfn-job-equivalent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-equivalent">Schedule Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-job-queue">
   <b><a href="#dfn-job-queue">#dfn-job-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-job-queue">Appendix A: Algorithms</a> <a href="#ref-for-dfn-job-queue①">(2)</a> <a href="#ref-for-dfn-job-queue②">(3)</a> <a href="#ref-for-dfn-job-queue③">(4)</a>
    <li><a href="#ref-for-dfn-job-queue④">Schedule Job</a>
    <li><a href="#ref-for-dfn-job-queue⑤">Run Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dfn-scope-to-job-queue-map">
   <b><a href="#dfn-scope-to-job-queue-map">#dfn-scope-to-job-queue-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-scope-to-job-queue-map">Schedule Job</a> <a href="#ref-for-dfn-scope-to-job-queue-map①">(2)</a> <a href="#ref-for-dfn-scope-to-job-queue-map②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-job">
   <b><a href="#create-job">#create-job</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-job">3.2.7. update()</a>
    <li><a href="#ref-for-create-job①">3.2.8. unregister()</a>
    <li><a href="#ref-for-create-job②">Start Register</a>
    <li><a href="#ref-for-create-job③">Soft Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="schedule-job">
   <b><a href="#schedule-job">#schedule-job</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-schedule-job">3.2.7. update()</a>
    <li><a href="#ref-for-schedule-job①">3.2.8. unregister()</a>
    <li><a href="#ref-for-schedule-job②">Start Register</a>
    <li><a href="#ref-for-schedule-job③">Soft Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="run-job">
   <b><a href="#run-job">#run-job</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-run-job">Schedule Job</a>
    <li><a href="#ref-for-run-job①">Finish Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="finish-job">
   <b><a href="#finish-job">#finish-job</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-finish-job">Register</a> <a href="#ref-for-finish-job①">(2)</a> <a href="#ref-for-finish-job②">(3)</a> <a href="#ref-for-finish-job③">(4)</a>
    <li><a href="#ref-for-finish-job④">Update</a> <a href="#ref-for-finish-job⑤">(2)</a> <a href="#ref-for-finish-job⑥">(3)</a> <a href="#ref-for-finish-job⑦">(4)</a> <a href="#ref-for-finish-job⑧">(5)</a>
    <li><a href="#ref-for-finish-job⑨">Install</a> <a href="#ref-for-finish-job①⓪">(2)</a>
    <li><a href="#ref-for-finish-job①①">Unregister</a> <a href="#ref-for-finish-job①②">(2)</a> <a href="#ref-for-finish-job①③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="resolve-job-promise">
   <b><a href="#resolve-job-promise">#resolve-job-promise</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-resolve-job-promise">Register</a>
    <li><a href="#ref-for-resolve-job-promise①">Update</a>
    <li><a href="#ref-for-resolve-job-promise②">Install</a>
    <li><a href="#ref-for-resolve-job-promise③">Unregister</a> <a href="#ref-for-resolve-job-promise④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="reject-job-promise">
   <b><a href="#reject-job-promise">#reject-job-promise</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reject-job-promise">Register</a> <a href="#ref-for-reject-job-promise①">(2)</a> <a href="#ref-for-reject-job-promise②">(3)</a>
    <li><a href="#ref-for-reject-job-promise③">Update</a> <a href="#ref-for-reject-job-promise④">(2)</a> <a href="#ref-for-reject-job-promise⑤">(3)</a> <a href="#ref-for-reject-job-promise⑥">(4)</a> <a href="#ref-for-reject-job-promise⑦">(5)</a> <a href="#ref-for-reject-job-promise⑧">(6)</a> <a href="#ref-for-reject-job-promise⑨">(7)</a>
    <li><a href="#ref-for-reject-job-promise①⓪">Unregister</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="start-register">
   <b><a href="#start-register">#start-register</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-start-register">3.4.3. register(scriptURL, options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="register">
   <b><a href="#register">#register</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-register">2.2.1. Lifetime</a>
    <li><a href="#ref-for-register①">4.1. ServiceWorkerGlobalScope</a>
    <li><a href="#ref-for-register②">Run Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="update">
   <b><a href="#update">#update</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-update">Run Job</a>
    <li><a href="#ref-for-update①">Register</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="soft-update">
   <b><a href="#soft-update">#soft-update</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-soft-update">Handle Fetch</a> <a href="#ref-for-soft-update①">(2)</a> <a href="#ref-for-soft-update②">(3)</a> <a href="#ref-for-soft-update③">(4)</a>
    <li><a href="#ref-for-soft-update④">Handle Functional Event</a> <a href="#ref-for-soft-update⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="install">
   <b><a href="#install">#install</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-install">3.5. Events</a>
    <li><a href="#ref-for-install①">4.7. Events</a>
    <li><a href="#ref-for-install②">Update</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="activate">
   <b><a href="#activate">#activate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-activate">3.5. Events</a> <a href="#ref-for-activate①">(2)</a>
    <li><a href="#ref-for-activate②">4.7. Events</a>
    <li><a href="#ref-for-activate③">Install</a> <a href="#ref-for-activate④">(2)</a>
    <li><a href="#ref-for-activate⑤">Try Activate</a>
    <li><a href="#ref-for-activate⑥">Handle User Agent Shutdown</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="try-activate">
   <b><a href="#try-activate">#try-activate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-try-activate">4.1.3. skipWaiting()</a>
    <li><a href="#ref-for-try-activate①">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-try-activate②">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-try-activate③">Install</a> <a href="#ref-for-try-activate④">(2)</a>
    <li><a href="#ref-for-try-activate⑤">Handle Service Worker Client Unload</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="run-service-worker">
   <b><a href="#run-service-worker">#run-service-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-run-service-worker">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-run-service-worker①">6.2. Content Security Policy</a>
    <li><a href="#ref-for-run-service-worker②">Update</a>
    <li><a href="#ref-for-run-service-worker③">Install</a>
    <li><a href="#ref-for-run-service-worker④">Activate</a>
    <li><a href="#ref-for-run-service-worker⑤">Handle Fetch</a>
    <li><a href="#ref-for-run-service-worker⑥">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="terminate-service-worker">
   <b><a href="#terminate-service-worker">#terminate-service-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-terminate-service-worker">2.1.1. Lifetime</a>
    <li><a href="#ref-for-terminate-service-worker①">2.2. Service Worker Registration</a>
    <li><a href="#ref-for-terminate-service-worker②">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-terminate-service-worker③">Install</a> <a href="#ref-for-terminate-service-worker④">(2)</a>
    <li><a href="#ref-for-terminate-service-worker⑤">Activate</a> <a href="#ref-for-terminate-service-worker⑥">(2)</a>
    <li><a href="#ref-for-terminate-service-worker⑦">Run Service Worker</a>
    <li><a href="#ref-for-terminate-service-worker⑧">Handle Fetch</a>
    <li><a href="#ref-for-terminate-service-worker⑨">Handle Service Worker Client Unload</a>
    <li><a href="#ref-for-terminate-service-worker①⓪">Clear Registration</a> <a href="#ref-for-terminate-service-worker①①">(2)</a> <a href="#ref-for-terminate-service-worker①②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-fetch">
   <b><a href="#handle-fetch">#handle-fetch</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-fetch">3.4.3. register(scriptURL, options)</a>
    <li><a href="#ref-for-handle-fetch①">4.5.6. event.respondWith(r)</a> <a href="#ref-for-handle-fetch②">(2)</a>
    <li><a href="#ref-for-handle-fetch③">4.7. Events</a> <a href="#ref-for-handle-fetch④">(2)</a>
    <li><a href="#ref-for-handle-fetch⑤">6.5. Implementer Concerns</a>
    <li><a href="#ref-for-handle-fetch⑥">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-functional-event">
   <b><a href="#handle-functional-event">#handle-functional-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-functional-event">7.4. Request Functional Event Dispatch</a> <a href="#ref-for-handle-functional-event①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-service-worker-client-unload">
   <b><a href="#handle-service-worker-client-unload">#handle-service-worker-client-unload</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-service-worker-client-unload">4.3.4. claim()</a>
    <li><a href="#ref-for-handle-service-worker-client-unload①">Install</a>
    <li><a href="#ref-for-handle-service-worker-client-unload②">Unregister</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-user-agent-shutdown">
   <b><a href="#handle-user-agent-shutdown">#handle-user-agent-shutdown</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-user-agent-shutdown">2.6. User Agent Shutdown</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="update-service-worker-extended-events-set">
   <b><a href="#update-service-worker-extended-events-set">#update-service-worker-extended-events-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-update-service-worker-extended-events-set">3.1.3. postMessage(message, transfer)</a>
    <li><a href="#ref-for-update-service-worker-extended-events-set①">Handle Fetch</a>
    <li><a href="#ref-for-update-service-worker-extended-events-set②">Handle Functional Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="unregister">
   <b><a href="#unregister">#unregister</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-unregister">2.2.1. Lifetime</a>
    <li><a href="#ref-for-unregister①">Run Job</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-registration">
   <b><a href="#set-registration">#set-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-registration">Register</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="clear-registration">
   <b><a href="#clear-registration">#clear-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-clear-registration">Update</a> <a href="#ref-for-clear-registration①">(2)</a>
    <li><a href="#ref-for-clear-registration②">Install</a>
    <li><a href="#ref-for-clear-registration③">Handle User Agent Shutdown</a>
    <li><a href="#ref-for-clear-registration④">Unregister</a> <a href="#ref-for-clear-registration⑤">(2)</a>
    <li><a href="#ref-for-clear-registration⑥">Try Clear Registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="try-clear-registration">
   <b><a href="#try-clear-registration">#try-clear-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-try-clear-registration">4.4.1. event.waitUntil(f)</a>
    <li><a href="#ref-for-try-clear-registration①">4.5.6. event.respondWith(r)</a>
    <li><a href="#ref-for-try-clear-registration②">Handle Service Worker Client Unload</a>
    <li><a href="#ref-for-try-clear-registration③">Unregister</a> <a href="#ref-for-try-clear-registration④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="update-registration-state">
   <b><a href="#update-registration-state">#update-registration-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-update-registration-state">Install</a> <a href="#ref-for-update-registration-state①">(2)</a> <a href="#ref-for-update-registration-state②">(3)</a> <a href="#ref-for-update-registration-state③">(4)</a>
    <li><a href="#ref-for-update-registration-state④">Activate</a> <a href="#ref-for-update-registration-state⑤">(2)</a>
    <li><a href="#ref-for-update-registration-state⑥">Clear Registration</a> <a href="#ref-for-update-registration-state⑦">(2)</a> <a href="#ref-for-update-registration-state⑧">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="update-worker-state">
   <b><a href="#update-worker-state">#update-worker-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-update-worker-state">Install</a> <a href="#ref-for-update-worker-state①">(2)</a> <a href="#ref-for-update-worker-state②">(3)</a> <a href="#ref-for-update-worker-state③">(4)</a> <a href="#ref-for-update-worker-state④">(5)</a>
    <li><a href="#ref-for-update-worker-state⑤">Activate</a> <a href="#ref-for-update-worker-state⑥">(2)</a> <a href="#ref-for-update-worker-state⑦">(3)</a>
    <li><a href="#ref-for-update-worker-state⑧">Clear Registration</a> <a href="#ref-for-update-worker-state⑨">(2)</a> <a href="#ref-for-update-worker-state①⓪">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="notify-controller-change">
   <b><a href="#notify-controller-change">#notify-controller-change</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notify-controller-change">4.3.4. claim()</a>
    <li><a href="#ref-for-notify-controller-change①">Activate</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="match-service-worker-registration">
   <b><a href="#match-service-worker-registration">#match-service-worker-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-match-service-worker-registration">2.4. Selection and Use</a> <a href="#ref-for-match-service-worker-registration①">(2)</a> <a href="#ref-for-match-service-worker-registration②">(3)</a>
    <li><a href="#ref-for-match-service-worker-registration③">3.1.1. scriptURL</a>
    <li><a href="#ref-for-match-service-worker-registration④">3.4.2. ready</a>
    <li><a href="#ref-for-match-service-worker-registration⑤">3.4.4. getRegistration(clientURL)</a>
    <li><a href="#ref-for-match-service-worker-registration⑥">4.3.4. claim()</a>
    <li><a href="#ref-for-match-service-worker-registration⑦">Install</a>
    <li><a href="#ref-for-match-service-worker-registration⑧">Activate</a>
    <li><a href="#ref-for-match-service-worker-registration⑨">Handle Fetch</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="get-registration">
   <b><a href="#get-registration">#get-registration</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-get-registration">Register</a>
    <li><a href="#ref-for-get-registration①">Update</a>
    <li><a href="#ref-for-get-registration②">Unregister</a>
    <li><a href="#ref-for-get-registration③">Match Service Worker Registration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="get-newest-worker">
   <b><a href="#get-newest-worker">#get-newest-worker</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-get-newest-worker">3.2.7. update()</a>
    <li><a href="#ref-for-get-newest-worker①">Register</a>
    <li><a href="#ref-for-get-newest-worker②">Update</a>
    <li><a href="#ref-for-get-newest-worker③">Soft Update</a>
    <li><a href="#ref-for-get-newest-worker④">Install</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="service-worker-has-no-pending-events">
   <b><a href="#service-worker-has-no-pending-events">#service-worker-has-no-pending-events</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-service-worker-has-no-pending-events">Try Activate</a>
    <li><a href="#ref-for-service-worker-has-no-pending-events①">Try Clear Registration</a> <a href="#ref-for-service-worker-has-no-pending-events②">(2)</a> <a href="#ref-for-service-worker-has-no-pending-events③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-client">
   <b><a href="#create-client">#create-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-client">4.3.1. get(id)</a>
    <li><a href="#ref-for-create-client①">4.3.2. matchAll(options)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-window-client">
   <b><a href="#create-window-client">#create-window-client</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-window-client">4.2.8. focus()</a>
    <li><a href="#ref-for-create-window-client①">4.2.9. navigate(url)</a>
    <li><a href="#ref-for-create-window-client②">4.3.1. get(id)</a>
    <li><a href="#ref-for-create-window-client③">4.3.2. matchAll(options)</a>
    <li><a href="#ref-for-create-window-client④">4.3.3. openWindow(url)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="query-cache">
   <b><a href="#query-cache">#query-cache</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-query-cache">5.4.2. matchAll(request, options)</a>
    <li><a href="#ref-for-query-cache①">5.4.7. keys(request, options)</a>
    <li><a href="#ref-for-query-cache②">Batch Cache Operations</a> <a href="#ref-for-query-cache③">(2)</a> <a href="#ref-for-query-cache④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="batch-cache-operations">
   <b><a href="#batch-cache-operations">#batch-cache-operations</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-batch-cache-operations">5.4.4. addAll(requests)</a>
    <li><a href="#ref-for-batch-cache-operations①">5.4.5. put(request, response)</a>
    <li><a href="#ref-for-batch-cache-operations②">5.4.6. delete(request, options)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>